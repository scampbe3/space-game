{"version":3,"file":"main-f158bbe7.js","sources":["../../public/hud.js","../../public/material-utils.js","../../public/boss-head.js","../../public/boss-hand.js","../../public/boss-missiles.js","../../public/boss-andross.js","../../public/asteroids.js","../../public/player-ship.js","../../public/ally-ship.js","../../public/explosion-pool.js","../../public/laser-system.js","../../public/starfield.js","../../public/collision-system.js","../../public/diagnostics.js","../../public/enemy-system.js","../../public/frigate-enemy.js","../../public/behaviours.js","../../public/boss-system.js","../../public/pickup-system.js","../../public/platform-system.js","../../public/station-turret.js","../../public/bolt-pool.js","../../public/station-boss.js","../../public/asteroid-passage.js","../../public/libs/examples/jsm/controls/OrbitControls.js","../../public/libs/examples/jsm/controls/TransformControls.js","../../public/main.js"],"sourcesContent":["/* hud.js ─ score + hearts + burst meter (DOM mode + worker proxy) */\nconst isWorker = typeof document === 'undefined' || typeof window === 'undefined' || globalThis.__IS_RENDER_WORKER;\n\nlet hearts = 10;\nlet score  = 0;\nlet bombs  = 0;\nlet meterState = { fraction: 1, active: false, recharging: false, mode: 'boost' };\nlet bossHealth = null; // null ⇒ hidden; number 0–1 ⇒ show bar\nlet bossAltHealth = null;\n\nconst notifyHost = (isWorker && typeof self?.postMessage === 'function')\n  ? () => self.postMessage({ type: 'hud', state: { score, hearts, bombs, meter: meterState, boss: bossHealth, bossAlt: bossAltHealth } })\n  : null;\nconst HUD_METER_SEND_INTERVAL_MS = 1000 / 20;\nconst HUD_METER_EPSILON = 0.002;\nlet lastHudSent = null;\nlet lastHudSentAt = 0;\n\n/* DOM-backed HUD (main thread) */\nlet renderScore = () => {};\nlet renderMeter = () => {};\nlet renderBoss  = () => {};\n\nif (!isWorker) {\n  const hud = document.getElementById('hud');\n  const hudDisabled = typeof window !== 'undefined'\n    && (window.__EDITOR__ || new URLSearchParams(window.location.search).has('editor'));\n  if (!hud || hudDisabled) {\n    if (hud) hud.style.display = 'none';\n  } else {\n  hud.style.display = 'flex';\n  hud.style.flexDirection = 'column';\n  hud.style.gap = '4px';\n  hud.innerHTML = '';\n\n  let lastScoreText = '';\n  let lastBombText = '';\n  let lastMeterFraction = null;\n  let lastMeterColor = '';\n  let lastMeterShow = null;\n  const primaryBossState = { lastFraction: null, lastVisible: null };\n  const altBossState = { lastFraction: null, lastVisible: null };\n\n  const scoreLine = document.createElement('div');\n  scoreLine.style.font = '14px monospace';\n  scoreLine.style.color = '#0f0';\n  hud.appendChild(scoreLine);\n\n  const bombsMeterRow = document.createElement('div');\n  Object.assign(bombsMeterRow.style, {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '12px'\n  });\n\n  const bombsWrap = document.createElement('div');\n  Object.assign(bombsWrap.style, {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '6px'\n  });\n\n  const bombBadge = document.createElement('div');\n  Object.assign(bombBadge.style, {\n    width: '20px',\n    height: '20px',\n    borderRadius: '50%',\n    background: '#081a33',\n    border: '2px solid #d01f1f',\n    color: '#fff',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    font: '12px monospace',\n    lineHeight: '1'\n  });\n  bombBadge.textContent = 'B';\n\n  const bombCountLine = document.createElement('div');\n  Object.assign(bombCountLine.style, {\n    font: '12px monospace',\n    color: '#0f0',\n    letterSpacing: '0.04em'\n  });\n\n  bombsWrap.appendChild(bombBadge);\n  bombsWrap.appendChild(bombCountLine);\n\n  const meterWrap = document.createElement('div');\n  Object.assign(meterWrap.style, {\n    position: 'relative',\n    width: '140px',\n    height: '10px',\n    background: 'rgba(0,0,0,0.35)',\n    border: '1px solid #0f0',\n    borderRadius: '2px',\n    overflow: 'hidden',\n    opacity: '0',\n    transition: 'opacity 0.25s ease'\n  });\n  const meterFill = document.createElement('div');\n  Object.assign(meterFill.style, {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    bottom: 0,\n    width: '100%',\n    background: '#00a9ff',\n    transformOrigin: 'left center',\n    transform: 'scaleX(1)',\n    willChange: 'transform',\n    transition: 'transform 0.05s linear, background 0.1s ease'\n  });\n  meterWrap.appendChild(meterFill);\n  bombsMeterRow.appendChild(bombsWrap);\n  bombsMeterRow.appendChild(meterWrap);\n  hud.appendChild(bombsMeterRow);\n\n  const createBossBar = () => {\n    const bossWrap = document.createElement('div');\n    Object.assign(bossWrap.style, {\n      position: 'fixed',\n      top: '8px',\n      left: '50%',\n      transform: 'translateX(-50%)',\n      width: '60vw',\n      maxWidth: '640px',\n      height: '12px',\n      background: 'rgba(0,0,0,0.35)',\n      border: '1px solid #0f0',\n      borderRadius: '2px',\n      overflow: 'hidden',\n      opacity: '0',\n      transition: 'opacity 0.2s ease',\n      pointerEvents: 'none',\n      zIndex: 9999\n    });\n    const bossFill = document.createElement('div');\n    Object.assign(bossFill.style, {\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      bottom: 0,\n      width: '100%',\n      background: '#0f0',\n      transformOrigin: 'left center',\n      transform: 'scaleX(1)',\n      willChange: 'transform',\n      transition: 'transform 0.05s linear'\n    });\n    bossWrap.appendChild(bossFill);\n    document.body.appendChild(bossWrap);\n    return { bossWrap, bossFill };\n  };\n  const primaryBar = createBossBar();\n  const altBar = createBossBar();\n\n  renderScore = () => {\n    const nextText = `SCORE ${score}  ${'♥'.repeat(hearts)}`;\n    const nextBombText = `x ${bombs}`;\n    if (nextText !== lastScoreText) {\n      lastScoreText = nextText;\n      scoreLine.textContent = nextText;\n    }\n    if (nextBombText !== lastBombText) {\n      lastBombText = nextBombText;\n      bombCountLine.textContent = nextBombText;\n    }\n  };\n\n  renderMeter = () => {\n    const clamped = Math.max(0, Math.min(1, meterState.fraction));\n    const nextColor = meterState.recharging\n      ? '#00ff99'\n      : meterState.mode === 'brake'\n        ? '#f8a300'\n        : '#00a9ff';\n\n    if (lastMeterFraction === null || Math.abs(clamped - lastMeterFraction) > 0.001) {\n      meterFill.style.transform = `scaleX(${clamped})`;\n      lastMeterFraction = clamped;\n    }\n    if (nextColor !== lastMeterColor) {\n      meterFill.style.background = nextColor;\n      lastMeterColor = nextColor;\n    }\n\n    const show = meterState.active || meterState.recharging || clamped < 0.999;\n    if (show !== lastMeterShow) {\n      meterWrap.style.opacity = show ? '1' : '0';\n      lastMeterShow = show;\n    }\n  };\n\n  const renderBossBar = (bar, fraction, state) => {\n    if (fraction === null || fraction === undefined) {\n      if (state.lastVisible !== false) {\n        bar.bossWrap.style.opacity = '0';\n        state.lastVisible = false;\n      }\n      state.lastFraction = null;\n      return;\n    }\n    const clamped = Math.max(0, Math.min(1, fraction));\n    if (state.lastVisible !== true) {\n      bar.bossWrap.style.opacity = '1';\n      state.lastVisible = true;\n    }\n    if (state.lastFraction === null || Math.abs(clamped - state.lastFraction) > 0.001) {\n      bar.bossFill.style.transform = `scaleX(${clamped})`;\n      state.lastFraction = clamped;\n    }\n  };\n\n  renderBoss = () => {\n    renderBossBar(primaryBar, bossHealth, primaryBossState);\n    renderBossBar(altBar, bossAltHealth, altBossState);\n  };\n  }\n} else {\n  // worker mode: no DOM, just notify host when state changes\n  renderScore = () => {};\n  renderMeter = () => {};\n  renderBoss  = () => {};\n}\n\nfunction pushHudState() {\n  if (!notifyHost) return;\n  const meterFraction = typeof meterState.fraction === 'number' ? meterState.fraction : 0;\n  const meterActive = Boolean(meterState.active);\n  const meterRecharging = Boolean(meterState.recharging);\n  const meterMode = meterState.mode ?? 'boost';\n    const boss = bossHealth;\n    const bossAlt = bossAltHealth;\n  const now = (typeof performance !== 'undefined' && typeof performance.now === 'function')\n    ? performance.now()\n    : Date.now();\n\n  if (!lastHudSent) {\n    lastHudSent = {\n      score,\n      hearts,\n      bombs,\n      boss,\n      bossAlt,\n      meterFraction,\n      meterActive,\n      meterRecharging,\n      meterMode\n    };\n    lastHudSentAt = now;\n    notifyHost();\n    return;\n  }\n\n  const scoreChanged = score !== lastHudSent.score;\n  const heartsChanged = hearts !== lastHudSent.hearts;\n  const bombsChanged = bombs !== lastHudSent.bombs;\n  const bossChanged = !Object.is(boss, lastHudSent.boss);\n  const bossAltChanged = !Object.is(bossAlt, lastHudSent.bossAlt);\n  const meterFractionChanged = Math.abs(meterFraction - lastHudSent.meterFraction) > HUD_METER_EPSILON;\n  const meterActiveChanged = meterActive !== lastHudSent.meterActive;\n  const meterRechargingChanged = meterRecharging !== lastHudSent.meterRecharging;\n  const meterModeChanged = meterMode !== lastHudSent.meterMode;\n  const meterChanged = meterFractionChanged || meterActiveChanged || meterRechargingChanged || meterModeChanged;\n\n  if (!scoreChanged && !heartsChanged && !bombsChanged && !bossChanged && !bossAltChanged) {\n    if (!meterChanged) return;\n    if (now - lastHudSentAt < HUD_METER_SEND_INTERVAL_MS) return;\n  }\n\n  lastHudSent.score = score;\n  lastHudSent.hearts = hearts;\n  lastHudSent.bombs = bombs;\n  lastHudSent.boss = boss;\n  lastHudSent.bossAlt = bossAlt;\n  lastHudSent.meterFraction = meterFraction;\n  lastHudSent.meterActive = meterActive;\n  lastHudSent.meterRecharging = meterRecharging;\n  lastHudSent.meterMode = meterMode;\n  lastHudSentAt = now;\n  notifyHost();\n}\n\nrenderScore();\n\nexport function addScore(pts = 10) {\n  score += pts;\n  renderScore();\n  pushHudState();\n}\n\nexport function loseHeart() {\n  hearts = Math.max(0, hearts - 1);\n  renderScore();\n  pushHudState();\n  return hearts;\n}\n\nexport function gainHeart(amount = 1) {\n  hearts = Math.max(0, hearts + amount);\n  renderScore();\n  pushHudState();\n}\n\nexport function getScore() {\n  return score;\n}\n\nexport function setBombs(count = 0) {\n  bombs = Math.max(0, Math.floor(count));\n  renderScore();\n  pushHudState();\n}\n\nexport function addBombs(amount = 1) {\n  if (!Number.isFinite(amount)) return;\n  setBombs(bombs + amount);\n}\n\nexport function setBurstMeter(fraction = 1, { active = false, recharging = false, mode = 'boost' } = {}) {\n  meterState = { fraction: Math.max(0, Math.min(1, fraction)), active, recharging, mode };\n  renderMeter();\n  pushHudState();\n}\n\nexport function setBossHealth(fraction = null) {\n  bossHealth = (fraction === null || fraction === undefined) ? null : Math.max(0, Math.min(1, fraction));\n  renderBoss();\n  pushHudState();\n}\n\nexport function setBossHealthAlt(fraction = null) {\n  bossAltHealth = (fraction === null || fraction === undefined) ? null : Math.max(0, Math.min(1, fraction));\n  renderBoss();\n  pushHudState();\n}\n\nexport function syncHud(state = {}) {\n  let scoreDirty = false;\n  let bombsDirty = false;\n  let meterDirty = false;\n  let bossDirty = false;\n  let bossAltDirty = false;\n\n  if (typeof state.score === 'number' && state.score !== score) {\n    score = state.score;\n    scoreDirty = true;\n  }\n  if (typeof state.hearts === 'number' && state.hearts !== hearts) {\n    hearts = state.hearts;\n    scoreDirty = true;\n  }\n  if (typeof state.bombs === 'number' && state.bombs !== bombs) {\n    bombs = state.bombs;\n    bombsDirty = true;\n  }\n\n  if (state.meter) {\n    const nextFraction = Math.max(0, Math.min(1, state.meter.fraction ?? meterState.fraction));\n    const nextActive = Boolean(state.meter.active ?? meterState.active);\n    const nextRecharging = Boolean(state.meter.recharging ?? meterState.recharging);\n    const nextMode = state.meter.mode ?? meterState.mode;\n    const currentFraction = typeof meterState.fraction === 'number' ? meterState.fraction : 0;\n    const currentActive = Boolean(meterState.active);\n    const currentRecharging = Boolean(meterState.recharging);\n    const currentMode = meterState.mode ?? 'boost';\n    meterDirty = Math.abs(nextFraction - currentFraction) > HUD_METER_EPSILON\n      || nextActive !== currentActive\n      || nextRecharging !== currentRecharging\n      || nextMode !== currentMode;\n    if (meterDirty) {\n      meterState = {\n        fraction: nextFraction,\n        active: nextActive,\n        recharging: nextRecharging,\n        mode: nextMode\n      };\n    }\n  }\n\n  if (state.boss !== undefined) {\n    const nextBoss = (state.boss === null || state.boss === undefined)\n      ? null\n      : Math.max(0, Math.min(1, state.boss));\n    bossDirty = !Object.is(nextBoss, bossHealth);\n    if (bossDirty) {\n      bossHealth = nextBoss;\n    }\n  }\n  if (state.bossAlt !== undefined) {\n    const nextBossAlt = (state.bossAlt === null || state.bossAlt === undefined)\n      ? null\n      : Math.max(0, Math.min(1, state.bossAlt));\n    bossAltDirty = !Object.is(nextBossAlt, bossAltHealth);\n    if (bossAltDirty) {\n      bossAltHealth = nextBossAlt;\n    }\n  }\n\n  if (scoreDirty || bombsDirty) renderScore();\n  if (meterDirty) renderMeter();\n  if (bossDirty || bossAltDirty) renderBoss();\n}\n","import * as THREE from './libs/build/three.module.js';\n\nexport function toLambert(material) {\n  if (!material) return material;\n  if (Array.isArray(material)) return material.map(toLambert);\n  const lambert = new THREE.MeshLambertMaterial({\n    color: material.color ? material.color.clone() : new THREE.Color(0xffffff),\n    map: material.map ?? null,\n    emissive: material.emissive ? material.emissive.clone() : new THREE.Color(0x000000),\n    emissiveMap: material.emissiveMap ?? null,\n    emissiveIntensity: material.emissiveIntensity ?? 1,\n    transparent: material.transparent ?? false,\n    opacity: material.opacity ?? 1,\n    alphaTest: material.alphaTest ?? 0,\n    side: material.side ?? THREE.FrontSide,\n    depthWrite: material.depthWrite ?? true,\n    depthTest: material.depthTest ?? true,\n    fog: material.fog ?? true\n  });\n  if (material.vertexColors !== undefined) lambert.vertexColors = material.vertexColors;\n  if (material.skinning !== undefined) lambert.skinning = material.skinning;\n  if (material.morphTargets !== undefined) lambert.morphTargets = material.morphTargets;\n  if (material.morphNormals !== undefined) lambert.morphNormals = material.morphNormals;\n  return lambert;\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { setBossHealth } from './hud.js';\nimport { toLambert } from './material-utils.js';\n\n/**\n * initBossHead(scene, {\n *   modelPath,\n *   eyesPath,\n *   rig,\n *   boltPool,\n *   playerObj,\n *   railSpeed,\n *   summonWave   // callback to spawn enemies\n * })\n */\nexport async function initBossHead(scene, {\n  modelPath,\n  eyesPath = './models/boss_eyes.glb',\n  rig,\n  boltPool,\n  playerObj,\n  railSpeed = 35,\n  summonWave = () => {},\n  materialMode = 'standard'\n} = {}) {\n  const prepareMeshBounds = (root) => {\n    if (!root) return;\n    root.traverse(o => {\n      if (!o.isMesh || !o.geometry) return;\n      if (!o.geometry.boundingBox) o.geometry.computeBoundingBox();\n      if (!o.geometry.boundingSphere) o.geometry.computeBoundingSphere();\n    });\n  };\n\n  const loader = new GLTFLoader();\n  const root = (await loader.loadAsync(modelPath)).scene;\n  root.scale.setScalar(14);\n  root.visible = false;\n  rig.add(root);\n\n  const MAX_HP = 120;\n  let hp = MAX_HP;\n  let flashT = 0;\n  const meshList = [];\n  const eyesMeshList = [];\n  let eyesRoot = null;\n  let eyesBlinkIdx = -1;\n  let eyesBlinkTimer = 0;\n  const eyesBlinkPattern = [0.07, -0.05, 0.07, -0.05];\n  const tmpBox = new THREE.Box3();\n  const tmpSize = new THREE.Vector3();\n  const tmpCenter = new THREE.Vector3();\n  const tmpInv = new THREE.Matrix4();\n  const tmpSphere = new THREE.Sphere();\n  const useLambert = materialMode === 'lambert';\n  root.traverse(o => {\n    if (o.isMesh) {\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      meshList.push(o);\n    }\n  });\n  function setEmissive(list, r, g, b) {\n    list.forEach(m => m.material.emissive && m.material.emissive.setRGB(r, g, b));\n  }\n  function blink() {\n    flashT = 0.15;\n    setEmissive(meshList, 1, 0, 0);\n  }\n  function setEyesBlink(on) {\n    if (!eyesMeshList.length) return;\n    setEmissive(eyesMeshList, on ? 1 : 0, 0, 0);\n  }\n  function startEyesBlink() {\n    if (!eyesRoot) return;\n    eyesBlinkIdx = 0;\n    eyesBlinkTimer = Math.abs(eyesBlinkPattern[0]);\n    setEyesBlink(true);\n  }\n  function updateEyesBlink(dt) {\n    if (eyesBlinkIdx < 0) return;\n    eyesBlinkTimer -= dt;\n    if (eyesBlinkTimer > 0) return;\n    eyesBlinkIdx += 1;\n    if (eyesBlinkIdx >= eyesBlinkPattern.length) {\n      setEyesBlink(false);\n      eyesBlinkIdx = -1;\n      return;\n    }\n    const entry = eyesBlinkPattern[eyesBlinkIdx];\n    setEyesBlink(entry > 0);\n    eyesBlinkTimer = Math.abs(entry);\n  }\n  root.userData.enemy = true;\n  root.userData.enemyRoot = true;\n  root.userData.hp = MAX_HP;\n  root.userData.dead = false;\n  root.userData.blink = blink;\n  root.userData.meshes = meshList;\n  root.userData.androssPart = 'head';\n  root.userData.scoreValue = 5000;\n  root.userData.largeExplosion = true;\n  root.userData.damageFn = (amt = 1) => damage(amt);\n  root.userData.hitRadius = 12;\n  root.userData.blastRadius = 14;\n  root.userData.chargeRadius = 14; // for charge-shot direct hit\n\n  prepareMeshBounds(root);\n\n  if (eyesPath) {\n    try {\n      eyesRoot = (await loader.loadAsync(eyesPath)).scene;\n    } catch (err) {\n      console.warn('[boss-head] eyes load failed:', err);\n    }\n  }\n  if (eyesRoot) {\n    eyesRoot.traverse(o => {\n      if (o.isMesh) {\n        o.material = useLambert ? toLambert(o.material) : o.material.clone();\n        eyesMeshList.push(o);\n      }\n    });\n    root.add(eyesRoot);\n    prepareMeshBounds(eyesRoot);\n    root.updateWorldMatrix(true, true);\n    eyesRoot.updateWorldMatrix(true, true);\n    let eyesHitRadius = 2;\n    tmpBox.setFromObject(eyesRoot);\n    if (!tmpBox.isEmpty()) {\n      const localBox = tmpBox.clone().applyMatrix4(tmpInv.copy(eyesRoot.matrixWorld).invert());\n      localBox.getCenter(tmpCenter);\n      localBox.getSize(tmpSize);\n      localBox.expandByScalar(0.11);\n      localBox.getBoundingSphere(tmpSphere);\n      eyesHitRadius = tmpSphere.center.length() + tmpSphere.radius + 0.19;\n      eyesRoot.userData.hitBoxes = [localBox];\n    }\n    eyesRoot.userData.enemy = true;\n    eyesRoot.userData.enemyRoot = true;\n    eyesRoot.userData.androssPart = 'eyes';\n    eyesRoot.userData.androssOwner = root;\n    eyesRoot.userData.meshes = eyesMeshList;\n    eyesRoot.userData.blink = startEyesBlink;\n    eyesRoot.userData.scoreValue = root.userData.scoreValue;\n    eyesRoot.userData.largeExplosion = true;\n    eyesRoot.userData.damageFn = (amt = 1) => damageEyes(amt);\n    eyesRoot.userData.hitRadius = eyesHitRadius;\n    eyesRoot.userData.blastRadius = root.userData.blastRadius;\n    eyesRoot.userData.chargeRadius = eyesHitRadius;\n  }\n\n  // idle motion\n  let idleT = Math.random() * Math.PI * 2;\n\n  // attacks timers\n  let eyeSweepCd = 3;\n  let summonCd = Infinity; // disable summon/retreat for now\n  let sweeping = false;\n  let sweepT = 0;\n  let retreating = false;\n  let retreatT = 0;\n\n  const tmp = new THREE.Vector3();\n  const tmpHead = new THREE.Vector3();\n  const tmpQuat = new THREE.Quaternion();\n  const tmpQuatLook = new THREE.Quaternion();\n  const headForward = new THREE.Vector3(0, 0, 1);\n  const aimTarget = new THREE.Vector3();\n  const aimHistory = [];\n  const aimPool = [];\n  for (let i = 0; i < 24; i++) {\n    aimPool.push({ t: 0, pos: new THREE.Vector3() });\n  }\n  const tmpAimFallback = { t: 0, pos: new THREE.Vector3() };\n  const tmpHeadPos = new THREE.Vector3();\n  const tmpTarget = new THREE.Vector3();\n  const tmpDirL = new THREE.Vector3();\n  const tmpDirR = new THREE.Vector3();\n  const tmpDirToAim = new THREE.Vector3();\n  const fallbackForward = new THREE.Vector3(0, 0, -1);\n  let elapsed = 0;\n  let lastPlayerZ = 0;\n  const IDLE_PHASES = [\n    {\n      maxRatio: 0.33,\n      swayRadius: 14.5,\n      yAmp: 7.5,\n      yFreq: 0.65,\n      baseYFlow: 1.4,\n      speedBase: 5.4,\n      speedRange: 1.2,\n      speedLerp: 0.3,\n      changeMin: 2,\n      changeMax: 3\n    },\n\n        {\n      maxRatio: 0.66,\n      swayRadius: 10.875,\n      yAmp: 5.625,\n      yFreq: 0.4875,\n      baseYFlow: 1.05,\n      speedBase: 4.05,\n      speedRange: 0.9,\n      speedLerp: 0.3,\n      changeMin: 2,\n      changeMax: 3\n    },\n\n    {\n      maxRatio:   1.0,\n      swayRadius: 7.25,\n      yAmp: 3.75,\n      yFreq: 0.325,\n      baseYFlow: 0.7,\n      speedBase: 2.7,\n      speedRange: 0.6,\n      speedLerp: 0.3,\n      changeMin: 2,\n      changeMax: 3\n    }\n\n  ];\n  const getIdlePhase = ratio => IDLE_PHASES.find(p => ratio <= p.maxRatio) ?? IDLE_PHASES[IDLE_PHASES.length - 1];\n  let headSwayAngle = Math.PI / 4;\n  let swaySpeed = 0.8;\n  let targetSwaySpeed = 0.8;\n  let swayChangeTimer = 0;\n  const eyeOffsetL = new THREE.Vector3(3, 0, 0);\n  const eyeOffsetR = new THREE.Vector3(-3, 0, 0);\n  const eyeWorldL = new THREE.Vector3();\n  const eyeWorldR = new THREE.Vector3();\n  let aimInitialized = false;\n  const AIM_LAG = 6; // higher = snappier; lower = slower\n  const beamMat = new THREE.MeshBasicMaterial({ color: 0x00ffff, transparent: true, opacity: 0.35, blending: THREE.AdditiveBlending, depthWrite: false });\n  const BEAM_LEN = 80;\n  const beamGeo = new THREE.BoxGeometry(0.8, 0.8, BEAM_LEN);\n  beamGeo.translate(0, 0, BEAM_LEN * 0.5); // anchor origin at the back so it projects forward only\n  const eyeBeamL = new THREE.Mesh(beamGeo, beamMat.clone());\n  const eyeBeamR = new THREE.Mesh(beamGeo, beamMat.clone());\n  eyeBeamL.visible = eyeBeamR.visible = false;\n  scene.add(eyeBeamL, eyeBeamR);\n\n  function startEyeSweep() {\n    sweeping = true;\n    sweepT = 0;\n    eyeBeamL.visible = eyeBeamR.visible = true;\n  }\n\n  function stopEyeSweep() {\n    sweeping = false;\n    eyeBeamL.visible = eyeBeamR.visible = false;\n  }\n\n  function updateEyeBeams(dt) {\n    if (!sweeping) return;\n    sweepT += dt;\n    // positions from head eyes (keep offsets as-is)\n    root.updateMatrixWorld(true);\n    const headPos = root.getWorldPosition(tmpHeadPos);\n    eyeWorldL.copy(eyeOffsetL).applyQuaternion(root.quaternion).add(headPos);\n    eyeWorldR.copy(eyeOffsetR).applyQuaternion(root.quaternion).add(headPos);\n    tmpTarget.set(aimTarget.x, aimTarget.y, lastPlayerZ);\n\n    tmpDirL.copy(tmpTarget).sub(eyeWorldL);\n    const lookDirL = tmpDirL.lengthSq() > 1e-6 ? tmpDirL.normalize() : fallbackForward;\n    tmpQuat.setFromUnitVectors(headForward, lookDirL);\n    eyeBeamL.position.copy(eyeWorldL);\n    eyeBeamL.quaternion.copy(tmpQuat);\n\n    tmpDirR.copy(tmpTarget).sub(eyeWorldR);\n    const lookDirR = tmpDirR.lengthSq() > 1e-6 ? tmpDirR.normalize() : fallbackForward;\n    tmpQuat.setFromUnitVectors(headForward, lookDirR);\n    eyeBeamR.position.copy(eyeWorldR);\n    eyeBeamR.quaternion.copy(tmpQuat);\n\n    if (sweepT >= 3) stopEyeSweep();\n  }\n\n  function update(dt, tPlayer, allowFire = true, paused = false) {\n    if (!root.visible || root.userData.dead) return;\n    if (paused) return;\n\n    // flash decay\n    if (flashT > 0) {\n      flashT = Math.max(0, flashT - dt);\n      const e = flashT > 0 ? 1 : 0;\n      setEmissive(meshList, e, 0, 0);\n    }\n    updateEyesBlink(dt);\n\n    // idle motion (no lunges)\n    idleT += dt * 0.6;\n    const hpRatio = Math.max(0, Math.min(1, hp / MAX_HP));\n    const phase = getIdlePhase(hpRatio);\n    const baseY = 8 + Math.sin(idleT) * phase.baseYFlow;\n    swayChangeTimer -= dt;\n    if (swayChangeTimer <= 0) {\n      targetSwaySpeed = phase.speedBase + Math.random() * phase.speedRange;\n      swayChangeTimer = phase.changeMin + Math.random() * (phase.changeMax - phase.changeMin);\n    }\n    swaySpeed += (targetSwaySpeed - swaySpeed) * phase.speedLerp * dt;\n    headSwayAngle += swaySpeed * dt;\n    root.position.x = Math.cos(headSwayAngle) * phase.swayRadius;\n    root.position.y = baseY + Math.sin(headSwayAngle * phase.yFreq) * phase.yAmp;\n    root.position.z = 0;\n\n    // always face the player with a small lag (shared with beams)\n    const headPos = root.getWorldPosition(tmpHead);\n    const playerPos = playerObj.getWorldPosition(tmp);\n    if (!aimInitialized) { aimTarget.set(playerPos.x, playerPos.y, 0); aimInitialized = true; }\n    elapsed += dt;\n    lastPlayerZ = playerPos.z;\n    // record current player position (XY only) in history (maintain small window)\n    const sample = aimPool.pop() ?? { t: 0, pos: new THREE.Vector3() };\n    sample.t = elapsed;\n    sample.pos.set(playerPos.x, playerPos.y, 0);\n    aimHistory.push(sample);\n    const AIM_DELAY = 0.1; // seconds of intentional delay\n    const targetTime = elapsed - AIM_DELAY;\n    // prune old samples\n    while (aimHistory.length && aimHistory[0].t < targetTime - 0.1) {\n      const oldSample = aimHistory.shift();\n      if (oldSample) aimPool.push(oldSample);\n    }\n    // find samples around the delayed time for interpolation\n    let prev = aimHistory[0] ?? tmpAimFallback;\n    if (prev === tmpAimFallback) {\n      tmpAimFallback.t = elapsed;\n      tmpAimFallback.pos.set(playerPos.x, playerPos.y, 0);\n    }\n    let next = aimHistory[aimHistory.length - 1] ?? prev;\n    for (let i = 0; i < aimHistory.length - 1; i++) {\n      const a = aimHistory[i];\n      const b = aimHistory[i + 1];\n      if (a.t <= targetTime && b.t >= targetTime) {\n        prev = a; next = b; break;\n      }\n    }\n    const span = Math.max(1e-5, next.t - prev.t);\n    const alpha = THREE.MathUtils.clamp((targetTime - prev.t) / span, 0, 1);\n    aimTarget.copy(prev.pos).lerp(next.pos, alpha);\n    aimTarget.z = lastPlayerZ;\n    tmpDirToAim.copy(aimTarget).sub(headPos);\n    if (tmpDirToAim.lengthSq() > 1e-6) {\n      tmpDirToAim.normalize();\n      tmpQuatLook.setFromUnitVectors(headForward, tmpDirToAim);\n      root.quaternion.slerp(tmpQuatLook, 0.25);\n      root.updateMatrixWorld(true);\n    }\n\n    if (!allowFire && sweeping) {\n      stopEyeSweep();\n    }\n\n    // attacks\n    if (allowFire) {\n      eyeSweepCd -= dt;\n      if (eyeSweepCd <= 0 && !sweeping && !retreating) {\n        startEyeSweep();\n        eyeSweepCd = 5 + Math.random() * 3;\n      }\n    }\n\n    // retreat/summon disabled for now\n\n    if (allowFire) updateEyeBeams(dt);\n  }\n\n  function damage(amount = 1, { full = false, blinkHead = true } = {}) {\n    if (root.userData.dead) return false;\n    const scaled = full ? amount : amount * 0.5;\n    hp = Math.max(0, hp - scaled);\n    root.userData.hp = hp;\n    if (blinkHead) blink();\n    setBossHealth(hp / MAX_HP);\n    if (hp === 0) {\n      root.userData.dead = true;\n      root.visible = false;\n      stopEyeSweep();\n      setEyesBlink(false);\n      eyesBlinkIdx = -1;\n      setBossHealth(null);\n      return true;\n    }\n    return false;\n  }\n\n  function damageEyes(amount = 1) {\n    startEyesBlink();\n    return damage(amount, { full: true, blinkHead: false });\n  }\n\n  return {\n    update,\n    damage,\n    damageEyes,\n    isAlive: () => !root.userData.dead,\n    getMesh: () => root,\n    getEyes: () => eyesRoot,\n    getHP: () => hp,\n    startEyeSweep,\n    handleLaserHit: (amount = 1) => damage(amount),\n    getActiveBeams: () => [eyeBeamL, eyeBeamR],\n    getHpRatio: () => hp / MAX_HP\n  };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\n/**\n * initBossHand(scene, {\n *   modelPath,          // glb path (left/right specific)\n *   palmPath,           // optional glb path for critical palm hit mesh\n *   rig,                // parent Object3D that follows the rail\n *   side,               // 'left' | 'right'\n *   boltPool,           // shared bolt pool for power blasts\n *   playerObj,          // player mesh for targeting\n *   railSpeed           // units/s (for syncing motion if needed)\n * })\n * Returns { update(dt,tPlayer), damage(n), getMesh(), isAlive(), setDefense(flag) }\n */\nexport async function initBossHand(scene, {\n  modelPath,\n  palmPath = null,\n  rig,\n  side = 'left',\n  boltPool,\n  playerObj,\n  railSpeed = 35,\n  headMesh = null,\n  getHeadHpRatio = () => 1,\n  materialMode = 'standard'\n} = {}) {\n  const prepareMeshBounds = (root) => {\n    if (!root) return;\n    root.traverse(o => {\n      if (!o.isMesh || !o.geometry) return;\n      if (!o.geometry.boundingBox) o.geometry.computeBoundingBox();\n      if (!o.geometry.boundingSphere) o.geometry.computeBoundingSphere();\n    });\n  };\n\n  const loader = new GLTFLoader();\n  const root = (await loader.loadAsync(modelPath)).scene;\n  root.scale.setScalar(12);\n  root.visible = false;\n  rig.add(root);\n\n  // basic health & flash\n  const MAX_HP = 40;\n  let hp = MAX_HP;\n  let flashT = 0;\n  let palmRoot = null;\n  const palmMeshList = [];\n  let palmBlinkIdx = -1;\n  let palmBlinkTimer = 0;\n  const palmBlinkPattern = [0.07, -0.05, 0.07, -0.05];\n  const tmpBox = new THREE.Box3();\n  const tmpSize = new THREE.Vector3();\n  const tmpCenter = new THREE.Vector3();\n  const tmpInv = new THREE.Matrix4();\n  const tmpSphere = new THREE.Sphere();\n  let defense = false;\n\n  const useLambert = materialMode === 'lambert';\n  const meshList = [];\n  root.traverse(o => {\n    if (o.isMesh) {\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      meshList.push(o);\n    }\n  });\n  function setEmissive(list, r, g, b) {\n    list.forEach(m => m.material.emissive && m.material.emissive.setRGB(r, g, b));\n  }\n  function blink() {\n    flashT = 0.15;\n    setEmissive(meshList, 1, 0, 0);\n  }\n  function setPalmBlink(on) {\n    if (!palmMeshList.length) return;\n    setEmissive(palmMeshList, on ? 1 : 0, 0, 0);\n  }\n  function startPalmBlink() {\n    if (!palmRoot) return;\n    palmBlinkIdx = 0;\n    palmBlinkTimer = Math.abs(palmBlinkPattern[0]);\n    setPalmBlink(true);\n  }\n  function updatePalmBlink(dt) {\n    if (palmBlinkIdx < 0) return;\n    palmBlinkTimer -= dt;\n    if (palmBlinkTimer > 0) return;\n    palmBlinkIdx += 1;\n    if (palmBlinkIdx >= palmBlinkPattern.length) {\n      setPalmBlink(false);\n      palmBlinkIdx = -1;\n      return;\n    }\n    const entry = palmBlinkPattern[palmBlinkIdx];\n    setPalmBlink(entry > 0);\n    palmBlinkTimer = Math.abs(entry);\n  }\n\n  root.userData.enemy = true;\n  root.userData.enemyRoot = true;\n  root.userData.hp = MAX_HP;\n  root.userData.dead = false;\n  root.userData.blink = blink;\n  root.userData.meshes = meshList;\n  root.userData.androssPart = side === 'left' ? 'handL' : 'handR';\n  root.userData.scoreValue = 500;\n  root.userData.largeExplosion = true;\n  root.userData.damageFn = (amt = 1) => damage(amt);\n  root.userData.hitRadius = 8;\n  root.userData.blastRadius = 10;\n  root.userData.chargeRadius = 10; // direct charge impact\n  prepareMeshBounds(root);\n  if (palmPath) {\n    try {\n      palmRoot = (await loader.loadAsync(palmPath)).scene;\n    } catch (err) {\n      console.warn('[boss-hand] palm load failed:', err);\n    }\n  }\n  if (palmRoot) {\n    palmRoot.traverse(o => {\n      if (o.isMesh) {\n        o.material = useLambert ? toLambert(o.material) : o.material.clone();\n        palmMeshList.push(o);\n      }\n    });\n    root.add(palmRoot);\n    prepareMeshBounds(palmRoot);\n    root.updateWorldMatrix(true, true);\n    palmRoot.updateWorldMatrix(true, true);\n    let palmHitRadius = 2;\n    tmpBox.setFromObject(palmRoot);\n    if (!tmpBox.isEmpty()) {\n      const localBox = tmpBox.clone().applyMatrix4(tmpInv.copy(palmRoot.matrixWorld).invert());\n      localBox.getCenter(tmpCenter);\n      localBox.getSize(tmpSize);\n      localBox.expandByScalar(0.30);\n      localBox.getBoundingSphere(tmpSphere);\n      palmHitRadius = tmpSphere.center.length() + tmpSphere.radius + 0.50;\n      palmRoot.userData.hitBoxes = [localBox];\n    }\n    palmRoot.userData.enemy = true;\n    palmRoot.userData.enemyRoot = true;\n    palmRoot.userData.androssPart = side === 'left' ? 'palmL' : 'palmR';\n    palmRoot.userData.androssOwner = root;\n    palmRoot.userData.meshes = palmMeshList;\n    palmRoot.userData.blink = startPalmBlink;\n    palmRoot.userData.scoreValue = root.userData.scoreValue;\n    palmRoot.userData.largeExplosion = true;\n    palmRoot.userData.damageFn = (amt = 1) => damagePalm(amt);\n    palmRoot.userData.hitRadius = palmHitRadius;\n    palmRoot.userData.blastRadius = root.userData.blastRadius;\n    palmRoot.userData.chargeRadius = palmHitRadius;\n  }\n  root.updateWorldMatrix(true, true);\n  const worldBox = new THREE.Box3().setFromObject(root);\n  const inv = new THREE.Matrix4().copy(root.matrixWorld).invert();\n  const localBox = worldBox.clone().applyMatrix4(inv); // oriented AABB in hand-local space\n  const size = localBox.getSize(new THREE.Vector3());\n  const center = localBox.getCenter(new THREE.Vector3());\n  const scale = new THREE.Vector3(0.42, 0.42, 0.32); // tighter palm-ish box\n  const halfSize = size.multiply(scale).multiplyScalar(0.4);\n  const palmOffset = size.z * 0.12; // bias forward toward palm\n  center.z += palmOffset;\n  localBox.min.copy(center).sub(halfSize);\n  localBox.max.copy(center).add(halfSize);\n  root.userData.handCollider = { box: localBox };\n\n  // idle motion\n  let idleT = Math.random() * Math.PI * 2;\n  const anchorHistory = [];\n  const anchorPool = [];\n  for (let i = 0; i < 24; i++) {\n    anchorPool.push({ t: 0, pos: new THREE.Vector3() });\n  }\n  const tmpAnchorFallback = { t: 0, pos: new THREE.Vector3() };\n  let anchorElapsed = 0;\n  const headAnchorScratch = new THREE.Vector3();\n  const delayedHeadScratch = new THREE.Vector3();\n  const tmpAnchoredBase = new THREE.Vector3();\n  const tmpIdlePos = new THREE.Vector3();\n  const baseOffset = new THREE.Vector3(\n    side === 'left' ? -20 : 20,   // tuned spacing\n    -3,\n    3\n  );\n  const palmTiltDir = side === 'left' ? -1 : 1;\n  const getAnchorDelay = ratio => ratio <= 0.33 ? 0.0625 : ratio <= 0.66 ? 0.1 : 0.2;\n\n  // attack timers\n  let swipeCd = 3 + Math.random();\n  let blastCd = 4 + Math.random();\n  let swipeLungeT = 0;\n  let swipeDist = 0;\n  const swipeDir = new THREE.Vector3();\n  const swipeAxis = new THREE.Vector3(0, 1, 0);\n  let charging = false;\n  let chargeT = 0;\n  const SWIPE_DURATION = 1.2;\n  const SWIPE_DAMAGE_RADIUS2 = 9; // 3u\n\n  const tmp = new THREE.Vector3();\n  const tmpQuat = new THREE.Quaternion();\n  const tmpRootPos = new THREE.Vector3();\n  const tmpPlayerPos = new THREE.Vector3();\n  const tmpDirVec = new THREE.Vector3();\n  const tmpPlayerLocal = new THREE.Vector3();\n  const tmpHandLocal = new THREE.Vector3();\n  const tmpArcSide = new THREE.Vector3();\n  const tmpForwardRef = new THREE.Vector3(0, 0, 1);\n\n  function update(dt, tPlayer, allowFire = true, paused = false) {\n    if (!root.visible || root.userData.dead) return;\n    if (paused) return;\n\n    // fade emissive flash\n    if (flashT > 0) {\n      flashT = Math.max(0, flashT - dt);\n      const e = flashT > 0 ? 1 : 0;\n      setEmissive(meshList, e, 0, 0);\n    }\n    updatePalmBlink(dt);\n\n    // idle loop + face player (stay near base offset trailing the head)\n    idleT += dt * 0.9;\n    const currentHeadPos = headMesh ? headMesh.position : headAnchorScratch.set(0,0,0);\n    const sample = anchorPool.pop() ?? { t: 0, pos: new THREE.Vector3() };\n    sample.t = anchorElapsed;\n    sample.pos.copy(currentHeadPos);\n    anchorHistory.push(sample);\n    anchorElapsed += dt;\n    const ratio = getHeadHpRatio?.() ?? 1;\n    const delay = getAnchorDelay(ratio);\n    const targetTime = Math.max(0, anchorElapsed - delay);\n    while (anchorHistory.length > 1 && anchorHistory[0].t < targetTime - 0.3) {\n      const oldSample = anchorHistory.shift();\n      if (oldSample) anchorPool.push(oldSample);\n    }\n    let prevSample = anchorHistory[0] ?? tmpAnchorFallback;\n    if (prevSample === tmpAnchorFallback) {\n      tmpAnchorFallback.t = targetTime;\n      tmpAnchorFallback.pos.copy(currentHeadPos);\n    }\n    let nextSample = anchorHistory[anchorHistory.length - 1] ?? prevSample;\n    for (let i = 0; i < anchorHistory.length - 1; i++) {\n      const a = anchorHistory[i];\n      const b = anchorHistory[i + 1];\n      if (a.t <= targetTime && b.t >= targetTime) {\n        prevSample = a;\n        nextSample = b;\n        break;\n      }\n    }\n    const span = Math.max(1e-5, nextSample.t - prevSample.t);\n    const histAlpha = THREE.MathUtils.clamp((targetTime - prevSample.t) / span, 0, 1);\n    delayedHeadScratch.copy(prevSample.pos).lerp(nextSample.pos, histAlpha);\n    const loop = idleT * 1.1;\n    tmpAnchoredBase.copy(delayedHeadScratch).add(baseOffset);\n    tmpIdlePos.set(\n      tmpAnchoredBase.x + Math.cos(loop) * 1.0 + Math.sin(loop * 1.8) * 0.4,\n      tmpAnchoredBase.y + Math.sin(loop) * 0.8 + Math.sin(loop * 2.1) * 0.3,\n      tmpAnchoredBase.z + Math.sin(loop * 1.3) * 0.6\n    );\n    root.position.copy(tmpIdlePos);\n    // face palm toward player using +Z as forward\n    playerObj.getWorldPosition(tmpPlayerPos);\n    root.getWorldPosition(tmpRootPos);\n    tmpDirVec.copy(tmpPlayerPos).sub(tmpRootPos);\n    if (tmpDirVec.lengthSq() > 1e-6) {\n      tmpDirVec.normalize();\n    } else {\n      tmpDirVec.copy(tmpForwardRef);\n    }\n    root.quaternion.setFromUnitVectors(tmpForwardRef, tmpDirVec);\n    // rotate so thumbs face inward (90° roll toward center)\n    root.rotateY(side === 'left' ? Math.PI * 0.5 : -Math.PI * 0.5);\n    // mild idle tilt for life\n    root.rotateX(Math.sin(loop * 1.9) * 0.08);\n\n    if (!allowFire) {\n      swipeLungeT = 0;\n      if (charging) {\n        charging = false;\n        root.scale.setScalar(12);\n      }\n      return;\n    }\n\n    // swipe attack\n    swipeCd -= dt;\n    if (swipeCd <= 0 && swipeLungeT <= 0 && !defense) {\n      swipeLungeT = SWIPE_DURATION;\n      swipeCd = 4 + Math.random() * 2;\n      // compute swipe direction in rig space toward player\n      playerObj.getWorldPosition(tmp);\n      tmpPlayerLocal.copy(tmp);\n      rig.worldToLocal(tmpPlayerLocal);\n      tmpHandLocal.copy(root.position);\n      swipeDir.copy(tmpPlayerLocal).sub(tmpHandLocal).normalize();\n      swipeDist = Math.min(102, tmpPlayerLocal.distanceTo(tmpHandLocal));\n    }\n    if (swipeLungeT > 0) {\n      swipeLungeT -= dt;\n      const progress = 1 - swipeLungeT / SWIPE_DURATION;\n      const offset = Math.sin(progress * Math.PI) * swipeDist; // out and back\n      tmpArcSide.copy(swipeDir).cross(swipeAxis).setLength(8.5);\n      tmpArcSide.multiplyScalar(Math.sin(progress * Math.PI));\n      root.position.copy(tmpIdlePos).addScaledVector(swipeDir, offset).add(tmpArcSide);\n      // rotate palm toward/down at peak (hand-specific)\n      const tilt = Math.sin(progress * Math.PI) * (Math.PI * 0.5);\n      root.rotateZ(palmTiltDir * -tilt);\n      // damage check\n      playerObj.getWorldPosition(tmp);\n      root.getWorldPosition(tmpRootPos);\n      if (tmp.distanceToSquared(tmpRootPos) < SWIPE_DAMAGE_RADIUS2) {\n        playerObj.userData?.onHit?.(tmpRootPos); // optional hook\n      }\n    } else {\n      root.position.copy(tmpIdlePos);\n    }\n\n    // blast attack\n    blastCd -= dt;\n    if (blastCd <= 0 && !charging && !defense) {\n      charging = true;\n      chargeT = 0;\n    }\n    if (charging) {\n      chargeT += dt;\n      // simple charge telegraph: scale pulse\n      const s = 1 + Math.sin(chargeT * 12) * 0.05;\n      root.scale.setScalar(12 * s);\n      if (chargeT >= 1.0) {\n        // fire bolt toward player\n        if (boltPool) {\n          const handle = boltPool.alloc({ big: true, life: 1.5, dir: 1, bounced: false, scale: 2 });\n          if (handle) {\n            root.getWorldQuaternion(tmpQuat);\n            root.getWorldPosition(tmp);\n            // orient palm toward player\n            playerObj.getWorldPosition(tmpPlayerPos);\n            tmpDirVec.copy(tmpPlayerPos).sub(tmp);\n            if (tmpDirVec.lengthSq() > 1e-6) {\n              tmpDirVec.normalize();\n            } else {\n              tmpDirVec.copy(tmpForwardRef);\n            }\n            tmpQuat.setFromUnitVectors(tmpForwardRef, tmpDirVec);\n            boltPool.setTransform(handle, tmp, tmpQuat);\n          }\n        }\n        charging = false;\n        root.scale.setScalar(12);\n        blastCd = 4 + Math.random() * 2;\n      }\n    }\n  }\n\n  function damage(amount = 1, { full = false, blinkHand = true } = {}) {\n    if (root.userData.dead) return false;\n    const scaled = full ? amount : amount * 0.5;\n    hp = Math.max(0, hp - scaled);\n    root.userData.hp = hp;\n    if (blinkHand) blink();\n    if (hp === 0) {\n      root.userData.dead = true;\n      root.visible = false;\n      setPalmBlink(false);\n      palmBlinkIdx = -1;\n      return true;\n    }\n    return false;\n  }\n\n  function damagePalm(amount = 1) {\n    startPalmBlink();\n    return damage(amount, { full: true, blinkHand: false });\n  }\n\n  function setDefense(flag) {\n    defense = flag;\n  }\n\n  function setNoScore(flag = true) {\n    root.userData.noScore = Boolean(flag);\n  }\n\n  function forceRemove() {\n    if (root.userData.dead) return false;\n    root.userData.noScore = true;\n    root.userData.dead = true;\n    root.visible = false;\n    root.userData.lockRing && (root.userData.lockRing.visible = false);\n    return true;\n  }\n\n  return {\n    update,\n    damage,\n    damagePalm,\n    setDefense,\n    setNoScore,\n    forceRemove,\n    isAlive: () => !root.userData.dead,\n    getMesh: () => root,\n    getPalm: () => palmRoot,\n    getHP: () => hp,\n    handleLaserHit: (amount = 1) => damage(amount)\n  };\n}\n","import * as THREE from './libs/build/three.module.js';\n\nexport function createBossMissileSystem(scene, {\n  playerObj,\n  explosionPool,\n  headMesh,\n  poolSize = 12\n} = {}) {\n  const FORWARD = new THREE.Vector3(0, 1, 0);\n  const missiles = [];\n  const active = [];\n  const tmpV = new THREE.Vector3();\n  const tmpDir = new THREE.Vector3();\n  const tmpPrewarmPos = new THREE.Vector3();\n  const tmpPrewarmDir = new THREE.Vector3();\n  const burstQueue = [];\n  let burstTimer = 0;\n  const BURST_SPACING = 0.36;\n  let spawningEnabled = true;\n\n  function makeMissile() {\n    const group = new THREE.Group();\n    const bodyMat = new THREE.MeshPhongMaterial({ color: 0x888888, transparent: true, opacity: 0.7 });\n    const tipMat  = new THREE.MeshPhongMaterial({ color: 0xffaa66, transparent: true, opacity: 0.7 });\n    const finMat  = new THREE.MeshPhongMaterial({ color: 0xffaa66, transparent: true, opacity: 0.7 });\n    const glowMat = new THREE.MeshBasicMaterial({ color: 0xff2222, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending, depthWrite: false });\n\n    const body = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 3, 6), bodyMat);\n    body.position.y = 1;\n    const tip = new THREE.Mesh(new THREE.ConeGeometry(0.5, 1.2, 6), tipMat);\n    tip.position.y = 3;\n    const fin = new THREE.Mesh(new THREE.BoxGeometry(0.1, 1.2, 1.8), finMat);\n    fin.position.y = -0.2;\n    fin.rotation.y = Math.PI / 2;\n    const fin2 = fin.clone();\n    fin2.rotation.y = 0;\n    const exhaust = new THREE.Mesh(new THREE.SphereGeometry(0.4, 6, 6), glowMat);\n    exhaust.scale.set(0.5, 0.3, 1.5);\n    exhaust.position.y = -1.2;\n\n    group.add(body, tip, fin, fin2, exhaust);\n    group.visible = false;\n    group.userData = {\n      hp: 1,\n      blink: () => {},\n      dead: false,\n      enemy: true,\n      hitRadius: 1.2,\n      state: 'idle',\n      t: 0,\n      vel: new THREE.Vector3()\n    };\n    scene.add(group);\n    group.rotateX(-Math.PI * 0.5); // align cone tip to +Z\n    return group;\n  }\n\n  for (let i = 0; i < poolSize; i++) missiles.push(makeMissile());\n\n  function spawnBurst() {\n    if (!headMesh || !spawningEnabled) return;\n    headMesh.updateWorldMatrix(true, true);\n    const headPos = headMesh.getWorldPosition(new THREE.Vector3());\n    const offsets = [-9, -5, -2, 2, 5, 9];\n    offsets.forEach((ox, idx) => {\n      burstQueue.push({\n        ox,\n        dirSign: idx < offsets.length / 2 ? -1 : 1,\n        origin: headPos.clone()\n      });\n    });\n    burstTimer = 0;\n  }\n\n  function launchQueuedMissile(entry) {\n    if (!entry) return;\n    const m = missiles.find(mi => !mi.visible);\n    if (!m) return;\n    const { ox, dirSign, origin } = entry;\n    m.visible = true;\n    m.userData.dead = false;\n    m.userData.hp = 1;\n    m.userData.noScore = true;\n    m.userData.state = 'launch';\n    m.userData.t = 0;\n    m.userData.dirSign = dirSign;\n    m.userData.pastPlayer = false;\n    const spawnPos = origin.clone().add(new THREE.Vector3(ox, -4, 0));\n    m.position.copy(spawnPos);\n    m.userData.vel.set(0, -8, 0);\n    if (playerObj) {\n      const targetPos = playerObj.getWorldPosition(new THREE.Vector3());\n      const dir = targetPos.sub(m.position).normalize();\n      m.quaternion.setFromUnitVectors(FORWARD, dir);\n    } else {\n      m.quaternion.setFromUnitVectors(new THREE.Vector3(0, 0, -1), FORWARD);\n    }\n    active.push(m);\n  }\n\n  function destroyMissile(m) {\n    m.visible = false;\n    m.userData.dead = true;\n    explosionPool?.spawn(m.position);\n  }\n\n  function clearAll() {\n    burstQueue.length = 0;\n    active.forEach(m => { m.visible = false; m.userData.dead = true; });\n    active.length = 0;\n  }\n\n  function update(dt, player) {\n    for (let i = active.length - 1; i >= 0; i--) {\n      const m = active[i];\n      if (!m.visible) { active.splice(i,1); continue; }\n      const ud = m.userData;\n      ud.t += dt;\n      const playerPos = player.getWorldPosition(tmpV);\n\n      if (ud.state === 'launch' && ud.t > 0.35) {\n        ud.state = 'arc';\n      } else if (ud.state === 'arc' && ud.t > 0.8) {\n        ud.state = 'home';\n      }\n\n      if (ud.state === 'launch') {\n        // initial drop\n        m.userData.vel.set(0, -20, 10);\n      } else if (!ud.pastPlayer) {\n        // steer toward player after the drop/arc phase\n        tmpDir.subVectors(playerPos, m.position).normalize();\n        const targetVel = tmpDir.multiplyScalar(42); // faster homing to visibly track the player\n        // stronger steering so path clearly curves toward the player\n        m.userData.vel.lerp(targetVel, 0.65);\n      }\n\n      m.position.addScaledVector(m.userData.vel, dt);\n\n      // orient nose toward player for visual alignment (even after passing the player)\n      tmpDir.subVectors(playerPos, m.position);\n      if (tmpDir.lengthSq() > 1e-6) {\n        tmpDir.normalize();\n        m.quaternion.setFromUnitVectors(FORWARD, tmpDir);\n      }\n\n      // once a missile crosses the player's plane, stop steering so it doesn't curl back\n      if (!ud.pastPlayer && m.position.z >= playerPos.z) {\n        ud.pastPlayer = true;\n      }\n\n      // out-of-range cleanup\n      if (m.position.distanceToSquared(playerPos) < (m.userData.hitRadius + 1.2) ** 2) {\n        destroyMissile(m);\n        player.userData?.onHit?.(m.position);\n        active.splice(i,1);\n        continue;\n      }\n      if (m.position.z > playerPos.z + 20) {\n        m.visible = false;\n        active.splice(i,1);\n      }\n    }\n\n    processBurstQueue(dt);\n  }\n\n  function processBurstQueue(dt) {\n    if (!burstQueue.length) return;\n    burstTimer -= dt;\n    while (burstQueue.length && burstTimer <= 0) {\n      const entry = burstQueue.shift();\n      launchQueuedMissile(entry);\n      burstTimer += BURST_SPACING;\n    }\n  }\n\n  function getActiveShips() {\n    return active.filter(m => m.visible && !m.userData.dead);\n  }\n\n  function setSpawning(flag) {\n    spawningEnabled = flag;\n    if (!flag) {\n      burstQueue.length = 0;\n      clearAll();\n    }\n  }\n\n  function prewarm(renderer, camera, { layer = null } = {}) {\n    if (!renderer || !camera || missiles.length === 0) return;\n    const m = missiles[0];\n    const prev = {\n      visible: m.visible,\n      position: m.position.clone(),\n      quaternion: m.quaternion.clone(),\n      layerMask: m.layers.mask\n    };\n    const prevCulls = [];\n    m.visible = true;\n    if (typeof layer === 'number') {\n      m.layers.set(layer);\n    }\n    camera.getWorldPosition(tmpPrewarmPos);\n    camera.getWorldDirection(tmpPrewarmDir);\n    m.position.copy(tmpPrewarmPos).addScaledVector(tmpPrewarmDir, 25);\n    m.quaternion.copy(camera.quaternion);\n    m.traverse(o => {\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    renderer.render(scene, camera);\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    m.visible = prev.visible;\n    m.position.copy(prev.position);\n    m.quaternion.copy(prev.quaternion);\n    m.layers.mask = prev.layerMask;\n  }\n\n  return { spawnBurst, update, getActiveShips, setSpawning, clearAll, prewarm };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { initBossHead } from './boss-head.js';\nimport { initBossHand } from './boss-hand.js';\nimport { createBossMissileSystem } from './boss-missiles.js';\nimport { setBossHealth } from './hud.js';\n\n/**\n * initBossAndross(scene, {\n *   playerObj,\n *   boltPool,\n *   railSpeed,\n *   summonWave // function to spawn a small wave (optional)\n *   canFire,   // optional predicate to gate attacks\n *   onHeadDestroyed, // callback when head is defeated\n *   handCleanupDelay // ms delay before removing hands\n * })\n */\nexport async function initBossAndross(scene, {\n  playerObj,\n  boltPool,\n  railSpeed = 35,\n  summonWave = () => {},\n  spawnZ = -1200,\n  explosionPool = null,\n  canFire = null,\n  onHeadDestroyed = null,\n  handCleanupDelay = 300,\n  materialMode = 'standard',\n  onDialogue = null\n} = {}) {\n  const rig = new THREE.Object3D();\n  scene.add(rig);\n\n  const head = await initBossHead(scene, {\n    modelPath: './models/boss_head.glb',\n    rig,\n    boltPool,\n    playerObj,\n    railSpeed,\n    summonWave,\n    materialMode\n  });\n\n\n  const getHeadHpRatio = () => head.getHpRatio ? head.getHpRatio() : 1;\n  const headMesh = head.getMesh();\n  const leftHand = await initBossHand(scene, {\n    modelPath: './models/boss_left_hand.glb',\n    palmPath: './models/boss_left_palm.glb',\n    rig,\n    side: 'left',\n    boltPool,\n    playerObj,\n    railSpeed,\n    headMesh,\n    getHeadHpRatio,\n    materialMode\n  });\n\n  const rightHand = await initBossHand(scene, {\n    modelPath: './models/boss_right_hand.glb',\n    palmPath: './models/boss_right_palm.glb',\n    rig,\n    side: 'right',\n    boltPool,\n    playerObj,\n    railSpeed,\n    headMesh,\n    getHeadHpRatio,\n    materialMode\n  });\n\n  const missileSystem = createBossMissileSystem(scene, {\n    playerObj,\n    explosionPool,\n    headMesh\n  });\n  let missileCd = 4;\n  let missileMuted = false;\n  let headDefeated = false;\n  let handCleanupScheduled = false;\n  let phase2Dialogue = false;\n  let phase3Dialogue = false;\n\n  const emitDialogue = (payload) => {\n    if (typeof onDialogue === 'function') {\n      onDialogue(payload);\n    } else if (typeof globalThis?.postMessage === 'function' && globalThis.__IS_RENDER_WORKER) {\n      globalThis.postMessage({ type: 'dialogue', payload });\n    }\n  };\n\n  // health bars: only head uses HUD bar; integrate externally\n\n  rig.visible = false;\n  rig.position.set(0, 0, spawnZ);\n  let active = false;\n  let activeStartT = 0;\n  let baseZ = spawnZ;\n\n  // defense trigger: when head takes burst damage in a short window\n  let recentDamage = 0;\n  let damageWindow = 0;\n  const DAMAGE_WINDOW_TIME = 2.0;\n  const BURST_THRESHOLD = 8;\n\n  function onHeadDamaged(amount) {\n    recentDamage += amount;\n    damageWindow = DAMAGE_WINDOW_TIME;\n  }\n\n  function activate(tPlayer = 0) {\n    active = true;\n    activeStartT = tPlayer;\n    baseZ = spawnZ;\n    rig.visible = true;\n    [head, leftHand, rightHand].forEach(p => p.getMesh().visible = true);\n    setBossHealth(getHeadHpRatio());\n    leftHand.setNoScore?.(false);\n    rightHand.setNoScore?.(false);\n    headDefeated = false;\n    handCleanupScheduled = false;\n    missileCd = 4;\n    missileSystem.setSpawning?.(true);\n    missileMuted = false;\n    phase2Dialogue = false;\n    phase3Dialogue = false;\n  }\n\n  function deactivate() {\n    active = false;\n    rig.visible = false;\n    [head, leftHand, rightHand].forEach(p => p.getMesh().visible = false);\n    setBossHealth(null);\n  }\n\n  function update(dt, tPlayer, playerZ = null, paused = false) {\n    if (!active) return;\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n    // keep offset ahead of player; mirror frigate behavior\n    if (playerZ !== null) {\n      rig.position.z = playerZ - 60; // 80 units in front of player\n    } else {\n      rig.position.z = baseZ;\n    }\n    if (paused) return;\n\n    if (damageWindow > 0) {\n      damageWindow -= dt;\n      if (damageWindow <= 0) recentDamage = 0;\n    }\n\n    // defense mode trigger\n    if (recentDamage >= BURST_THRESHOLD) {\n      const defender = leftHand.isAlive() ? leftHand : rightHand;\n      const idle = rightHand.isAlive() && defender === leftHand ? rightHand : null;\n      defender?.setDefense(true);\n      if (idle) idle.setDefense(false);\n      recentDamage = 0;\n      damageWindow = 0;\n    } else {\n      leftHand.setDefense(false);\n      rightHand.setDefense(false);\n    }\n\n    head.update(dt, tPlayer, allowFire, false);\n    leftHand.update(dt, tPlayer, allowFire, false);\n    rightHand.update(dt, tPlayer, allowFire, false);\n\n    const hpRatio = getHeadHpRatio();\n    if (!phase2Dialogue && hpRatio <= 0.66) {\n      phase2Dialogue = true;\n      emitDialogue({\n        id: 'boss-phase-66',\n        portraitSrc: './textures/boss.png',\n        textLines: ['I will crush you like a bug.']\n      });\n    }\n    if (!phase3Dialogue && hpRatio <= 0.33) {\n      phase3Dialogue = true;\n      emitDialogue({\n        id: 'boss-phase-33',\n        portraitSrc: './textures/boss.png',\n        textLines: ['To Oblivion, then.']\n      });\n    }\n\n    if (head.isAlive() && allowFire) {\n      if (missileMuted) {\n        missileSystem.setSpawning?.(true);\n        missileMuted = false;\n      }\n      missileCd -= dt;\n      if (missileCd <= 0) {\n        missileSystem.spawnBurst();\n        missileCd = 6 + Math.random() * 3;\n      }\n      missileSystem.update(dt, playerObj);\n    } else if (!missileMuted) {\n      missileSystem.setSpawning?.(false);\n      missileSystem.clearAll?.();\n      missileMuted = true;\n    }\n  }\n\n  function damageHead(amount, { critical = false } = {}) {\n    const actual = critical ? amount : amount * 0.5;\n    const dead = critical && head.damageEyes ? head.damageEyes(amount) : head.damage(amount);\n    if (dead) {\n      if (!headDefeated) {\n        headDefeated = true;\n        leftHand.setDefense(false);\n        rightHand.setDefense(false);\n        leftHand.setNoScore?.(true);\n        rightHand.setNoScore?.(true);\n        missileSystem.setSpawning?.(false);\n        missileSystem.clearAll?.();\n        active = false; // stop updates/collisions, keep rig visible briefly\n        if (!handCleanupScheduled) {\n          handCleanupScheduled = true;\n          const doCleanup = () => {\n            leftHand.forceRemove?.();\n            rightHand.forceRemove?.();\n            deactivate();\n          };\n          if (handCleanupDelay <= 0) doCleanup();\n          else setTimeout(doCleanup, handCleanupDelay);\n        }\n        if (typeof onHeadDestroyed === 'function') onHeadDestroyed();\n      }\n    } else {\n      onHeadDamaged(actual);\n    }\n    return dead;\n  }\n\n  function damageHand(which, amount, { critical = false } = {}) {\n    const hand = which === 'left' ? leftHand : rightHand;\n    if (critical && hand.damagePalm) return hand.damagePalm(amount);\n    return hand.damage(amount);\n  }\n\n  const bindDamageFns = () => {\n    const headRoot = head.getMesh();\n    const eyesRoot = head.getEyes?.();\n    const leftRoot = leftHand.getMesh();\n    const leftPalm = leftHand.getPalm?.();\n    const rightRoot = rightHand.getMesh();\n    const rightPalm = rightHand.getPalm?.();\n    if (headRoot?.userData) {\n      headRoot.userData.damageFn = (amt = 1) => damageHead(amt);\n    }\n    if (eyesRoot?.userData) {\n      eyesRoot.userData.damageFn = (amt = 1) => damageHead(amt, { critical: true });\n    }\n    if (leftRoot?.userData) {\n      leftRoot.userData.damageFn = (amt = 1) => damageHand('left', amt);\n    }\n    if (leftPalm?.userData) {\n      leftPalm.userData.damageFn = (amt = 1) => damageHand('left', amt, { critical: true });\n    }\n    if (rightRoot?.userData) {\n      rightRoot.userData.damageFn = (amt = 1) => damageHand('right', amt);\n    }\n    if (rightPalm?.userData) {\n      rightPalm.userData.damageFn = (amt = 1) => damageHand('right', amt, { critical: true });\n    }\n  };\n  bindDamageFns();\n\n  function getEnemyParts() {\n    const parts = [];\n    if (!active) return parts;\n    if (head.isAlive()) {\n      const eyes = head.getEyes?.();\n      if (eyes) parts.push(eyes);\n      parts.push(head.getMesh());\n    }\n    if (leftHand.isAlive()) {\n      const palm = leftHand.getPalm?.();\n      if (palm) parts.push(palm);\n      parts.push(leftHand.getMesh());\n    }\n    if (rightHand.isAlive()) {\n      const palm = rightHand.getPalm?.();\n      if (palm) parts.push(palm);\n      parts.push(rightHand.getMesh());\n    }\n    const missiles = missileSystem.getActiveShips?.();\n    if (missiles?.length) parts.push(...missiles);\n    return parts;\n  }\n\n  function handleLaserHit(mesh, amount = 1) {\n    if (mesh === head.getMesh()) return damageHead(amount);\n    if (mesh === head.getEyes?.()) return damageHead(amount, { critical: true });\n    if (mesh === leftHand.getMesh()) return damageHand('left', amount);\n    if (mesh === leftHand.getPalm?.()) return damageHand('left', amount, { critical: true });\n    if (mesh === rightHand.getMesh()) return damageHand('right', amount);\n    if (mesh === rightHand.getPalm?.()) return damageHand('right', amount, { critical: true });\n    return false;\n  }\n\n  function prewarm(renderer, camera) {\n    if (!renderer || !camera) return;\n    const PREWARM_LAYER = 2;\n    const prevTarget = renderer.getRenderTarget();\n    const prevCameraMask = camera.layers.mask;\n    const prevVis = rig.visible;\n    rig.visible = true;\n    const prevCulls = [];\n    const prevBeams = [];\n    const prevParts = [];\n    const prevLayers = [];\n    const prevLightLayers = [];\n    rig.traverse(o => {\n      prevLayers.push([o, o.layers.mask]);\n      o.layers.set(PREWARM_LAYER);\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    scene.traverse(o => {\n      if (o.isLight) {\n        prevLightLayers.push([o, o.layers.mask]);\n        o.layers.enable(PREWARM_LAYER);\n      }\n    });\n    head.getMesh().visible = true;\n    leftHand.getMesh().visible = true;\n    rightHand.getMesh().visible = true;\n    const eyes = head.getEyes?.();\n    if (eyes) {\n      prevParts.push([eyes, eyes.visible]);\n      eyes.visible = true;\n    }\n    const leftPalm = leftHand.getPalm?.();\n    if (leftPalm) {\n      prevParts.push([leftPalm, leftPalm.visible]);\n      leftPalm.visible = true;\n    }\n    const rightPalm = rightHand.getPalm?.();\n    if (rightPalm) {\n      prevParts.push([rightPalm, rightPalm.visible]);\n      rightPalm.visible = true;\n    }\n    const beams = head.getActiveBeams?.() ?? [];\n    if (camera && beams.length) {\n      const tmpPos = new THREE.Vector3();\n      const tmpDir = new THREE.Vector3();\n      camera.getWorldPosition(tmpPos);\n      camera.getWorldDirection(tmpDir);\n      beams.forEach(beam => {\n        if (!beam) return;\n        prevBeams.push([\n          beam,\n          beam.visible,\n          beam.position.clone(),\n          beam.quaternion.clone(),\n          beam.frustumCulled,\n          beam.layers.mask\n        ]);\n        beam.visible = true;\n        beam.frustumCulled = false;\n        beam.layers.set(PREWARM_LAYER);\n        beam.position.copy(tmpPos).addScaledVector(tmpDir, 30);\n        beam.quaternion.copy(camera.quaternion);\n      });\n    }\n    camera.layers.set(PREWARM_LAYER);\n    const rt = new THREE.WebGLRenderTarget(1, 1);\n    if ('outputColorSpace' in renderer && renderer.outputColorSpace) {\n      rt.texture.colorSpace = renderer.outputColorSpace;\n    }\n    renderer.setRenderTarget(rt);\n    renderer.render(scene, camera);\n    missileSystem.prewarm?.(renderer, camera, { layer: PREWARM_LAYER });\n    renderer.setRenderTarget(prevTarget);\n    rt.dispose();\n    rig.visible = prevVis;\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    prevParts.forEach(([root, vis]) => { root.visible = vis; });\n    prevBeams.forEach(([beam, vis, pos, quat, culled, mask]) => {\n      beam.visible = vis;\n      beam.position.copy(pos);\n      beam.quaternion.copy(quat);\n      beam.frustumCulled = culled;\n      beam.layers.mask = mask;\n    });\n    prevLayers.forEach(([o, mask]) => { o.layers.mask = mask; });\n    prevLightLayers.forEach(([o, mask]) => { o.layers.mask = mask; });\n    camera.layers.mask = prevCameraMask;\n  }\n\n  return {\n    update,\n    damageHead,\n    damageHand,\n    getEnemyParts,\n    handleLaserHit,\n    activate,\n    deactivate,\n    getRig: () => rig,\n    getHead: () => head,\n    getHands: () => [leftHand, rightHand],\n    getMissiles: () => missileSystem,\n    prewarm\n  };\n}\n","/*  asteroids.js\n    --------------------------------------------------\n    Usage:\n      import { initAsteroids } from './asteroids.js';\n      const { update } = await initAsteroids(scene, spawnArray);\n      // call update(dt) each frame\n*/\n\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\n/* deterministic asteroid presets to avoid per-spawn random math */\nconst ASTEROID_TYPES = [\n  { name: 'small',  scale: 1.4,  spin: [0.18, 0.22, 0.16], rot: [0.3, 0.8, 0.1] },\n  { name: 'medium', scale: 3.0,  spin: [0.14, 0.18, 0.12], rot: [0.7, 1.2, 0.4] },\n  { name: 'large',  scale: 4.6,  spin: [0.10, 0.14, 0.10], rot: [1.1, 0.2, 0.9] },\n  { name: 'flat',   scale: 2.2,  spin: [0.12, 0.20, 0.08], rot: [0.5, 0.3, 1.0] }\n];\n\n/**\n * Loads a GLB rock once, clones it for every entry in spawnArray,\n * adds them to the scene, and returns an update(dt) function.\n *\n * @param {THREE.Scene} scene\n * @param {Array<{x:number,y:number,z:number}>} spawnArray\n * @param {string} modelPath  default './models/asteroid.glb'\n */\nexport async function initAsteroids(scene, spawnArray, modelPath = './models/asteroid.glb', {\n  materialMode = 'standard'\n} = {}) {\n  if (!Array.isArray(spawnArray) || spawnArray.length === 0) {\n    return { update: () => {} };           // nothing to do\n  }\n\n  const rockSrc = (await new GLTFLoader().loadAsync(modelPath)).scene;\n  const useLambert = materialMode === 'lambert';\n  if (useLambert) {\n    rockSrc.traverse(o => {\n      if (o.isMesh) {\n        o.material = toLambert(o.material);\n      }\n    });\n  } else {\n    rockSrc.traverse(o => {\n      if (o.isMesh) {\n        o.material = o.material.clone();\n      }\n    });\n  }\n  const group   = new THREE.Group();\n  scene.add(group);\n\n  function pickType(cfg) {\n    if (cfg.type) {\n      const found = ASTEROID_TYPES.find(t => t.name === cfg.type);\n      if (found) return found;\n    }\n    return ASTEROID_TYPES[1]; // default \"medium\" if not specified\n  }\n\n  spawnArray.forEach((cfg) => {\n    const rock = rockSrc.clone(true);\n    const preset = pickType(cfg);\n    rock.scale.setScalar(preset.scale);\n    rock.position.set(cfg.x, cfg.y, cfg.z);\n    rock.rotation.set(preset.rot[0], preset.rot[1], preset.rot[2]);\n    rock.userData.asteroid = true;\n    rock.userData.editorRef = cfg;\n    rock.userData.editorGroup = 'asteroid';\n    rock.userData.spin = new THREE.Vector3(preset.spin[0], preset.spin[1], preset.spin[2]);\n    rock.frustumCulled = false;\n    group.add(rock);\n  });\n\n  /* update all rocks each frame */\n  const camPos = new THREE.Vector3();\n  const RENDER_DIST = 200;            // tweak to taste\n\n  function update(dt, camera) {\n    if (camera) camera.getWorldPosition(camPos);\n    for (let i = group.children.length - 1; i >= 0; i--) {\n      const r = group.children[i];\n      if (r.userData.dead) {\n        group.children.splice(i, 1);\n        continue;\n      }\n      const s = r.userData.spin;\n      r.rotation.x += s.x * dt;\n      r.rotation.y += s.y * dt;\n      r.rotation.z += s.z * dt;\n\n\nr.visible = r.position.distanceToSquared(camPos) < RENDER_DIST*RENDER_DIST;\n\n/* hard-remove if rock fell 25 u behind camera */\nif (r.position.z > camPos.z + 25) {\n  r.visible       = false;\n      r.userData.dead = true;\n    }\n\n\n    }\n  }\n\n  return { group, update };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\n/**\n * initPlayerShip(parent)\n * ▸ loads player_starfighter_body_only.glb (body) + optional wing GLBs\n * ▸ adds them to parent\n * ▸ returns { mesh, radius, update(dx,dy,dt) }\n */\nexport async function initPlayerShip(parent, {\n  path = './models/player_starfighter_body_only.glb',\n  wingLeftPath = './models/player_starfighter_l_wing_only.glb',\n  wingRightPath = './models/player_starfighter_r_wing_only.glb',\n  fallbackColour = 0x00aaff,\n  scene = null,                  // optional, for world-space trail\n  explosionPool = null,          // optional, for wing break FX\n  materialMode = 'standard'\n} = {}) {\n\n  /* 1 ─ load model */\n  const loader = new GLTFLoader();\n  const mesh = new THREE.Object3D();\n  parent.add(mesh);\n\n  const loadModel = async (modelPath) => {\n    if (!modelPath) return null;\n    try {\n      return (await loader.loadAsync(modelPath)).scene;\n    } catch {\n      return null;\n    }\n  };\n\n  const fallbackModel = () => new THREE.Mesh(\n    new THREE.BoxGeometry(5, 2, 10),\n    new THREE.MeshStandardMaterial({ color: fallbackColour })\n  );\n\n  const tmpBox = new THREE.Box3();\n  const tmpMatrix = new THREE.Matrix4();\n  const tmpVec = new THREE.Vector3();\n  const tmpSizeVec = new THREE.Vector3();\n\n  const collectMeshes = (root) => {\n    const list = [];\n    if (!root) return list;\n    root.traverse(node => {\n      if (node.isMesh) list.push(node);\n    });\n    return list;\n  };\n\n  const computeLocalBounds = (root) => {\n    const box = new THREE.Box3();\n    if (!root) return box;\n    root.updateMatrixWorld(true);\n    const inv = tmpMatrix.copy(root.matrixWorld).invert();\n    root.traverse(node => {\n      if (!node.isMesh || !node.geometry) return;\n      if (!node.geometry.boundingBox) node.geometry.computeBoundingBox();\n      if (!node.geometry.boundingBox) return;\n      tmpBox.copy(node.geometry.boundingBox);\n      tmpBox.applyMatrix4(node.matrixWorld);\n      tmpBox.applyMatrix4(inv);\n      box.union(tmpBox);\n    });\n    return box;\n  };\n\n  const computeNoseTipZ = (root, bounds, center) => {\n    if (!root || !bounds || bounds.isEmpty()) return null;\n    const size = bounds.getSize(tmpSizeVec);\n    const xLimit = size.x * 0.22;\n    const yLimit = size.y * 0.22;\n    const zSamples = [];\n    root.updateMatrixWorld(true);\n    const inv = tmpMatrix.copy(root.matrixWorld).invert();\n    root.traverse(node => {\n      if (!node.isMesh || !node.geometry) return;\n      const pos = node.geometry.getAttribute('position');\n      if (!pos) return;\n      const step = Math.max(1, Math.floor(pos.count / 4000));\n      for (let i = 0; i < pos.count; i += step) {\n        tmpVec.set(pos.getX(i), pos.getY(i), pos.getZ(i));\n        tmpVec.applyMatrix4(node.matrixWorld);\n        tmpVec.applyMatrix4(inv);\n        if (Math.abs(tmpVec.x - center.x) > xLimit) continue;\n        if (Math.abs(tmpVec.y - center.y) > yLimit) continue;\n        zSamples.push(tmpVec.z);\n      }\n    });\n    if (!zSamples.length) return null;\n    zSamples.sort((a, b) => b - a);\n    const skip = Math.min(3, Math.floor(zSamples.length * 0.005));\n    return zSamples[Math.min(skip, zSamples.length - 1)];\n  };\n\n  const useLambert = materialMode === 'lambert';\n  const prepareBody = (model) => {\n    if (!model) return null;\n    const data = {\n      model,\n      meshList: [],\n      bounds: new THREE.Box3(),\n      boundsCenter: new THREE.Vector3(),\n      chargeNoseOffsetZ: 0\n    };\n\n    model.traverse(o => {\n      if (o.isMesh) {\n        o.material = useLambert ? toLambert(o.material) : o.material.clone();\n        data.meshList.push(o);\n      }\n    });\n\n    data.bounds = computeLocalBounds(model);\n    if (!data.bounds.isEmpty()) {\n      data.bounds.getCenter(data.boundsCenter);\n      data.chargeNoseOffsetZ = data.bounds.max.z;\n    }\n    return data;\n  };\n\n  const prepareWing = (model) => {\n    if (!model) return null;\n    const data = {\n      model,\n      meshList: [],\n      bounds: new THREE.Box3(),\n      center: new THREE.Vector3()\n    };\n\n    model.traverse(o => {\n      if (o.isMesh) {\n        o.material = useLambert ? toLambert(o.material) : o.material.clone();\n        data.meshList.push(o);\n      }\n    });\n\n    data.bounds = computeLocalBounds(model);\n    if (!data.bounds.isEmpty()) {\n      data.bounds.getCenter(data.center);\n    }\n    return data;\n  };\n\n  const bodyModel = await loadModel(path) ?? fallbackModel();\n  const bodyData = prepareBody(bodyModel);\n  if (bodyData?.model) mesh.add(bodyData.model);\n\n  const wingLeftModel = await loadModel(wingLeftPath);\n  const wingRightModel = await loadModel(wingRightPath);\n  const wingLeft = wingLeftModel ? prepareWing(wingLeftModel) : null;\n  const wingRight = wingRightModel ? prepareWing(wingRightModel) : null;\n  if (wingLeft?.model) {\n    wingLeft.model.name = 'player-wing-left';\n    mesh.add(wingLeft.model);\n  }\n  if (wingRight?.model) {\n    wingRight.model.name = 'player-wing-right';\n    mesh.add(wingRight.model);\n  }\n\n  if (bodyData?.model) {\n    bodyData.model.updateMatrix();\n    bodyData.boundsCenterInPlayer = bodyData.boundsCenter\n      ? bodyData.boundsCenter.clone().applyMatrix4(bodyData.model.matrix)\n      : new THREE.Vector3();\n  }\n  if (wingLeft?.model && wingLeft?.bounds && !wingLeft.bounds.isEmpty()) {\n    wingLeft.model.updateMatrix();\n    wingLeft.boundsInPlayer = wingLeft.bounds.clone().applyMatrix4(wingLeft.model.matrix);\n    wingLeft.boundsInPlayer.expandByScalar(0.05);\n    wingLeft.centerInPlayer = wingLeft.boundsInPlayer.getCenter(new THREE.Vector3());\n  }\n  if (wingRight?.model && wingRight?.bounds && !wingRight.bounds.isEmpty()) {\n    wingRight.model.updateMatrix();\n    wingRight.boundsInPlayer = wingRight.bounds.clone().applyMatrix4(wingRight.model.matrix);\n    wingRight.boundsInPlayer.expandByScalar(0.05);\n    wingRight.centerInPlayer = wingRight.boundsInPlayer.getCenter(new THREE.Vector3());\n  }\n\n  /* 2 ─ pre-compute bounding radius (root-local bounds for accuracy) */\n  const sphere = new THREE.Sphere();\n  const combinedBox = new THREE.Box3();\n  const addLocalBox = (box, obj) => {\n    if (!box || box.isEmpty() || !obj) return;\n    obj.updateMatrix();\n    tmpBox.copy(box).applyMatrix4(obj.matrix);\n    combinedBox.union(tmpBox);\n  };\n  addLocalBox(bodyData?.bounds, bodyData?.model);\n  addLocalBox(wingLeft?.bounds, wingLeft?.model);\n  addLocalBox(wingRight?.bounds, wingRight?.model);\n  if (combinedBox.isEmpty()) {\n    mesh.updateMatrixWorld(true);\n    combinedBox.setFromObject(mesh);\n  }\n  combinedBox.getBoundingSphere(sphere);\n  const radius = sphere.radius;\n\n  if (bodyData?.bounds && bodyData?.model) {\n    bodyData.model.updateMatrixWorld(true);\n    const noseTipZ = computeNoseTipZ(bodyData.model, bodyData.bounds, bodyData.boundsCenter);\n    if (typeof noseTipZ === 'number') {\n      const nosePoint = new THREE.Vector3(\n        bodyData.boundsCenter.x,\n        bodyData.boundsCenter.y,\n        noseTipZ\n      );\n      nosePoint.applyMatrix4(bodyData.model.matrix);\n      mesh.userData.chargeNosePoint = nosePoint;\n      mesh.userData.chargeNoseOffsetZ = nosePoint.z;\n    } else {\n      tmpBox.copy(bodyData.bounds).applyMatrix4(bodyData.model.matrix);\n      mesh.userData.chargeNoseOffsetZ = tmpBox.max.z;\n    }\n  } else {\n    mesh.userData.chargeNoseOffsetZ = combinedBox.max.z;\n  }\n\n  /* gather meshes for local emissive flash */\n  let meshList = [\n    ...(bodyData?.meshList ?? []),\n    ...(wingLeft?.meshList ?? []),\n    ...(wingRight?.meshList ?? [])\n  ];\n  mesh.userData.meshes = meshList;\n\n  /* 3 ─ attitude parameters */\n  const MAX_ROLL  = 0.30;  // rad  ≈17°\n  const MAX_YAW   = 0.20;  // rad  ≈11°\n  const MAX_PITCH = 0.20;\n\n  const DAMP      = 6;     // how fast we return to neutral (larger = snappier)\n\n  /* barrel-roll parms */\nconst ROLL_TIME   = 0.6;   // seconds for two full spins\nlet   rollT   = 0;         // time left\nlet   rollDir = 0;         // -1 = left, +1 = right\n  const SIDE_BANK_ANGLE = Math.PI * 0.5;\n\n  /* hit flash */\n  let flashT = 0;\n\n  /* compact engine glow (soft, layered ovals, no tail) */\n  const glowGeo = new THREE.CircleGeometry(0.2, 20); // size already tuned by you\n  glowGeo.scale(1.4, 0.85, 1);                       // small horizontal oval\n\n  const makeGlowMat = (hex, opacity, softness = 0.35) => new THREE.ShaderMaterial({\n    transparent : true,\n    blending    : THREE.AdditiveBlending,\n    depthWrite  : false,\n    side        : THREE.DoubleSide,\n    uniforms: {\n      color   : { value: new THREE.Color(hex) },\n      opacity : { value: opacity },\n      softness: { value: softness }\n    },\n    vertexShader: /* glsl */`\n      varying vec2 vUv;\n      void main(){\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    `,\n    fragmentShader: /* glsl */`\n      uniform vec3  color;\n      uniform float opacity;\n      uniform float softness;\n      varying vec2  vUv;\n      void main(){\n        vec2 p = (vUv - 0.5) * 2.0;\n        float d = length(p);\n        float mask = 1.0 - smoothstep(1.0 - softness, 1.0, d);\n        gl_FragColor = vec4(color, opacity * mask);\n      }\n    `\n  });\n\n  const outerGlow = new THREE.Mesh(glowGeo, makeGlowMat(0x00ccff, 0.45, 0.45));\n  outerGlow.position.set(0, 0, -1.0); // tuck close to the rear\n  outerGlow.frustumCulled = false;\n  mesh.add(outerGlow);\n\n  const innerGlow = new THREE.Mesh(glowGeo, makeGlowMat(0x0077c8, 0.55, 0.35));\n  innerGlow.scale.set(0.6, 0.6, 0.6); // smaller darker core\n  innerGlow.position.set(0, 0, -1.01);\n  innerGlow.frustumCulled = false;\n  mesh.add(innerGlow);\n  const baseGlowScaleOuter = outerGlow.scale.clone();\n  const baseGlowScaleInner = innerGlow.scale.clone();\n  const engineOffset = outerGlow.position.clone();\n\n  const TAIL_SEGMENTS = 12;\n  const TAIL_SPACING = 0.6;\n  const TAIL_FADE_IN = 6.0;\n  const TAIL_FADE_OUT = 3.2;\n  const TAIL_SMOOTH = 0.35;\n  const TAIL_START_SCALE = 1.15;\n  const TAIL_END_SCALE = 0.35;\n  const TAIL_BASE_OPACITY = 0.65;\n\n  const makeTailMat = () => new THREE.ShaderMaterial({\n    transparent: true,\n    blending: THREE.AdditiveBlending,\n    depthWrite: false,\n    side: THREE.DoubleSide,\n    uniforms: {\n      innerColor: { value: new THREE.Color(0x0077c8) },\n      outerColor: { value: new THREE.Color(0x00ccff) },\n      opacity: { value: TAIL_BASE_OPACITY },\n      softness: { value: 0.6 }\n    },\n    vertexShader: /* glsl */`\n      varying vec2 vUv;\n      void main(){\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    `,\n    fragmentShader: /* glsl */`\n      uniform vec3 innerColor;\n      uniform vec3 outerColor;\n      uniform float opacity;\n      uniform float softness;\n      varying vec2 vUv;\n      void main(){\n        vec2 p = (vUv - 0.5) * 2.0;\n        float d = length(p);\n        float t = smoothstep(0.0, 1.0, d);\n        vec3 color = mix(innerColor, outerColor, t);\n        float mask = 1.0 - smoothstep(1.0 - softness, 1.0, d);\n        gl_FragColor = vec4(color, opacity * mask);\n      }\n    `\n  });\n\n  const tailMeshes = [];\n  const tailPositions = Array.from({ length: TAIL_SEGMENTS }, () => new THREE.Vector3());\n  const tailQuats = Array.from({ length: TAIL_SEGMENTS }, () => new THREE.Quaternion());\n  const tailTargetPos = new THREE.Vector3();\n  const tailTargetQuat = new THREE.Quaternion();\n  const tailTmpPos = new THREE.Vector3();\n  let tailCount = 0;\n  let tailFade = 0;\n  let lastTrailTime = 0;\n  let boosting = false;\n  let boostScale = 1;\n  if (scene) {\n    for (let i = 0; i < TAIL_SEGMENTS; i++) {\n      const m = new THREE.Mesh(glowGeo, makeTailMat());\n      m.visible = false;\n      m.frustumCulled = false;\n      scene.add(m);\n      tailMeshes.push(m);\n    }\n  }\n\n  /* wing health + wing meshes */\n  const WING_MAX_HP = 3;\n  let wingHpLeft = WING_MAX_HP;\n  let wingHpRight = WING_MAX_HP;\n  const wingMeshes = {\n    left: wingLeft?.meshList ?? [],\n    right: wingRight?.meshList ?? []\n  };\n  const tmpWingLocal = new THREE.Vector3();\n  const tmpWingWorld = new THREE.Vector3();\n  const tmpWingDir = new THREE.Vector3();\n  const tmpBodyCenterWorld = new THREE.Vector3();\n  const tmpWingOrigin = new THREE.Vector3();\n  const tmpPlayerLocal = new THREE.Vector3();\n  const WING_HIT_PAD = 0.25;\n  const wingBlinkColor = new THREE.Color(0x4aa3ff);\n  const WING_BLINK_DURATION = 1.6;\n  const WING_BLINK_RATE = 8.0;\n  let wingBlinkLeftT = 0;\n  let wingBlinkRightT = 0;\n  let wingBlinkLeftOn = false;\n  let wingBlinkRightOn = false;\n  let warnedMissingWings = false;\n\n  function syncWingUserData() {\n    mesh.userData.wingHpLeft = wingHpLeft;\n    mesh.userData.wingHpRight = wingHpRight;\n  }\n\n  function updateWingVariant() {\n    let nextKey = 'full';\n    if (wingHpLeft <= 0 && wingHpRight <= 0) nextKey = 'noW';\n    else if (wingHpLeft <= 0) nextKey = 'noL';\n    else if (wingHpRight <= 0) nextKey = 'noR';\n    mesh.userData.wingVariant = nextKey;\n  }\n\n  function setWingVisible(wingData, visible) {\n    if (!wingData?.model) return;\n    wingData.model.visible = visible;\n    if (!visible) {\n      setWingGlow(wingData.meshList, 0);\n    }\n  }\n\n  function spawnWingExplosion(wingData) {\n    if (!explosionPool?.spawn || !wingData?.center || !wingData?.model) return;\n    tmpWingWorld.copy(wingData.center);\n    wingData.model.localToWorld(tmpWingWorld);\n    explosionPool.spawn(tmpWingWorld);\n  }\n\n  function segmentHitsBox(origin, dir, box) {\n    if (!box) return false;\n    if (dir.lengthSq() < 1e-6) return false;\n    let tMin = 0;\n    let tMax = 1;\n    const sx = origin.x;\n    const sy = origin.y;\n    const sz = origin.z;\n    const dx = dir.x;\n    const dy = dir.y;\n    const dz = dir.z;\n    const min = box.min;\n    const max = box.max;\n    const eps = 1e-6;\n    if (Math.abs(dx) < eps) {\n      if (sx < min.x || sx > max.x) return false;\n    } else {\n      const inv = 1 / dx;\n      let t1 = (min.x - sx) * inv;\n      let t2 = (max.x - sx) * inv;\n      if (t1 > t2) [t1, t2] = [t2, t1];\n      tMin = Math.max(tMin, t1);\n      tMax = Math.min(tMax, t2);\n      if (tMin > tMax) return false;\n    }\n    if (Math.abs(dy) < eps) {\n      if (sy < min.y || sy > max.y) return false;\n    } else {\n      const inv = 1 / dy;\n      let t1 = (min.y - sy) * inv;\n      let t2 = (max.y - sy) * inv;\n      if (t1 > t2) [t1, t2] = [t2, t1];\n      tMin = Math.max(tMin, t1);\n      tMax = Math.min(tMax, t2);\n      if (tMin > tMax) return false;\n    }\n    if (Math.abs(dz) < eps) {\n      if (sz < min.z || sz > max.z) return false;\n    } else {\n      const inv = 1 / dz;\n      let t1 = (min.z - sz) * inv;\n      let t2 = (max.z - sz) * inv;\n      if (t1 > t2) [t1, t2] = [t2, t1];\n      tMin = Math.max(tMin, t1);\n      tMax = Math.min(tMax, t2);\n      if (tMin > tMax) return false;\n    }\n    return tMax >= 0 && tMin <= 1;\n  }\n\n  function hitWing(wingData, hitPointWorld, hitPointPlayerLocal = null) {\n    if (!wingData?.model || !wingData.bounds || wingData.bounds.isEmpty()) return false;\n    if (wingData.model.visible === false) return false;\n    const hitLocal = hitPointPlayerLocal ?? tmpPlayerLocal.copy(hitPointWorld);\n\n    if (hitPointPlayerLocal === null) {\n      mesh.updateMatrixWorld(true);\n      mesh.worldToLocal(hitLocal);\n    }\n\n    if (wingData.boundsInPlayer && (wingData.boundsInPlayer.containsPoint(hitLocal) ||\n        wingData.boundsInPlayer.distanceToPoint(hitLocal) <= WING_HIT_PAD)) {\n      return true;\n    }\n\n    if (bodyData?.boundsCenterInPlayer) {\n      tmpWingOrigin.copy(bodyData.boundsCenterInPlayer);\n      tmpWingDir.copy(hitLocal).sub(tmpWingOrigin);\n      if (wingData.boundsInPlayer && !wingData.boundsInPlayer.containsPoint(tmpWingOrigin)) {\n        if (segmentHitsBox(tmpWingOrigin, tmpWingDir, wingData.boundsInPlayer)) return true;\n      }\n    }\n\n    wingData.model.updateMatrixWorld(true);\n    tmpWingLocal.copy(hitPointWorld);\n    wingData.model.worldToLocal(tmpWingLocal);\n    if (wingData.bounds.containsPoint(tmpWingLocal) ||\n        wingData.bounds.distanceToPoint(tmpWingLocal) <= WING_HIT_PAD) return true;\n    if (!bodyData?.model || !bodyData?.boundsCenter) return false;\n    bodyData.model.updateMatrixWorld(true);\n    tmpBodyCenterWorld.copy(bodyData.boundsCenter);\n    bodyData.model.localToWorld(tmpBodyCenterWorld);\n    tmpWingOrigin.copy(tmpBodyCenterWorld);\n    wingData.model.worldToLocal(tmpWingOrigin);\n    tmpWingDir.copy(tmpWingLocal).sub(tmpWingOrigin);\n    if (!wingData.bounds.containsPoint(tmpWingOrigin)) {\n      return segmentHitsBox(tmpWingOrigin, tmpWingDir, wingData.bounds);\n    }\n    return false;\n  }\n\n  function applyWingDamage(hitPointWorld) {\n    if (!hitPointWorld) return null;\n    if (!wingLeft?.model && !wingRight?.model) {\n      if (!warnedMissingWings) {\n        warnedMissingWings = true;\n        console.warn('[player] wing models not found; check player_starfighter_l_wing_only/player_starfighter_r_wing_only GLBs.');\n      }\n      return null;\n    }\n    mesh.updateMatrixWorld(true);\n    tmpPlayerLocal.copy(hitPointWorld);\n    mesh.worldToLocal(tmpPlayerLocal);\n\n    const leftHit = wingLeft?.model && wingHpLeft > 0 && hitWing(wingLeft, hitPointWorld, tmpPlayerLocal);\n    const rightHit = wingRight?.model && wingHpRight > 0 && hitWing(wingRight, hitPointWorld, tmpPlayerLocal);\n    if (!leftHit && !rightHit) return null;\n\n    let side = leftHit ? 'left' : 'right';\n    if (leftHit && rightHit) {\n      const leftDist = wingLeft?.centerInPlayer\n        ? tmpPlayerLocal.distanceToSquared(wingLeft.centerInPlayer)\n        : Infinity;\n      const rightDist = wingRight?.centerInPlayer\n        ? tmpPlayerLocal.distanceToSquared(wingRight.centerInPlayer)\n        : Infinity;\n      side = rightDist < leftDist ? 'right' : 'left';\n    }\n\n    if (side === 'left') {\n      wingHpLeft = Math.max(0, wingHpLeft - 1);\n      syncWingUserData();\n      mesh.userData.wingHitCountLeft = (mesh.userData.wingHitCountLeft ?? 0) + 1;\n      mesh.userData.lastWingHit = 'left';\n      mesh.userData.lastWingHitAt = (typeof performance !== 'undefined' && performance.now)\n        ? performance.now()\n        : Date.now();\n      if (wingHpLeft === 0) {\n        setWingVisible(wingLeft, false);\n        spawnWingExplosion(wingLeft);\n        mesh.userData.onWingLost && mesh.userData.onWingLost('left');\n      }\n    } else {\n      wingHpRight = Math.max(0, wingHpRight - 1);\n      syncWingUserData();\n      mesh.userData.wingHitCountRight = (mesh.userData.wingHitCountRight ?? 0) + 1;\n      mesh.userData.lastWingHit = 'right';\n      mesh.userData.lastWingHitAt = (typeof performance !== 'undefined' && performance.now)\n        ? performance.now()\n        : Date.now();\n      if (wingHpRight === 0) {\n        setWingVisible(wingRight, false);\n        spawnWingExplosion(wingRight);\n        mesh.userData.onWingLost && mesh.userData.onWingLost('right');\n      }\n    }\n    updateWingVariant();\n    return side;\n  }\n\n  function setWingGlow(meshes, intensity) {\n    if (!meshes || !meshes.length) return;\n    const r = wingBlinkColor.r * intensity;\n    const g = wingBlinkColor.g * intensity;\n    const b = wingBlinkColor.b * intensity;\n    meshes.forEach(m => {\n      if (m.material.emissive) m.material.emissive.setRGB(r, g, b);\n    });\n  }\n\n  function updateWingBlink(dt) {\n    if (wingBlinkLeftT > 0) {\n      wingBlinkLeftT = Math.max(0, wingBlinkLeftT - dt);\n    }\n    if (wingBlinkRightT > 0) {\n      wingBlinkRightT = Math.max(0, wingBlinkRightT - dt);\n    }\n    const leftActive = wingBlinkLeftT > 0 && wingLeft?.model?.visible !== false;\n    const rightActive = wingBlinkRightT > 0 && wingRight?.model?.visible !== false;\n    if (leftActive) {\n      const pulse = 0.6 + 0.4 * Math.sin((WING_BLINK_DURATION - wingBlinkLeftT) * WING_BLINK_RATE);\n      setWingGlow(wingMeshes.left, pulse);\n      wingBlinkLeftOn = true;\n    } else if (wingBlinkLeftOn) {\n      setWingGlow(wingMeshes.left, 0);\n      wingBlinkLeftOn = false;\n    }\n    if (rightActive) {\n      const pulse = 0.6 + 0.4 * Math.sin((WING_BLINK_DURATION - wingBlinkRightT) * WING_BLINK_RATE);\n      setWingGlow(wingMeshes.right, pulse);\n      wingBlinkRightOn = true;\n    } else if (wingBlinkRightOn) {\n      setWingGlow(wingMeshes.right, 0);\n      wingBlinkRightOn = false;\n    }\n  }\n\n  function restoreWings() {\n    wingHpLeft = WING_MAX_HP;\n    wingHpRight = WING_MAX_HP;\n    syncWingUserData();\n    setWingVisible(wingLeft, true);\n    setWingVisible(wingRight, true);\n    wingBlinkLeftT = WING_BLINK_DURATION;\n    wingBlinkRightT = WING_BLINK_DURATION;\n    updateWingVariant();\n  }\n\n  /** update(dx, dy, dt, bankDir) ▸ dx,dy ∈ [-1,1]  dt seconds */\n  function update(dx, dy, dt, bankDir = 0) {\n    /* fade emissive flash */\n    if (flashT > 0) {\n      flashT = Math.max(0, flashT - dt);\n      const e = flashT > 0 ? 1 : 0;\n      meshList.forEach(m => {\n        if (m.material.emissive) m.material.emissive.setRGB(e, 0, 0);\n      });\n    }\n    updateWingBlink(dt);\n\n    /* target angles based on current key press */\n    const tgtRoll  = bankDir ? bankDir * SIDE_BANK_ANGLE : -dx * MAX_ROLL;\n    const tgtYaw   =  dx * MAX_YAW;\n    const tgtPitch = -dy * MAX_PITCH;\n\n    /* critically damp toward targets */\n    if (rollT === 0) {                                       // not rolling\n      mesh.rotation.z += (tgtRoll - mesh.rotation.z) * DAMP * dt;\n    }\n    mesh.rotation.y += (tgtYaw   - mesh.rotation.y) * DAMP * dt;\n    mesh.rotation.x += (tgtPitch - mesh.rotation.x) * DAMP * dt;\n\n    /* active barrel roll */\n    if (rollT > 0) {\n      rollT  = Math.max(0, rollT - dt);\n      const spin = rollDir * (4 * Math.PI) * (dt / ROLL_TIME); // 720° total\n      mesh.rotateZ(spin);\n      if (rollT === 0) mesh.rotation.z = 0;    // land perfectly level\n    }\n  }\n\n  function startRoll(dir){\n    if (rollT === 0){        // only if not already rolling\n      rollT  = ROLL_TIME;\n      rollDir= dir;          // -1 left, +1 right\n    }\n  }\n  function isRolling(){ return rollT > 0; }\n  function getRollDir(){ return rollDir; }\n  function blink(){\n    flashT = 0.15;\n    meshList.forEach(m => {\n      if (m.material.emissive) m.material.emissive.setRGB(1, 0, 0);\n    });\n  }\n\n  function updateTrail(dt = 0) {\n    if (!scene || tailMeshes.length === 0) return;\n    let stepDt = dt;\n    if (!Number.isFinite(stepDt) || stepDt <= 0) {\n      const now = typeof performance !== 'undefined' ? performance.now() : Date.now();\n      stepDt = lastTrailTime ? Math.max(0, (now - lastTrailTime) / 1000) : 0;\n      lastTrailTime = now;\n    }\n\n    if (boosting) {\n      tailFade = Math.min(1, tailFade + stepDt * TAIL_FADE_IN);\n    } else {\n      tailFade = Math.max(0, tailFade - stepDt * TAIL_FADE_OUT);\n    }\n\n    if (boosting) {\n      tailTmpPos.copy(engineOffset);\n      mesh.localToWorld(tailTmpPos);\n      mesh.getWorldQuaternion(tailTargetQuat);\n      if (tailCount === 0 || tailTmpPos.distanceToSquared(tailPositions[0]) >= (TAIL_SPACING * TAIL_SPACING)) {\n        for (let i = TAIL_SEGMENTS - 1; i > 0; i--) {\n          tailPositions[i].copy(tailPositions[i - 1]);\n          tailQuats[i].copy(tailQuats[i - 1]);\n        }\n        tailPositions[0].copy(tailTmpPos);\n        tailQuats[0].copy(tailTargetQuat);\n        tailCount = Math.min(TAIL_SEGMENTS, tailCount + 1);\n      }\n    }\n\n    const scaleBoost = 1 + Math.max(0, boostScale - 1) * 0.35;\n    for (let i = 0; i < tailMeshes.length; i++) {\n      const m = tailMeshes[i];\n      if (i >= tailCount || tailFade <= 0.001) {\n        m.visible = false;\n        continue;\n      }\n      const t = tailCount > 1 ? i / (tailCount - 1) : 0;\n      const fade = (1 - t) * tailFade;\n      if (fade <= 0.01) {\n        m.visible = false;\n        continue;\n      }\n      tailTargetPos.copy(tailPositions[i]);\n      tailTargetQuat.copy(tailQuats[i]);\n      if (!m.userData.init) {\n        m.position.copy(tailTargetPos);\n        m.quaternion.copy(tailTargetQuat);\n        m.userData.init = true;\n      } else {\n        m.position.lerp(tailTargetPos, TAIL_SMOOTH);\n        m.quaternion.slerp(tailTargetQuat, TAIL_SMOOTH);\n      }\n      const scale = THREE.MathUtils.lerp(TAIL_START_SCALE, TAIL_END_SCALE, t) * scaleBoost;\n      m.scale.copy(baseGlowScaleOuter).multiplyScalar(scale);\n      if (m.material?.uniforms?.opacity) {\n        m.material.uniforms.opacity.value = TAIL_BASE_OPACITY * fade;\n      }\n      m.visible = true;\n    }\n  }\n  function setEngineGlowScale(mult = 1) {\n    outerGlow.scale.copy(baseGlowScaleOuter).multiplyScalar(mult);\n    innerGlow.scale.copy(baseGlowScaleInner).multiplyScalar(mult);\n    boostScale = mult;\n    boosting = mult > 1.01;\n  }\n\n  mesh.userData.blink = blink;   // allow external callers\n  mesh.userData.updateTrail = updateTrail;\n  mesh.userData.setEngineGlowScale = setEngineGlowScale;\n  mesh.userData.applyWingDamage = applyWingDamage;\n  mesh.userData.restoreWings = restoreWings;\n  mesh.userData.wingMaxHp = WING_MAX_HP;\n  syncWingUserData();\n  updateWingVariant();\n\n  return { mesh, radius, update, startRoll, isRolling, getRollDir, blink, updateTrail, setEngineGlowScale };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\nexport async function initAllyShip(scene, {\n  railCurve,\n  playerObj,\n  laserSystem,\n  enemySystem = null,\n  enemyLasers = null,\n  enemyBoltPool = null,\n  explosionPool = null,\n  onDialogue = null,\n  onEscortOutcome = null,\n  playerSpeed = 35,\n  spawn = { x: 80, y: 12, z: -3500 },\n  spawnTriggerZ = -3520,\n  materialMode = 'standard'\n} = {}) {\n  const loader = new GLTFLoader();\n  let modelProto = null;\n  try {\n    modelProto = (await loader.loadAsync('./models/player_starfighter_v2.glb')).scene;\n  } catch (err) {\n    console.warn('[ally] failed to load model', err);\n  }\n\n  if (!modelProto) {\n    modelProto = new THREE.Mesh(\n      new THREE.BoxGeometry(5, 2, 10),\n      new THREE.MeshStandardMaterial({ color: 0x00aaff })\n    );\n  }\n\n  const useLambert = materialMode === 'lambert';\n  modelProto.updateMatrixWorld(true);\n  const bounds = new THREE.Box3().setFromObject(modelProto);\n  const boundsCenter = bounds.getCenter(new THREE.Vector3());\n  const hitSphere = new THREE.Sphere();\n  const hitRadius = bounds.isEmpty() ? 4 : bounds.getBoundingSphere(hitSphere).radius;\n  const nosePoint = (!bounds.isEmpty())\n    ? new THREE.Vector3(boundsCenter.x, boundsCenter.y, bounds.max.z)\n    : null;\n\n  const glowGeo = new THREE.CircleGeometry(0.2, 20);\n  glowGeo.scale(1.4, 0.85, 1);\n  const makeGlowMat = (hex, opacity, softness = 0.35) => new THREE.ShaderMaterial({\n    transparent: true,\n    blending: THREE.AdditiveBlending,\n    depthWrite: false,\n    side: THREE.DoubleSide,\n    uniforms: {\n      color: { value: new THREE.Color(hex) },\n      opacity: { value: opacity },\n      softness: { value: softness }\n    },\n    vertexShader: /* glsl */`\n      varying vec2 vUv;\n      void main(){\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    `,\n    fragmentShader: /* glsl */`\n      uniform vec3  color;\n      uniform float opacity;\n      uniform float softness;\n      varying vec2  vUv;\n      void main(){\n        vec2 p = (vUv - 0.5) * 2.0;\n        float d = length(p);\n        float mask = 1.0 - smoothstep(1.0 - softness, 1.0, d);\n        gl_FragColor = vec4(color, opacity * mask);\n      }\n    `\n  });\n\n  const engineZ = bounds.isEmpty() ? -1.0 : (bounds.min.z - 0.2);\n\n  const createAllyRoot = () => {\n    const root = new THREE.Object3D();\n    root.visible = false;\n\n    const model = modelProto.clone(true);\n    const meshList = [];\n    model.traverse(o => {\n      if (!o.isMesh) return;\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      o.frustumCulled = false;\n      meshList.push(o);\n    });\n    root.add(model);\n\n    if (nosePoint) {\n      root.userData.chargeNoseOffsetZ = bounds.max.z;\n      root.userData.chargeNosePoint = nosePoint.clone();\n    }\n\n    const outerGlow = new THREE.Mesh(glowGeo, makeGlowMat(0x00ccff, 0.45, 0.45));\n    outerGlow.position.set(boundsCenter.x, boundsCenter.y, engineZ);\n    outerGlow.frustumCulled = false;\n    root.add(outerGlow);\n\n    const innerGlow = new THREE.Mesh(glowGeo, makeGlowMat(0x0077c8, 0.55, 0.35));\n    innerGlow.scale.set(0.6, 0.6, 0.6);\n    innerGlow.position.set(boundsCenter.x, boundsCenter.y, engineZ - 0.01);\n    innerGlow.frustumCulled = false;\n    root.add(innerGlow);\n\n    root.userData._blinkMeshes = meshList;\n    root.userData._blinkBase = meshList.map(m => (m.material?.emissive ? m.material.emissive.clone() : null));\n    root.userData.flashT = 0;\n    root.userData.hitRadius = hitRadius * 0.9;\n\n    scene.add(root);\n    return root;\n  };\n\n  const root = createAllyRoot();\n  const escortRoot = createAllyRoot();\n\n  const spawnPos = new THREE.Vector3(spawn.x, spawn.y, spawn.z);\n  const targetA = new THREE.Vector3(80, -10, -4002);\n  const targetB = new THREE.Vector3(95, -10, -4003);\n  const fireSequence = [targetA, targetA, targetA, targetB, targetB, targetB];\n  const ATTACK_START_MAX = 210;\n  const ATTACK_START_MAX_SQ = ATTACK_START_MAX * ATTACK_START_MAX;\n  const FORWARD_TARGET = 20;\n  const APPROACH_SPEED = 35;\n  const FOLLOW_LERP = 2.0;\n  const FIRE_DELAY = 0.35;\n  const FIRE_INTERVAL = 0.22;\n  const EXIT_DELAY = 1.4;\n  const EXIT_FORWARD_SPEED = 35;\n  const EXIT_LEFT_SPEED = 20;\n  const EXIT_UP_SPEED = 20;\n  const EXIT_DURATION = 5.0;\n  const ROLL_TIME = 0.6;\n\n  const ESCORT_TRIGGER_Z = -1280;\n  const ESCORT_RESUME_Z = -1470;\n  const ESCORT_WAYPOINTS = [\n        new THREE.Vector3(-210, 30, -1450),\n    new THREE.Vector3(-52, 15, -1600),\n    new THREE.Vector3(12, 22, -1845)\n  ];\n  const ESCORT_SPAWN_POS = ESCORT_WAYPOINTS[0].clone();\n  const ESCORT_CHASER_CLEANUP_PAD = 20;\n  const ESCORT_CHASER_CLEANUP_Z = ESCORT_WAYPOINTS[ESCORT_WAYPOINTS.length - 1].z - ESCORT_CHASER_CLEANUP_PAD;\n  const ESCORT_CHASER_SPAWNS = [\n    new THREE.Vector3(-350, 20, -1470),\n    new THREE.Vector3(-360, 10, -1470),\n    new THREE.Vector3(-370, -10, -1470),\n    new THREE.Vector3(-380, -20, -1470)\n  ];\n  const ESCORT_CHASER_OFFSETS = [\n    new THREE.Vector3(6, 6, 12),\n    new THREE.Vector3(-6, 6, 14),\n    new THREE.Vector3(7, -6, 13),\n    new THREE.Vector3(-7, -6, 12)\n  ];\n  const ESCORT_SLOW_MULT = 0.9;\n  const ESCORT_MATCH_LERP = 2.5;\n  const ESCORT_WAYPOINT_EPS = 6;\n  const ESCORT_CHASER_SPEED = playerSpeed * 1.15;\n  const ESCORT_ROLL_INTERVAL = 1.8;\n  const ESCORT_EXIT_FORWARD_SPEED = playerSpeed;\n  const ESCORT_EXIT_RIGHT_SPEED = 20;\n  const ESCORT_EXIT_UP_SPEED = 20;\n\n  const ESCORT_SCALE = 3.5;\n\n  const TARGET_X = 35;\n  const TARGET_Y = 10;\n  const WORLD_UP = new THREE.Vector3(0, 1, 0);\n  const forwardAxis = new THREE.Vector3(0, 0, 1);\n  const FORWARD_FIX = new THREE.Quaternion().setFromAxisAngle(WORLD_UP, Math.PI);\n  const tmpPlayerPos = new THREE.Vector3();\n  const tmpForward = new THREE.Vector3(0, 0, -1);\n  const tmpRailForward = new THREE.Vector3(0, 0, -1);\n  const tmpRight = new THREE.Vector3();\n  const tmpUp = new THREE.Vector3(0, 1, 0);\n  const tmpDesired = new THREE.Vector3();\n  const tmpAim = new THREE.Vector3();\n  const tmpLookMat = new THREE.Matrix4();\n  const tmpLookTarget = new THREE.Vector3();\n  const tmpQuat = new THREE.Quaternion();\n  const tmpRollQuat = new THREE.Quaternion();\n  const tmpExitVel = new THREE.Vector3();\n  const tmpExitForward = new THREE.Vector3();\n  const tmpEscortExitVel = new THREE.Vector3();\n  const tmpEscortExitForward = new THREE.Vector3();\n  const tmpEscortDir = new THREE.Vector3();\n  const tmpSeg = new THREE.Vector3();\n  const tmpToCenter = new THREE.Vector3();\n  const tmpClosest = new THREE.Vector3();\n  const tmpBoltDir = new THREE.Vector3();\n  const tmpBoltPos = new THREE.Vector3();\n  const tmpAxisZ = new THREE.Vector3(0, 0, 1);\n  const railLength = railCurve.getLength();\n\n  let active = false;\n  let spawned = false;\n  let state = 'idle';\n  let forwardOffset = -10;\n  let rightOffset = 0;\n  let upOffset = 0;\n  let attackElapsed = 0;\n  let fireIndex = 0;\n  let exitElapsed = 0;\n  let rollT = 0;\n  let rollAngle = 0;\n\n  let escortActive = false;\n  let escortSpawned = false;\n  let escortState = 'idle';\n  let escortSpeed = 0;\n  let escortWaypoint = 0;\n  let escortRollT = 0;\n  let escortRollAngle = 0;\n  let escortRollCooldown = ESCORT_ROLL_INTERVAL;\n  let escortExitElapsed = 0;\n  let escortDestroyTimer = 0;\n  const escortChasers = [];\n  let prevPlayerT = null;\n  let playerSpeedNow = playerSpeed;\n  let escortOutcomeSent = false;\n  let escortCleanupDone = false;\n\n  function spawnNow(playerPos, forward, right, up) {\n    root.position.copy(spawnPos);\n    root.visible = true;\n    active = true;\n    state = 'approach';\n    attackElapsed = 0;\n    fireIndex = 0;\n    exitElapsed = 0;\n    rollT = 0;\n    rollAngle = 0;\n\n    forwardOffset = -10;\n    rightOffset = 0;\n    upOffset = 0;\n    emitDialogue({\n      id: 'turret-ally-spawn',\n      portraitSrc: './textures/red.png',\n      textLines: [\"I'll take out the turrets on the right!\"]\n    });\n  }\n\n  const triggerBlink = (targetRoot) => {\n    if (!targetRoot?.userData) return;\n    targetRoot.userData.flashT = 0.15;\n    const meshes = targetRoot.userData._blinkMeshes ?? [];\n    meshes.forEach(m => {\n      if (m.material?.emissive) m.material.emissive.setRGB(1, 0, 0);\n    });\n  };\n\n  const updateBlink = (targetRoot, dt) => {\n    if (!targetRoot?.userData) return;\n    const ud = targetRoot.userData;\n    if (!ud.flashT) return;\n    ud.flashT = Math.max(0, ud.flashT - dt);\n    if (ud.flashT > 0) return;\n    const meshes = ud._blinkMeshes ?? [];\n    const base = ud._blinkBase ?? [];\n    meshes.forEach((m, i) => {\n      if (!m.material?.emissive) return;\n      const baseColor = base[i];\n      if (baseColor) m.material.emissive.copy(baseColor);\n      else m.material.emissive.setRGB(0, 0, 0);\n    });\n  };\n\n  const emitDialogue = (payload) => {\n    if (typeof onDialogue === 'function') {\n      onDialogue(payload);\n      return;\n    }\n    if (typeof globalThis?.postMessage === 'function' && globalThis.__IS_RENDER_WORKER) {\n      globalThis.postMessage({ type: 'dialogue', payload });\n    }\n  };\n\n  function segmentSphereHit(a, b, center, radiusSq) {\n    tmpSeg.copy(b).sub(a);\n    const segLenSq = tmpSeg.lengthSq();\n    let t = 0;\n    if (segLenSq > 1e-8) {\n      tmpToCenter.copy(center).sub(a);\n      t = tmpToCenter.dot(tmpSeg) / segLenSq;\n      if (t < 0) t = 0;\n      else if (t > 1) t = 1;\n    }\n    tmpClosest.copy(a).addScaledVector(tmpSeg, t);\n    return tmpClosest.distanceToSquared(center) <= radiusSq;\n  }\n\n  function spawnEscort() {\n    escortRoot.position.copy(ESCORT_SPAWN_POS);\n    escortRoot.visible = true;\n    escortRoot.traverse(o => {\n      if (o.isMesh) o.visible = true;\n    });\n    escortRoot.scale.setScalar(ESCORT_SCALE);\n    escortRoot.updateMatrixWorld(true);\n    escortActive = true;\n    escortState = 'path';\n    const baseSpeed = Number.isFinite(playerSpeedNow) ? playerSpeedNow : playerSpeed;\n    escortSpeed = baseSpeed * ESCORT_SLOW_MULT;\n    escortWaypoint = Math.min(1, ESCORT_WAYPOINTS.length - 1);\n    escortRollT = 0;\n    escortRollAngle = 0;\n    escortRollCooldown = ESCORT_ROLL_INTERVAL;\n    escortExitElapsed = 0;\n    escortDestroyTimer = 0;\n    escortChasers.length = 0;\n    escortOutcomeSent = false;\n    escortCleanupDone = false;\n    spawnEscortChasers();\n    emitDialogue({\n      id: 'escort-spawn',\n      portraitSrc: './textures/green.png',\n      textLines: [\"They're on me! I can't shake 'em!\"]\n    });\n  }\n\n  function spawnEscortChaser(pos, idx = 0) {\n    if (!enemySystem?.spawnManual || !pos) return;\n    const chaser = enemySystem.spawnManual(pos, {\n      state: 'chase',\n      onSpawn: (ship) => {\n        ship.userData.chaseTarget = escortRoot;\n        ship.userData.chaseOffset = ESCORT_CHASER_OFFSETS[idx % ESCORT_CHASER_OFFSETS.length];\n        ship.userData.chaseOffsetMode = 'world';\n        ship.userData.chaseMinDist = 6;\n        ship.userData.chaseSpeed = ESCORT_CHASER_SPEED;\n        ship.userData.allyChaser = true;\n        ship.userData.noCullBehind = true;\n        ship.userData.fireT = 999;\n      }\n    });\n    if (chaser) escortChasers.push(chaser);\n  }\n\n  function spawnEscortChasers() {\n    ESCORT_CHASER_SPAWNS.forEach((pos, idx) => spawnEscortChaser(pos, idx));\n  }\n\n  function countAliveChasers() {\n    let alive = 0;\n    for (let i = 0; i < escortChasers.length; i++) {\n      const ship = escortChasers[i];\n      if (!ship || !ship.visible || ship.userData?.dead) continue;\n      alive += 1;\n    }\n    return alive;\n  }\n\n  function cleanupEscortChasers() {\n    if (!escortChasers.length) return;\n    for (let i = 0; i < escortChasers.length; i++) {\n      const ship = escortChasers[i];\n      if (!ship) continue;\n      ship.visible = false;\n      if (ship.userData) {\n        ship.userData.dead = true;\n        ship.userData.allyChaser = false;\n        ship.userData.noCullBehind = false;\n        ship.userData.chaseTarget = null;\n      }\n    }\n    escortChasers.length = 0;\n  }\n\n  function checkEscortLaserHits() {\n    const lasers = (typeof enemyLasers === 'function') ? enemyLasers() : enemyLasers;\n    if (!lasers?.length || !escortRoot.visible) return;\n    const radius = escortRoot.userData.hitRadius ?? 6;\n    const radiusSq = radius * radius;\n    const center = escortRoot.position;\n    for (let i = 0; i < lasers.length; i++) {\n      const bolt = lasers[i];\n      if (!bolt?.userData?.active) continue;\n      const prev = bolt.prev ?? bolt.position;\n      if (segmentSphereHit(prev, bolt.position, center, radiusSq)) {\n        bolt.userData.active = false;\n        bolt.userData.life = 0;\n        triggerBlink(escortRoot);\n        break;\n      }\n    }\n  }\n\n  function fireEscortKillShots() {\n    if (!enemyBoltPool?.alloc) return;\n    const targetPos = escortRoot.position;\n    for (let i = 0; i < escortChasers.length; i++) {\n      const ship = escortChasers[i];\n      if (!ship || !ship.visible || ship.userData?.dead) continue;\n      const handle = enemyBoltPool.alloc({ big: false, life: 1.2, dir: 1, bounced: false });\n      if (!handle) continue;\n      ship.getWorldPosition(tmpBoltPos);\n      tmpBoltDir.copy(targetPos).sub(tmpBoltPos);\n      if (tmpBoltDir.lengthSq() < 1e-6) tmpBoltDir.set(0, 0, -1);\n      tmpBoltDir.normalize();\n      tmpQuat.setFromUnitVectors(tmpAxisZ, tmpBoltDir);\n      enemyBoltPool.setTransform(handle, tmpBoltPos, tmpQuat);\n    }\n  }\n\n  function updateOrientation(targetRoot, desiredForward, rollAngle = 0) {\n    if (!targetRoot || desiredForward.lengthSq() < 1e-6) return;\n    tmpAim.copy(desiredForward).normalize();\n    tmpLookTarget.copy(targetRoot.position).add(tmpAim);\n    tmpLookMat.lookAt(targetRoot.position, tmpLookTarget, WORLD_UP);\n    tmpQuat.setFromRotationMatrix(tmpLookMat);\n    targetRoot.quaternion.copy(tmpQuat);\n    targetRoot.quaternion.multiply(FORWARD_FIX);\n    if (rollAngle) {\n      tmpRollQuat.setFromAxisAngle(forwardAxis, rollAngle);\n      targetRoot.quaternion.multiply(tmpRollQuat);\n    }\n  }\n\n  function update(dt, tPlayer) {\n    if (!playerObj || !railCurve || !laserSystem?.fireAllyShot) return;\n    playerObj.getWorldPosition(tmpPlayerPos);\n    if (typeof tPlayer === 'number') {\n      railCurve.getTangentAt(tPlayer, tmpRailForward).normalize();\n      if (dt > 0 && Number.isFinite(tPlayer)) {\n        if (prevPlayerT !== null) {\n          const deltaT = tPlayer - prevPlayerT;\n          const speed = Math.abs(deltaT) * railLength / dt;\n          if (Number.isFinite(speed) && speed >= 0) {\n            playerSpeedNow = speed;\n          }\n        }\n        prevPlayerT = tPlayer;\n      }\n    } else {\n      tmpRailForward.set(0, 0, -1);\n    }\n    tmpRight.copy(tmpRailForward).cross(tmpUp.set(0, 1, 0)).normalize();\n    tmpUp.crossVectors(tmpRight, tmpRailForward).normalize();\n\n    if (!spawned) {\n      if (tmpPlayerPos.z <= spawnTriggerZ) {\n        spawned = true;\n        spawnNow(tmpPlayerPos, tmpRailForward, tmpRight, tmpUp);\n      }\n    }\n    if (active) {\n      if (state !== 'exit') {\n        forwardOffset = Math.min(FORWARD_TARGET, forwardOffset + APPROACH_SPEED * dt);\n        tmpDesired.copy(tmpPlayerPos)\n          .addScaledVector(tmpRailForward, forwardOffset);\n        tmpDesired.x = TARGET_X;\n        tmpDesired.y = TARGET_Y;\n        root.position.lerp(tmpDesired, Math.min(1, FOLLOW_LERP * dt));\n      }\n\n      if (state === 'approach') {\n        const d2A = root.position.distanceToSquared(targetA);\n        const d2B = root.position.distanceToSquared(targetB);\n        if (Math.min(d2A, d2B) <= ATTACK_START_MAX_SQ) {\n          state = 'attack';\n          attackElapsed = 0;\n        }\n      }\n\n      if (state === 'attack') {\n        attackElapsed += dt;\n        while (fireIndex < fireSequence.length &&\n               attackElapsed >= FIRE_DELAY + fireIndex * FIRE_INTERVAL) {\n          laserSystem.fireAllyShot(root, fireSequence[fireIndex]);\n          fireIndex++;\n        }\n        if (fireIndex >= fireSequence.length &&\n            attackElapsed >= FIRE_DELAY + fireSequence.length * FIRE_INTERVAL + EXIT_DELAY) {\n          state = 'exit';\n          exitElapsed = 0;\n          rollAngle = 0;\n          rollT = ROLL_TIME;\n          tmpExitVel.copy(tmpRailForward).multiplyScalar(EXIT_FORWARD_SPEED);\n          tmpExitVel.x -= EXIT_LEFT_SPEED;\n          tmpExitVel.y += EXIT_UP_SPEED;\n          tmpExitForward.copy(tmpExitVel).normalize();\n          emitDialogue({\n            id: 'turret-ally-exit',\n            portraitSrc: './textures/red.png',\n            textLines: ['Scratch two turrets! No need to thank me.']\n          });\n        }\n      }\n\n      if (state === 'exit') {\n        exitElapsed += dt;\n        root.position.addScaledVector(tmpExitVel, dt);\n\n        if (rollT > 0) {\n          rollT = Math.max(0, rollT - dt);\n          const spin = (4 * Math.PI) * (dt / ROLL_TIME);\n          rollAngle += spin;\n          if (rollT === 0) rollAngle = 0;\n        }\n\n        if (exitElapsed >= EXIT_DURATION) {\n          root.visible = false;\n          active = false;\n        }\n      }\n\n      let aimTarget = null;\n      if (state === 'attack' && fireIndex < fireSequence.length) {\n        aimTarget = fireSequence[fireIndex];\n      }\n\n      if (state === 'exit') {\n        updateOrientation(root, tmpExitForward, rollAngle);\n      } else if (aimTarget) {\n        tmpAim.copy(aimTarget).sub(root.position);\n        if (tmpAim.lengthSq() > 1e-6) tmpAim.normalize();\n        tmpForward.copy(tmpRailForward).lerp(tmpAim, 0.6).normalize();\n        updateOrientation(root, tmpForward, rollAngle);\n      } else {\n        updateOrientation(root, tmpRailForward, rollAngle);\n      }\n    }\n\n    if (!escortSpawned && tmpPlayerPos.z <= ESCORT_TRIGGER_Z) {\n      escortSpawned = true;\n      spawnEscort();\n    }\n\n    if (escortActive) {\n      escortRoot.visible = true;\n      const aliveChasers = countAliveChasers();\n      if (aliveChasers > 0) checkEscortLaserHits();\n\n      if (escortRollT > 0) {\n        escortRollT = Math.max(0, escortRollT - dt);\n        const spin = (4 * Math.PI) * (dt / ROLL_TIME);\n        escortRollAngle += spin;\n        if (escortRollT === 0) escortRollAngle = 0;\n      } else {\n        escortRollCooldown = Math.max(0, escortRollCooldown - dt);\n        if (escortRollCooldown === 0) {\n          escortRollT = ROLL_TIME;\n          escortRollCooldown = ESCORT_ROLL_INTERVAL;\n          escortRollAngle = 0;\n        }\n      }\n\n      if (escortState === 'destroying') {\n        escortDestroyTimer += dt;\n        if (escortDestroyTimer >= 0.2) {\n          escortRoot.visible = false;\n          escortActive = false;\n        }\n      } else if (escortState === 'exit') {\n        escortExitElapsed += dt;\n        escortRoot.position.addScaledVector(tmpEscortExitVel, dt);\n        updateOrientation(escortRoot, tmpEscortExitForward, escortRollAngle);\n        if (escortExitElapsed >= EXIT_DURATION) {\n          escortRoot.visible = false;\n          escortActive = false;\n        }\n      } else {\n        const target = ESCORT_WAYPOINTS[Math.min(escortWaypoint, ESCORT_WAYPOINTS.length - 1)];\n        tmpEscortDir.copy(target).sub(escortRoot.position);\n        const dist = tmpEscortDir.length();\n        if (dist > 1e-4) tmpEscortDir.multiplyScalar(1 / dist);\n\n        const baseSpeed = Number.isFinite(playerSpeedNow) ? playerSpeedNow : playerSpeed;\n        const targetSpeed = (tmpPlayerPos.z <= ESCORT_RESUME_Z)\n          ? baseSpeed\n          : baseSpeed * ESCORT_SLOW_MULT;\n        escortSpeed += (targetSpeed - escortSpeed) * Math.min(1, ESCORT_MATCH_LERP * dt);\n\n        const step = escortSpeed * dt;\n        const arriveDist = Math.max(step, ESCORT_WAYPOINT_EPS);\n        if (dist <= arriveDist) {\n          escortRoot.position.copy(target);\n          if (escortWaypoint < ESCORT_WAYPOINTS.length - 1) {\n            escortWaypoint += 1;\n          } else {\n            if (aliveChasers === 0) {\n              escortState = 'exit';\n              escortExitElapsed = 0;\n              escortRollAngle = 0;\n              escortRollT = ROLL_TIME;\n              tmpEscortExitVel.copy(tmpRailForward).multiplyScalar(ESCORT_EXIT_FORWARD_SPEED);\n              tmpEscortExitVel.x += ESCORT_EXIT_RIGHT_SPEED;\n              tmpEscortExitVel.y += ESCORT_EXIT_UP_SPEED;\n              tmpEscortExitForward.copy(tmpEscortExitVel).normalize();\n              if (!escortOutcomeSent) {\n                escortOutcomeSent = true;\n                if (typeof onEscortOutcome === 'function') onEscortOutcome({ survived: true });\n              }\n              emitDialogue({\n                id: 'escort-escape',\n                portraitSrc: './textures/green.png',\n                textLines: ['Thanks, cat! That was too close!']\n              });\n            } else {\n              escortState = 'destroying';\n              escortDestroyTimer = 0;\n              triggerBlink(escortRoot);\n              fireEscortKillShots();\n              explosionPool?.spawn?.(escortRoot.position);\n              if (!escortOutcomeSent) {\n                escortOutcomeSent = true;\n                if (typeof onEscortOutcome === 'function') onEscortOutcome({ survived: false });\n              }\n              emitDialogue({\n                id: 'escort-destroyed',\n                portraitSrc: './textures/green.png',\n                textLines: [\"I'm hit! Ahhhhh!\"]\n              });\n            }\n          }\n        } else if (dist > 1e-4) {\n          escortRoot.position.addScaledVector(tmpEscortDir, step);\n        }\n\n        const aimDir = dist > 1e-4 ? tmpEscortDir : tmpRailForward;\n        updateOrientation(escortRoot, aimDir, escortRollAngle);\n      }\n    }\n\n    if (!escortCleanupDone && escortSpawned && tmpPlayerPos.z <= ESCORT_CHASER_CLEANUP_Z && escortState !== 'path') {\n      escortCleanupDone = true;\n      cleanupEscortChasers();\n    }\n\n    updateBlink(root, dt);\n    updateBlink(escortRoot, dt);\n  }\n\n  function prewarm(renderer, camera) {\n    if (!renderer || !camera) return;\n    const prevVis = [root.visible, escortRoot.visible];\n    const prevPos = [root.position.clone(), escortRoot.position.clone()];\n    const prevQuat = [root.quaternion.clone(), escortRoot.quaternion.clone()];\n    root.visible = true;\n    escortRoot.visible = true;\n    camera.getWorldPosition(tmpPlayerPos);\n    camera.getWorldDirection(tmpForward);\n    root.position.copy(tmpPlayerPos).addScaledVector(tmpForward, 30);\n    escortRoot.position.copy(tmpPlayerPos).addScaledVector(tmpForward, 36);\n    root.quaternion.copy(camera.quaternion);\n    escortRoot.quaternion.copy(camera.quaternion);\n    renderer.compile(scene, camera);\n    root.visible = prevVis[0];\n    escortRoot.visible = prevVis[1];\n    root.position.copy(prevPos[0]);\n    escortRoot.position.copy(prevPos[1]);\n    root.quaternion.copy(prevQuat[0]);\n    escortRoot.quaternion.copy(prevQuat[1]);\n  }\n\n  return {\n    mesh: root,\n    meshes: [root, escortRoot],\n    update,\n    prewarm\n  };\n}\n","import * as THREE from './libs/build/three.module.js';\n\n/**\n * Lightweight explosion pool: tiny additive billboards with quick fade/expand.\n */\nexport function createExplosionPool(scene, {\n  poolSize = 24,\n  baseSize = 6,\n  colors = null,             // optional palette override\n  life = 0.35                // seconds\n} = {}) {\n  const geo = new THREE.PlaneGeometry(baseSize, baseSize);\n\n  // fuzzy radial gradient (shared) to avoid sharp edges/squares\n  const canvas = (typeof document !== 'undefined')\n    ? document.createElement('canvas')\n    : (typeof OffscreenCanvas !== 'undefined' ? new OffscreenCanvas(128, 128) : null);\n  if (!canvas) throw new Error('No canvas available for explosion texture');\n  canvas.width = canvas.height = 128;\n  const ctx = canvas.getContext('2d');\n  const grad = ctx.createRadialGradient(64, 64, 0, 64, 64, 64);\n  grad.addColorStop(0, 'rgba(255,255,255,1)');\n  grad.addColorStop(0.6, 'rgba(255,255,255,0.4)');\n  grad.addColorStop(1, 'rgba(255,255,255,0)');\n  ctx.fillStyle = grad;\n  ctx.fillRect(0, 0, 128, 128);\n  const tex = new THREE.CanvasTexture(canvas);\n  tex.needsUpdate = true;\n\n  const defaultPalette = [0xff6622, 0xffbb22, 0xff3322];\n  const palette = colors && colors.length ? colors : defaultPalette;\n  const opacities = [0.8, 0.6, 0.85];\n  const variants = palette.map((c, i) => new THREE.MeshBasicMaterial({\n    color: c,\n    map: tex,\n    transparent: true,\n    opacity: opacities[i % opacities.length],\n    blending: THREE.AdditiveBlending,\n    depthWrite: false,\n    side: THREE.DoubleSide\n  }));\n\n  const pool = [];\n  for (let i = 0; i < poolSize; i++) {\n    const mat = variants[i % variants.length];\n    const mesh = new THREE.Mesh(geo, mat);\n    mesh.visible = false;\n    mesh.frustumCulled = false;\n    mesh.userData.life = 0;\n    mesh.userData.variant = i % variants.length;\n    scene.add(mesh);\n    pool.push(mesh);\n  }\n\n  function spawn(position, lifeOverride = null) {\n    const fx = pool.find(m => !m.visible);\n    if (!fx) return;\n    fx.visible = true;\n    const maxLife = Number.isFinite(lifeOverride) ? lifeOverride : life;\n    fx.userData.maxLife = maxLife;\n    fx.userData.life = maxLife;             // seconds\n    fx.scale.setScalar(1);\n    fx.position.copy(position);\n    return fx;\n  }\n\n  function update(dt, camera = null) {\n    pool.forEach(fx => {\n      if (!fx.visible) return;\n      fx.userData.life -= dt;\n      if (fx.userData.life <= 0) {\n        fx.visible = false;\n        return;\n      }\n      const maxLife = fx.userData.maxLife ?? life;\n      const t = maxLife > 0 ? (fx.userData.life / maxLife) : 0;\n      const baseOpacity = fx.userData.variant === 1 ? 0.6 : fx.userData.variant === 2 ? 0.85 : 0.8;\n      fx.material.opacity = baseOpacity * t;\n      const s = THREE.MathUtils.lerp(1, 2.5, 1 - t);\n      fx.scale.setScalar(s);\n      if (camera) {\n        fx.quaternion.copy(camera.quaternion); // true billboard\n      }\n    });\n  }\n\n  function prewarm(renderer, camera) {\n    const prev = pool.map(p => ({ vis: p.visible, life: p.userData.life }));\n    pool.slice(0, Math.min(pool.length, 8)).forEach(p => {\n      p.visible = true;\n      p.userData.maxLife = life;\n      p.userData.life = life;\n      p.scale.setScalar(1);\n    });\n    // render a tiny frame to bake programs/UBOs\n    const prevSize = renderer.getSize(new THREE.Vector2());\n    renderer.setSize(64, 64, false);\n    renderer.render(scene, camera);\n    renderer.setSize(prevSize.x, prevSize.y, false);\n    pool.forEach((p, i) => {\n      p.visible = prev[i].vis;\n      p.userData.life = prev[i].life;\n    });\n  }\n\n  return { spawn, update, prewarm };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { addScore } from './hud.js';   // NEW – scoring\nimport { createExplosionPool } from './explosion-pool.js';\n\nexport function createLaserSystem(scene, {\n  speed    = 200,\n  life     = 2,\n  colour   = 0x00ff00,\n  poolSize = 30,\n  cooldown = 0.18,\n  bossMesh   = null,\n  damageBoss = ()=>{},\n  bossHitR2  = 400,\n  stationMesh   = null,        // NEW\n  damageStation = () => {},    // NEW\n  camera,                 // ① NEW – the main PerspectiveCamera\n  getEnemies = () => [],   // ② NEW – returns active fighters\n  passageCollider = null,   // optional single collider (back-compat)\n  passageColliders = [],     // optional array of colliders\n  onEnemyKilled = () => {},  // callback(positionVec3) when a fighter is killed\n  onShotFired = () => {},    // callback(shotId, type)\n  onShotHit = () => {}       // callback(shotId)\n\n} = {}) {\n\nlet dualMode = false;\nlet blueMode = false;\nlet damageMult = 1;\nconst BASE_COLOR = colour;\nconst BLUE_COLOR = 0x00ffff;\n  const LASER_WIDTH = 0.3;\n  const LASER_RADIUS = LASER_WIDTH * 0.5;\n  const geo = new THREE.BoxGeometry(LASER_WIDTH, LASER_WIDTH, 6).translate(0, 0, 3);\n  const tmp = new THREE.Vector3();\n  const tmp2 = new THREE.Vector3();   // new scratch\n  const tmpPrev = new THREE.Vector3();\n  const tmpKill = new THREE.Vector3();\n  const blastFX = [];  // pooled charge-explosion visuals\n  const tmpBill = new THREE.Quaternion();\n  const tmpAllyDir = new THREE.Vector3();\n  const tmpAllyQuat = new THREE.Quaternion();\n\n\n  const MIN_HIT_R2   = 3 * 3;               // impact radius (3 u)\n  const MAX_FLIGHT_T = 1.5;                 // shorter life to keep active count low\n  const mat = new THREE.MeshBasicMaterial({ color: BASE_COLOR });\n  const pool = Array.from({ length: poolSize }, () => {\n    const m = new THREE.Mesh(geo, mat);\n    m.visible = false;\n    scene.add(m);\n    return m;\n  });\n  const ALLY_POOL_SIZE = 8;\n  const allyMat = new THREE.MeshBasicMaterial({ color: BASE_COLOR });\n  const allyPool = Array.from({ length: ALLY_POOL_SIZE }, () => {\n    const m = new THREE.Mesh(geo, allyMat);\n    m.visible = false;\n    scene.add(m);\n    return m;\n  });\n\n\n  /* charge-shot params */\nconst CHARGE_COOLDOWN = 0.18;   // # same as normal laser rate\nconst CHARGE_COUNT    = 3;      // fire 3 normals, then start charging\nconst CHARGE_TIME     = 0.7;    // seconds to reach full charge\nconst CHARGE_SPEED    = 120;    // flight speed once released\nconst CHARGE_RANGE    = 120;     // distance before it explodes\nconst BOSS_MESH   = bossMesh;\nconst DAMAGE_BOSS = damageBoss;\nconst BOSS_R2     = bossHitR2;\nconst STATION_MESH   = stationMesh;\nconst STATION_COLLIDER = stationMesh?.userData?.collider ?? null;\nconst DAMAGE_STATION = damageStation;\nconst CAMERA     = camera;         // ← store once\nconst GET_ENEMY  = getEnemies;     // ← store once\nconst CHARGE_SCALE_MIN = 0.30;   // a touch larger while growing\nconst CHARGE_SCALE_MAX = 0.80;   // final size in flight\nconst CHARGE_DAMAGE    = 3;\nconst BLAST_INNER_R    = 8;      // ↑ mild increase (damage)\nconst BLAST_OUTER_R    = 16;     // ↑ mild increase (flash halo)\nconst BLAST_MID_R      = (BLAST_INNER_R + BLAST_OUTER_R) * 0.5;\nconst BLAST_COLOR_INNER = 0x00ff7f;\nconst BLAST_COLOR_OUTER = 0x00b060;\nconst BLAST_LIFE       = 0.5;    // shorter explosion life to cut fill-rate\nconst BLAST_START_SCALE = 0.5;   // start smaller than target radius\nconst CHARGE_FORWARD_OFFSET = 0.5; // fallback offset if no nose data found\nconst CHARGE_FORWARD_TWEAK = -0.85; // manual tweak applied even with nose data\nconst CHARGE_NOSE_PAD = -1; // extra push beyond the ship nose\nconst BOMB_RADIUS = 1.1;\nconst BOMB_SPEED = CHARGE_SPEED;\nconst BOMB_RANGE = CHARGE_RANGE;\nconst BOMB_POOL_SIZE = 6;\nconst BOMB_BLAST_INNER_R = BLAST_INNER_R * 2;\nconst BOMB_BLAST_OUTER_R = BLAST_OUTER_R * 2;\nconst BOMB_BLAST_LIFE = BLAST_LIFE * 3;\nconst BOMB_BLAST_START_SCALE = 0.35;\nconst BOMB_DPS = CHARGE_DAMAGE;\nconst BOMB_IMPACT_DAMAGE = CHARGE_DAMAGE * 2;\nconst PASSAGE_COLLIDERS = [];\nif (passageCollider) PASSAGE_COLLIDERS.push(passageCollider);\nif (Array.isArray(passageColliders)) {\n  PASSAGE_COLLIDERS.push(...passageColliders.filter(Boolean));\n}\n\nconst MUZZLE_POOL_SIZE = Math.max(40, poolSize * 2);\nconst MUZZLE_BACK_OFFSET = 0; // place flashes at the nose instead of pulling back\nconst MUZZLE_BASE_SIZE = LASER_WIDTH * 2;\nconst MUZZLE_LIFE = 0.03;\nconst TINY_IMPACT_LIFE = 0.175;\nconst muzzleFxGreen = createExplosionPool(scene, {\n  poolSize: MUZZLE_POOL_SIZE,\n  baseSize: MUZZLE_BASE_SIZE,\n  colors: [BASE_COLOR]\n});\nconst muzzleFxBlue = createExplosionPool(scene, {\n  poolSize: MUZZLE_POOL_SIZE,\n  baseSize: MUZZLE_BASE_SIZE,\n  colors: [BLUE_COLOR]\n});\n\nconst setBlastOpacity = (fx, value) => {\n  if (!fx?.material) return;\n  if (fx.material.uniforms?.opacity) {\n    fx.material.uniforms.opacity.value = value;\n  } else {\n    fx.material.opacity = value;\n  }\n};\n\nconst createBlastMidMaterial = () => new THREE.ShaderMaterial({\n  transparent: true,\n  depthWrite: false,\n  blending: THREE.AdditiveBlending,\n  uniforms: {\n    innerColor: { value: new THREE.Color(BLAST_COLOR_INNER) },\n    outerColor: { value: new THREE.Color(BLAST_COLOR_OUTER) },\n    opacity: { value: 0.65 }\n  },\n  vertexShader: `\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    void main() {\n      vNormal = normalize(normalMatrix * normal);\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      vViewPosition = -mvPosition.xyz;\n      gl_Position = projectionMatrix * mvPosition;\n    }\n  `,\n  fragmentShader: `\n    uniform vec3 innerColor;\n    uniform vec3 outerColor;\n    uniform float opacity;\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    void main() {\n      vec3 viewDir = normalize(vViewPosition);\n      float rim = 1.0 - clamp(dot(normalize(vNormal), viewDir), 0.0, 1.0);\n      float t = smoothstep(0.0, 1.0, rim);\n      vec3 color = mix(innerColor, outerColor, t);\n      float edge = smoothstep(0.6, 1.0, rim);\n      float alpha = opacity * (0.35 + 0.65 * (1.0 - edge));\n      gl_FragColor = vec4(color, alpha);\n    }\n  `\n});\n\n/* pool just for charge spheres */\nconst cGeo  = new THREE.SphereGeometry(CHARGE_SCALE_MAX, 16, 16);   // mesh size ≈ max charge\nconst cMat  = new THREE.MeshBasicMaterial({ color: 0x00ff7f });  // HUD-green\nconst chargePool = Array.from({ length: 8 }, () => {\n  const m = new THREE.Mesh(cGeo, cMat); m.visible = false; scene.add(m); return m;\n});\n// charge blast FX pool (two expanding spheres, pooled)\nconst blastLayers = [\n  { radius: BLAST_INNER_R, opacity: 0.9, material: new THREE.MeshBasicMaterial({\n    color: BLAST_COLOR_INNER,\n    transparent: true,\n    opacity: 0.9\n  }) },\n  { radius: BLAST_MID_R, opacity: 0.65, material: createBlastMidMaterial() },\n  { radius: BLAST_OUTER_R, opacity: 0.4, material: new THREE.MeshBasicMaterial({\n    color: BLAST_COLOR_OUTER,\n    transparent: true,\n    opacity: 0.4\n  }) }\n];\nblastLayers.forEach(layer => {\n  const g = new THREE.SphereGeometry(layer.radius, 16, 16);\n  const fx = new THREE.Mesh(g, layer.material);\n  fx.visible = false;\n  fx.userData.life = 0;\n  fx.userData.baseOpacity = layer.opacity;\n  scene.add(fx);\n  blastFX.push(fx);\n});\n\n/* bomb projectile pool (low-poly sphere + face) */\nconst bombBodyMat = new THREE.MeshBasicMaterial({ color: 0xd01f1f });\nconst bombFaceMat = new THREE.MeshBasicMaterial({ color: 0x081a33 });\nconst bombLetterMat = new THREE.MeshBasicMaterial({ color: 0xffffff });\nconst bombCore = new THREE.Group();\nconst bombBody = new THREE.Mesh(new THREE.IcosahedronGeometry(BOMB_RADIUS, 0), bombBodyMat);\nbombCore.add(bombBody);\nconst bombFace = new THREE.Mesh(new THREE.CircleGeometry(BOMB_RADIUS * 0.7, 8), bombFaceMat);\nbombFace.position.z = BOMB_RADIUS * 0.85;\nbombCore.add(bombFace);\nconst bombLetter = new THREE.Group();\nconst bStem = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.7, 0.06), bombLetterMat);\nbStem.position.set(-0.12, 0, 0);\nconst bTop = new THREE.Mesh(new THREE.BoxGeometry(0.32, 0.22, 0.06), bombLetterMat);\nbTop.position.set(0.05, 0.2, 0);\nconst bBottom = new THREE.Mesh(new THREE.BoxGeometry(0.32, 0.22, 0.06), bombLetterMat);\nbBottom.position.set(0.05, -0.2, 0);\nbombLetter.add(bStem, bTop, bBottom);\nbombLetter.position.z = bombFace.position.z + 0.02;\nbombCore.add(bombLetter);\nconst bombPool = Array.from({ length: BOMB_POOL_SIZE }, () => {\n  const core = bombCore.clone(true);\n  const m = new THREE.Group();\n  m.add(core);\n  m.visible = false;\n  scene.add(m);\n  return m;\n});\n\n/* bomb blast FX pool (bigger, longer, with spikes) */\nconst bombBlastFX = [];\nconst bombInnerGeo = new THREE.SphereGeometry(BOMB_BLAST_INNER_R, 12, 12);\nconst bombOuterGeo = new THREE.SphereGeometry(BOMB_BLAST_OUTER_R, 12, 12);\nconst bombInnerMat = new THREE.MeshBasicMaterial({\n  color: 0x00ffff,\n  transparent: true,\n  opacity: 0.9,\n  blending: THREE.AdditiveBlending,\n  depthWrite: false\n});\nconst bombOuterMat = new THREE.MeshBasicMaterial({\n  color: 0x00ccff,\n  transparent: true,\n  opacity: 0.35,\n  blending: THREE.AdditiveBlending,\n  depthWrite: false\n});\nconst bombSpikeLen = (BOMB_BLAST_OUTER_R - BOMB_BLAST_INNER_R) * 1.15;\nconst bombSpikeGeo = new THREE.ConeGeometry(BOMB_BLAST_INNER_R * 0.25, bombSpikeLen, 4);\nconst bombSpikeMat = new THREE.MeshBasicMaterial({\n  color: 0x0077c8,\n  transparent: true,\n  opacity: 0.75,\n  blending: THREE.AdditiveBlending,\n  depthWrite: false\n});\nconst bombSpikeUp = new THREE.Vector3(0, 1, 0);\nconst bombSpikeDirs = [\n  new THREE.Vector3(1, 0, 0),\n  new THREE.Vector3(-1, 0, 0),\n  new THREE.Vector3(0, 1, 0),\n  new THREE.Vector3(0, -1, 0),\n  new THREE.Vector3(0, 0, 1),\n  new THREE.Vector3(0, 0, -1),\n  new THREE.Vector3(1, 1, 1),\n  new THREE.Vector3(1, 1, -1),\n  new THREE.Vector3(1, -1, 1),\n  new THREE.Vector3(-1, 1, 1),\n  new THREE.Vector3(-1, -1, 1),\n  new THREE.Vector3(-1, 1, -1)\n].map(v => v.normalize());\nconst createBombBlast = () => {\n  const grp = new THREE.Group();\n  const inner = new THREE.Mesh(bombInnerGeo, bombInnerMat.clone());\n  const outer = new THREE.Mesh(bombOuterGeo, bombOuterMat.clone());\n  const spikes = new THREE.Group();\n  bombSpikeDirs.forEach(dir => {\n    const spike = new THREE.Mesh(bombSpikeGeo, bombSpikeMat.clone());\n    spike.quaternion.setFromUnitVectors(bombSpikeUp, dir);\n    spike.position.copy(dir).multiplyScalar(BOMB_BLAST_INNER_R + bombSpikeLen * 0.5);\n    spikes.add(spike);\n  });\n  grp.add(inner);\n  grp.add(outer);\n  grp.add(spikes);\n  grp.visible = false;\n  grp.userData.life = 0;\n  grp.userData.inner = inner;\n  grp.userData.outer = outer;\n  grp.userData.spikes = spikes;\n  grp.userData.innerOpacity = inner.material.opacity;\n  grp.userData.outerOpacity = outer.material.opacity;\n  grp.userData.spikeOpacity = bombSpikeMat.opacity;\n  scene.add(grp);\n  return grp;\n};\nfor (let i = 0; i < 3; i++) {\n  bombBlastFX.push(createBombBlast());\n}\n\n\n/* reticle geometry -- stays module-level */\nconst retGeo = new THREE.RingGeometry(3, 3.2, 8);          // slightly thicker\nconst retMat = new THREE.MeshBasicMaterial({\n  color: 0x00ff7f,\n  transparent: true,\n  opacity: 1,\n  side: THREE.DoubleSide\n});\nconst reticle = new THREE.Mesh(retGeo, retMat);\nreticle.visible = false;\nscene.add(reticle);\n\nconst retLiteGeo = new THREE.RingGeometry(3.05, 3.15, 8);\nconst retLiteMat = new THREE.MeshBasicMaterial({\n  color: 0x66ffb3,\n  transparent: true,\n  opacity: 0.6,\n  side: THREE.DoubleSide\n});\nconst reticleLite = new THREE.Mesh(retLiteGeo, retLiteMat);\nreticleLite.visible = false;\nscene.add(reticleLite);\nconst retForward = new THREE.Vector3();\nconst retShipPos = new THREE.Vector3();\nconst retBillboardQ = new THREE.Quaternion();\nconst RETICLE_DISTANCE = 50;\nconst RETICLE_LITE_FACTOR = 2 / 3;\nconst RETICLE_OPACITY_CHARGE = 1;\nconst RETICLE_OPACITY_IDLE = 0.5;\nconst RETICLE_LITE_OPACITY_CHARGE = 0.6;\nconst RETICLE_LITE_OPACITY_IDLE = 0.3;\nconst LOCK_MAX_DIST = 60;\nconst LOCK_MAX_R2 = 16;\nconst forwardZ = new THREE.Vector3(0, 0, 1);\nconst fallbackForwardZ = new THREE.Vector3(0, 0, -1);\nconst homingForward = new THREE.Vector3();\nconst homingDesired = new THREE.Vector3();\nconst homingNew = new THREE.Vector3();\nconst lockVec = new THREE.Vector3();\nconst lockForward = new THREE.Vector3();\nconst lockOrigin = new THREE.Vector3();\nconst homingTargetPos = new THREE.Vector3();\nconst segDir = new THREE.Vector3();            // segment direction scratch\nconst segMin = new THREE.Vector3();\nconst segMax = new THREE.Vector3();\nconst segBox = new THREE.Box3();\nconst boxScratch = new THREE.Box3();\nconst tmpStaticPos = new THREE.Vector3();\nlet shotIdCounter = 1;\nconst nextShotId = () => shotIdCounter++;\nlet suppressShotEvents = false;\nconst getProjectileForwardOffset = (fromObject, radius) => {\n  const noseOffset = fromObject?.userData?.chargeNoseOffsetZ;\n  if (typeof noseOffset !== 'number') return CHARGE_FORWARD_OFFSET + CHARGE_FORWARD_TWEAK;\n  return noseOffset + radius + CHARGE_NOSE_PAD + CHARGE_FORWARD_TWEAK;\n};\nfunction setProjectilePosition(fromObject, radius, out, forwardQuat) {\n  if (!fromObject) return;\n  const nosePoint = fromObject?.userData?.chargeNosePoint;\n  const nosePad = typeof fromObject?.userData?.chargeNosePad === 'number'\n    ? fromObject.userData.chargeNosePad\n    : CHARGE_NOSE_PAD;\n  const useQuat = forwardQuat ?? fromObject.quaternion;\n  if (nosePoint && nosePoint.isVector3) {\n    out.copy(nosePoint);\n    fromObject.localToWorld(out);\n    TMP_FORWARD.set(0, 0, 1).applyQuaternion(useQuat);\n    out.addScaledVector(TMP_FORWARD, radius + nosePad + CHARGE_FORWARD_TWEAK);\n    return;\n  }\n  fromObject.getWorldPosition(out);\n  const forwardOffset = getProjectileForwardOffset(fromObject, radius);\n  TMP_FORWARD.set(0, 0, forwardOffset).applyQuaternion(useQuat);\n  out.add(TMP_FORWARD);\n}\n\nfunction getMuzzlePosition(fromObject, offX, out, forwardQuat) {\n  if (!fromObject) return null;\n  const useQuat = forwardQuat ?? fromObject.quaternion;\n  const nosePoint = fromObject?.userData?.chargeNosePoint;\n  if (nosePoint && nosePoint.isVector3) {\n    out.copy(nosePoint);\n    fromObject.localToWorld(out);\n  } else {\n    fromObject.getWorldPosition(out);\n    const forwardOffset = getProjectileForwardOffset(fromObject, 0);\n    TMP_FORWARD.set(0, 0, forwardOffset).applyQuaternion(useQuat);\n    out.add(TMP_FORWARD);\n  }\n  TMP_FORWARD.set(0, 0, 1).applyQuaternion(useQuat);\n  out.addScaledVector(TMP_FORWARD, -MUZZLE_BACK_OFFSET);\n  if (offX !== 0) {\n    TMP_SIDE.set(1, 0, 0).applyQuaternion(useQuat);\n    out.addScaledVector(TMP_SIDE, offX);\n  }\n  return out;\n}\nfunction segmentHitsCollider(collider, mesh, prev, curr) {\n  if (!collider || !mesh?.visible) return null;\n  const aabb = collider.worldAABB;\n  if (aabb) {\n    segMin.set(Math.min(prev.x, curr.x), Math.min(prev.y, curr.y), Math.min(prev.z, curr.z));\n    segMax.set(Math.max(prev.x, curr.x), Math.max(prev.y, curr.y), Math.max(prev.z, curr.z));\n    segBox.min.copy(segMin);\n    segBox.max.copy(segMax);\n    if (!segBox.intersectsBox(aabb)) return null;   // coarse reject\n  }\n  segDir.copy(curr).sub(prev);\n  const dist = segDir.length();\n  if (dist < 1e-5) return null;\n  segDir.multiplyScalar(1 / dist);\n  const hit = collider.linecast(prev, segDir, dist);\n  return hit.hit ? hit : null;\n}\n\nfunction stationLinecast(prev, curr) {\n  return segmentHitsCollider(STATION_COLLIDER, STATION_MESH, prev, curr);\n}\n\nfunction stationIntersectsSphere(center, radius = 0.5) {\n  if (!STATION_COLLIDER || !STATION_MESH?.visible) return false;\n  const aabb = STATION_COLLIDER.worldAABB;\n  const r = Math.max(radius, 0.25);\n  if (aabb) {\n    boxScratch.copy(aabb).expandByScalar(r);\n    if (!boxScratch.containsPoint(center)) return false;\n  }\n  const result = STATION_COLLIDER.testSphere(center, r);\n  return result.hit || STATION_COLLIDER.isPointInside(center);\n}\n\nfunction linecastStatic(prev, curr) {\n  for (const col of PASSAGE_COLLIDERS) {\n    if (!col) continue;\n    const mesh = col.mesh ?? col.root ?? null;\n    if (mesh) {\n      if (!mesh.visible) continue;\n      if (mesh.userData?.dead) continue;\n      if (mesh.userData?.laserCollisionEnabled === false) continue;\n      if (mesh.userData?.destructible && mesh.userData.destructible.hp <= 0) continue;\n    }\n    const aabb = col.worldAABB;\n    let intersects = true;\n    if (aabb) {\n      segMin.set(Math.min(prev.x, curr.x), Math.min(prev.y, curr.y), Math.min(prev.z, curr.z));\n      segMax.set(Math.max(prev.x, curr.x), Math.max(prev.y, curr.y), Math.max(prev.z, curr.z));\n      segBox.min.copy(segMin); segBox.max.copy(segMax);\n      intersects = segBox.intersectsBox(aabb);\n    }\n    if (!intersects) continue;\n    segDir.copy(curr).sub(prev);\n    const dist = segDir.length();\n    if (dist > 1e-5) {\n      segDir.multiplyScalar(1 / dist);\n      const hit = col.linecast(prev, segDir, dist);\n      if (hit.hit) {\n        hit.collider = col;\n        hit.mesh = col.mesh ?? col.root ?? null;\n        return hit;\n      }\n    }\n  }\n  return null;\n}\n\nfunction applyStaticDamage(hit, projectile) {\n  const mesh = hit?.mesh ?? hit?.collider?.mesh ?? null;\n  const destructible = mesh?.userData?.destructible;\n  if (!mesh?.visible || !destructible) return false;\n  const dmg = projectile?.userData?.damage ?? 1;\n  const currentHp = Number.isFinite(destructible.hp) ? destructible.hp : 0;\n  const nextHp = currentHp - dmg;\n  destructible.hp = nextHp;\n  if (mesh.userData?.blink) mesh.userData.blink();\n  if (nextHp > 0) return true;\n  mesh.visible = false;\n  mesh.userData.dead = true;\n  mesh.userData.laserCollisionEnabled = false;\n  if (typeof mesh.userData.onDestroyed === 'function') {\n    const pos = mesh.getWorldPosition ? mesh.getWorldPosition(tmpStaticPos) : mesh.position;\n    mesh.userData.onDestroyed(pos, mesh);\n  }\n  return true;\n}\n\nfunction findLockTarget(origin, forward) {\n  if (!origin || !forward) return null;\n  let bestR2 = Infinity;\n  let candidate = null;\n  const enemies = GET_ENEMY ? GET_ENEMY() : [];\n  for (let i = 0; i < enemies.length; i++) {\n    const f = enemies[i];\n    if (!f?.visible) continue;\n    const v = lockVec.copy(f.position).sub(origin);\n    const l = -v.dot(forward);\n    if (l < 0 || l > LOCK_MAX_DIST) continue;\n    const r2 = v.lengthSq() - l * l;\n    if (r2 < LOCK_MAX_R2 && r2 < bestR2) {\n      bestR2 = r2;\n      candidate = f;\n    }\n  }\n  return candidate;\n}\n\nfunction applyHoming(mesh, target, blend = 0.10) {\n  if (!mesh || !target || !target.visible) return;\n  if (typeof target.getWorldPosition === 'function') {\n    target.getWorldPosition(homingTargetPos);\n  } else {\n    homingTargetPos.copy(target.position);\n  }\n  const desired = homingDesired.copy(homingTargetPos).sub(mesh.position);\n  if (desired.lengthSq() > 1e-6) {\n    desired.normalize();\n  } else {\n    desired.copy(fallbackForwardZ);\n  }\n  const fwdNow = homingForward.set(0, 0, 1).applyQuaternion(mesh.quaternion);\n  const newFwd = homingNew.copy(fwdNow).lerp(desired, blend);\n  if (newFwd.lengthSq() > 1e-6) {\n    newFwd.normalize();\n  } else {\n    newFwd.copy(fallbackForwardZ);\n  }\n  mesh.quaternion.setFromUnitVectors(forwardZ, newFwd);\n}\n\n  /* local state */\n  let triggerHeld = false;\n  let timer       = 0;\n  let fireCount   = 0;          // how many normals since last release\n  let charging    = false;      // true while holding the big shot\n  let chargeT     = 0;          // timer while charging\n  let chargeObj   = null;       // current sphere mesh\n  let flown       = 0;          // range tracker after release\n  let flightTime  = 0;\n  let nextTarget  = null;\nlet lockedTarget = null;         // survives until cleared\nlet lockTimer    = 0;            // optional fade-out\nconst LOCK_FADE  = 1.0;          // seconds to keep the ring after loss\nlet fireMuted    = false;\n\nconst TIMER = { flown: 0, time: 0 };      // template object\nconst TMP_FORWARD = new THREE.Vector3();\nconst TMP_SIDE = new THREE.Vector3();\nconst SINGLE_OFFSETS = [0];\nconst DUAL_OFFSETS = [-1, 1];\n\n\n  /* simple input hook */\n  addEventListener('keydown', e => { if (e.code === 'Space') triggerHeld = true; });\n  addEventListener('keyup', e => {\n    if (e.code === 'Space') {\n      triggerHeld = false;\n     /* If the player released before charging began, forget the series */\n     if (!charging) fireCount = 0;\n    }\n  });\n\nfunction resetTriggerState() {\n  triggerHeld = false;\n  charging = false;\n  fireCount = 0;\n  chargeT = 0;\n  if (chargeObj) {\n    chargeObj.visible = false;\n    chargeObj = null;\n  }\n  reticle.visible = false;\n  reticleLite.visible = false;\n  lockTimer = 0;\n  if (lockedTarget) {\n    lockedTarget.userData.lockRing &&\n      (lockedTarget.userData.lockRing.visible = false);\n    lockedTarget = null;\n  }\n  GET_ENEMY().forEach(f => {\n    f.userData.lockRing && (f.userData.lockRing.visible = false);\n  });\n}\n\nfunction spawn(fromObject){\n  const offsets = dualMode ? DUAL_OFFSETS : SINGLE_OFFSETS;          // X-offsets in world units\n  const shotId = nextShotId();\n  let spawned = false;\n  offsets.forEach(offX => {\n    const m = pool.find(l => !l.visible);\n    if (!m) return;                                 // pool exhausted\n\n    fromObject.getWorldPosition(m.position);\n    fromObject.getWorldQuaternion(m.quaternion);\n\n    if (offX !== 0){\n      TMP_SIDE.set(1, 0, 0).applyQuaternion(m.quaternion);\n      m.position.addScaledVector(TMP_SIDE, offX);\n    }\n    m.userData.prev = (m.userData.prev || new THREE.Vector3()).copy(m.position);\n    m.userData.damage = damageMult;\n    m.userData.isBlue = blueMode;\n    m.userData.shotId = shotId;\n    m.visible        = true;\n    m.userData.life  = life;\n    spawned = true;\n\n    if (fromObject) {\n      const fxPos = getMuzzlePosition(fromObject, offX, tmp2, m.quaternion);\n      if (fxPos) {\n        (blueMode ? muzzleFxBlue : muzzleFxGreen).spawn(fxPos, MUZZLE_LIFE);\n      }\n    }\n  });\n  if (spawned && !suppressShotEvents) {\n    onShotFired && onShotFired(shotId, 'laser');\n  }\n}\n\nfunction fireAllyShot(fromObject, target) {\n  if (!fromObject || !target) return false;\n  const m = allyPool.find(l => !l.visible);\n  if (!m) return false;\n\n  setProjectilePosition(fromObject, LASER_RADIUS, m.position, fromObject.quaternion);\n  tmpAllyDir.copy(target).sub(m.position);\n  if (tmpAllyDir.lengthSq() < 1e-6) {\n    tmpAllyDir.set(0, 0, 1);\n  } else {\n    tmpAllyDir.normalize();\n  }\n  tmpAllyQuat.setFromUnitVectors(forwardZ, tmpAllyDir);\n  m.quaternion.copy(tmpAllyQuat);\n  m.userData.prev = (m.userData.prev || new THREE.Vector3()).copy(m.position);\n  m.userData.damage = 1;\n  m.userData.isBlue = false;\n  m.userData.shotId = null;\n  m.userData.life = life;\n  m.visible = true;\n\n  const fxPos = getMuzzlePosition(fromObject, 0, tmp2, fromObject.quaternion);\n  if (fxPos) {\n    muzzleFxGreen.spawn(fxPos, MUZZLE_LIFE);\n  }\n  return true;\n}\n\nfunction spawnTinyImpact(pos, isBlue) {\n  if (!pos) return;\n  (isBlue ? muzzleFxBlue : muzzleFxGreen).spawn(pos, TINY_IMPACT_LIFE);\n}\n\n\nfunction spawnChargeSphere(fromObject){\n  chargeObj = chargePool.find(c=>!c.visible); if(!chargeObj) return;\n  fromObject.getWorldQuaternion(chargeObj.quaternion);\n  const initialScale = 0.5;\n  setProjectilePosition(\n    fromObject,\n    CHARGE_SCALE_MAX * initialScale,\n    chargeObj.position,\n    chargeObj.quaternion\n  );\n  chargeObj.scale.setScalar(initialScale);           // start small, grow while chargeT < CHARGE_TIME\n  chargeObj.visible = true;\n  chargeObj.userData.flown = 0;\n  chargeObj.userData.time  = 0;\n  chargeObj.userData.prev  = (chargeObj.userData.prev || new THREE.Vector3()).copy(chargeObj.position);\n}\n\nfunction fireBomb(fromObject) {\n  if (!fromObject || fireMuted) return false;\n  const bomb = bombPool.find(b => !b.visible);\n  if (!bomb) return false;\n  const shotId = nextShotId();\n  fromObject.getWorldQuaternion(bomb.quaternion);\n  setProjectilePosition(fromObject, BOMB_RADIUS, bomb.position, bomb.quaternion);\n  bomb.visible = true;\n  bomb.userData.flown = 0;\n  bomb.userData.time = 0;\n  bomb.userData.prev = (bomb.userData.prev || new THREE.Vector3()).copy(bomb.position);\n  bomb.userData.shotId = shotId;\n  bomb.userData.statHit = false;\n  const locked = lockedTarget && lockedTarget.visible ? lockedTarget : null;\n  if (locked) {\n    bomb.userData.target = locked;\n  } else {\n    bomb.userData.target = null;\n  }\n  if (!suppressShotEvents) {\n    onShotFired && onShotFired(shotId, 'bomb');\n  }\n  return true;\n}\n\n  /** call every frame */\n  function update(dt, fromObject, { allowFire = true } = {}) {\n\n  /* ensure world matrices are current for hit-tests */\n  scene.updateMatrixWorld(false);\n\n  /* update pooled charge blast FX */\n  blastFX.forEach(fx => {\n    if (!fx.visible) return;\n    fx.userData.life -= dt;\n    if (fx.userData.life <= 0) {\n      fx.visible = false;\n      return;\n    }\n    const t = 1 - (fx.userData.life / BLAST_LIFE);\n    const s = THREE.MathUtils.lerp(BLAST_START_SCALE, 1, t);\n    fx.scale.setScalar(s);\n    const baseOp = fx.userData.baseOpacity ?? 0.5;\n    setBlastOpacity(fx, baseOp * (fx.userData.life / BLAST_LIFE));\n    if (CAMERA) fx.quaternion.copy(CAMERA.quaternion);\n  });\n\n  /* update bomb blast FX (damage-over-time) */\n  bombBlastFX.forEach(fx => {\n    if (!fx.visible) return;\n    const prevLife = fx.userData.life ?? 0;\n    if (prevLife <= 0) {\n      fx.visible = false;\n      return;\n    }\n    const dtApplied = Math.min(dt, prevLife);\n    fx.userData.life = prevLife - dt;\n    const t = 1 - (fx.userData.life / BOMB_BLAST_LIFE);\n    const s = THREE.MathUtils.lerp(BOMB_BLAST_START_SCALE, 1, t);\n    fx.scale.setScalar(s);\n    const fade = fx.userData.life / BOMB_BLAST_LIFE;\n    const inner = fx.userData.inner;\n    const outer = fx.userData.outer;\n    if (inner?.material) inner.material.opacity = fx.userData.innerOpacity * fade;\n    if (outer?.material) outer.material.opacity = fx.userData.outerOpacity * fade;\n    const spikes = fx.userData.spikes;\n    if (spikes?.children?.length) {\n      spikes.children.forEach(spike => {\n        if (spike.material) spike.material.opacity = fx.userData.spikeOpacity * fade;\n      });\n    }\n    if (dtApplied > 0) {\n      const didHit = applyBombDamage(fx.position, dtApplied, fx.userData.hitTarget);\n      if (didHit && fx.userData.shotId && !fx.userData.statHit) {\n        fx.userData.statHit = true;\n        onShotHit && onShotHit(fx.userData.shotId);\n      }\n    }\n    if (fx.userData.life <= 0) {\n      fx.visible = false;\n    }\n  });\n\n  muzzleFxGreen.update(dt, CAMERA);\n  muzzleFxBlue.update(dt, CAMERA);\n\n\n\n  if (!allowFire) {\n    triggerHeld = false;\n    if (!fireMuted) {\n      resetTriggerState();\n      fireMuted = true;\n    }\n  } else if (fireMuted) {\n    fireMuted = false;\n  }\n\n    /* handle input / cooldown */\n    timer += dt;\n\n\n\n  if (!charging && triggerHeld && timer >= cooldown) {\n    spawn(fromObject);\n    fireCount++;\n    timer = 0;\n    if (fireCount >= CHARGE_COUNT && triggerHeld) {           // start holding energy\n      charging  = true;\n      chargeT   = 0;\nspawnChargeSphere(fromObject);\nchargeObj.userData.target = lockedTarget;   // → use the persistent lock\n    }\n  }\n\n  /* keep sphere glued to nose while charging */\n  if (charging && triggerHeld && chargeObj){\n    chargeT = Math.min(CHARGE_TIME, chargeT + dt);\n    fromObject.getWorldQuaternion(chargeObj.quaternion);\n    const s = THREE.MathUtils.lerp(CHARGE_SCALE_MIN,\n                                   CHARGE_SCALE_MAX,\n                                   chargeT / CHARGE_TIME);\n    setProjectilePosition(\n      fromObject,\n      CHARGE_SCALE_MAX * s,\n      chargeObj.position,\n      chargeObj.quaternion\n    );\n    chargeObj.scale.setScalar(s);\n  }\n\n  /* release – fire the charged bolt  */\nif (charging && !triggerHeld && chargeObj) {\n  charging  = false;\n  fireCount = 0;\n  const shotId = nextShotId();\n  chargeObj.userData.shotId = shotId;\n  chargeObj.userData.statHit = false;\n  if (!suppressShotEvents) {\n    onShotFired && onShotFired(shotId, 'charge');\n  }\n\n  /* finalise homing target */\n  chargeObj.userData.target = lockedTarget;\n\n  /* OPTIONAL — drop the lock so the next volley starts clean */\n  if (lockedTarget) {\nlockedTarget.userData.lockRing &&\n        (lockedTarget.userData.lockRing.visible = false);    lockedTarget = null;\n  }\n}\n\n /* ── reticle (always active while firing allowed) ─────────────── */\n  if (fromObject) {\n    /* player lasers travel along local +Z of the ship mesh */\n    retForward.set(0, 0, 1);\n    fromObject.getWorldDirection(retForward).negate(); // forward is independent\n\n    fromObject.getWorldPosition(retShipPos);\n    reticle.position.copy(retShipPos).addScaledVector(retForward, -RETICLE_DISTANCE);\n    reticleLite.position\n      .copy(retShipPos)\n      .addScaledVector(retForward, -RETICLE_DISTANCE * RETICLE_LITE_FACTOR);\n\n    retBillboardQ.setFromUnitVectors(forwardZ, retForward);\n    reticle.quaternion.copy(retBillboardQ);\n    reticleLite.quaternion.copy(retBillboardQ);\n\n    retMat.opacity = charging ? RETICLE_OPACITY_CHARGE : RETICLE_OPACITY_IDLE;\n    retLiteMat.opacity = charging ? RETICLE_LITE_OPACITY_CHARGE : RETICLE_LITE_OPACITY_IDLE;\n\n    const reticleActive = allowFire && fromObject.visible !== false;\n    reticle.visible = reticleActive;\n    reticleLite.visible = reticleActive;\n  }\n\n /* ── reticle & lock-on while charging ───────────────────── */\nif (charging) {\n\n\n\n\n  /* ----- pick & toggle target ----- */\n/* ----- pick candidate under reticle ----- */\n/* ----- pick candidate along beam (0-50 u) ----- */\nnextTarget = null;\nnextTarget = findLockTarget(retShipPos, retForward);\n\n\n/* if we see a new candidate, make it the primary lock */\nif (nextTarget) {\n  lockedTarget = nextTarget;\n  lockTimer    = 0;                   // reset fade timer\n}\n\n/* show the ring on the *locked* target, not the transient one */\nGET_ENEMY().forEach(f => {\n  if (f.userData.lockRing)\n      f.userData.lockRing.visible = (f === lockedTarget);\n});\n\n\n\n}\n\nelse {                                   // <— not charging\n  if (lockedTarget) {\n    lockTimer += dt;\n    const expired = lockTimer > LOCK_FADE || !lockedTarget.visible;\n\n    /* show or hide the ring for EVERY fighter */\n    GET_ENEMY().forEach(f => {\n      f.userData.lockRing && (f.userData.lockRing.visible = false);\n    });\n\n    if (expired) lockedTarget = null;    // forget after fade\n  } else {\n    /* no lock at all — hide every ring */\n    GET_ENEMY().forEach(f => {\n      f.userData.lockRing && (f.userData.lockRing.visible = false);\n    });\n}}\n\n\n/* ── update every active charge sphere ───────────────────── */\nchargePool.forEach(s => {\n  if (!s.visible) return;                     // slot unused\n\n  /* keep the one on the nose fixed until released */\n  if (charging && s === chargeObj) return;\n\n  /* advance */\n  tmpPrev.copy(s.position);\n  s.userData.prev = (s.userData.prev || new THREE.Vector3()).copy(tmpPrev);\n  s.translateZ(CHARGE_SPEED * dt);\n  s.userData.flown += CHARGE_SPEED * dt;\n  s.userData.time  += dt;\n  let explodeNow = false;\n\n  const hitStatic = linecastStatic(tmpPrev, s.position);\n  if (hitStatic) {\n    s.position.copy(hitStatic.point);\n    explodeNow = true;\n  }\n  if (!explodeNow && STATION_COLLIDER) {\n    const hit = stationLinecast(tmpPrev, s.position);\n    if (hit) {\n      s.position.copy(hit.point);\n      explodeNow = true;\n    } else if (stationIntersectsSphere(s.position, CHARGE_SCALE_MAX)) {\n      explodeNow = true;\n    }\n  }\n\n  /* impact checks without full scene traversal */\n  let hitTarget = null;\n  if (!explodeNow) {\n    const enemies = GET_ENEMY ? GET_ENEMY() : [];\n    for (let i = 0; i < enemies.length; i++) {\n      const root = enemies[i];\n      if (!root?.visible) continue;\n      const chargeRadius = root.userData?.chargeRadius ?? root.userData?.hitRadius;\n      const hitR2 = chargeRadius ? (chargeRadius * chargeRadius) : MIN_HIT_R2;\n      if (root.getWorldPosition(tmp).distanceToSquared(s.position) < hitR2) {\n        hitTarget = root;\n        explodeNow = true;\n        break;\n      }\n    }\n  }\n\n  if (!explodeNow && BOSS_MESH && BOSS_MESH.visible &&\n      BOSS_MESH.position.distanceToSquared(s.position) < BOSS_R2) {\n    explodeNow = true;\n  }\n\napplyHoming(s, s.userData.target, 0.10);\n\n\n\n  /* range + timeout */\n  if (s.userData.flown >= CHARGE_RANGE ||\n      s.userData.time  >= MAX_FLIGHT_T)\n    explodeNow = true;\n\n  /* perform explosion */\n  if (explodeNow) {\n    explodeCharge(s.position, hitTarget, s.userData?.shotId ?? null);\n    s.visible = false;               // frees this pool slot\n  }\n});\n\n/* ── update every active bomb ───────────────────── */\nbombPool.forEach(b => {\n  if (!b.visible) return;\n  if (!b.userData.target && lockedTarget && lockedTarget.visible && charging) {\n    b.userData.target = lockedTarget;\n  }\n\n  tmpPrev.copy(b.position);\n  b.userData.prev = (b.userData.prev || new THREE.Vector3()).copy(tmpPrev);\n  b.translateZ(BOMB_SPEED * dt);\n  b.userData.flown = (b.userData.flown ?? 0) + BOMB_SPEED * dt;\n  b.userData.time = (b.userData.time ?? 0) + dt;\n  let explodeNow = false;\n\n  const hitStatic = linecastStatic(tmpPrev, b.position);\n  if (hitStatic) {\n    b.position.copy(hitStatic.point);\n    explodeNow = true;\n  }\n  if (!explodeNow && STATION_COLLIDER) {\n    const hit = stationLinecast(tmpPrev, b.position);\n    if (hit) {\n      b.position.copy(hit.point);\n      explodeNow = true;\n    } else if (stationIntersectsSphere(b.position, BOMB_RADIUS)) {\n      explodeNow = true;\n    }\n  }\n\n  let hitTarget = null;\n  if (!explodeNow) {\n    const enemies = GET_ENEMY ? GET_ENEMY() : [];\n    for (let i = 0; i < enemies.length; i++) {\n      const root = enemies[i];\n      if (!root?.visible) continue;\n      const bombRadius = root.userData?.chargeRadius ?? root.userData?.hitRadius;\n      const hitR2 = bombRadius ? (bombRadius * bombRadius) : MIN_HIT_R2;\n      if (root.getWorldPosition(tmp).distanceToSquared(b.position) < hitR2) {\n        hitTarget = root;\n        explodeNow = true;\n        break;\n      }\n    }\n  }\n\n  if (!explodeNow && BOSS_MESH && BOSS_MESH.visible &&\n      BOSS_MESH.position.distanceToSquared(b.position) < BOSS_R2) {\n    explodeNow = true;\n  }\n\n  applyHoming(b, b.userData.target, 0.10);\n\n  if (b.userData.flown >= BOMB_RANGE ||\n      b.userData.time >= MAX_FLIGHT_T) {\n    explodeNow = true;\n  }\n\n  if (explodeNow) {\n    explodeBomb(b.position, hitTarget, b.userData?.shotId ?? null);\n    b.visible = false;\n  }\n});\n\n\n\n    /* move & cull */\n    pool.forEach(l => {\n      if (!l.visible) return;\n\n      // remember start of step for segment collision\n      tmpPrev.copy(l.position);\n      l.userData.prev = (l.userData.prev || new THREE.Vector3()).copy(tmpPrev);\n\n      l.translateZ(speed * dt);\n\n      // collide with any static tunnel/asteroid set piece\n      const hitStatic = linecastStatic(tmpPrev, l.position);\n      if (hitStatic) {\n        l.position.copy(hitStatic.point);\n        const didHit = applyStaticDamage(hitStatic, l);\n        if (didHit && l.userData?.shotId) {\n          onShotHit && onShotHit(l.userData.shotId);\n        }\n        spawnTinyImpact(hitStatic.point, l.userData?.isBlue);\n        l.visible = false;\n      }\n\n      l.userData.life -= dt;\n      if (l.userData.life <= 0) l.visible = false;\n    });\n\n    allyPool.forEach(l => {\n      if (!l.visible) return;\n\n      tmpPrev.copy(l.position);\n      l.userData.prev = (l.userData.prev || new THREE.Vector3()).copy(tmpPrev);\n\n      l.translateZ(speed * dt);\n\n      const hitStatic = linecastStatic(tmpPrev, l.position);\n      if (hitStatic) {\n        l.position.copy(hitStatic.point);\n        applyStaticDamage(hitStatic, l);\n        spawnTinyImpact(hitStatic.point, false);\n        l.visible = false;\n      }\n\n      l.userData.life -= dt;\n      if (l.userData.life <= 0) l.visible = false;\n    });\n  }\n\n\n  /** returns an array of visible laser meshes */\n  function getActive() {\n    const active = pool.filter(l => l.visible);\n    allyPool.forEach(l => { if (l.visible) active.push(l); });\n    return active;\n  }\n\n  function awardEnemyKill(root) {\n    if (!root) return;\n    const shouldScore = !root.userData?.noScore;\n    if (shouldScore) {\n      const scoreValue = root.userData?.scoreValue ?? 100;\n      addScore(scoreValue);\n    }\n    if (onEnemyKilled && root.getWorldPosition) {\n      root.getWorldPosition(tmpKill);\n      onEnemyKilled(tmpKill, root);\n    }\n  }\n\n  /* hide whole fighter & flag it dead so its update loop stops */\n  function killEnemy(root){\n    if (!root || root.userData?.dead) return;\n    root.visible       = false;\n    root.userData.dead = true;\n    if (root.userData.lockRing) root.userData.lockRing.visible = false;\n    awardEnemyKill(root);\n    /* optional: instantly hide its own lasers if you store them by owner */\n  }\n\n\n\nfunction explodeCharge(pos, hitTarget = null, shotId = null){\n  let   bossHit = false;                 // ensure ≤1 HP per blast\n  const innerR = BLAST_INNER_R;\n  const outerR = BLAST_OUTER_R;\n  const androssGroups = new Set();\n  const isCriticalAndross = part => part === 'eyes' || part === 'palmL' || part === 'palmR';\n  let didHit = false;\n\n  const processed = new Set();   // keep fighters we've already damaged\n\n  if (hitTarget?.userData?.androssPart && hitTarget?.userData?.damageFn) {\n    const owner = hitTarget.userData.androssOwner ?? hitTarget;\n    androssGroups.add(owner);\n    const died = hitTarget.userData.damageFn(CHARGE_DAMAGE);\n    hitTarget.userData.blink && hitTarget.userData.blink();\n    if (died) awardEnemyKill(owner);\n    didHit = true;\n  }\n\n  /* ---------- fighters (targeted list; avoid full-scene traverse) ---- */\n  const enemies = GET_ENEMY ? GET_ENEMY() : [];\n  for (let i = 0; i < enemies.length; i++) {\n    const root = enemies[i];\n    if (!root?.visible || !root.userData) continue;\n    root.updateMatrixWorld?.(false);\n    const blastR = root.userData?.blastRadius ?? innerR;\n    const d2 = root.getWorldPosition(tmp).distanceToSquared(pos);\n    if (d2 >= blastR * blastR) continue;\n\n    if (root.userData.androssPart && root.userData.damageFn) {\n      const owner = root.userData.androssOwner ?? root;\n      if (androssGroups.has(owner)) continue;\n      if (!hitTarget && isCriticalAndross(root.userData.androssPart)) continue;\n      androssGroups.add(owner);\n      const died = root.userData.damageFn(CHARGE_DAMAGE);\n      root.userData.blink && root.userData.blink();\n      if (died) awardEnemyKill(owner);\n      didHit = true;\n      continue;\n    }\n\n    if (processed.has(root)) continue;         // avoid double-hits on same fighter\n    processed.add(root);\n\n    root.userData.blink && root.userData.blink();\n\n    /* start red flash for this spider (or any multi-HP enemy) */\n    root.userData.flashT = 0.5;          // start timer\n    // some enemies (e.g., pooled projectiles) may not expose meshes array\n    if (root.userData.meshes?.forEach) {\n      root.userData.meshes.forEach(m =>\n        m.material.emissive.setRGB(1, 0, 0));\n    }\n\n    if (root.userData.hp > CHARGE_DAMAGE) {              // spider survives the blast\n      root.userData.hp -= CHARGE_DAMAGE;                 // 3-laser damage\n    } else {                                 // this blast kills it\n      killEnemy(root);                       // remove fighter & +100 score\n    }\n    didHit = true;\n  }\n\n  /* ---------- boss (once) -------------------------------- */\n  if (!bossHit && BOSS_MESH && BOSS_MESH.visible &&\n      BOSS_MESH.position.distanceToSquared(pos) < BOSS_R2) {\n    DAMAGE_BOSS(CHARGE_DAMAGE);                                    // single-laser dmg\n    bossHit = true;\n    didHit = true;\n  }\n\n  /* ---------- station ------------------------------------ */\n  if (stationIntersectsSphere(pos, innerR)) {\n    DAMAGE_STATION(CHARGE_DAMAGE);            // same 3-laser punch\n    /* start red flash */\n    STATION_MESH?.userData?.blink && STATION_MESH.userData.blink();\n    didHit = true;\n  }\n\n  /* simple visual flash – pooled expanding transparent spheres */\n  blastFX.forEach((fx, i) => {\n    fx.visible = true;\n    fx.position.copy(pos);\n    fx.scale.setScalar(BLAST_START_SCALE);\n    fx.userData.life = BLAST_LIFE;\n    if (typeof fx.userData.baseOpacity !== 'number') {\n      fx.userData.baseOpacity = 0.5;\n    }\n    setBlastOpacity(fx, fx.userData.baseOpacity);\n  });\n  if (didHit && shotId) {\n    onShotHit && onShotHit(shotId);\n  }\n}\n\nconst bombDamageProcessed = new Set();\nconst bombAndrossGroups = new Set();\nconst isCriticalAndrossPart = part => part === 'eyes' || part === 'palmL' || part === 'palmR';\n\nfunction applyBombDamageAmount(pos, amount, hitTarget = null) {\n  if (!pos || amount <= 0) return false;\n  let didHit = false;\n\n  bombDamageProcessed.clear();\n  bombAndrossGroups.clear();\n\n  if (hitTarget?.userData?.androssPart && hitTarget.userData.damageFn) {\n    const owner = hitTarget.userData.androssOwner ?? hitTarget;\n    bombAndrossGroups.add(owner);\n    const died = hitTarget.userData.damageFn(amount);\n    hitTarget.userData.blink && hitTarget.userData.blink();\n    if (died) awardEnemyKill(owner);\n    didHit = true;\n  }\n\n  const enemies = GET_ENEMY ? GET_ENEMY() : [];\n  for (let i = 0; i < enemies.length; i++) {\n    const root = enemies[i];\n    if (!root?.visible || !root.userData) continue;\n    root.updateMatrixWorld?.(false);\n    const blastR = root.userData?.blastRadius ?? BOMB_BLAST_INNER_R;\n    const d2 = root.getWorldPosition(tmp).distanceToSquared(pos);\n    if (d2 >= blastR * blastR) continue;\n\n    if (root.userData.androssPart && root.userData.damageFn) {\n      const owner = root.userData.androssOwner ?? root;\n      if (bombAndrossGroups.has(owner)) continue;\n      if (!hitTarget && isCriticalAndrossPart(root.userData.androssPart)) continue;\n      bombAndrossGroups.add(owner);\n      const died = root.userData.damageFn(amount);\n      root.userData.blink && root.userData.blink();\n      if (died) awardEnemyKill(owner);\n      didHit = true;\n      continue;\n    }\n\n    if (bombDamageProcessed.has(root)) continue;\n    bombDamageProcessed.add(root);\n\n    root.userData.blink && root.userData.blink();\n    root.userData.flashT = 0.5;\n    if (root.userData.meshes?.forEach) {\n      root.userData.meshes.forEach(m =>\n        m.material.emissive.setRGB(1, 0, 0));\n    }\n\n    const hp = root.userData.hp ?? 1;\n    if (hp <= 1) {\n      root.userData.hp = 0;\n      killEnemy(root);\n      continue;\n    }\n    const nextHp = hp - amount;\n    root.userData.hp = nextHp;\n    if (nextHp <= 0) {\n      killEnemy(root);\n    }\n    didHit = true;\n  }\n\n  if (BOSS_MESH && BOSS_MESH.visible &&\n      BOSS_MESH.position.distanceToSquared(pos) < BOSS_R2) {\n    DAMAGE_BOSS(amount);\n    didHit = true;\n  }\n\n  if (stationIntersectsSphere(pos, BOMB_BLAST_INNER_R)) {\n    DAMAGE_STATION(amount);\n    STATION_MESH?.userData?.blink && STATION_MESH.userData.blink();\n    didHit = true;\n  }\n  return didHit;\n}\n\nfunction applyBombDamage(pos, dt, hitTarget = null) {\n  if (!pos || dt <= 0) return false;\n  const amount = BOMB_DPS * dt;\n  if (amount <= 0) return false;\n  return applyBombDamageAmount(pos, amount, hitTarget);\n}\n\nfunction explodeBomb(pos, hitTarget = null, shotId = null) {\n  const fx = bombBlastFX.find(f => !f.visible);\n  if (!fx) return;\n  fx.visible = true;\n  fx.position.copy(pos);\n  fx.scale.setScalar(BOMB_BLAST_START_SCALE);\n  fx.userData.life = BOMB_BLAST_LIFE;\n  fx.userData.hitTarget = hitTarget;\n  fx.userData.shotId = shotId;\n  fx.userData.statHit = false;\n  if (fx.userData.inner?.material) {\n    fx.userData.inner.material.opacity = fx.userData.innerOpacity;\n  }\n  if (fx.userData.outer?.material) {\n    fx.userData.outer.material.opacity = fx.userData.outerOpacity;\n  }\n  if (fx.userData.spikes?.children?.length) {\n    fx.userData.spikes.children.forEach(spike => {\n      if (spike.material) spike.material.opacity = fx.userData.spikeOpacity;\n    });\n  }\n  const didImpact = applyBombDamageAmount(pos, BOMB_IMPACT_DAMAGE, hitTarget);\n  if (didImpact && shotId && !fx.userData.statHit) {\n    fx.userData.statHit = true;\n    onShotHit && onShotHit(shotId);\n  }\n}\n\n\n  function prewarm(renderer, cam = CAMERA) {\n    const prevVis = pool.map(p => p.visible);\n    const prevAlly = allyPool.map(p => p.visible);\n    const prevCharge = chargePool.map(c => c.visible);\n    const prevBomb = bombPool.map(b => b.visible);\n    const prevBombFx = bombBlastFX.map(fx => fx.visible);\n    const prevRet = reticle.visible;\n    const prevRetLite = reticleLite.visible;\n    pool.forEach(p => p.visible = true);\n    allyPool.forEach(p => p.visible = true);\n    chargePool.forEach(c => c.visible = true);\n    bombPool.forEach(b => b.visible = true);\n    reticle.visible = true;\n    reticleLite.visible = true;\n    blastFX.forEach(fx => fx.visible = true);\n    bombBlastFX.forEach(fx => fx.visible = true);\n    renderer.compile(scene, cam);\n    const prevSize = renderer.getSize(new THREE.Vector2());\n    renderer.setSize(64, 64, false);\n    renderer.render(scene, cam);\n    renderer.setSize(prevSize.x, prevSize.y, false);\n    pool.forEach((p, i) => p.visible = prevVis[i]);\n    allyPool.forEach((p, i) => p.visible = prevAlly[i]);\n    chargePool.forEach((c, i) => c.visible = prevCharge[i]);\n    bombPool.forEach((b, i) => b.visible = prevBomb[i]);\n    reticle.visible = prevRet;\n    reticleLite.visible = prevRetLite;\n    blastFX.forEach(fx => { fx.visible = false; fx.userData.life = 0; });\n    bombBlastFX.forEach((fx, i) => {\n      fx.visible = prevBombFx[i];\n      fx.userData.life = 0;\n    });\n    muzzleFxGreen.prewarm(renderer, cam);\n    muzzleFxBlue.prewarm(renderer, cam);\n  }\n\n  function prewarmDual(fromObject) {\n    if (!fromObject) return;\n    const prevDual = dualMode;\n    const prevBlue = blueMode;\n    const prevVis = pool.map(p => p.visible);\n    const prevLife = pool.map(p => p.userData.life);\n    const prevDamage = pool.map(p => p.userData.damage);\n    dualMode = true;\n    suppressShotEvents = true;\n    spawn(fromObject);\n    suppressShotEvents = false;\n    dualMode = prevDual;\n    blueMode = prevBlue;\n    pool.forEach((p, i) => {\n      if (!prevVis[i] && p.visible) {\n        p.visible = false;\n        p.userData.life = prevLife[i] ?? 0;\n        p.userData.damage = prevDamage[i];\n      }\n    });\n  }\n\n  function applyLaserMode() {\n    const nextColor = blueMode ? BLUE_COLOR : BASE_COLOR;\n    damageMult = blueMode ? 2 : 1;\n    mat.color.setHex(nextColor);\n    pool.forEach(p => {\n      if (p.visible) p.userData.damage = damageMult;\n    });\n  }\n\n  function enableBlue(flag = true) {\n    blueMode = flag;\n    applyLaserMode();\n  }\n\n  function resetUpgrades() {\n    dualMode = false;\n    blueMode = false;\n    applyLaserMode();\n  }\n\n  return {\n    update,\n    getActive,\n    enableDual: (flag = true) => { dualMode = flag; },\n    enableBlue,\n    resetUpgrades,\n    isDual: () => dualMode,\n    isBlue: () => blueMode,\n    clearInput: resetTriggerState,\n    fireAllyShot,\n    fireBomb,\n    prewarm,\n    prewarmDual\n  };\n\n}\n","import * as THREE from './libs/build/three.module.js';\n\nexport function addStarfield(scene, {\n  radius = 12200,\n  depth  = 500,\n  count  = 20000,\n  size   = 0.7,\n  colour = 0xffffff\n} = {}) {\n  const pos = new Float32Array(count * 3);\n  const outer = Math.max(1, radius + depth);\n  for (let i = 0; i < count; i++) {\n    // Uniform distribution through sphere volume (not a shell).\n    const r = Math.cbrt(Math.random()) * outer;\n    const v = new THREE.Vector3().randomDirection().multiplyScalar(r);\n    pos.set([v.x, v.y, v.z], i * 3);\n  }\n  const geo = new THREE.BufferGeometry()\n    .setAttribute('position', new THREE.BufferAttribute(pos, 3));\n  scene.add(new THREE.Points(\n    geo,\n    new THREE.PointsMaterial({ size, color: colour })\n  ));\n}\n","/* collision-system.js */\nimport * as THREE from './libs/build/three.module.js';\n\nexport function createCollisionSystem({\n  asteroidGroup,\n  laserSystem,          // module with getActive()\n  enemyShips,            // array of visible enemy meshes   ← NEW\n  enemyLasers,           // array of visible enemy lasers  ← NEW\n  bossMesh,\n  damageBoss,\n  playerMesh,\n  playerRadius,\n  stationMesh,        // ← NEW\n  damageStation,      // ← NEW\n  asteroidPassage = null,   // optional { getMesh(), collider }\n  staticHazards = [],       // optional array of additional colliders {mesh, collider}\n  hazardPlayerCollisionEnabled = true,  // toggle player vs set-piece hazards\n  hazardLaserCollisionEnabled  = true,  // toggle lasers vs set-piece hazards\n  hazardEnemyCollisionEnabled  = true,  // toggle enemy vs set-piece hazards\n  asteroidHazardCollisionEnabled = false, // toggle asteroids vs set-piece hazards\n  onLaserHit  = () => {},\n  onPlayerHit = () => {},\n  onEnemyDestroyed = () => {},          // NEW; called with position vector\n  onEnemyNeutralized = () => {},        // NEW; non-scoring deaths (hazards)\n  onAsteroidDestroyed = () => {},       // called with asteroid world position\n  onShotHit = () => {},                 // player shot hit a damageable target\n  isRolling       = () => false,\n  androssBeams    = () => []\n\n}) {\n  const tmp = new THREE.Vector3();    // shared scratch\n  const tmpShip = new THREE.Vector3();\n  const tmpRock = new THREE.Vector3();\n  const segDir = new THREE.Vector3();\n  const segMin = new THREE.Vector3();\n  const segMax = new THREE.Vector3();\n  const segBox = new THREE.Box3();\n  const segTmpA = new THREE.Vector3();\n  const segTmpB = new THREE.Vector3();\n  const BOSS_R2 = 100;      // 10²  (≈ bounding-sphere²)\n  const Z_GATE  = 120;      // quick reject on z-axis\n  const ASTEROID_Z_PAD = 120; // coarse reject for asteroid checks\n  const tmpHandLocal = new THREE.Vector3();\n  const tmpHandClosest = new THREE.Vector3();\n  const handHitCooldowns = new WeakMap();\n  const beamBoxWorld = new THREE.Box3();\n  const beamClosest = new THREE.Vector3();\n  const beamSegA = new THREE.Vector3();\n  const beamSegB = new THREE.Vector3();\n  const tmpSphere = new THREE.Sphere();\n  const tmpCenter = new THREE.Vector3();\n  const tmpSize = new THREE.Vector3();\n  const tmpLocal = new THREE.Vector3();\n  const tmpLocalPrev = new THREE.Vector3();\n  const tmpLocalCurr = new THREE.Vector3();\n  const tmpHit = new THREE.Vector3();\n  const BEAM_HIT_COOLDOWN = 0.5;\n  let beamHitTimer = 0;\n\n\n/* ── cached station collision geometry (if a station exists) ── */\n  const stationCollider = stationMesh?.userData?.collider ?? null;\n\n  /* collect static hazards (tunnels, flats, etc.) */\n  const hazards = [];\n  function addHazard(entry) {\n    if (!entry) return;\n    const mesh = entry.getMesh ? entry.getMesh() : entry.mesh ?? null;\n    const collider = entry.collider ?? mesh?.userData?.collider ?? null;\n    if (!mesh || !collider) return;\n    hazards.push({\n      mesh,\n      collider,\n      laserCollisionEnabled: mesh.userData?.laserCollisionEnabled !== false,\n      gateCylinder: mesh.userData?.gateCylinder ?? null,\n      playerState: { insideTimer: 0, colliding: false },\n      enemyState : new WeakMap()\n    });\n  }\n  addHazard(asteroidPassage);\n  (staticHazards ?? []).forEach(addHazard);\n\n  let stationInsideTimer = 0;\n  let stationColliding = false;\n\n  function killRock(rock) {\n    if (!rock || rock.userData.dead) return;\n    rock.visible = false;\n    rock.userData.dead = true;\n    const pos = rock.getWorldPosition ? rock.getWorldPosition(tmpRock) : rock.position;\n    onAsteroidDestroyed(pos);\n  }\n\n  function awardEnemyKill(ship, { awardScore = true } = {}) {\n    if (!ship) return;\n    const shouldScore = awardScore && !ship.userData?.noScore;\n    (shouldScore ? onEnemyDestroyed : onEnemyNeutralized)(ship.position, ship);\n  }\n\n  function damageEnemyShip(ship, { awardScore = true } = {}) {\n    if (!ship?.visible || !ship.userData) return false;\n\n    /* boss parts handle their own HP bookkeeping */\n    if (ship.userData.androssPart && ship.userData.damageFn) {\n      const owner = ship.userData.androssOwner ?? ship;\n      const died = ship.userData.damageFn(1);\n      if (died) awardEnemyKill(owner, { awardScore });\n      return died;\n    }\n\n    const hp = ship.userData.hp ?? 1;\n    if (hp > 1) {\n      ship.userData.hp = hp - 1;\n      ship.userData.blink?.();\n      return false;\n    }\n\n    ship.userData.blink?.();\n    ship.visible = false;\n    ship.userData.dead = true;\n    ship.userData.lockRing && (ship.userData.lockRing.visible = false);\n    awardEnemyKill(ship, { awardScore });\n    return true;\n  }\n\n  /* scratch vectors */\n  function segmentHitsCollider(collider, mesh, prev, curr) {\n    if (!collider || !mesh?.visible) return false;\n    if (collider.worldAABB) {\n      // quick reject: if segment AABB doesn't touch collider bounds, skip\n      segMin.set(Math.min(prev.x, curr.x), Math.min(prev.y, curr.y), Math.min(prev.z, curr.z));\n      segMax.set(Math.max(prev.x, curr.x), Math.max(prev.y, curr.y), Math.max(prev.z, curr.z));\n      segBox.min.copy(segMin);\n      segBox.max.copy(segMax);\n      if (!segBox.intersectsBox(collider.worldAABB)) return false;\n    }\n    const aabb = collider.worldAABB;\n    if (aabb) {\n      segMin.set(Math.min(prev.x, curr.x), Math.min(prev.y, curr.y), Math.min(prev.z, curr.z));\n      segMax.set(Math.max(prev.x, curr.x), Math.max(prev.y, curr.y), Math.max(prev.z, curr.z));\n      segBox.min.copy(segMin);\n      segBox.max.copy(segMax);\n      if (!segBox.intersectsBox(aabb)) return false; // coarse reject\n    }\n    segDir.copy(curr).sub(prev);\n    const dist = segDir.length();\n    if (dist < 1e-5) return false;\n    segDir.multiplyScalar(1 / dist);\n    const hit = collider.linecast(prev, segDir, dist);\n    if (hit.hit) {\n      curr.copy(hit.point);\n      return true;\n    }\n    return false;\n  }\n\n  function segmentIntersectsBox(a, b, box) {\n    let tmin = 0;\n    let tmax = 1;\n    const dx = b.x - a.x;\n    const dy = b.y - a.y;\n    const dz = b.z - a.z;\n    if (Math.abs(dx) < 1e-8) {\n      if (a.x < box.min.x || a.x > box.max.x) return false;\n    } else {\n      const inv = 1 / dx;\n      let t1 = (box.min.x - a.x) * inv;\n      let t2 = (box.max.x - a.x) * inv;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = Math.max(tmin, t1);\n      tmax = Math.min(tmax, t2);\n      if (tmin > tmax) return false;\n    }\n    if (Math.abs(dy) < 1e-8) {\n      if (a.y < box.min.y || a.y > box.max.y) return false;\n    } else {\n      const inv = 1 / dy;\n      let t1 = (box.min.y - a.y) * inv;\n      let t2 = (box.max.y - a.y) * inv;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = Math.max(tmin, t1);\n      tmax = Math.min(tmax, t2);\n      if (tmin > tmax) return false;\n    }\n    if (Math.abs(dz) < 1e-8) {\n      if (a.z < box.min.z || a.z > box.max.z) return false;\n    } else {\n      const inv = 1 / dz;\n      let t1 = (box.min.z - a.z) * inv;\n      let t2 = (box.max.z - a.z) * inv;\n      if (t1 > t2) { const tmp = t1; t1 = t2; t2 = tmp; }\n      tmin = Math.max(tmin, t1);\n      tmax = Math.min(tmax, t2);\n      if (tmin > tmax) return false;\n    }\n    return true;\n  }\n\n  function segmentHitsHazard(prev, curr, onHit) {\n    for (const h of hazards) {\n      if (!h.mesh?.visible) continue;\n      if (h.laserCollisionEnabled === false) continue;\n      // coarse Z gate to avoid hitting heavy mesh colliders unless near\n      if (h.gateZ !== undefined && h.gateHalfZ !== undefined) {\n        const prevZ = prev.z, currZ = curr.z;\n        const zGate = h.gateHalfZ + 80; // padded gate\n        if (Math.abs(prevZ - h.gateZ) > zGate && Math.abs(currZ - h.gateZ) > zGate) {\n          continue;\n        }\n      }\n      if (h.gateCylinder) {\n        const gate = h.gateCylinder;\n        const segMinY = Math.min(prev.y, curr.y);\n        const segMaxY = Math.max(prev.y, curr.y);\n        if (segMaxY < gate.minY || segMinY > gate.maxY) {\n          continue;\n        }\n        const distSq = segmentDistSq2D(gate.x, gate.z, prev, curr);\n        if (distSq > gate.radius * gate.radius) {\n          continue;\n        }\n      }\n      if (segmentHitsCollider(h.collider, h.mesh, prev, curr)) {\n        onHit && onHit(h);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  function damageHazard(hazard, damage = 1) {\n    const mesh = hazard?.mesh;\n    const destructible = mesh?.userData?.destructible;\n    if (!mesh?.visible || !destructible) return false;\n    const currentHp = Number.isFinite(destructible.hp) ? destructible.hp : 0;\n    const nextHp = currentHp - damage;\n    destructible.hp = nextHp;\n    if (nextHp > 0) return false;\n    mesh.visible = false;\n    mesh.userData.dead = true;\n    mesh.userData.laserCollisionEnabled = false;\n    if (typeof mesh.userData.onDestroyed === 'function') {\n      const pos = mesh.getWorldPosition ? mesh.getWorldPosition(tmpHit) : mesh.position;\n      mesh.userData.onDestroyed(pos, mesh);\n    }\n    return true;\n  }\n\n  function segmentDistSq2D(cx, cz, a, b) {\n    const abx = b.x - a.x;\n    const abz = b.z - a.z;\n    const acx = cx - a.x;\n    const acz = cz - a.z;\n    const abLenSq = abx * abx + abz * abz;\n    let t = 0;\n    if (abLenSq > 1e-8) t = (acx * abx + acz * abz) / abLenSq;\n    if (t < 0) t = 0;\n    else if (t > 1) t = 1;\n    const dx = a.x + abx * t - cx;\n    const dz = a.z + abz * t - cz;\n    return dx * dx + dz * dz;\n  }\n\n  function update(dt = 0) {\n    if (beamHitTimer > 0 && dt > 0) {\n      beamHitTimer = Math.max(0, beamHitTimer - dt);\n    }\n\n    /* -------- lasers × static hazards (tunnels, flats) ------- */\n    if (hazardLaserCollisionEnabled && hazards.length) {\n      const playerBolts = laserSystem.getActive();\n      for (let i = 0; i < playerBolts.length; i++) {\n        const bolt = playerBolts[i];\n        if (!bolt.visible) continue;\n        const prev = bolt.userData.prev ?? bolt.position;\n        if (segmentHitsHazard(prev, bolt.position, (hazard) => {\n          const dmg = bolt.userData?.damage ?? 1;\n          damageHazard(hazard, dmg);\n        })) bolt.visible = false;\n      }\n      const enemyBoltArr = enemyLasers();\n      for (let i = 0; i < enemyBoltArr.length; i++) {\n        const bolt = enemyBoltArr[i];\n        if (!bolt?.position) continue;\n        const prev = bolt.prev ?? bolt.position;\n        if (segmentHitsHazard(prev, bolt.position)) {\n          if (bolt.userData) bolt.userData.life = 0;\n        }\n      }\n    }\n\n    /* ------------- player laser × boss -------------- */\n    if (bossMesh.visible){\n      const playerBolts = laserSystem.getActive();\n      for (let i = 0; i < playerBolts.length; i++) {\n        const b = playerBolts[i];\n        if(!b.visible) continue;\n        if(Math.abs(b.position.z-bossMesh.position.z)>Z_GATE) continue;\n        if(bossMesh.position.distanceToSquared(b.position)<BOSS_R2){\n          const dmg = b.userData?.damage ?? 1;\n          if (b.userData?.shotId) onShotHit(b.userData.shotId);\n          b.visible=false;\n          damageBoss(dmg);\n        }\n      }\n      /* reflected enemy / boss bolts hurt boss too */\n      const enemyBoltArr = enemyLasers();\n      for (let i = 0; i < enemyBoltArr.length; i++) {\n        const b = enemyBoltArr[i];\n        if(!b.visible||!b.userData.bounced) continue;\n        if(Math.abs(b.position.z-bossMesh.position.z)>Z_GATE) continue;\n        if(bossMesh.position.distanceToSquared(b.position)<BOSS_R2){\n          b.visible=false;\n          damageBoss(1);\n        }\n      }\n    }\n\n    /* laser vs asteroid */\n    laserSystem.getActive().forEach(laser => {\n      asteroidGroup.children.forEach(rock => {\n        if (!rock.visible) return;\n        const r = rock.scale.x;          // bounding-sphere\n        if (laser.position.distanceToSquared(rock.position) < r*r) {\n          killRock(rock);\n          laser.visible = false;\n          if (laser.userData?.shotId) onShotHit(laser.userData.shotId);\n          onLaserHit();\n        }\n      });\n    });\n\n  /* ---------- enemy laser × asteroid (no score) ---------- */\n    enemyLasers().forEach(bolt=>{\n      if (!bolt?.position) return;\n      const playerPosZ = playerMesh.getWorldPosition(tmp).z;\n      if (Math.abs(bolt.position.z - playerPosZ) > ASTEROID_Z_PAD) return;\n      asteroidGroup.children.forEach(rock=>{\n        if (!rock.visible || rock.userData.dead) return;\n        if (Math.abs(rock.position.z - bolt.position.z) > ASTEROID_Z_PAD) return;\n        const r = rock.scale.x;\n        if (bolt.position.distanceToSquared(rock.position) < r*r){\n          killRock(rock);\n          bolt.userData && (bolt.userData.life = 0);\n        }\n      });\n    });\n\n    /* ---------- enemy ship × asteroid (both vanish) ---------- */\n    enemyShips().forEach(ship=>{\n      asteroidGroup.children.forEach(rock=>{\n        if (!rock.visible || rock.userData.dead || !ship.visible) return;\n        const r = rock.scale.x * 1.2;\n        if (ship.position.distanceToSquared(rock.position) < r*r){\n      ship.userData.collided = true;\n      ship.userData.finishPath?.('collision');\n      /* NEW: spiders take 1 HP, others still explode outright */\n      if (ship.userData.hp > 1) {            // → multi‑hit spider\n        ship.userData.hp--;                  //   −1 HP\n        ship.userData.blink();               //   0.15 s red flash\n\n        /* asteroid is still destroyed */\n        killRock(rock);\n\n        /* if that was the last HP, clean up just like a laser kill */\n        if (ship.userData.hp === 0) ship.visible = false;\n\n     } else {                               // → one‑hit fighters\n        ship.userData.blink();\n        killRock(rock);\n        ship.visible = false;\n      }\n        }\n      });\n    });\n\n/* ---------- enemy laser × player ---------- */\nconst shipPos = playerMesh.getWorldPosition(tmp);\n\nenemyLasers().forEach(bolt => {\n  if (!bolt?.position) return;\n  const bounced = bolt.userData?.bounced ?? false;\n  if (bounced) return;\n\n  const hit =\n    shipPos.distanceToSquared(bolt.position) <\n    (playerRadius + 0.5) ** 2;\n  if (!hit) return;\n\n  /* while rolling → reflect and ignore damage */\n  if (isRolling()) {\n    if (bolt.userData){\n      bolt.userData.bounced = true;   // mark so we’ll ignore it next frames\n      bolt.userData.dir *= -1;        // reverse direction\n    }\n    return;                         // <-- no heart loss\n  }\n\n  /* not rolling → normal damage */\n  if (bolt.userData) bolt.userData.life = 0;\n  onPlayerHit(bolt.position);\n});\n\n    /* ---------- boss beams × player ---------- */\n    const beams = androssBeams ? androssBeams() : [];\n    if (beams && beams.length) {\n      for (const beam of beams) {\n        if (!beam?.visible || !beam.geometry) continue;\n        beam.updateMatrixWorld(true);\n        if (!beam.geometry.boundingBox) beam.geometry.computeBoundingBox?.();\n        const bbox = beam.geometry.boundingBox;\n        if (!bbox) continue;\n        // treat beam as a segment from bbox.min.z to bbox.max.z in local space\n        beamSegA.set(0, 0, bbox.min.z).applyMatrix4(beam.matrixWorld);\n        beamSegB.set(0, 0, bbox.max.z).applyMatrix4(beam.matrixWorld);\n        const beamWidth = (bbox.max.x - bbox.min.x) * (beam.scale?.x ?? 1);\n        const radius = (beamWidth * 0.5) + 0.1; // small margin\n        const distSq = pointSegmentDistSq(shipPos, beamSegA, beamSegB, beamClosest);\n        const hit = distSq <= radius * radius;\n        if (hit && beamHitTimer <= 0) {\n          tmpHit.copy(shipPos).sub(beamClosest);\n          if (tmpHit.lengthSq() > 1e-6) {\n            tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n          } else {\n            tmpHit.copy(shipPos);\n          }\n          onPlayerHit(tmpHit);\n          beamHitTimer = BEAM_HIT_COOLDOWN;\n          break; // apply cooldown before checking other beams this frame\n        }\n      }\n    }\n\n\n\n\n    /* ---------- player laser × enemy ship ---------- */\n    laserSystem.getActive().forEach(bolt=>{\n      enemyShips().forEach(ship=>{\n        if (!bolt.visible) return;\n        if (!ship.visible) return;\n        const hitR = ship.userData.hitRadius ?? 3;\n        const shipWorld = ship.getWorldPosition ? ship.getWorldPosition(tmpShip) : ship.position;\n        const hitBoxes = ship.userData?.hitBoxes;\n        const prev = bolt.userData?.prev ?? bolt.position;\n        let hit = false;\n\n        if (hitBoxes && hitBoxes.length) {\n          tmpLocalPrev.copy(prev);\n          tmpLocalCurr.copy(bolt.position);\n          ship.worldToLocal(tmpLocalPrev);\n          ship.worldToLocal(tmpLocalCurr);\n          for (let i = 0; i < hitBoxes.length; i++) {\n            if (segmentIntersectsBox(tmpLocalPrev, tmpLocalCurr, hitBoxes[i])) { hit = true; break; }\n          }\n          if (!hit) return;\n        } else {\n          hit = bolt.position.distanceToSquared(shipWorld) < hitR * hitR;\n          if (!hit) return;\n        }\n\n        const dmg = bolt.userData?.damage ?? 1;\n        /* special handling for multi-HP (spiders) and bosses */\n        if (ship.userData.androssPart && ship.userData.damageFn) {\n          const owner = ship.userData.androssOwner ?? ship;\n          const died = ship.userData.damageFn(dmg);\n          bolt.visible = false;\n          if (bolt.userData?.shotId) onShotHit(bolt.userData.shotId);\n          if (died) awardEnemyKill(owner);\n          return;\n        }\n\n        /* spiders take 5 hits, others die in 1 */\n        const hp = ship.userData.hp ?? 1;\n        if (hp > dmg) {\n          ship.userData.hp = hp - dmg;\n          ship.userData.blink();           // red flash\n          bolt.visible = false;          // consume the laser\n          if (bolt.userData?.shotId) onShotHit(bolt.userData.shotId);\n        } else {\n          ship.userData.blink();\n          bolt.visible = ship.visible = false;  // destroy fighter\n          ship.userData.dead = true;\n          if (bolt.userData?.shotId) onShotHit(bolt.userData.shotId);\n          awardEnemyKill(ship);      // +100 pts + explosion\n        }\n      });\n    });\n\n    /* ---------- reflected enemy laser × enemy ship (incl. Andross parts) ---------- */\n    enemyLasers().forEach(bolt=>{\n      if (!bolt?.position) return;\n      if (!bolt.userData?.bounced) return;\n      enemyShips().forEach(ship=>{\n        if (bolt.userData?.life <= 0 || bolt.visible === false) return;\n        if (!ship.visible || !ship.userData?.hp || !ship.userData?.blink) return;\n        const hitR = ship.userData.hitRadius ?? 3;\n        const shipWorld = ship.getWorldPosition ? ship.getWorldPosition(tmpShip) : ship.position;\n        const hitBoxes = ship.userData?.hitBoxes;\n        const prev = bolt.prev ?? bolt.position;\n        let hit = false;\n        if (hitBoxes && hitBoxes.length) {\n          tmpLocalPrev.copy(prev);\n          tmpLocalCurr.copy(bolt.position);\n          ship.worldToLocal(tmpLocalPrev);\n          ship.worldToLocal(tmpLocalCurr);\n          hit = hitBoxes.some(box => segmentIntersectsBox(tmpLocalPrev, tmpLocalCurr, box));\n        } else {\n          hit = bolt.position.distanceToSquared(shipWorld) < hitR * hitR;\n        }\n        if (hit) {\n          if (ship.userData.androssPart && ship.userData.damageFn) {\n            const owner = ship.userData.androssOwner ?? ship;\n            const died = ship.userData.damageFn(1);\n            bolt.userData && (bolt.userData.life = 0);\n            if (died) awardEnemyKill(owner);\n            return;\n          }\n          /* reflected bolts should damage just like player lasers */\n          if (ship.userData.hp > 1) {\n            ship.userData.hp--;\n            ship.userData.blink();          // red flash\n            if (bolt.userData) bolt.userData.life = 0;             // consume the bolt\n          } else {\n            ship.userData.blink();            // ← keep\n            if (bolt.userData) bolt.userData.life = 0;\n            ship.visible       = false;\n            ship.userData.dead = true;\n            awardEnemyKill(ship);               // +100 pts\n          }\n        }\n      });\n    });\n\n    /* player vs asteroid */\n    const playerPosZ = playerMesh.getWorldPosition(tmp).z;\n    asteroidGroup.children.forEach(rock => {\n      if (!rock.visible) return;\n      if (Math.abs(rock.position.z - playerPosZ) > ASTEROID_Z_PAD) return;\n      const r = rock.scale.x * 1.2;\n      const shipPos = playerMesh.getWorldPosition(tmp);\n      if (shipPos.distanceToSquared(rock.position) <\n          (playerRadius + r) * (playerRadius + r)) {\n        killRock(rock);\n        tmpHit.copy(shipPos).sub(rock.position);\n        if (tmpHit.lengthSq() > 1e-6) {\n          tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n        } else {\n          tmpHit.copy(shipPos);\n        }\n        onPlayerHit(tmpHit);\n      }\n    });\n\n    /* player vs static hazards (solid shell + interior) */\n    if (hazardPlayerCollisionEnabled && dt > 0 && hazards.length) {\n      const shipPos = playerMesh.getWorldPosition(tmpShip);\n      hazards.forEach(h => {\n        const state = h.playerState;\n        if (!h.collider || !h.mesh?.visible) {\n          state.insideTimer = 0;\n          state.colliding = false;\n          return;\n        }\n        if (h.gateZ !== undefined && h.gateHalfZ !== undefined) {\n          const zGate = h.gateHalfZ + 80;\n          if (Math.abs(shipPos.z - h.gateZ) > zGate) {\n            state.insideTimer = 0;\n            state.colliding = false;\n            return;\n          }\n        }\n        if (h.collider.worldAABB &&\n            !h.collider.worldAABB.intersectsSphere(tmpSphere.set(shipPos, playerRadius))) {\n          state.insideTimer = 0;\n          state.colliding = false;\n          return;\n        }\n        const hit = h.collider.testSphere(shipPos, playerRadius);\n        const skipInside = Boolean(h.mesh?.userData?.skipInsideCheck);\n        const inside = hit.hit || (!skipInside && h.collider.isPointInside(shipPos));\n        const hitPoint = hit.hit ? hit.point : shipPos;\n        if (inside) {\n          if (!state.colliding) {\n            tmpHit.copy(shipPos).sub(hitPoint);\n            if (tmpHit.lengthSq() > 1e-6) {\n              tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n            } else {\n              tmpHit.copy(shipPos);\n            }\n            onPlayerHit(tmpHit);\n            state.insideTimer = 0;\n          }\n          state.colliding = true;\n          state.insideTimer += dt;\n          while (state.insideTimer >= 1) {\n            tmpHit.copy(shipPos).sub(hitPoint);\n            if (tmpHit.lengthSq() > 1e-6) {\n              tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n            } else {\n              tmpHit.copy(shipPos);\n            }\n            onPlayerHit(tmpHit);\n            state.insideTimer -= 1;\n          }\n        } else {\n          state.insideTimer = 0;\n          state.colliding = false;\n        }\n      });\n    } else if (hazardPlayerCollisionEnabled && hazards.length) {\n      hazards.forEach(h => {\n        h.playerState.insideTimer = 0;\n        h.playerState.colliding = false;\n      });\n    }\n\n    /* enemy vs static hazards (same rules, no points) */\n    if (hazardEnemyCollisionEnabled && dt > 0 && hazards.length) {\n      const enemies = enemyShips();\n      if (enemies && enemies.length) {\n        hazards.forEach(h => {\n          if (!h.collider || !h.mesh?.visible) {\n            h.enemyState = new WeakMap();\n            return;\n          }\n          const zGate = h.gateHalfZ !== undefined ? h.gateHalfZ + 80 : null;\n          const stateMap = h.enemyState;\n          enemies.forEach(ship => {\n            if (!ship?.visible || ship.userData?.dead) return;\n            if (zGate !== null && Math.abs(ship.position.z - h.gateZ) > zGate) {\n              const state = stateMap.get(ship);\n              if (state) {\n                state.insideTimer = 0;\n                state.colliding = false;\n              }\n              return;\n            }\n            const hitR = ship.userData?.hitRadius ?? 3;\n            const shipPos = ship.getWorldPosition ? ship.getWorldPosition(tmpShip) : ship.position;\n            if (h.collider.worldAABB &&\n                !h.collider.worldAABB.intersectsSphere(tmpSphere.set(shipPos, hitR))) {\n              const state = stateMap.get(ship);\n              if (state) {\n                state.insideTimer = 0;\n                state.colliding = false;\n              }\n              return;\n            }\n            const state = stateMap.get(ship) ?? { insideTimer: 0, colliding: false };\n            const hit = h.collider.testSphere(shipPos, hitR);\n            const skipInside = Boolean(h.mesh?.userData?.skipInsideCheck);\n            const inside = hit.hit || (!skipInside && h.collider.isPointInside(shipPos));\n            if (inside) {\n              ship.userData.collided = true;\n              ship.userData.finishPath?.('collision');\n              if (!state.colliding) {\n                if (damageEnemyShip(ship, { awardScore: false })) {\n                  stateMap.delete(ship);\n                  return;\n                }\n                state.insideTimer = 0;\n              }\n              state.colliding = true;\n              state.insideTimer += dt;\n              while (state.insideTimer >= 1 && ship.visible && !ship.userData?.dead) {\n                damageEnemyShip(ship, { awardScore: false });\n                if (!ship.visible || ship.userData?.dead) break;\n                state.insideTimer -= 1;\n              }\n            } else {\n              state.insideTimer = 0;\n              state.colliding = false;\n            }\n\n            if (!ship.visible || ship.userData?.dead) {\n              stateMap.delete(ship);\n            } else {\n              stateMap.set(ship, state);\n            }\n          });\n        });\n      } else {\n        hazards.forEach(h => { h.enemyState = new WeakMap(); });\n      }\n    } else if (hazardEnemyCollisionEnabled && hazards.length) {\n      hazards.forEach(h => { h.enemyState = new WeakMap(); });\n    }\n\n    /* asteroids vs static hazards */\n    if (asteroidHazardCollisionEnabled && hazards.length) {\n      asteroidGroup.children.forEach(rock => {\n        if (!rock.visible || rock.userData.dead) return;\n        const r = rock.scale.x;\n        for (const h of hazards) {\n          if (!h.collider || !h.mesh?.visible) continue;\n          if (h.collider.worldAABB) {\n            h.collider.worldAABB.getCenter(tmpCenter);\n            h.collider.worldAABB.getSize(tmpSize);\n            const halfZ = tmpSize.z * 0.5;\n            if (Math.abs(rock.position.z - tmpCenter.z) > halfZ + 150) continue;\n          }\n          if (h.collider.worldAABB &&\n              !h.collider.worldAABB.intersectsSphere(tmpSphere.set(rock.position, r))) {\n            continue;\n          }\n          const hit = h.collider.testSphere(rock.position, r);\n          const skipInside = Boolean(h.mesh?.userData?.skipInsideCheck);\n          const inside = hit.hit || (!skipInside && h.collider.isPointInside(rock.position));\n          if (inside) {\n            killRock(rock);\n            break;\n          }\n        }\n      });\n    }\n\n    /* player vs station boss (solid mesh) */\n    if (stationCollider && stationMesh?.visible && dt > 0) {\n      const shipPos = playerMesh.getWorldPosition(tmpShip);\n      if (stationCollider.worldAABB?.containsPoint(shipPos)) {\n        const hit = stationCollider.testSphere(shipPos, playerRadius);\n        const inside = hit.hit || stationCollider.isPointInside(shipPos);\n        const hitPoint = hit.hit ? hit.point : shipPos;\n        if (inside) {\n          if (!stationColliding) {\n            tmpHit.copy(shipPos).sub(hitPoint);\n            if (tmpHit.lengthSq() > 1e-6) {\n              tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n            } else {\n              tmpHit.copy(shipPos);\n            }\n            onPlayerHit(tmpHit);\n            stationInsideTimer = 0;\n          }\n          stationColliding = true;\n          stationInsideTimer += dt;\n          while (stationInsideTimer >= 1) {\n            tmpHit.copy(shipPos).sub(hitPoint);\n            if (tmpHit.lengthSq() > 1e-6) {\n              tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n            } else {\n              tmpHit.copy(shipPos);\n            }\n            onPlayerHit(tmpHit);\n            stationInsideTimer -= 1;\n          }\n        } else {\n          stationInsideTimer = 0;\n          stationColliding = false;\n        }\n      } else {\n        stationInsideTimer = 0;\n        stationColliding = false;\n      }\n    } else {\n      stationInsideTimer = 0;\n      stationColliding = false;\n    }\n\n    /* ---------- enemy laser × enemy ship ---------- */\n    enemyLasers().forEach(bolt=>{\n  if (!bolt?.position) return;\n  if (!bolt.userData?.bounced) return;\n  enemyShips().forEach(ship=>{\n  if (!ship.visible || !ship.userData?.hp || !ship.userData?.blink) return;\n    const hitR = ship.userData.hitRadius ?? 3;\n    const shipWorld = ship.getWorldPosition ? ship.getWorldPosition(tmpShip) : ship.position;\n    const hit = bolt.position.distanceToSquared(shipWorld) < hitR*hitR;\nif (hit) {\n\n  /* reflected bolts should damage just like player lasers */\n  if (ship.userData.hp > 1) {\n    ship.userData.hp--;\nship.userData.blink();          // red flash\n    if (bolt.userData) bolt.userData.life = 0;             // consume the bolt\n  } else {\n      ship.userData.blink();            // ← keep\n    if (bolt.userData) bolt.userData.life = 0;\n    ship.visible       = false;\n    ship.userData.dead = true;\n    awardEnemyKill(ship);               // +100 pts\n  }\n}\n  });\n});\n\n\n    /* ---------- player × enemy ship (includes Andross hands) ---------- */\n    enemyShips().forEach(ship=>{\n      if (!ship.visible) {\n        handHitCooldowns.delete(ship);\n        return;\n      }\n      const androssPart = ship.userData?.androssPart;\n      if (androssPart === 'eyes' || androssPart === 'palmL' || androssPart === 'palmR') {\n        return;\n      }\n      const shipPos = playerMesh.getWorldPosition(tmp);\n      const handCol = ship.userData?.handCollider;\n      const isHand = ship.userData?.androssPart === 'handL' || ship.userData?.androssPart === 'handR';\n      let collided = false;\n      const cd = Math.max(0, (handHitCooldowns.get(ship) ?? 0) - dt);\n      handHitCooldowns.set(ship, cd);\n\n      if (handCol?.box) {\n        const playerLocal = ship.worldToLocal(tmpHandLocal.copy(shipPos));\n        const min = handCol.box.min;\n        const max = handCol.box.max;\n        tmpHandClosest.set(\n          THREE.MathUtils.clamp(playerLocal.x, min.x, max.x),\n          THREE.MathUtils.clamp(playerLocal.y, min.y, max.y),\n          THREE.MathUtils.clamp(playerLocal.z, min.z, max.z)\n        );\n        const rHand = playerRadius * 0.4; // hand-only contact uses smaller sphere\n        collided = playerLocal.distanceToSquared(tmpHandClosest) < rHand * rHand;\n      } else {\n        const ENEMY_R = 3;                             // ~half 5-u fighter length\n        collided = shipPos.distanceToSquared(ship.position) <\n          (playerRadius + ENEMY_R) ** 2;\n      }\n\n      if (!collided) return;\n\n      if (isHand) {\n        if (cd === 0) {\n          tmpHit.copy(tmpHandClosest).applyMatrix4(ship.matrixWorld);\n          tmpHit.copy(shipPos).sub(tmpHit);\n          if (tmpHit.lengthSq() > 1e-6) {\n            tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n          } else {\n            tmpHit.copy(shipPos);\n          }\n          onPlayerHit(tmpHit);\n          handHitCooldowns.set(ship, 0.75); // cap to one heart while overlapping\n        }\n        return;\n      }\n\n      ship.visible = false;\n      awardEnemyKill(ship);             // +100 pts\n      tmpHit.copy(shipPos).sub(ship.position);\n      if (tmpHit.lengthSq() > 1e-6) {\n        tmpHit.normalize().multiplyScalar(playerRadius).add(shipPos);\n      } else {\n        tmpHit.copy(shipPos);\n      }\n      onPlayerHit(tmpHit);\n    });\n\n    /* ---------- player laser × station ---------- */\n    if (stationCollider && stationMesh?.visible){\n      laserSystem.getActive().forEach(bolt=>{\n        if (!bolt.visible) return;\n        const prev = bolt.userData.prev ?? bolt.position;\n        if (segmentHitsCollider(stationCollider, stationMesh, prev, bolt.position)){\n          const dmg = bolt.userData?.damage ?? 1;\n          bolt.visible = false;\n          if (bolt.userData?.shotId) onShotHit(bolt.userData.shotId);\n          damageStation?.(dmg);\n        }\n      });\n\n      /* reflected bolts hurt station too */\n      enemyLasers().forEach(bolt=>{\n        if (!bolt?.position) return;\n        if (!bolt.userData?.bounced) return;\n        const prev = bolt.prev ?? bolt.position;\n        if (segmentHitsCollider(stationCollider, stationMesh, prev, bolt.position)){\n          if (bolt.userData) bolt.userData.life = 0;\n          damageStation?.(1);\n        }\n      });\n    }\n\n\n\n  }\n\n  function pointSegmentDistSq(p, a, b, out = null) {\n    segTmpA.copy(b).sub(a);           // ab\n    const lenSq = segTmpA.lengthSq();\n    if (lenSq === 0) {\n      if (out) out.copy(a);\n      return p.distanceToSquared(a);\n    }\n    segTmpB.copy(p).sub(a);           // ap\n    const t = Math.max(0, Math.min(1, segTmpB.dot(segTmpA) / lenSq));\n    if (out) out.copy(a).addScaledVector(segTmpA, t);\n    return segTmpB.copy(a).addScaledVector(segTmpA, t).distanceToSquared(p);\n  }\n\n  return { update };\n}\n","/* diagnostics.js  ─────────────────────────────────────────────\n   DOM overlay on main thread; worker proxy posts diagnostics to host.\n----------------------------------------------------------------*/\n\nconst isWorker = typeof document === 'undefined' || typeof window === 'undefined' || globalThis.__IS_RENDER_WORKER;\nconst showOverlay = !isWorker && !!globalThis.__SHOW_DIAGNOSTICS__;\n\nlet acc = 0, frames = 0;\nlet el = null;\nlet emit = null;\n\nif (showOverlay) {\n  el = document.createElement('div');\n  Object.assign(el.style, {\n    position: 'fixed',\n    right:    '8px',\n    bottom:   '4px',\n    font:     '14px monospace',\n    color:    '#00ff00',\n    pointerEvents: 'none',\n    textAlign: 'right',\n  });\n  document.body.appendChild(el);\n} else if (isWorker && typeof self?.postMessage === 'function' && globalThis.__SHOW_DIAGNOSTICS__) {\n  // only emit diagnostics if overlay is requested\n  emit = (payload) => self.postMessage({ type: 'diag', payload });\n}\n\nlet lastHtml = '';\nexport function renderDiagnosticsLines(lines = []) {\n  if (!el) return;\n  const html = lines.join('<br>');\n  if (html === lastHtml) return;\n  lastHtml = html;\n  el.innerHTML = html;\n}\n\nexport function updateDiagnostics(dt /* seconds */, extraLines = []) {\n  if (!showOverlay && !emit) return;\n  acc    += dt;\n  frames += 1;\n  if (acc >= 0.5) {                 // refresh twice a second\n    const fps = Math.round(frames / acc);\n    const lines = [`${fps} FPS`, ...extraLines];\n    if (showOverlay && el) {\n      const html = lines.join('<br>');\n      if (html !== lastHtml) {\n        lastHtml = html;\n        el.innerHTML = html;\n      }\n    } else if (emit) {\n      emit({ fps, lines });\n    }\n    acc = frames = 0;\n  }\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\n/* optional dev capture of live flight paths */\nexport const CAPTURED_ENEMY_PATHS = [];\nconst CAPTURE_ENABLED = false; // set to false to disable recording\nconst AVOIDANCE_ENABLED = false; // turn off obstacle avoidance entirely\nconst CAPTURE_SAMPLE_STEP = 1 / 30;   // seconds between recorded samples\nconst CAPTURE_BLOCKLIST = ['andross', 'frigate', 'station-boss', 'station-turret', 'spinner', 'platform'];\n\nconst _modelCache = new Map();\nconst sharedLoader = new GLTFLoader();\nasync function loadModelCached(path){\n  if (_modelCache.has(path)) return _modelCache.get(path).clone(true);\n  const gltf = await sharedLoader.loadAsync(path);\n  _modelCache.set(path, gltf.scene);\n  return gltf.scene.clone(true);\n}\n\n/**\n * initEnemySystem(scene, {\n *   spawnArray,                 // [{x,y,z}, …] from spawns.json\n *   playerObj,                  // mesh of the player ship\n *   railCurve,                  // CatmullRomCurve3\n *   playerSpeed,                // forward speed along rail (units/s)\n *   modelPath                   // defaults to ./models/dark1.glb\n *   hazardColliders             // optional static colliders to avoid\n *   hazardEntries               // optional static hazards for LOS checks\n *   canFire                     // optional predicate to gate firing\n * })\n *\n * Returns { update(dt) }\n */\nexport async function initEnemySystem(scene, {\n  spawnArray,\n  playerObj,\n  railCurve,\n  playerSpeed,\n boltPool = null,\n  canFire  = null,\n  modelPath = './models/dark1.glb',\n  yaw       = 0,                    // ← NEW: apply extra Y-rotation (rad)\n  fireDir   = -1,                    // +1 ⇒ shoot +Z; −1 ⇒ shoot −Z\n  orbitRadius = 0,              // ← NEW: 0 ⇒ no cork-screw\n  orbitRate   = 0,               //      (radians · s⁻¹)\n  diagSpeed   = 0,                     // ← NEW\n  diagVec     = null,                  // ← NEW (THREE.Vector3 or null)\n  lateralAmp  = 0,   // NEW zig-zag side amplitude\n  lateralHz   = 0,   // NEW zig-zag frequency  (cycles·s-¹)\n  verticalAmp = 0,   // NEW up-down bob amplitude\n  verticalHz  = 0,   // NEW bob frequency\n  retreatDist = 50,\n  despawnDelay = Infinity,\n  behaviour   = {},          // ← NEW\n  camera,\n  dualGun     = false,          // NEW\n  gunSpacing  = 0,\n  fireInterval = 1.2,\n  fireOffsetZ = 0,\n  forwardAxis = null,\n  burstCount = 0,\n  burstInterval = 0,\n  burstPause = 0,\n  passLoop = false,\n  passDuration = 6,\n  passAhead = 120,\n  passBehind = 20,\n  passFireWindow = 80,\n  orientToVelocity = false,\n  orientToPlayerWhenFiring = false,\n  glowOffset = null,\n  hazardColliders = [],\n  hazardEntries = null,\n  bakedPaths = null,\n  useBakedPaths = true,\n  manualPoolSize = 0,\n  materialMode = 'standard',\n  editorGroup = null,\n\n\n\n}) {\n\n  let backpedal = false;\n\n\n  /* merge behaviour-specific overrides ------------------------- */\n  if (behaviour){\n    if ('despawnDelay' in behaviour) despawnDelay = behaviour.despawnDelay;\n    if ('yaw'         in behaviour) yaw         = behaviour.yaw;\n    if ('fireDir'     in behaviour) fireDir     = behaviour.fireDir;\n    if ('orbitRadius' in behaviour) orbitRadius = behaviour.orbitRadius;\n    if ('orbitRate'   in behaviour) orbitRate   = behaviour.orbitRate;\n    if ('diagSpeed'   in behaviour) diagSpeed   = behaviour.diagSpeed;\n    if ('diagVec'     in behaviour) diagVec     = behaviour.diagVec;\n    if ('lateralAmp'  in behaviour) lateralAmp  = behaviour.lateralAmp;\n    if ('lateralHz'   in behaviour) lateralHz   = behaviour.lateralHz;\n    if ('verticalAmp' in behaviour) verticalAmp = behaviour.verticalAmp;\n    if ('verticalHz'  in behaviour) verticalHz  = behaviour.verticalHz;\n    if ('dualGun'     in behaviour) dualGun     = behaviour.dualGun;\n   if ('gunSpacing'  in behaviour) gunSpacing  = behaviour.gunSpacing;\n    if ('fireInterval'in behaviour) fireInterval= behaviour.fireInterval;\n    if ('fireOffsetZ' in behaviour) fireOffsetZ = behaviour.fireOffsetZ;\n    if ('forwardAxis' in behaviour) forwardAxis = behaviour.forwardAxis;\n    if ('burstCount'  in behaviour) burstCount  = behaviour.burstCount;\n    if ('burstInterval' in behaviour) burstInterval = behaviour.burstInterval;\n    if ('burstPause'  in behaviour) burstPause  = behaviour.burstPause;\n    if ('passLoop'    in behaviour) passLoop    = behaviour.passLoop;\n    if ('passDuration' in behaviour) passDuration = behaviour.passDuration;\n    if ('passAhead'   in behaviour) passAhead   = behaviour.passAhead;\n    if ('passBehind'  in behaviour) passBehind  = behaviour.passBehind;\n    if ('passFireWindow' in behaviour) passFireWindow = behaviour.passFireWindow;\n    if ('orientToVelocity' in behaviour) orientToVelocity = behaviour.orientToVelocity;\n    if ('orientToPlayerWhenFiring' in behaviour) orientToPlayerWhenFiring = behaviour.orientToPlayerWhenFiring;\n    if ('glowOffset'  in behaviour) glowOffset  = behaviour.glowOffset;\n    if ('retreatDist' in behaviour) retreatDist = behaviour.retreatDist;\nif (behaviour && 'backpedal' in behaviour) backpedal = behaviour.backpedal;\n\n  }\n\n  const spawnList = Array.isArray(spawnArray) ? spawnArray : [];\n  if (spawnList.length === 0 && manualPoolSize <= 0) {\n    return { update: () => {}, getActiveShips: () => [] };      // nothing to do\n  }\n\n  /* ---- load fighter once (cached across systems) ---- */\n  const proto = await loadModelCached(modelPath);\n  proto.scale.setScalar(5);\n  const useLambert = materialMode === 'lambert';\n    /* one-time quaternion that keeps the model’s nose correct             */\n  const yawFixQ = new THREE.Quaternion()\n        .setFromAxisAngle(new THREE.Vector3(0, 1, 0), yaw);   // 0 or π\n  const forwardAxisNorm = (forwardAxis && forwardAxis.isVector3)\n    ? forwardAxis.clone().normalize()\n    : null;\n\n\n\n\n\n\n  /* ---- shared bolt pool hookup (instanced) ---- */\n  const LASER_SPEED = 160, LASER_LIFE = 1.2;\n  const BOLT_POOL = boltPool ?? scene.userData?.boltPool ?? null;\n  function getActiveLasers() { return []; }\n  const useBurstFire = burstCount > 0 && burstInterval > 0;\n  const losHazards = [];\n  const tmpFireForward = new THREE.Vector3();\n  const tmpBoltPos = new THREE.Vector3();\n  const tmpBoltQuat = new THREE.Quaternion();\n  const tmpFireQuat = new THREE.Quaternion();\n  const tmpBoltUp = new THREE.Vector3();\n  const tmpBoltBack = new THREE.Vector3();\n  const tmpBoltRight = new THREE.Vector3();\n  const tmpAxisZ = new THREE.Vector3(0, 0, 1);\n  const tmpChaseOffset = new THREE.Vector3();\n  const tmpChaseAim = new THREE.Vector3();\n  const tmpLosDir = new THREE.Vector3();\n  const tmpLosMin = new THREE.Vector3();\n  const tmpLosMax = new THREE.Vector3();\n  const tmpLosBox = new THREE.Box3();\n\n  function addLosHazard(entry) {\n    if (!entry) return;\n    const mesh = entry.getMesh ? entry.getMesh() : entry.mesh ?? null;\n    const collider = entry.collider ?? mesh?.userData?.collider ?? null;\n    if (!mesh || !collider) return;\n    losHazards.push({\n      mesh,\n      collider,\n      laserCollisionEnabled: mesh.userData?.laserCollisionEnabled !== false,\n      gateCylinder: mesh.userData?.gateCylinder ?? null\n    });\n  }\n\n  const losEntries = Array.isArray(hazardEntries) ? hazardEntries : [];\n  losEntries.forEach(addLosHazard);\n\n  function segmentDistSq2D(cx, cz, a, b) {\n    const abx = b.x - a.x;\n    const abz = b.z - a.z;\n    const acx = cx - a.x;\n    const acz = cz - a.z;\n    const abLenSq = abx * abx + abz * abz;\n    let t = 0;\n    if (abLenSq > 1e-8) t = (acx * abx + acz * abz) / abLenSq;\n    if (t < 0) t = 0;\n    else if (t > 1) t = 1;\n    const dx = a.x + abx * t - cx;\n    const dz = a.z + abz * t - cz;\n    return dx * dx + dz * dz;\n  }\n\n  function hasLineOfSight(origin, target) {\n    if (!losHazards.length) return true;\n    tmpLosDir.copy(target).sub(origin);\n    const dist = tmpLosDir.length();\n    if (dist <= 1e-5) return true;\n    tmpLosDir.multiplyScalar(1 / dist);\n    tmpLosMin.set(\n      Math.min(origin.x, target.x),\n      Math.min(origin.y, target.y),\n      Math.min(origin.z, target.z)\n    );\n    tmpLosMax.set(\n      Math.max(origin.x, target.x),\n      Math.max(origin.y, target.y),\n      Math.max(origin.z, target.z)\n    );\n    tmpLosBox.set(tmpLosMin, tmpLosMax);\n    for (let i = 0; i < losHazards.length; i++) {\n      const h = losHazards[i];\n      if (!h.mesh?.visible) continue;\n      if (h.laserCollisionEnabled === false) continue;\n      if (h.gateCylinder) {\n        const gate = h.gateCylinder;\n        const segMinY = Math.min(origin.y, target.y);\n        const segMaxY = Math.max(origin.y, target.y);\n        if (segMaxY < gate.minY || segMinY > gate.maxY) {\n          continue;\n        }\n        const distSq = segmentDistSq2D(gate.x, gate.z, origin, target);\n        if (distSq > gate.radius * gate.radius) {\n          continue;\n        }\n      }\n      if (h.collider?.worldAABB && !tmpLosBox.intersectsBox(h.collider.worldAABB)) {\n        continue;\n      }\n      if (h.collider?.linecast) {\n        const hit = h.collider.linecast(origin, tmpLosDir, dist);\n        if (hit?.hit) return false;\n      }\n    }\n    return true;\n  }\n\nfunction fireLaser(from) {\n  if (!dualGun) {            // ─ single-barrel fighters (old path)\n    spawnBolt(from, 0);\n    return;\n  }\n\n  /* dual-gun: alternate left / right every 0.15 s */\n  const side = from.userData.barrelSide;\n  spawnBolt(from,  side * gunSpacing);\n  from.userData.barrelSide = -side;     // toggle for next shot\n}\n\nfunction spawnBolt(from, offsetX) {\n  if (!BOLT_POOL) return;\n  const handle = BOLT_POOL.alloc({ big:false, life: LASER_LIFE, dir: fireDir, bounced: false });\n  if (!handle) return;\n\n  from.getWorldPosition(tmpBoltPos);\n  from.getWorldQuaternion(tmpBoltQuat);\n  let boltQuat = tmpBoltQuat;\n  let forwardDir = null;\n  const dirSign = fireDir >= 0 ? 1 : -1;\n  if (forwardAxisNorm) {\n    forwardDir = tmpFireForward.copy(forwardAxisNorm).applyQuaternion(tmpBoltQuat);\n    tmpFireQuat.setFromUnitVectors(tmpAxisZ, forwardDir);\n    boltQuat = tmpFireQuat;\n  }\n\n  /* Spider-turret needs its gun elevated; others don’t                */\n  if (dualGun) {                                 // true only for spider\n    tmpBoltUp.set(0, 1, 0).applyQuaternion(tmpBoltQuat);\n    tmpBoltBack.set(0, 0, -1).applyQuaternion(tmpBoltQuat);\n    tmpBoltPos.addScaledVector(tmpBoltUp,   1.8);   // turret height\n    tmpBoltPos.addScaledVector(tmpBoltBack, 1.5);   // turret is aft\n  }\n  // Offset left or right for dual guns (if used)\n  if (offsetX) {\n    tmpBoltRight.set(1, 0, 0).applyQuaternion(tmpBoltQuat);\n    tmpBoltPos.addScaledVector(tmpBoltRight, offsetX);\n  }\n  if (fireOffsetZ) {\n    if (forwardAxisNorm) {\n      tmpBoltPos.addScaledVector(forwardDir, fireOffsetZ * dirSign);\n    } else {\n      tmpFireForward.set(0, 0, 1).applyQuaternion(tmpBoltQuat);\n      tmpBoltPos.addScaledVector(tmpFireForward, fireOffsetZ * dirSign);\n    }\n  }\n\n  BOLT_POOL.setTransform(handle, tmpBoltPos, boltQuat);\n}\n\n\n\n/* ── lock-on visuals (shared across all fighters) ─────────── */\nconst lockGeo = new THREE.RingGeometry(1.6, 1.9, 4);  // a thin square\n  const lockMat = new THREE.MeshBasicMaterial({\n  color: 0x00ff7f, side: THREE.DoubleSide\n});\n\n  /* shared engine-glow geo/materials (lighter: basic + pre-baked gradient) */\n  const glowGeo = new THREE.CircleGeometry(0.2, 12);\n  glowGeo.scale(1.4, 0.85, 1);\n  const glowCanvas = (typeof document !== 'undefined')\n    ? document.createElement('canvas')\n    : (typeof OffscreenCanvas !== 'undefined' ? new OffscreenCanvas(64, 64) : null);\n  if (!glowCanvas) throw new Error('No canvas available for glow texture');\n  glowCanvas.width = glowCanvas.height = 64;\n  const gctx = glowCanvas.getContext('2d');\n  const ggrad = gctx.createRadialGradient(32, 32, 0, 32, 32, 32);\n  ggrad.addColorStop(0, 'rgba(255,255,255,1)');\n  ggrad.addColorStop(0.5, 'rgba(255,255,255,0.35)');\n  ggrad.addColorStop(1, 'rgba(255,255,255,0)');\n  gctx.fillStyle = ggrad;\n  gctx.fillRect(0, 0, 64, 64);\n  const glowTex = new THREE.CanvasTexture(glowCanvas);\n  const makeBasicGlow = (hex, opacity) => new THREE.MeshBasicMaterial({\n    color: hex,\n    map: glowTex,\n    transparent: true,\n    opacity,\n    blending: THREE.AdditiveBlending,\n    depthWrite: false,\n    side: THREE.DoubleSide\n  });\n  const outerGlowMat = makeBasicGlow(0xff4422, 0.5);\n  const innerGlowMat = makeBasicGlow(0xff9900, 0.6);\n\n  /* per-model tuning for glow placement/size */\n  const glowOffsetZ = modelPath.includes('blue1') ? 1.2 : -1.0; // blue1 faced opposite; place at back\n  const defaultGlowOffset = new THREE.Vector3(0, 0, glowOffsetZ);\n  const glowOffsetVec = (glowOffset && glowOffset.isVector3)\n    ? glowOffset.clone()\n    : defaultGlowOffset;\n  const innerGlowOffset = glowOffsetVec.clone();\n  if (innerGlowOffset.lengthSq() > 1e-6) {\n    const offsetDir = glowOffsetVec.clone().normalize();\n    innerGlowOffset.addScaledVector(offsetDir, -0.01);\n  } else {\n    innerGlowOffset.z -= 0.01;\n  }\n  const baseScale = modelPath.includes('dark1') ? 2 : 1;\n  const globalScale = modelPath.includes('dark1') ? 1.5 : 3.0; // dark1 unchanged; others doubled again\n  const glowScaleMult = baseScale * globalScale;\n\n\n  /* ---- enemy instances ---- */\n  const ACTIVE = [];\n  const ACTIVE_SHIPS = [];\n  const spawnQueue = spawnList.map((cfg, idx) => ({\n    ...cfg,\n    __spawnIdx: idx,\n    __src: cfg,\n    spawned: false\n  }));\n  const bakedPathLookup = (useBakedPaths && bakedPaths instanceof Map) ? bakedPaths : new Map();\n\n  /* Build all enemy meshes up-front so spawning is just a state reset.\n     This avoids runtime GLTF cloning/material cloning hitches. */\n  function createShipInstance() {\n    const ship = proto.clone(true);\n    ship.visible = false;\n    ship.userData = {\n      enemy     : true,\n      enemyRoot : true,\n      flashT    : 0\n    };\n\n    /* gather meshes + unique materials for local emissive flash */\n    const meshes = [];\n    ship.traverse(n => {\n      if (n.isMesh) {\n        n.material = useLambert ? toLambert(n.material) : n.material.clone();\n        n.userData.enemy = true;\n        n.frustumCulled = false; // ensure warmup renders even if off-screen\n        meshes.push(n);\n      }\n    });\n    ship.userData.meshes = meshes;\n    ship.userData.blink  = () => { ship.userData.flashT = 0.15; };\n\n    /* add hidden lock-on ring */\n    const ring = new THREE.Mesh(lockGeo, lockMat.clone());\n    ring.visible = false;\n    ship.add(ring);\n    ship.userData.lockRing = ring;\n\n    /* attach compact red/orange engine glow */\n    const outerGlow = new THREE.Mesh(glowGeo, outerGlowMat);\n    outerGlow.position.copy(glowOffsetVec);\n    outerGlow.scale.multiplyScalar(glowScaleMult);\n    const innerGlow = new THREE.Mesh(glowGeo, innerGlowMat);\n    innerGlow.scale.set(0.6 * glowScaleMult, 0.6 * glowScaleMult, 0.6 * glowScaleMult);\n    innerGlow.position.copy(innerGlowOffset);\n    // let normal frustum culling discard them when off-screen\n    ship.add(outerGlow);\n    ship.add(innerGlow);\n\n    scene.add(ship);\n    return ship;\n  }\n\n  const shipPool = spawnQueue.map(() => {\n    const ship = createShipInstance();\n    ACTIVE.push(ship);\n    return ship;\n  });\n  spawnQueue.forEach((cfg, i) => { cfg.ship = shipPool[i]; });\n  const manualPool = [];\n  for (let i = 0; i < manualPoolSize; i++) {\n    const ship = createShipInstance();\n    ship.userData.manual = true;\n    ship.userData.dead = true;\n    ship.visible = false;\n    manualPool.push(ship);\n    ACTIVE.push(ship);\n  }\n  const allShips = manualPool.length ? shipPool.concat(manualPool) : shipPool;\n  const SPAWN_RADIUS = behaviour.spawnRadius ?? 200;\n  const SPAWN_RADIUS_SQ = SPAWN_RADIUS * SPAWN_RADIUS;\n  const BUCKET_SIZE = behaviour.spawnBucketSize ?? (SPAWN_RADIUS * 2); // coarse Z buckets\n  const spawnBuckets = new Map(); // key -> [cfg,...]\n  const bucketKey = (z) => Math.floor((z ?? 0) / BUCKET_SIZE);\n  spawnQueue.forEach(cfg => {\n    const k = bucketKey(cfg.z);\n    if (!spawnBuckets.has(k)) spawnBuckets.set(k, []);\n    spawnBuckets.get(k).push(cfg);\n  });\n\n  function resetShipState(ship, cfg) {\n    const baked = bakedPathLookup.get(cfg.__spawnIdx) ?? null;\n\n    ship.visible          = true;\n    ship.userData.dead    = false;\n    ship.userData.fireT   = 0;\n    ship.userData.barrelSide = 1;\n    ship.userData.phi     = 0;\n    ship.userData.ttl     = despawnDelay;\n    ship.userData.hp      = behaviour.hp ?? 1;\n    ship.userData.flashT  = 0;\n    ship.userData.dropHealRing = Boolean(cfg.dropHealRing);\n    ship.userData.burstRemaining = burstCount;\n    ship.userData.burstCooldown = 0;\n    ship.userData.burstShotT = 0;\n    ship.userData.passT = Math.random() * passDuration;\n    ship.userData.passFireReady = true;\n    ship.userData.lockRing.visible = false;\n    ship.position.set(cfg.x, cfg.y, cfg.z);\n    ship.userData.collided = false;\n    ship.userData.state   = baked ? 'path' : 'approach';\n    ship.userData.retreatZ = null;\n    if (cfg.__src) {\n      ship.userData.editorRef = cfg.__src;\n      ship.userData.editorGroup = editorGroup;\n      ship.userData.editorIndex = cfg.__spawnIdx;\n    }\n    if (baked) {\n      ship.userData.bakedPath = {\n        samples : baked.samples,\n        duration: baked.duration ?? (baked.samples?.length ? baked.samples[baked.samples.length - 1].t : 0),\n        t       : 0,\n        idx     : 0\n      };\n    } else {\n      ship.userData.bakedPath = null;\n    }\n\n    if (CAPTURE_ACTIVE) {\n      ship.userData.pathLog      = [];\n      ship.userData.captureT     = 0;\n      ship.userData.captureAcc   = 0;\n      ship.userData.spawnIdx     = cfg.__spawnIdx ?? null;\n      ship.userData.spawnPoint   = { x: cfg.x, y: cfg.y, z: cfg.z };\n      ship.userData.pathLogged   = false;\n      ship.userData.finishPath   = (reason) => finalizeCapture(ship, reason);\n    } else {\n      ship.userData.pathLog    = null;\n      ship.userData.captureT   = 0;\n      ship.userData.captureAcc = 0;\n      ship.userData.spawnIdx   = cfg.__spawnIdx ?? null;\n      ship.userData.spawnPoint = { x: cfg.x, y: cfg.y, z: cfg.z };\n      ship.userData.pathLogged = true;\n      ship.userData.finishPath = null;\n    }\n  }\n\n  function materializeSpawns() {\n    spawnQueue.forEach(cfg => {\n      resetShipState(cfg.ship, cfg);\n    });\n    return spawnQueue.map(cfg => cfg.ship);\n  }\n\n  function getActiveShips()  { return ACTIVE_SHIPS; }\n  function getActiveLasers() { return []; }\n\n  /* quick helpers */\n  const tmp = new THREE.Vector3();\n  const playerPos = new THREE.Vector3();\n  const tmpTargetPos = new THREE.Vector3();\n  const tmpChaseDir = new THREE.Vector3();\n  const railDir   = new THREE.Vector3();\n  const tmpRight  = new THREE.Vector3();\n  const tmpUp     = new THREE.Vector3();\n  const tmpBack   = new THREE.Vector3();\n  const tmpPrevPos = new THREE.Vector3();\n  const tmpAvoid   = new THREE.Vector3();\n  const tmpAhead   = new THREE.Vector3();\n  const tmpVel     = new THREE.Vector3();\n  const tmpRearDir = new THREE.Vector3();\n  const tmpSphere  = new THREE.Sphere();\n  const tmpDir     = new THREE.Vector3();\n  const tmpFaceQuat = new THREE.Quaternion();\n  const tmpLosOrigin = new THREE.Vector3();\n\n  const CULL_Z_BEHIND = 20;   // units the player may outrun a fighter\n  const AVOID_RADIUS_PAD   = 1.5;   // extra padding beyond hit radius\n  const AVOID_LOOKAHEAD    = 100;    // how far ahead to probe for hazards\n  const AVOID_MAX_PUSH     = 20;    // clamp avoidance velocity (u/s)\n  const AVOID_REAR_LOOKAHEAD = 0.5;  // extra buffer for set pieces behind (negative Z)\n  const AVOID_REAR_PAD = 1.5;       // extra radius padding when moving backward\n  const AVOID_REAR_PUSH = 5.5;      // gentle push away from rear hazards\n  const AVOID_RETURN_SPEED = Math.max(20, playerSpeed * 2.0); // nudge back to desired distance\n\n  const CAMERA = camera;\n  const CAPTURE_ACTIVE = CAPTURE_ENABLED &&\n    !CAPTURE_BLOCKLIST.some(key => modelPath.includes(key));\n\n  function finalizeCapture(ship, reason = 'ok') {\n    if (!CAPTURE_ACTIVE) return;\n    const ud = ship?.userData;\n    if (!ud?.pathLog || ud.pathLogged) return;\n    ud.pathLogged = true;\n    if (ud.pathLog.length === 0) return;\n    CAPTURED_ENEMY_PATHS.push({\n      spawnIdx : ud.spawnIdx ?? null,\n      spawn    : ud.spawnPoint ?? null,\n      model    : modelPath,\n      collided : Boolean(ud.collided || reason === 'collision'),\n      reason   : reason,\n      samples  : ud.pathLog.slice()\n    });\n  }\n\n  function applyHazardAvoidance(ship, prevPos, dt) {\n    if (!AVOIDANCE_ENABLED) return;\n    if (!hazardColliders?.length || dt <= 0) return;\n    tmpVel.copy(ship.position).sub(prevPos);\n    if (tmpVel.lengthSq() < 1e-5) {\n      tmpVel.copy(playerPos).sub(ship.position);\n      if (tmpVel.lengthSq() < 1e-5) tmpVel.set(0, 0, -1);\n    }\n    tmpVel.normalize();\n    const movingBack = tmpVel.z < -0.2;\n    const lookAhead = movingBack ? AVOID_LOOKAHEAD * 1.6 : AVOID_LOOKAHEAD;\n    const hitR = (ship.userData?.hitRadius ?? 3) + AVOID_RADIUS_PAD + (movingBack ? AVOID_REAR_PAD : 0);\n    const coarseR = hitR + lookAhead * 0.5;\n    tmpAvoid.set(0, 0, 0);\n    let avoidActive = false;\n\n    for (let i = 0; i < hazardColliders.length; i++) {\n      const col = hazardColliders[i];\n      if (!col?.testSphere) continue;\n      if (col.worldAABB &&\n          !col.worldAABB.intersectsSphere(tmpSphere.set(ship.position, coarseR))) {\n        continue;\n      }\n\n      /* immediate overlap → push out along the surface normal */\n      const overlap = col.testSphere(ship.position, hitR);\n      if (overlap.hit) {\n        ship.userData.collided = true;\n        avoidActive = true;\n        tmpAvoid.addScaledVector(overlap.normal, overlap.depth + 0.5);\n        continue;\n      }\n\n      /* look ahead in current travel direction to bias around obstacles */\n      const ahead = tmpAhead.copy(ship.position).addScaledVector(tmpVel, lookAhead);\n      const aheadProbe = col.testSphere(ahead, hitR);\n      if (aheadProbe.hit) {\n        const dist = ship.position.distanceTo(ahead);\n        const gain = Math.max(0.35, 1 - dist / (lookAhead + 1e-3));\n        avoidActive = true;\n        tmpAvoid.addScaledVector(aheadProbe.normal, gain * 4);\n      }\n\n      if (movingBack && col.worldAABB && col.worldAABB.max.z < ship.position.z) {\n        const rearGap = ship.position.z - col.worldAABB.max.z;\n        if (rearGap < AVOID_REAR_LOOKAHEAD) {\n          const rearGain = Math.max(0.15, 1 - rearGap / (AVOID_REAR_LOOKAHEAD + 1e-3));\n          tmpRearDir.set(0, 0, 1);\n          avoidActive = true;\n          tmpAvoid.addScaledVector(tmpRearDir, rearGain * AVOID_REAR_PUSH);\n        }\n      }\n    }\n\n    if (avoidActive && ship.userData?.state === 'retreat') {\n      const desiredZ = playerPos.z + (typeof ship.userData.retreatZ === 'number'\n        ? ship.userData.retreatZ\n        : -retreatDist);\n      const diffZ = desiredZ - ship.position.z;\n      if (diffZ < -0.1) {\n        tmpAvoid.z += Math.max(diffZ, -AVOID_RETURN_SPEED * dt);\n      }\n    }\n\n    const len = tmpAvoid.length();\n    if (len > 1e-4) {\n      const maxStep = AVOID_MAX_PUSH * dt;\n      tmpAvoid.multiplyScalar(Math.min(1, maxStep / len));\n      ship.position.add(tmpAvoid);\n    }\n  }\n\n\n  function update(dt, tPlayer) {\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n    playerObj.getWorldPosition(playerPos);\n\n    /* 1. spawn check (nearby Z buckets) */\n    let spawnedThisFrame = 0;\n    const MAX_SPAWN_PER_FRAME = 3;\n    const centerKey = bucketKey(playerPos.z);\n    const keys = [centerKey - 1, centerKey, centerKey + 1];\n    for (let kIdx = 0; kIdx < keys.length; kIdx++) {\n      const list = spawnBuckets.get(keys[kIdx]);\n      if (!list || !list.length) continue;\n      for (let i = list.length - 1; i >= 0 && spawnedThisFrame < MAX_SPAWN_PER_FRAME; i--) {\n        const cfg = list[i];\n        if (cfg.spawned) { list.splice(i, 1); continue; }\n        const ship = cfg.ship;\n        if (!ship) { list.splice(i, 1); continue; }\n        tmp.set(cfg.x, cfg.y, cfg.z);\n        if (tmp.distanceToSquared(playerPos) < SPAWN_RADIUS_SQ) {\n          resetShipState(ship, cfg);\n          cfg.spawned = true;\n          spawnedThisFrame++;\n          list.splice(i, 1);\n        }\n      }\n      if (!list.length) spawnBuckets.delete(keys[kIdx]);\n      if (spawnedThisFrame >= MAX_SPAWN_PER_FRAME) break;\n    }\n\n\n\n    /* 2. per-enemy logic */\n    ACTIVE_SHIPS.length = 0;\n    ACTIVE.forEach(e => {\n       if (CAPTURE_ACTIVE && e.userData?.dead && e.userData.pathLog && !e.userData.pathLogged) {\n         finalizeCapture(e, 'dead');\n       }\n       if (!e.visible || e.userData.dead) return;   // ← ignore destroyed ships\n      ACTIVE_SHIPS.push(e);\n\n      tmpPrevPos.copy(e.position);\n\n      e.userData.fireT += dt;\n\n      /* aim, then restore model’s correct nose direction */\n      let usedBakedPath = false;\n      const chaseTarget = e.userData?.chaseTarget ?? null;\n      const chaseOffset = e.userData?.chaseOffset ?? null;\n      const chaseOffsetMode = e.userData?.chaseOffsetMode ?? 'local';\n      const chaseMinDist = e.userData?.chaseMinDist ?? 0;\n      let chaseActive = false;\n      if (e.userData?.state === 'chase') {\n        if (chaseTarget && chaseTarget.visible) {\n          chaseActive = true;\n          chaseTarget.getWorldPosition(tmpTargetPos);\n          tmpChaseAim.copy(tmpTargetPos);\n          if (chaseOffset) {\n            tmpChaseOffset.copy(chaseOffset);\n            if (chaseOffsetMode !== 'world' && chaseTarget.quaternion) {\n              tmpChaseOffset.applyQuaternion(chaseTarget.quaternion);\n            }\n            tmpTargetPos.add(tmpChaseOffset);\n          }\n        } else {\n          e.userData.state = 'retreat';\n          e.userData.chaseTarget = null;\n        }\n      }\n      const targetPos = chaseActive ? tmpTargetPos : playerPos;\n      const aimPos = chaseActive ? tmpChaseAim : targetPos;\n      if (chaseActive) {\n        usedBakedPath = true;\n        tmpChaseDir.copy(targetPos).sub(e.position);\n        const dist = tmpChaseDir.length();\n        if (dist > 1e-4) {\n          tmpChaseDir.multiplyScalar(1 / dist);\n          const chaseSpeed = e.userData.chaseSpeed ?? (playerSpeed * 1.1);\n          const step = Math.min(chaseSpeed * dt, Math.max(0, dist - chaseMinDist));\n          if (step > 0) e.position.addScaledVector(tmpChaseDir, step);\n        }\n      }\n      const baked = e.userData.bakedPath;\n      if (!chaseActive && baked && baked.samples?.length) {\n        usedBakedPath = true;\n        baked.t = Math.min(baked.t + dt, baked.duration);\n        const s = baked.samples;\n        while (baked.idx < s.length - 2 && s[baked.idx + 1].t < baked.t) baked.idx++;\n        const a = s[baked.idx];\n        const b = s[Math.min(baked.idx + 1, s.length - 1)];\n        const span = Math.max(1e-4, b.t - a.t);\n        const alpha = THREE.MathUtils.clamp((baked.t - a.t) / span, 0, 1);\n        e.position.set(\n          THREE.MathUtils.lerp(a.pos[0], b.pos[0], alpha),\n          THREE.MathUtils.lerp(a.pos[1], b.pos[1], alpha),\n          THREE.MathUtils.lerp(a.pos[2], b.pos[2], alpha)\n        );\n        if (baked.t >= baked.duration - 1e-3) {\n          // finished baked path; fall back to default behaviour\n          e.userData.bakedPath = null;\n          e.userData.state = 'retreat';\n          e.userData.retreatZ = e.position.z - playerPos.z;\n        }\n      }\n\n      let passLoopActive = false;\n      if (!usedBakedPath && passLoop) {\n        passLoopActive = true;\n        e.userData.passT += dt;\n        if (passDuration > 0) {\n          e.userData.passT %= passDuration;\n        }\n        const phase = passDuration > 0\n          ? (e.userData.passT / passDuration) * Math.PI * 2\n          : e.userData.passT;\n        railCurve.getTangentAt(tPlayer, railDir).normalize();\n        tmpRight.copy(railDir).cross(tmpUp.set(0,1,0)).normalize();\n        const up = tmpUp.crossVectors(tmpRight, railDir).normalize();\n        const zUnit = Math.sin(phase);\n        const zOffset = ((zUnit + 1) * 0.5) * (passAhead + passBehind) - passBehind;\n        const xOffset = Math.cos(phase) * lateralAmp;\n        const yOffset = Math.sin(phase * 0.5) * verticalAmp;\n        e.position.copy(playerPos)\n          .addScaledVector(railDir, zOffset)\n          .addScaledVector(tmpRight, xOffset)\n          .addScaledVector(up, yOffset);\n        e.userData.passZOffset = zOffset;\n        e.userData.passFireReady = Math.abs(zOffset) <= passFireWindow;\n      } else if (!usedBakedPath && e.userData.state === 'approach') {\n        /* fly toward player until within 50 u  (axis-independent) */\n        tmp.copy(playerPos).sub(e.position).normalize();  // vector TO player\n        e.position.addScaledVector(tmp, 20 * dt);         // 20 u s⁻¹\n        if (e.position.distanceToSquared(playerPos) < retreatDist * retreatDist) {\n          e.userData.state = 'retreat';\n          /* figure out rail direction at player t to mirror speed */\n          railCurve.getTangentAt(tPlayer, railDir).normalize();\n          e.userData.retreatZ = e.position.z - playerPos.z;\n        }\n      } else if (!usedBakedPath) { /* retreat */\n        e.position.addScaledVector(railDir, playerSpeed * dt);\n\n        // Special case: spider turret style → jitter back now and then\nif (backpedal && Math.random() < 0.2 * dt) {\n  tmpBack.copy(railDir).multiplyScalar(-20 * dt);\n  e.position.add(tmpBack);\n}\n\n\n\n\n\n       /* ---------- optional diagonal drive-by ---------------- */\n        if (diagSpeed && diagVec) {\n          e.position.addScaledVector(diagVec, diagSpeed * dt);\n        }\n\n/* ── optional cork-screw (blue squadron only) ────────── */\n        if (orbitRadius > 0 && orbitRate !== 0) {\n          e.userData.phi += orbitRate * dt;\n\n          /* build a local side/up frame perpendicular to railDir */\n          const right = tmpRight.copy(railDir).cross(tmpUp.set(0,1,0)).normalize();\n          const up    = tmpUp.crossVectors(right, railDir).normalize();\n\n          /* velocity needed for circular motion of radius R */\n          const vLat = right.multiplyScalar(-Math.sin(e.userData.phi))\n                            .add(  up.multiplyScalar( Math.cos(e.userData.phi)))\n                            .multiplyScalar(orbitRadius * orbitRate);\n\n          e.position.addScaledVector(vLat, dt);\n        }\n\n                /* ── optional LATERAL zig-zag (uses right vector) ─────── */\n        if (lateralAmp && lateralHz) {\n          e.userData.phi += lateralHz * 2*Math.PI * dt;\n          tmpRight.copy(railDir).cross(tmpUp.set(0,1,0)).normalize();\n          e.position.addScaledVector(tmpRight,\n            Math.cos(e.userData.phi) * lateralAmp * dt);   // velocity style\n        }\n\n        /* ── optional vertical bob (uses up vector) ───────────── */\n        if (verticalAmp && verticalHz) {\n          e.userData.phi += verticalHz * 2*Math.PI * dt;\n          tmpUp.set(0,1,0);\n          e.position.addScaledVector(tmpUp,\n            Math.sin(e.userData.phi) * verticalAmp * dt);\n        }\n\n      }\n\n      const useForwardAxis = Boolean(forwardAxisNorm);\n      let facePlayer = true;\n      let movingToward = true;\n      if (passLoopActive) {\n        tmpVel.copy(e.position).sub(tmpPrevPos);\n        if (tmpVel.lengthSq() > 1e-6) {\n          tmpVel.normalize();\n          tmpDir.copy(targetPos).sub(e.position);\n          if (tmpDir.lengthSq() > 1e-6) {\n            tmpDir.normalize();\n            movingToward = tmpVel.dot(tmpDir) > 0;\n          }\n        }\n        const zOffset = typeof e.userData.passZOffset === 'number'\n          ? e.userData.passZOffset\n          : 0;\n        e.userData.passFireReady = movingToward && Math.abs(zOffset) <= passFireWindow;\n      }\n      if (passLoopActive && (orientToVelocity || orientToPlayerWhenFiring)) {\n        if (orientToPlayerWhenFiring && e.userData.passFireReady && movingToward) {\n          facePlayer = true;\n        } else if (orientToVelocity) {\n          if (tmpVel.lengthSq() > 1e-6) {\n            if (useForwardAxis) {\n              tmpFaceQuat.setFromUnitVectors(forwardAxisNorm, tmpVel);\n              e.quaternion.copy(tmpFaceQuat);\n            } else {\n              tmp.copy(e.position).add(tmpVel);\n              e.lookAt(tmp);\n            }\n            facePlayer = false;\n          }\n        }\n      }\n      if (facePlayer) {\n        if (useForwardAxis) {\n          tmpDir.copy(aimPos).sub(e.position);\n          if (tmpDir.lengthSq() > 1e-6) {\n            tmpDir.normalize();\n            tmpFaceQuat.setFromUnitVectors(forwardAxisNorm, tmpDir);\n            e.quaternion.copy(tmpFaceQuat);\n          }\n        } else {\n          e.lookAt(aimPos);\n        }\n      }\n      if (!useForwardAxis) {\n        e.quaternion.multiply(yawFixQ);      // ← keep nose forward\n      }\n\n      if (!passLoopActive) {\n        applyHazardAvoidance(e, tmpPrevPos, dt);\n      }\n\n      if (CAPTURE_ACTIVE && e.userData.pathLog) {\n        e.userData.captureT   += dt;\n        e.userData.captureAcc += dt;\n        if (e.userData.captureAcc >= CAPTURE_SAMPLE_STEP) {\n          e.userData.captureAcc -= CAPTURE_SAMPLE_STEP;\n          const pos = e.position;\n          e.userData.pathLog.push({\n            t  : e.userData.captureT,\n            pos: [pos.x, pos.y, pos.z]\n          });\n        }\n      }\n\n/* --- 1-D cull (only behind-player check) ------------------- */\nif (!e.userData?.noCullBehind && e.position.z > playerPos.z + CULL_Z_BEHIND) {\nif (CAPTURE_ACTIVE && e.userData.pathLog && !e.userData.pathLogged) {\n    finalizeCapture(e, 'cull');\n  }\n  e.visible       = false;   // no render, no firing\n  e.userData.dead = true;    // collisions skip\n  return;                    // stop updating this fighter\n}\n\n\n/* ---------- life-timer ------------------------------------- */\nif (e.userData.ttl !== Infinity) {\n  e.userData.ttl -= dt;\n  if (e.userData.ttl <= 0) {\n    if (CAPTURE_ACTIVE && e.userData.pathLog && !e.userData.pathLogged) {\n      finalizeCapture(e, 'ttl');\n    }\n    /* shift fighter just past the cull gate so next frame it disappears */\n    e.position.z = playerPos.z + CULL_Z_BEHIND + 1;\n  }\n}\n\n /*  ── keep lock-ring facing the camera ───────────────────── */\nif (e.userData.lockRing.visible && CAMERA) {\n  e.userData.lockRing.quaternion.copy(CAMERA.quaternion); // ← full billboard\n}\n\n /* firing */\n const allowFireNow = allowFire && (!passLoop || e.userData.passFireReady);\n if (allowFireNow) {\n   if (useBurstFire) {\n     if (e.userData.burstCooldown > 0) {\n       e.userData.burstCooldown -= dt;\n     } else {\n       e.userData.burstShotT += dt;\n       if (e.userData.burstShotT >= burstInterval) {\n         tmpLosOrigin.copy(e.position);\n         const hasLOS = hasLineOfSight(tmpLosOrigin, aimPos);\n         if (hasLOS) {\n           fireLaser(e);\n           e.userData.burstShotT = 0;\n           e.userData.burstRemaining -= 1;\n           if (e.userData.burstRemaining <= 0) {\n             e.userData.burstCooldown = burstPause;\n             e.userData.burstRemaining = burstCount;\n           }\n         } else {\n           e.userData.burstShotT = burstInterval;\n         }\n       }\n     }\n   } else if (e.userData.fireT >= fireInterval) {\n     tmpLosOrigin.copy(e.position);\n     const hasLOS = hasLineOfSight(tmpLosOrigin, aimPos);\n     if (hasLOS) {\n       fireLaser(e);\n       e.userData.fireT = 0;\n     } else {\n       e.userData.fireT = fireInterval;\n     }\n   }\n }\n\n\n\nif (e.userData.needsFlash) {\n     e.userData.flashT   = 0.15;       // start 150 ms blink\n     delete e.userData.needsFlash;     // consume the flag\n }\n\n/* ── red-flash blink (simple) ─────────────────────────────── */\nconst flashing = e.userData.flashT > 0;\n\nif (flashing) {\n  e.userData.flashT = Math.max(0, e.userData.flashT - dt);\n}\n\n/* paint red while flashing, otherwise black */\nconst r = flashing ? 1 : 0;\ne.userData.meshes.forEach(m => m.material.emissive.setRGB(r, 0, 0));\n\n\n\n\n\n    });\n\n    /* 3. update enemy lasers — movement handled by shared pool */\n  }\n\n  function prewarm(renderer, camera) {\n    const prev = allShips.map(s => s.visible);\n    allShips.forEach(s => { s.visible = true; });\n    renderer.compile(scene, camera);\n    allShips.forEach((s, i) => { s.visible = prev[i]; });\n  }\n  function prewarmRender(renderer, camera) {\n    const prev = allShips.map(s => s.visible);\n    allShips.forEach(s => { s.visible = true; });\n    renderer.render(scene, camera);\n    allShips.forEach((s, i) => { s.visible = prev[i]; });\n  }\n  function prewarmSpawn(renderer, camera) {\n    if (!allShips.length) return;\n    const prevStates = allShips.map(s => ({\n      vis: s.visible,\n      pos: s.position.clone()\n    }));\n    allShips.forEach((s, i) => {\n      s.visible = true;\n      s.position.set((i % 5) * 2, -200 - Math.floor(i / 5) * 2, -200);\n    });\n    renderer.render(scene, camera);\n    allShips.forEach((s, i) => {\n      s.visible = prevStates[i].vis;\n      s.position.copy(prevStates[i].pos);\n    });\n  }\n\n  function previewSetup({\n    origin = null,\n    right = null,\n    up = null,\n    spacing = 12,\n    count = 1,\n    faceTarget = null\n  } = {}) {\n    if (!shipPool.length) return () => {};\n    const maxCount = Math.min(count, shipPool.length);\n    const prevStates = [];\n    for (let i = 0; i < maxCount; i++) {\n      const ship = shipPool[i];\n      prevStates.push({\n        ship,\n        vis: ship.visible,\n        pos: ship.position.clone(),\n        quat: ship.quaternion.clone()\n      });\n      ship.visible = true;\n      ship.userData.dead = false;\n      ship.userData.flashT = 0;\n      if (origin) {\n        ship.position.copy(origin);\n      }\n      if (right) {\n        const offset = (i - (maxCount - 1) * 0.5) * spacing;\n        ship.position.addScaledVector(right, offset);\n      }\n      if (up) {\n        ship.position.addScaledVector(up, (i % 2) * spacing * 0.15);\n      }\n      if (faceTarget) {\n        ship.lookAt(faceTarget);\n        ship.quaternion.multiply(yawFixQ);\n      }\n    }\n    return () => {\n      prevStates.forEach(state => {\n        state.ship.visible = state.vis;\n        state.ship.position.copy(state.pos);\n        state.ship.quaternion.copy(state.quat);\n      });\n    };\n  }\n\n  let manualSpawnIdx = -1;\n  const manualSpawnCfg = { x: 0, y: 0, z: 0, dropHealRing: false, __spawnIdx: -1 };\n  function spawnManual(position, overrides = {}) {\n    if (!manualPool.length || !position) return null;\n    const ship = manualPool.find(s => !s.visible || s.userData.dead);\n    if (!ship) return null;\n    manualSpawnIdx -= 1;\n    manualSpawnCfg.x = position.x;\n    manualSpawnCfg.y = position.y;\n    manualSpawnCfg.z = position.z;\n    manualSpawnCfg.dropHealRing = Boolean(overrides.dropHealRing);\n    manualSpawnCfg.__spawnIdx = manualSpawnIdx;\n    resetShipState(ship, manualSpawnCfg);\n    if (overrides.state) ship.userData.state = overrides.state;\n    if (typeof overrides.hp === 'number') ship.userData.hp = overrides.hp;\n    if (typeof overrides.onSpawn === 'function') overrides.onSpawn(ship);\n    return ship;\n  }\n\n   return { update\n         , getActiveShips: () => ACTIVE_SHIPS\n         , getActiveLasers: () => []\n         , prewarm\n         , prewarmRender\n         , prewarmSpawn\n         , previewSetup\n         , spawnManual\n         , materializeSpawns\n          };\n}\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\nexport async function initFrigateEnemySystem(scene, {\n  spawnArray,\n  playerObj,\n  boltPool = null,\n  canFire = null,\n  hazardEntries = null,\n  spawnBlue = null,\n  modelPath = './models/dark_frigate.glb',\n  scale = 30,\n  moveSpeed = 3,\n  hp = 40,\n  scoreValue = 400,\n  wingBurstCount = 10,\n  wingBurstInterval = 0.30,\n  wingBurstPause = 2.0,\n  noseFireInterval = 1.3,\n  bigLaserScale = 2.2,\n  spawnInterval = 3.0,\n  spawnLimit = 3,\n  spawnRadius = 420,\n  cullBehind = 30,\n  faceMinDistance = 140,\n  yaw = 0,\n  forwardAxis = new THREE.Vector3(-1, 0, 0),\n  materialMode = 'standard',\n  editorGroup = null\n} = {}) {\n  if (!Array.isArray(spawnArray) || spawnArray.length === 0) {\n    return { update: () => {}, getActiveShips: () => [] };\n  }\n\n  const loader = new GLTFLoader();\n  const proto = (await loader.loadAsync(modelPath)).scene;\n  const useLambert = materialMode === 'lambert';\n\n  const baseBox = new THREE.Box3().setFromObject(proto);\n  const baseSize = new THREE.Vector3();\n  const baseCenter = new THREE.Vector3();\n  baseBox.getSize(baseSize);\n  baseBox.getCenter(baseCenter);\n\n  const baseHitRadius = Math.max(baseSize.x, baseSize.z) * 0.35;\n  const hitBoxes = [];\n  {\n    const rootInv = new THREE.Matrix4();\n    const tmpVec = new THREE.Vector3();\n    proto.updateMatrixWorld(true);\n    rootInv.copy(proto.matrixWorld).invert();\n\n    const maxDim = Math.max(baseSize.x, baseSize.y, baseSize.z) || 1;\n    const gridX = Math.min(14, Math.max(6, Math.round((baseSize.x / maxDim) * 12)));\n    const gridY = Math.min(14, Math.max(8, Math.round((baseSize.y / maxDim) * 12)));\n    const gridZ = Math.min(14, Math.max(6, Math.round((baseSize.z / maxDim) * 12)));\n    const cellCount = gridX * gridY * gridZ;\n    const filled = new Uint8Array(cellCount);\n    const baseMin = baseBox.min;\n    const sizeX = baseSize.x || 1e-6;\n    const sizeY = baseSize.y || 1e-6;\n    const sizeZ = baseSize.z || 1e-6;\n    const invSizeX = 1 / sizeX;\n    const invSizeY = 1 / sizeY;\n    const invSizeZ = 1 / sizeZ;\n    const toIndex = (ix, iy, iz) => ix + gridX * (iy + gridY * iz);\n    let sawVertex = false;\n\n    proto.traverse(node => {\n      if (!node.isMesh || !node.geometry || !node.geometry.attributes?.position) return;\n      const posAttr = node.geometry.attributes.position;\n      const mat = node.matrixWorld;\n      for (let i = 0, n = posAttr.count; i < n; i++) {\n        tmpVec.fromBufferAttribute(posAttr, i);\n        tmpVec.applyMatrix4(mat);\n        tmpVec.applyMatrix4(rootInv);\n        const ix = Math.min(gridX - 1, Math.max(0, Math.floor(((tmpVec.x - baseMin.x) * invSizeX) * gridX)));\n        const iy = Math.min(gridY - 1, Math.max(0, Math.floor(((tmpVec.y - baseMin.y) * invSizeY) * gridY)));\n        const iz = Math.min(gridZ - 1, Math.max(0, Math.floor(((tmpVec.z - baseMin.z) * invSizeZ) * gridZ)));\n        filled[toIndex(ix, iy, iz)] = 1;\n        sawVertex = true;\n      }\n    });\n\n    if (sawVertex) {\n      for (let iz = 0; iz < gridZ; iz++) {\n        const z0 = baseMin.z + (iz / gridZ) * sizeZ;\n        const z1 = baseMin.z + ((iz + 1) / gridZ) * sizeZ;\n        for (let iy = 0; iy < gridY; iy++) {\n          const y0 = baseMin.y + (iy / gridY) * sizeY;\n          const y1 = baseMin.y + ((iy + 1) / gridY) * sizeY;\n          for (let ix = 0; ix < gridX; ix++) {\n            if (!filled[toIndex(ix, iy, iz)]) continue;\n            const x0 = baseMin.x + (ix / gridX) * sizeX;\n            const x1 = baseMin.x + ((ix + 1) / gridX) * sizeX;\n            hitBoxes.push(new THREE.Box3(\n              new THREE.Vector3(x0, y0, z0),\n              new THREE.Vector3(x1, y1, z1)\n            ));\n          }\n        }\n      }\n    } else {\n      hitBoxes.push(baseBox.clone());\n    }\n  }\n\n  const forwardAxisNorm = forwardAxis.clone().normalize();\n  const axisUp = new THREE.Vector3(0, 1, 0);\n  const axisRight = new THREE.Vector3().crossVectors(axisUp, forwardAxisNorm).normalize();\n  const baseCorners = [\n    new THREE.Vector3(baseBox.min.x, baseBox.min.y, baseBox.min.z),\n    new THREE.Vector3(baseBox.min.x, baseBox.min.y, baseBox.max.z),\n    new THREE.Vector3(baseBox.min.x, baseBox.max.y, baseBox.min.z),\n    new THREE.Vector3(baseBox.min.x, baseBox.max.y, baseBox.max.z),\n    new THREE.Vector3(baseBox.max.x, baseBox.min.y, baseBox.min.z),\n    new THREE.Vector3(baseBox.max.x, baseBox.min.y, baseBox.max.z),\n    new THREE.Vector3(baseBox.max.x, baseBox.max.y, baseBox.min.z),\n    new THREE.Vector3(baseBox.max.x, baseBox.max.y, baseBox.max.z)\n  ];\n  function axisExtents(axis) {\n    let min = Infinity;\n    let max = -Infinity;\n    baseCorners.forEach(corner => {\n      const v = corner.dot(axis);\n      if (v < min) min = v;\n      if (v > max) max = v;\n    });\n    const center = baseCenter.dot(axis);\n    return { min, max, length: max - min, center };\n  }\n  const fExt = axisExtents(forwardAxisNorm);\n  const rExt = axisExtents(axisRight);\n  const uExt = axisExtents(axisUp);\n  const buildLocalPos = (forward, right, up) => (\n    baseCenter.clone()\n      .addScaledVector(forwardAxisNorm, forward - fExt.center)\n      .addScaledVector(axisRight, right - rExt.center)\n      .addScaledVector(axisUp, up - uExt.center)\n  );\n  const noseForward = fExt.max - fExt.length * 0.01;\n  const wingForward = fExt.min + fExt.length * 0.22;\n  const bellyForward = fExt.min + fExt.length * 0.42;\n  const wingRight = rExt.max - rExt.length * 0.05;\n  const wingLeft = rExt.min + rExt.length * 0.05;\n  const noseRight = rExt.center + rExt.length * 0.03;\n  const noseLeft = rExt.center - rExt.length * 0.03;\n  const wingUp = uExt.center + uExt.length * 0.05;\n  const noseUp = uExt.center - uExt.length * 0.02;\n  const bellyUp = uExt.min + uExt.length * 0.12;\n  const baseWingLeft = buildLocalPos(wingForward, wingLeft, wingUp);\n  const baseWingRight = buildLocalPos(wingForward, wingRight, wingUp);\n  const baseNoseLeft = buildLocalPos(noseForward, noseLeft, noseUp);\n  const baseNoseRight = buildLocalPos(noseForward, noseRight, noseUp);\n  const baseBelly = buildLocalPos(bellyForward, rExt.center, bellyUp);\n\n  const yawFixQ = new THREE.Quaternion()\n    .setFromAxisAngle(new THREE.Vector3(0, 1, 0), yaw);\n  const BOLT_POOL = boltPool ?? scene.userData?.boltPool ?? null;\n\n  const ACTIVE = [];\n  const ACTIVE_SHIPS = [];\n  const spawnQueue = spawnArray.map((cfg, idx) => ({\n    ...cfg,\n    __spawnIdx: idx,\n    __src: cfg,\n    spawned: false\n  }));\n\n  function createFrigateInstance() {\n    const ship = proto.clone(true);\n    ship.visible = false;\n    ship.userData = {\n      enemy: true,\n      enemyRoot: true,\n      flashT: 0,\n      hitBoxes,\n      largeExplosion: true\n    };\n\n    const meshes = [];\n    ship.traverse(n => {\n      if (n.isMesh) {\n        n.material = useLambert ? toLambert(n.material) : n.material.clone();\n        n.userData.enemy = true;\n        n.frustumCulled = false;\n        meshes.push(n);\n      }\n    });\n    ship.userData.meshes = meshes;\n    ship.userData.blink = () => { ship.userData.flashT = 0.2; };\n    scene.add(ship);\n    return ship;\n  }\n\n  const shipPool = spawnQueue.map(() => {\n    const ship = createFrigateInstance();\n    ACTIVE.push(ship);\n    return ship;\n  });\n  spawnQueue.forEach((cfg, i) => { cfg.ship = shipPool[i]; });\n\n  const tmpPlayer = new THREE.Vector3();\n  const tmpPos = new THREE.Vector3();\n  const tmpQuat = new THREE.Quaternion();\n  const tmpDir = new THREE.Vector3();\n  const tmpForward = new THREE.Vector3();\n  const tmpSpawn = new THREE.Vector3();\n  const tmpOffset = new THREE.Vector3();\n  const boltForward = new THREE.Vector3(0, 0, 1);\n  const losHazards = [];\n  const tmpLosDir = new THREE.Vector3();\n  const tmpLosMin = new THREE.Vector3();\n  const tmpLosMax = new THREE.Vector3();\n  const tmpLosBox = new THREE.Box3();\n\n  function addLosHazard(entry) {\n    if (!entry) return;\n    const mesh = entry.getMesh ? entry.getMesh() : entry.mesh ?? null;\n    const collider = entry.collider ?? mesh?.userData?.collider ?? null;\n    if (!mesh || !collider) return;\n    losHazards.push({\n      mesh,\n      collider,\n      laserCollisionEnabled: mesh.userData?.laserCollisionEnabled !== false,\n      gateCylinder: mesh.userData?.gateCylinder ?? null\n    });\n  }\n\n  const losEntries = Array.isArray(hazardEntries) ? hazardEntries : [];\n  losEntries.forEach(addLosHazard);\n\n  function segmentDistSq2D(cx, cz, a, b) {\n    const abx = b.x - a.x;\n    const abz = b.z - a.z;\n    const acx = cx - a.x;\n    const acz = cz - a.z;\n    const abLenSq = abx * abx + abz * abz;\n    let t = 0;\n    if (abLenSq > 1e-8) t = (acx * abx + acz * abz) / abLenSq;\n    if (t < 0) t = 0;\n    else if (t > 1) t = 1;\n    const dx = a.x + abx * t - cx;\n    const dz = a.z + abz * t - cz;\n    return dx * dx + dz * dz;\n  }\n\n  function hasLineOfSight(origin, target) {\n    if (!losHazards.length) return true;\n    tmpLosDir.copy(target).sub(origin);\n    const dist = tmpLosDir.length();\n    if (dist <= 1e-5) return true;\n    tmpLosDir.multiplyScalar(1 / dist);\n    tmpLosMin.set(\n      Math.min(origin.x, target.x),\n      Math.min(origin.y, target.y),\n      Math.min(origin.z, target.z)\n    );\n    tmpLosMax.set(\n      Math.max(origin.x, target.x),\n      Math.max(origin.y, target.y),\n      Math.max(origin.z, target.z)\n    );\n    tmpLosBox.set(tmpLosMin, tmpLosMax);\n    for (let i = 0; i < losHazards.length; i++) {\n      const h = losHazards[i];\n      if (!h.mesh?.visible) continue;\n      if (h.laserCollisionEnabled === false) continue;\n      if (h.gateCylinder) {\n        const gate = h.gateCylinder;\n        const segMinY = Math.min(origin.y, target.y);\n        const segMaxY = Math.max(origin.y, target.y);\n        if (segMaxY < gate.minY || segMinY > gate.maxY) {\n          continue;\n        }\n        const distSq = segmentDistSq2D(gate.x, gate.z, origin, target);\n        if (distSq > gate.radius * gate.radius) {\n          continue;\n        }\n      }\n      if (h.collider?.worldAABB && !tmpLosBox.intersectsBox(h.collider.worldAABB)) {\n        continue;\n      }\n      if (h.collider?.linecast) {\n        const hit = h.collider.linecast(origin, tmpLosDir, dist);\n        if (hit?.hit) return false;\n      }\n    }\n    return true;\n  }\n\n  function lookQuaternion(from, to, out) {\n    tmpDir.copy(to).sub(from);\n    if (tmpDir.lengthSq() > 1e-6) {\n      tmpDir.normalize();\n    } else {\n      tmpDir.set(0, 0, 1);\n    }\n    return (out ?? tmpQuat).setFromUnitVectors(boltForward, tmpDir);\n  }\n\n  function fireLaser(worldPos, worldQuat, { big = false } = {}) {\n    if (!BOLT_POOL) return;\n    const handle = BOLT_POOL.alloc({\n      big,\n      life: big ? 1.8 : 1.8,\n      dir: 1,\n      bounced: false,\n      scale: big ? bigLaserScale : 1\n    });\n    if (!handle) return;\n    BOLT_POOL.setTransform(handle, worldPos, worldQuat, big ? bigLaserScale : 1);\n  }\n\n  function resetFrigate(ship, cfg) {\n    const scaleMult = typeof cfg.scale === 'number' ? cfg.scale : 1;\n    const totalScale = scale * scaleMult;\n    ship.scale.setScalar(totalScale);\n    ship.position.set(cfg.x, cfg.y, cfg.z);\n    if (cfg.__src) {\n      ship.userData.editorRef = cfg.__src;\n      ship.userData.editorGroup = editorGroup;\n      ship.userData.editorIndex = cfg.__spawnIdx;\n    }\n    ship.visible = true;\n    ship.userData.dead = false;\n    ship.userData.hp = typeof cfg.hp === 'number' ? cfg.hp : hp;\n    ship.userData.scoreValue = typeof cfg.scoreValue === 'number' ? cfg.scoreValue : scoreValue;\n    ship.userData.hitRadius = baseHitRadius * totalScale;\n    ship.userData.dropHealRing = Boolean(cfg.dropHealRing);\n    ship.userData.flashT = 0;\n    ship.userData.wingBurstRemaining = wingBurstCount;\n    ship.userData.wingBurstCooldown = 0;\n    ship.userData.wingBurstShotT = 0;\n    ship.userData.noseFireT = 0;\n    ship.userData.noseSide = 1;\n    ship.userData.spawnT = 0;\n    const spawnCap = typeof cfg.spawnLimit === 'number' ? cfg.spawnLimit : spawnLimit;\n    ship.userData.spawnRemaining = Number.isFinite(spawnCap) ? spawnCap : Infinity;\n    ship.userData.spawnInterval = typeof cfg.spawnInterval === 'number'\n      ? cfg.spawnInterval\n      : spawnInterval;\n    const yawOffset = typeof cfg.yaw === 'number' ? cfg.yaw : 0;\n    if (!ship.userData.yawOffsetQ) ship.userData.yawOffsetQ = new THREE.Quaternion();\n    ship.userData.yawOffsetQ.setFromAxisAngle(axisUp, yawOffset);\n    if (!ship.userData.spawnOffsetVec) ship.userData.spawnOffsetVec = new THREE.Vector3();\n    const spawnOffset = cfg.spawnOffset;\n    if (spawnOffset && typeof spawnOffset === 'object') {\n      ship.userData.spawnOffsetVec.set(\n        Number(spawnOffset.x) || 0,\n        Number(spawnOffset.y) || 0,\n        Number(spawnOffset.z) || 0\n      );\n    } else if (typeof cfg.spawnOffsetY === 'number') {\n      ship.userData.spawnOffsetVec.set(0, cfg.spawnOffsetY, 0);\n    } else {\n      ship.userData.spawnOffsetVec.set(0, 0, 0);\n    }\n    ship.userData.guns = {\n      wingLeft: baseWingLeft.clone(),\n      wingRight: baseWingRight.clone(),\n      noseLeft: baseNoseLeft.clone(),\n      noseRight: baseNoseRight.clone(),\n      belly: baseBelly.clone()\n    };\n    ship.updateMatrixWorld(true);\n  }\n\n  function update(dt) {\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n    playerObj.getWorldPosition(tmpPlayer);\n\n    let spawnedThisFrame = 0;\n    const MAX_SPAWN_PER_FRAME = 1;\n    for (let i = 0; i < spawnQueue.length && spawnedThisFrame < MAX_SPAWN_PER_FRAME; i++) {\n      const cfg = spawnQueue[i];\n      if (cfg.spawned) continue;\n      tmpPos.set(cfg.x, cfg.y, cfg.z);\n      if (tmpPos.distanceToSquared(tmpPlayer) <= spawnRadius * spawnRadius) {\n        resetFrigate(cfg.ship, cfg);\n        cfg.spawned = true;\n        spawnedThisFrame += 1;\n      }\n    }\n\n    ACTIVE_SHIPS.length = 0;\n    ACTIVE.forEach(ship => {\n      if (!ship.visible || ship.userData.dead) return;\n      ACTIVE_SHIPS.push(ship);\n\n      const distSq = ship.position.distanceToSquared(tmpPlayer);\n      if (distSq >= faceMinDistance * faceMinDistance) {\n        ship.lookAt(tmpPlayer);\n        ship.quaternion.multiply(yawFixQ);\n        ship.userData.yawOffsetQ && ship.quaternion.multiply(ship.userData.yawOffsetQ);\n      }\n\n      tmpForward.copy(forwardAxisNorm).applyQuaternion(ship.quaternion).normalize();\n      ship.position.addScaledVector(tmpForward, moveSpeed * dt);\n\n      if (ship.position.z > tmpPlayer.z + cullBehind) {\n        ship.visible = false;\n        ship.userData.dead = true;\n        return;\n      }\n\n      if (allowFire) {\n        if (ship.userData.wingBurstCooldown > 0) {\n          ship.userData.wingBurstCooldown = Math.max(0, ship.userData.wingBurstCooldown - dt);\n        } else {\n          ship.userData.wingBurstShotT += dt;\n          if (ship.userData.wingBurstShotT >= wingBurstInterval) {\n            let fired = false;\n            ship.localToWorld(tmpPos.copy(ship.userData.guns.wingLeft));\n            if (hasLineOfSight(tmpPos, tmpPlayer)) {\n              lookQuaternion(tmpPos, tmpPlayer, tmpQuat);\n              fireLaser(tmpPos, tmpQuat);\n              fired = true;\n            }\n            ship.localToWorld(tmpPos.copy(ship.userData.guns.wingRight));\n            if (hasLineOfSight(tmpPos, tmpPlayer)) {\n              lookQuaternion(tmpPos, tmpPlayer, tmpQuat);\n              fireLaser(tmpPos, tmpQuat);\n              fired = true;\n            }\n            if (fired) {\n              ship.userData.wingBurstShotT = 0;\n              ship.userData.wingBurstRemaining -= 1;\n              if (ship.userData.wingBurstRemaining <= 0) {\n                ship.userData.wingBurstRemaining = wingBurstCount;\n                ship.userData.wingBurstCooldown = wingBurstPause;\n              }\n            } else {\n              ship.userData.wingBurstShotT = wingBurstInterval;\n            }\n          }\n        }\n\n        ship.userData.noseFireT += dt;\n        if (ship.userData.noseFireT >= noseFireInterval) {\n          const useRight = ship.userData.noseSide > 0;\n          ship.userData.noseSide *= -1;\n          const noseLocal = useRight ? ship.userData.guns.noseRight : ship.userData.guns.noseLeft;\n          ship.localToWorld(tmpPos.copy(noseLocal));\n          if (hasLineOfSight(tmpPos, tmpPlayer)) {\n            ship.userData.noseFireT = 0;\n            lookQuaternion(tmpPos, tmpPlayer, tmpQuat);\n            fireLaser(tmpPos, tmpQuat, { big: true });\n          } else {\n            ship.userData.noseFireT = noseFireInterval;\n          }\n        }\n\n        if (spawnBlue && ship.userData.spawnRemaining > 0) {\n          ship.userData.spawnT += dt;\n          if (ship.userData.spawnT >= ship.userData.spawnInterval) {\n            ship.userData.spawnT = 0;\n            ship.localToWorld(tmpSpawn.copy(ship.userData.guns.belly));\n            if (ship.userData.spawnOffsetVec?.lengthSq() > 1e-6) {\n              tmpOffset.copy(ship.userData.spawnOffsetVec).applyQuaternion(ship.quaternion);\n              tmpSpawn.add(tmpOffset);\n            }\n            spawnBlue(tmpSpawn);\n            if (Number.isFinite(ship.userData.spawnRemaining)) {\n              ship.userData.spawnRemaining -= 1;\n            }\n          }\n        }\n      }\n\n      if (ship.userData.flashT > 0) {\n        ship.userData.flashT = Math.max(0, ship.userData.flashT - dt);\n      }\n      const flashOn = ship.userData.flashT > 0;\n      const r = flashOn ? 1 : 0;\n      ship.userData.meshes.forEach(m => m.material.emissive.setRGB(r, 0, 0));\n    });\n  }\n\n  function prewarm(renderer, camera) {\n    const prev = shipPool.map(s => s.visible);\n    shipPool.forEach(s => { s.visible = true; });\n    renderer.compile(scene, camera);\n    shipPool.forEach((s, i) => { s.visible = prev[i]; });\n  }\n\n  function previewSetup({\n    origin = null,\n    right = null,\n    up = null,\n    spacing = 12,\n    count = 1,\n    faceTarget = null\n  } = {}) {\n    if (!shipPool.length) return () => {};\n    const maxCount = Math.min(count, shipPool.length);\n    const prevStates = [];\n    for (let i = 0; i < maxCount; i++) {\n      const ship = shipPool[i];\n      prevStates.push({\n        ship,\n        vis: ship.visible,\n        pos: ship.position.clone(),\n        quat: ship.quaternion.clone(),\n        scale: ship.scale.clone()\n      });\n      ship.visible = true;\n      ship.userData.dead = false;\n      ship.userData.flashT = 0;\n      ship.scale.setScalar(scale);\n      if (origin) ship.position.copy(origin);\n      if (right) {\n        const offset = (i - (maxCount - 1) * 0.5) * spacing;\n        ship.position.addScaledVector(right, offset);\n      }\n      if (up) ship.position.addScaledVector(up, (i % 2) * spacing * 0.1);\n      if (faceTarget) {\n        ship.lookAt(faceTarget);\n        ship.quaternion.multiply(yawFixQ);\n      }\n    }\n    return () => {\n      prevStates.forEach(state => {\n        state.ship.visible = state.vis;\n        state.ship.position.copy(state.pos);\n        state.ship.quaternion.copy(state.quat);\n        state.ship.scale.copy(state.scale);\n      });\n    };\n  }\n\n  function materializeSpawns() {\n    spawnQueue.forEach(cfg => {\n      resetFrigate(cfg.ship, cfg);\n    });\n    return spawnQueue.map(cfg => cfg.ship);\n  }\n\n  return {\n    update,\n    getActiveShips: () => ACTIVE_SHIPS,\n    prewarm,\n    previewSetup,\n    materializeSpawns\n  };\n}\n","/* behaviours.js – all enemy movement/aim presets in one place */\nimport * as THREE from './libs/build/three.module.js';\n\nexport const BEHAVIOURS = {\n  /* regular dark fighter */\n  straight : {\n    retreatDist : 50,\n    fireDir     : +1,             // your dark bolts use +Z  :contentReference[oaicite:4]{index=4}\n    despawnDelay: 20\n  },\n\n  /* blue cork-screw fighter */\n  corkscrew : {\n    yaw         : Math.PI,\n    fireDir     : -1,\n    orbitRadius : 4,\n    orbitRate   : 3,\n    retreatDist : 50,\n    despawnDelay: 20\n  },\n\n  /* blue straight fighter (normal movement, blue mesh) */\n  blueStraight : {\n    yaw         : Math.PI,\n    fireDir     : -1,\n    retreatDist : 50,\n    despawnDelay: 20\n  },\n\n  /* diagonal left→right drive-by */\n  diagLR : {\n    fireDir     : +1,\n    diagSpeed   : 25,\n    diagVec     : new THREE.Vector3( 1, -0.3, 0 ).normalize(),\n    retreatDist : 70,\n    despawnDelay: 20\n  },\n\n  /* mirrored right→left drive-by */\n  diagRL : {\n    fireDir     : +1,\n    diagSpeed   : 25,\n    diagVec     : new THREE.Vector3(-1,  0.3, 0 ).normalize(),\n    retreatDist : 70,\n    despawnDelay: 20\n  },\n\n/* ============================================================= */\n/*  NEW BEHAVIOURS                                               */\n/* ============================================================= */\n\n/* 1. Wide lateral zig-zag (dark model) ------------------------ */\nzigzagWide : {\n  fireDir    : +1,\n  lateralAmp : 18,          // 8-unit side sweep\n  lateralHz  : 0.8,        // cycles per second\n  retreatDist: 60,\n  despawnDelay: 20\n},\n\n/* 2. Tight high-speed zig-zag (blue model) -------------------- */\nzigzagTight : {\n  yaw        : Math.PI,    // flip blue model\n  fireDir    : -1,\n  lateralAmp : 8,\n  lateralHz  : 1,\n  retreatDist: 55,\n  despawnDelay: 20\n},\n\n/* 3. Hover-bob (vertical sine) -------------------------------- */\nhoverBob : {\n  yaw         : Math.PI,\n  fireDir     : -1,\n  verticalAmp : 15,\n  verticalHz  : 1,\n  retreatDist : 45,\n  despawnDelay: 20\n},\n\n/* 4. Spiral-in cork-screw (dark) ------------------------------ */\nspiralIn : {\n  fireDir     : +1,\n  orbitRadius : 16,\n  orbitRate   : 2,         // fast spin while sliding back\n  retreatDist : 40,\n  despawnDelay: 20\n},\n\n\n /* 5. Spider-Turret fighter (dark3) ------------------------ */\nspiderTurret: {\n  dualGun      : true,\n  gunSpacing   : 0.6,\n  fireInterval : 0.3,\n  fireDir      : +1,\n\n  lateralAmp   : 18,      // side-scuttle\n  lateralHz    : 0.6,\n\n  verticalAmp  : 8,      // subtle hover-bob\n  verticalHz   : 0.4,\n\n  retreatDist  : 50,     // a bit closer\n\nbackpedal : true,\nhp           : 5,\n  despawnDelay : 30\n},\n\n/* 6. Jet swoop (fast arcing passes) -------------------------- */\njetArc: {\n  fireDir      : +1,\n  fireOffsetZ  : 1.5,\n  forwardAxis  : new THREE.Vector3(-1, 0, 0),\n  hp           : 5,\n  burstCount   : 5,\n  burstInterval: 0.12,\n  burstPause   : 2.0,\n  passLoop     : true,\n  passDuration : 7,\n  passAhead    : 180,\n  passBehind   : 8,\n  passFireWindow: 70,\n  orientToVelocity: true,\n  orientToPlayerWhenFiring: true,\n  glowOffset   : new THREE.Vector3(0.8, 0, 0),\n  lateralAmp   : 16,\n  lateralHz    : 0.45,\n  verticalAmp  : 10,\n  verticalHz   : 0.25,\n  retreatDist  : 90,\n  despawnDelay : 28\n}\n\n\n\n\n};\n","import * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { setBossHealthAlt } from './hud.js';\nimport { toLambert } from './material-utils.js';\n\n/**\n * initBossSystem(scene,{\n *   spawn,        // {x,y,z} from spawns.json\n *   playerObj,    // mesh of player ship\n *   railCurve,    // CatmullRomCurve3\n *   playerSpeed   // units / s\n * })\n *  → returns { update(dt,tPlayer), getActiveLasers() }\n */\nexport async function initBossSystem(scene,{\n  spawn,\n  playerObj,\n  railCurve,\n  playerSpeed,\n  modelPath = './models/dark2.glb',\n  boltPool = null,\n  onDestroyed = null,\n  canFire = null,\n  materialMode = 'standard',\n  autoDespawnZ = -3205\n}){\n  /* ── load and scale frigate ───────────────────────────── */\n  const boss = (await new GLTFLoader().loadAsync(modelPath)).scene;\n  const useLambert = materialMode === 'lambert';\n  boss.scale.setScalar(36);                     // “frigate-sized”\n  boss.position.set(spawn.x, spawn.y, spawn.z);\n boss.visible = false;                         // ← hide until spawned\n  scene.add(boss);\n\n  /* ── dynamic gun hard-points based on scaled bounds ───── */\n  const box   = new THREE.Box3().setFromObject(boss);\nconst size  = new THREE.Vector3(); box.getSize(size);\nconst hitR  = size.z * 0.44;            // 45 % of frigate length\nconst hitR2 = hitR * hitR;              // tighter & visually matched\n\n  const w = size.x * 0.1, h = size.y * 0.1, d = size.z * 0.1;\n\n/* ── gun hard-points (nose + slight left / right) ────────── */\nconst guns = [\n  new THREE.Vector3( 0,            0,  0 ),        // dead-centre bow\n  new THREE.Vector3(-0.7,  -0.1,  -d * 0.1),   // left-front\n  new THREE.Vector3( 0.7,  -0.1,  -d * 0.1),    // right-front\n  new THREE.Vector3(-0.2,  -0.15,  -d * 0.1),   // left-front\n  new THREE.Vector3( 0.2,  -0.15,  -d * 0.1)    // right-front\n];\n\n\n  /* ── laser pool (shared instanced) ───────────────────── */\n  const LASER_SPD = 180, LASER_LIFE = 1.2, FIRE_INT = 1.8;\n  const BOLT_POOL = boltPool ?? scene.userData?.boltPool ?? null;\n  function fireLaser(worldPos, worldQuat, isBig = false){\n    if (!BOLT_POOL) return;\n    const handle = BOLT_POOL.alloc({ big: isBig, life: LASER_LIFE * (isBig ? 1.5 : 1), dir: 1, bounced: false, scale: isBig ? 2 : 1 });\n    if (!handle) return;\n    BOLT_POOL.setTransform(handle, worldPos, worldQuat, isBig ? 2 : 1);\n  }\n  function getActiveLasers(){ return []; }\n\n/* ---------- new boss stats & flash ---------- */\nconst MAX_HP = 45;\nlet   hp     = MAX_HP;\nlet   flashT = 0;\nlet   destroyed = false;\n\n/* cache all meshes once for cheap flash */\n  const meshList = [];\n  boss.traverse(o => {\n    if (o.isMesh) {\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      meshList.push(o);\n    }\n  });\n\n/* expose to collision system */\nfunction getMesh(){ return boss; }\nfunction damageBoss(dmg){\n  if (destroyed) return;\n  hp = Math.max(0, hp-dmg);\n flashT = dmg >= 3 ? 0.30  // charge‑shot or other “big” hits\n                   : 0.15; // regular lasers & bounced bolt\n  setBossHealthAlt(hp / MAX_HP);\n  if(hp===0){\n    destroyed = true;\n    boss.visible=false;\n    setBossHealthAlt(null);\n    if (typeof onDestroyed === 'function') onDestroyed();\n  }\n}\n\n  /* ── helper scratch ──────────────────────────────────── */\nconst tmpPos   = new THREE.Vector3(),\n      tmpQuat  = new THREE.Quaternion(),\n      tmpWorld = new THREE.Vector3(),\n      tmpDir   = new THREE.Vector3();    // ← declare properly\nconst lookForward = new THREE.Vector3(0, 0, 1);\n  let fireTimer = 0;\n  let spawned   = false;        //  ← was below update() in your copy\n  const autoKillZ = Number.isFinite(spawn?.autoDespawnZ)\n    ? spawn.autoDespawnZ\n    : autoDespawnZ;\n\n  function lookQuaternion(from, to, out) {\n  tmpDir.copy(to).sub(from);\n  if (tmpDir.lengthSq() > 1e-6) {\n    tmpDir.normalize();\n  } else {\n    tmpDir.copy(lookForward);\n  }\n  return (out ?? tmpQuat).setFromUnitVectors(\n         lookForward, tmpDir);            // +Z → dir\n}\n\n\n\n  /* ── update each frame ───────────────────────────────── */\n     function update(dt,tPlayer){\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n\n    /* 0. spawn when player is close enough */\n  /* 0. spawn when player comes within 300 u of the boss point */\n  if (!spawned) {\n  playerObj.getWorldPosition(tmpWorld);\n  if (tmpWorld.z <= spawn.z + 300) {          // within range\n    spawned      = true;                     // ← FIXED (was inside the comment)\n    boss.visible = true;\n    setBossHealthAlt(hp / MAX_HP);\n  } else {\n    return;                                  // not active yet\n  }\n}\n\n    // keep boss HUD in sync while active (for worker-host HUD)\n    setBossHealthAlt(hp > 0 ? hp / MAX_HP : null);\n\n    /* 1. once spawned, stay a little ahead of the player & face them */\n    const bossT = Math.min(1, tPlayer + 0.0032); // ~2 % ahead\n    boss.position.copy(railCurve.getPointAt(bossT));\n    boss.lookAt(tmpWorld.setFromMatrixPosition(playerObj.matrixWorld));\n\n    if (!destroyed && Number.isFinite(autoKillZ) && boss.position.z <= autoKillZ) {\n      destroyed = true;\n      hp = 0;\n      boss.visible = false;\n      setBossHealthAlt(null);\n      if (typeof onDestroyed === 'function') onDestroyed({ auto: true, noScore: true });\n      return;\n    }\n\n if (hp > 0 && allowFire) {                       // ← NEW guard: only while alive\n      fireTimer += dt;\n      if (fireTimer >= FIRE_INT) {\n        fireTimer = 0;\n    guns.forEach(g => {\n          boss.localToWorld(tmpPos.copy(g));\n          lookQuaternion(tmpPos, tmpWorld, tmpQuat);\n          fireLaser(tmpPos, tmpQuat);\n        });\n        /* big centre blast every third volley */\n        if (Math.random() < 0.34) {\n          tmpPos.copy(guns[0]); boss.localToWorld(tmpPos);\n          lookQuaternion(tmpPos, tmpWorld, tmpQuat);\n          fireLaser(tmpPos, tmpQuat, true);\n        }\n      }\n    }\n\n    /* update lasers */\n\n/* red flash using emissive – no traverse each frame */\nif (flashT>0){\n  flashT=Math.max(0,flashT-dt);\n  const e=flashT>0?1:0;\n  meshList.forEach(m=>m.material.emissive.setRGB(e,0,0));\n}\n\n\n    // movement handled by shared pool update\n  }\n\n  function prewarm(renderer, camera) {\n    const prevVis = boss.visible;\n    const prevPos = boss.position.clone();\n    const prevQuat = boss.quaternion.clone();\n    const prevCulls = [];\n    boss.visible = true;\n    if (camera) {\n      const camPos = new THREE.Vector3();\n      const camDir = new THREE.Vector3();\n      camera.getWorldPosition(camPos);\n      camera.getWorldDirection(camDir);\n      boss.position.copy(camPos).addScaledVector(camDir, 80);\n      boss.lookAt(camPos);\n    }\n    boss.traverse(o => {\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    renderer.render(scene, camera);\n    boss.visible = prevVis;\n    boss.position.copy(prevPos);\n    boss.quaternion.copy(prevQuat);\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n  }\n\n  return { update, getActiveLasers, damageBoss, getMesh,  getRadiusSq: () => hitR2, prewarm };\n}\n","// pickup-system.js\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { gainHeart } from './hud.js';\n\nexport async function initPickupSystem(scene, {\n  spawnArray = [{ x: 0, y: 0, z: -120 }],\n  blueSpawnArray = [],\n  ringSpawnArray = [],\n  wingRepairSpawnArray = [],\n  bombSpawnArray = [],\n  playerObj,\n  lasers,\n  onBombPickup = () => {},\n  onRingCollected = () => {}\n}) {\n    const tmp1 = new THREE.Vector3();\n    const tmp2 = new THREE.Vector3();\n  const PICKUP_SPAWN_DISTANCE = 300;\n  /* ----- visual -------------------------------------------------- */\n/* ------- visual: twin-laser icon --------------------------------- */\n\n/* bar geometry (vertical) */\nconst barGeo = new THREE.BoxGeometry(0.25, 6, 0.25);\nconst barMat = new THREE.MeshStandardMaterial({\n  color: 0x00ff7f,\n  emissive: 0x00ff7f,\n  emissiveIntensity: 1.5,\n  roughness: 0.3,\n  metalness: 0.6\n});\nconst BLUE_LASER_COLOR = 0x00ffff;\nconst barMatBlue = new THREE.MeshStandardMaterial({\n  color: BLUE_LASER_COLOR,\n  emissive: BLUE_LASER_COLOR,\n  emissiveIntensity: 1.5,\n  roughness: 0.3,\n  metalness: 0.6\n});\n\n/* dark-blue bridge – connects mid-sections (y = 0) */\nconst bridgeGeo = new THREE.BoxGeometry(2, 1.2, 0.3);      // ↑ taller bridgeconst\nconst  bridgeMat = new THREE.MeshStandardMaterial({ color: 0x001244 });\nconst bridge    = new THREE.Mesh(bridgeGeo, bridgeMat);\nbridge.position.y = 0;            // centred\n\n/* ── white capital “L” glued to the bridge ─────────────────────── */\nconst letterMat = new THREE.MeshStandardMaterial({\n  color: 0xffffff,\n  emissive: 0xffffff,\n  emissiveIntensity: 0.8,\n  roughness: 0.2,\n  metalness: 0.4\n});\n\n/* bigger “L” */\nconst vert  = new THREE.Mesh(new THREE.BoxGeometry(0.22, 2.0, 0.22), letterMat);\nvert.position.set(-0.55, 0, 0.2);               // centred on taller bridge\n\nconst horiz = new THREE.Mesh(new THREE.BoxGeometry(1.1, 0.22, 0.22), letterMat);\nhoriz.position.set( 0.05, -0.9, 0.2);           // aligns with bottom\n\nconst letterGrp = new THREE.Group();\nletterGrp.add(vert);\nletterGrp.add(horiz);\nconst createDualCore = (barMaterial) => {\n  const core = new THREE.Group();\n  const barL = new THREE.Mesh(barGeo, barMaterial);\n  barL.position.x = -1;\n  core.add(barL);\n  const barR = new THREE.Mesh(barGeo, barMaterial);\n  barR.position.x = 1;\n  core.add(barR);\n  core.add(bridge.clone());\n  core.add(letterGrp.clone());\n  return core;\n};\n\nconst pickupCore = createDualCore(barMat);\nconst pickupBlueCore = createDualCore(barMatBlue);\n\n/* starting position */\n  const pickups = [];\n\n  spawnArray.forEach(p => {\n    const core = pickupCore.clone(true);      // deep clone of bars/L/bridge\n    const inst = new THREE.Group();\n    inst.add(core);\n    inst.position.set(p.x, p.y, p.z);\n    inst.userData.editorRef = p;\n    inst.userData.editorGroup = 'pickupDual';\n    scene.add(inst);\n    pickups.push({\n      group: inst,\n      core,\n      baseY: p.y,\n      active: false,\n      pending: true,\n      spawnRef: p,\n      spawnGroup: 'pickupDual'\n    });\n    core.visible = false;\n  });\n\n  const bluePickups = [];\n  const createBlueEntry = (position = null, pending = false) => {\n    const core = pickupBlueCore.clone(true);\n    const inst = new THREE.Group();\n    inst.add(core);\n    if (position) inst.position.copy(position);\n    scene.add(inst);\n    return {\n      group: inst,\n      core,\n      baseY: position ? position.y : 0,\n      active: false,\n      pending\n    };\n  };\n  blueSpawnArray.forEach(p => {\n    const entry = createBlueEntry(new THREE.Vector3(p.x, p.y, p.z), true);\n    entry.group.userData.editorRef = p;\n    entry.group.userData.editorGroup = 'pickupDualBlue';\n    entry.spawnRef = p;\n    entry.spawnGroup = 'pickupDualBlue';\n    bluePickups.push(entry);\n    entry.core.visible = false;\n  });\n  const BLUE_POOL_EXTRA = Math.max(4, Array.isArray(spawnArray) ? spawnArray.length : 0);\n  for (let i = 0; i < BLUE_POOL_EXTRA; i++) {\n    const entry = createBlueEntry();\n    entry.core.visible = false;\n    bluePickups.push(entry);\n  }\n\n  /* ------- visual: heal ring ------------------------------------- */\n  const RING_OUTER_R = 3;\n//const RING_INNER_R = 4.2;\n  const RING_INNER_R = 2.25;\n  const RING_SCALE = 1.7;\n  const RING_RADIUS = RING_OUTER_R * RING_SCALE;\n  const RING_RADIUS2 = RING_RADIUS * RING_RADIUS;\n  const RING_HALF_DEPTH = 3.5;\n  const RING_COLLECT_DURATION = 0.45;\n  const RING_SPIN_SPEED = (Math.PI * 4) / RING_COLLECT_DURATION;\n\n  const RING_MAJOR_R = (RING_OUTER_R + RING_INNER_R) * 0.5;\n  const RING_TUBE_R = (RING_OUTER_R - RING_INNER_R) * 0.5;\n  const ringGeo = new THREE.TorusGeometry(RING_MAJOR_R, RING_TUBE_R, 6, 12);\n  const ringMat = new THREE.MeshStandardMaterial({\n    color: 0xc0c0c0,\n    emissive: 0x202020,\n    emissiveIntensity: 1.25,\n    metalness: 1.0,\n    roughness: 0.12,\n    side: THREE.FrontSide\n  });\n  const ringMesh = new THREE.Mesh(ringGeo, ringMat);\n  const ringGrp = new THREE.Group();\n  ringGrp.add(ringMesh);\n\n  const ringPickups = [];\n  const RING_POOL_EXTRA = 12;\n  const createRingEntry = () => {\n    const inst = ringGrp.clone(true);\n    inst.visible = false;\n    inst.scale.setScalar(RING_SCALE);\n    scene.add(inst);\n    return {\n      mesh: inst,\n      baseY: 0,\n      state: 'done',\n      animT: 0,\n      spin: 0\n    };\n  };\n  ringSpawnArray.forEach(p => {\n    const entry = createRingEntry();\n    entry.mesh.position.set(p.x, p.y, p.z);\n    entry.mesh.visible = false;\n    entry.baseY = p.y;\n    entry.state = 'pending';\n    entry.mesh.userData.editorRef = p;\n    entry.mesh.userData.editorGroup = 'pickupHealRing';\n    entry.spawnRef = p;\n    entry.spawnGroup = 'pickupHealRing';\n    ringPickups.push(entry);\n  });\n  for (let i = 0; i < RING_POOL_EXTRA; i++) {\n    ringPickups.push(createRingEntry());\n  }\n\n  /* ------- visual: wing repair pickup (wrench) ------------------ */\n  const wingCore = new THREE.Group();\n  const wingCoreMat = new THREE.MeshStandardMaterial({\n    color: 0x6bbcff,\n    emissive: 0x2b6bff,\n    emissiveIntensity: 1.2,\n    roughness: 0.2,\n    metalness: 0.6\n  });\n  const wingBarMat = new THREE.MeshStandardMaterial({\n    color: 0x9ad6ff,\n    emissive: 0x3a8bff,\n    emissiveIntensity: 0.9,\n    roughness: 0.25,\n    metalness: 0.4\n  });\n\n  const handle = new THREE.Mesh(new THREE.BoxGeometry(0.55, 4.2, 0.45), wingCoreMat);\n  handle.position.set(0, 0, 0);\n  wingCore.add(handle);\n\n  const socketOuter = new THREE.Mesh(new THREE.CylinderGeometry(0.9, 0.8, 0.6, 14), wingCoreMat);\n  socketOuter.rotation.x = Math.PI * 0.5;\n  socketOuter.position.set(0, -2.4, 0);\n  wingCore.add(socketOuter);\n\n  const socketInnerMat = new THREE.MeshStandardMaterial({\n    color: 0x2a4d7f,\n    emissive: 0x18335a,\n    emissiveIntensity: 0.6,\n    roughness: 0.35,\n    metalness: 0.2\n  });\n  const socketInner = new THREE.Mesh(new THREE.CylinderGeometry(0.45, 0.4, 0.55, 12), socketInnerMat);\n  socketInner.rotation.x = Math.PI * 0.5;\n  socketInner.position.set(0, -2.4, 0.06);\n  wingCore.add(socketInner);\n\n  const openBase = new THREE.Mesh(new THREE.BoxGeometry(1.3, 0.9, 0.55), wingCoreMat);\n  openBase.position.set(0, 2.05, 0);\n  wingCore.add(openBase);\n\n  const jawGeo = new THREE.BoxGeometry(0.45, 0.85, 0.55);\n  const jawL = new THREE.Mesh(jawGeo, wingBarMat);\n  jawL.position.set(-0.65, 2.45, 0);\n  wingCore.add(jawL);\n  const jawR = jawL.clone();\n  jawR.position.set(0.65, 2.25, 0);\n  wingCore.add(jawR);\n\n  wingCore.rotation.z = -Math.PI * 0.25;\n  wingCore.scale.setScalar(1.55);\n\n  wingCore.updateMatrixWorld(true);\n  const wingCoreBounds = new THREE.Box3().setFromObject(wingCore);\n  const wingCoreCenter = wingCoreBounds.getCenter(new THREE.Vector3());\n  wingCore.children.forEach(child => {\n    child.position.sub(wingCoreCenter);\n  });\n  wingCore.updateMatrixWorld(true);\n  wingCoreBounds.setFromObject(wingCore);\n  const wingCoreSphere = wingCoreBounds.getBoundingSphere(new THREE.Sphere());\n  const wingCoreRadius = wingCoreSphere.radius;\n\n  const wingPickups = [];\n  const dualSpawnCount = (Array.isArray(spawnArray) ? spawnArray.length : 0)\n    + (Array.isArray(blueSpawnArray) ? blueSpawnArray.length : 0);\n  const WING_POOL_EXTRA = Math.max(6, dualSpawnCount);\n  const createWingEntry = (position = null, pending = false) => {\n    const core = wingCore.clone(true);\n    const inst = new THREE.Group();\n    inst.add(core);\n    if (position) inst.position.copy(position);\n    scene.add(inst);\n    return {\n      group: inst,\n      core,\n      baseY: position ? position.y : 0,\n      pickupRadius: wingCoreRadius,\n      pickupRadiusSq: wingCoreRadius * wingCoreRadius,\n      active: false,\n      pending\n    };\n  };\n  wingRepairSpawnArray.forEach(p => {\n    const entry = createWingEntry(new THREE.Vector3(p.x, p.y, p.z), true);\n    entry.group.userData.editorRef = p;\n    entry.group.userData.editorGroup = 'pickupWingRepair';\n    entry.spawnRef = p;\n    entry.spawnGroup = 'pickupWingRepair';\n    wingPickups.push(entry);\n    entry.core.visible = false;\n  });\n  for (let i = 0; i < WING_POOL_EXTRA; i++) {\n    const entry = createWingEntry();\n    entry.core.visible = false;\n    wingPickups.push(entry);\n  }\n\n  /* ------- visual: bomb pickup ---------------------------------- */\n  const BOMB_SCALE = 40.0;\n  const BOMB_EMISSIVE_SCALE = 0.85;\n  const bombGltf = await new GLTFLoader().loadAsync('./models/pickup_bomb.glb');\n  const bombCore = bombGltf.scene;\n  const sharedBombMaterials = new Map();\n  const makeBombEmissive = (mat) => {\n    const base = mat.color ? mat.color.clone() : new THREE.Color(0xffffff);\n    base.multiplyScalar(BOMB_EMISSIVE_SCALE);\n    const out = new THREE.MeshBasicMaterial({\n      color: base,\n      map: mat.map ?? null,\n      transparent: mat.transparent ?? false,\n      opacity: mat.opacity ?? 1,\n      alphaTest: mat.alphaTest ?? 0,\n      side: mat.side ?? THREE.FrontSide,\n      depthWrite: mat.depthWrite ?? true,\n      depthTest: mat.depthTest ?? true\n    });\n    if (mat.vertexColors !== undefined) out.vertexColors = mat.vertexColors;\n    out.toneMapped = false;\n    return out;\n  };\n  const applyBombMaterials = (root) => {\n    root.traverse(node => {\n      if (!node.isMesh || !node.userData?.bombMatKeys) return;\n      const keys = node.userData.bombMatKeys;\n      if (Array.isArray(node.material)) {\n        node.material = keys.map(key => sharedBombMaterials.get(key)).filter(Boolean);\n      } else {\n        node.material = sharedBombMaterials.get(keys[0]);\n      }\n    });\n  };\n  bombCore.traverse(node => {\n    if (node.isLight) {\n      node.visible = false;\n      return;\n    }\n    if (!node.isMesh || !node.material) return;\n    const materials = Array.isArray(node.material) ? node.material : [node.material];\n    const keys = materials.map(mat => {\n      if (!mat) return null;\n      if (!mat.userData.bombKey) {\n        mat.userData.bombKey = `bomb_${sharedBombMaterials.size}`;\n      }\n      const key = mat.userData.bombKey;\n      if (!sharedBombMaterials.has(key)) {\n        sharedBombMaterials.set(key, makeBombEmissive(mat));\n      }\n      return key;\n    }).filter(Boolean);\n    node.userData.bombMatKeys = keys;\n    if (keys.length) {\n      node.material = Array.isArray(node.material)\n        ? keys.map(key => sharedBombMaterials.get(key)).filter(Boolean)\n        : sharedBombMaterials.get(keys[0]);\n    }\n  });\n  bombCore.scale.setScalar(1);\n  bombCore.updateMatrixWorld(true);\n  const bombCoreBounds = new THREE.Box3().setFromObject(bombCore);\n  const bombCoreCenter = bombCoreBounds.getCenter(new THREE.Vector3());\n  bombCore.position.sub(bombCoreCenter);\n  bombCore.updateMatrixWorld(true);\n  bombCoreBounds.setFromObject(bombCore);\n  const bombCoreSphere = bombCoreBounds.getBoundingSphere(new THREE.Sphere());\n  const bombCoreRadius = bombCoreSphere.radius * BOMB_SCALE;\n\n  const bombPickups = [];\n  const BOMB_POOL_EXTRA = Math.max(4, Array.isArray(bombSpawnArray) ? bombSpawnArray.length : 0);\n  const createBombEntry = (position = null, pending = false) => {\n    const core = bombCore.clone(true);\n    applyBombMaterials(core);\n    const inst = new THREE.Group();\n    inst.add(core);\n    inst.scale.setScalar(BOMB_SCALE);\n    if (position) inst.position.copy(position);\n    scene.add(inst);\n    return {\n      group: inst,\n      core,\n      baseY: position ? position.y : 0,\n      pickupRadius: bombCoreRadius,\n      pickupRadiusSq: bombCoreRadius * bombCoreRadius,\n      active: false,\n      pending\n    };\n  };\n  bombSpawnArray.forEach(p => {\n    const entry = createBombEntry(new THREE.Vector3(p.x, p.y, p.z), true);\n    entry.group.userData.editorRef = p;\n    entry.group.userData.editorGroup = 'pickupBomb';\n    entry.spawnRef = p;\n    entry.spawnGroup = 'pickupBomb';\n    bombPickups.push(entry);\n    entry.core.visible = false;\n  });\n  for (let i = 0; i < BOMB_POOL_EXTRA; i++) {\n    const entry = createBombEntry();\n    entry.core.visible = false;\n    bombPickups.push(entry);\n  }\n\n  /* ----- state --------------------------------------------------- */\n  const setPickupInactive = (entry) => {\n    entry.active = false;\n    entry.core.visible = false;\n  };\n  const setWingPickupInactive = (entry) => {\n    entry.active = false;\n    entry.core.visible = false;\n  };\n\n  function spawnWingRepairAt(position) {\n    if (!position) return false;\n    let entry = wingPickups.find(p => !p.active && !p.pending);\n    if (!entry) return false;\n    entry.group.position.copy(position);\n    entry.baseY = position.y;\n    entry.pending = false;\n    entry.active = true;\n    entry.core.visible = true;\n    return true;\n  }\n\n  function spawnBluePickupAt(position) {\n    if (!position) return false;\n    let entry = bluePickups.find(p => !p.active && !p.pending);\n    if (!entry) return false;\n    entry.group.position.copy(position);\n    entry.baseY = position.y;\n    entry.pending = false;\n    entry.active = true;\n    entry.core.visible = true;\n    return true;\n  }\n\n  const hasMissingWing = () => {\n    const left = playerObj?.userData?.wingHpLeft;\n    const right = playerObj?.userData?.wingHpRight;\n    if (typeof left !== 'number' || typeof right !== 'number') return false;\n    return left <= 0 || right <= 0;\n  };\n\n  const shouldSpawnAt = (spawnZ, playerZ) => {\n    const dz = playerZ - spawnZ;\n    return dz >= 0 && dz <= PICKUP_SPAWN_DISTANCE;\n  };\n\n  function update(dt, t) {\n    playerObj.getWorldPosition(tmp2);\n    const playerZ = tmp2.z;\n    const missingWing = hasMissingWing();\n    const hasDualGreen = lasers?.isDual?.() && !lasers?.isBlue?.();\n    const hasDualBlue = lasers?.isDual?.() && lasers?.isBlue?.();\n\n    pickups.forEach((entry) => {\n      if (entry.pending) {\n        if (shouldSpawnAt(entry.group.position.z, playerZ)) {\n          if (missingWing) {\n            spawnWingRepairAt(entry.group.position);\n            entry.pending = false;\n            entry.active = false;\n            entry.core.visible = false;\n            return;\n          }\n          if (hasDualBlue) {\n            if (spawnWingRepairAt(entry.group.position)) {\n              entry.pending = false;\n              entry.active = false;\n              entry.core.visible = false;\n              return;\n            }\n          }\n          if (hasDualGreen) {\n            if (spawnBluePickupAt(entry.group.position)) {\n              entry.pending = false;\n              entry.active = false;\n              entry.core.visible = false;\n              return;\n            }\n          }\n          entry.pending = false;\n          entry.active = true;\n          entry.core.visible = true;\n        } else {\n          return;\n        }\n      }\n      if (!entry.active) return;\n      if (missingWing) {\n        spawnWingRepairAt(entry.group.position);\n        setPickupInactive(entry);\n        return;\n      }\n      const grp = entry.group;\n\n      /* spin & bob */\n      grp.position.y  = entry.baseY + Math.sin(t * 0.001) * 1.8;\n\n      /* world-space collision check (6 u sphere → 36) */\n      grp.getWorldPosition(tmp1);\n      if (tmp1.distanceToSquared(tmp2) < 36) {\n        setPickupInactive(entry);\n        lasers.enableDual(true);        // activate dual fire\n        lasers.enableBlue && lasers.enableBlue(false);\n      }\n    });\n\n    bluePickups.forEach((entry) => {\n      if (entry.pending) {\n        if (shouldSpawnAt(entry.group.position.z, playerZ)) {\n          if (missingWing) {\n            spawnWingRepairAt(entry.group.position);\n            entry.pending = false;\n            entry.active = false;\n            entry.core.visible = false;\n            return;\n          }\n          entry.pending = false;\n          entry.active = true;\n          entry.core.visible = true;\n        } else {\n          return;\n        }\n      }\n      if (!entry.active) return;\n      if (missingWing) {\n        spawnWingRepairAt(entry.group.position);\n        setPickupInactive(entry);\n        return;\n      }\n      const grp = entry.group;\n      grp.position.y = entry.baseY + Math.sin(t * 0.001) * 1.8;\n      grp.getWorldPosition(tmp1);\n      if (tmp1.distanceToSquared(tmp2) < 36) {\n        setPickupInactive(entry);\n        lasers.enableDual(true);\n        lasers.enableBlue && lasers.enableBlue(true);\n      }\n    });\n\n    wingPickups.forEach(entry => {\n      if (entry.pending) {\n        if (shouldSpawnAt(entry.group.position.z, playerZ)) {\n          entry.pending = false;\n          entry.active = true;\n          entry.core.visible = true;\n        } else {\n          return;\n        }\n      }\n      if (!entry.active) return;\n      const grp = entry.group;\n      grp.rotation.y += 0.9 * dt;\n      grp.position.y = entry.baseY + Math.sin(t * 0.001) * 1.8;\n      grp.getWorldPosition(tmp1);\n      if (tmp1.distanceToSquared(tmp2) < entry.pickupRadiusSq) {\n        setWingPickupInactive(entry);\n        playerObj.userData?.restoreWings?.();\n      }\n    });\n\n    bombPickups.forEach(entry => {\n      if (entry.pending) {\n        if (shouldSpawnAt(entry.group.position.z, playerZ)) {\n          entry.pending = false;\n          entry.active = true;\n          entry.core.visible = true;\n        } else {\n          return;\n        }\n      }\n      if (!entry.active) return;\n      const grp = entry.group;\n      grp.rotation.y += 0.8 * dt;\n      grp.position.y = entry.baseY + Math.sin(t * 0.001) * 1.2;\n      grp.getWorldPosition(tmp1);\n      if (tmp1.distanceToSquared(tmp2) < entry.pickupRadiusSq) {\n        setPickupInactive(entry);\n        onBombPickup(1);\n      }\n    });\n\n    ringPickups.forEach(entry => {\n      const grp = entry.mesh;\n      if (entry.state === 'pending') {\n        if (shouldSpawnAt(grp.position.z, playerZ)) {\n          entry.state = 'idle';\n          entry.mesh.visible = true;\n          entry.mesh.scale.setScalar(RING_SCALE);\n          entry.mesh.rotation.set(0, 0, 0);\n        } else {\n          return;\n        }\n      }\n      if (!grp.visible) return;\n      if (entry.state === 'idle') {\n        grp.rotation.y += 1.0 * dt;\n        grp.position.y = entry.baseY + Math.sin(t * 0.001) * 2.4;\n\n        grp.getWorldPosition(tmp1);\n        const dz = tmp1.z - tmp2.z;\n        if (Math.abs(dz) <= RING_HALF_DEPTH) {\n          const dx = tmp1.x - tmp2.x;\n          const dy = tmp1.y - tmp2.y;\n          if ((dx * dx + dy * dy) <= RING_RADIUS2) {\n            entry.state = 'collecting';\n            entry.animT = 0;\n            entry.spin = 0;\n            grp.rotation.set(0, 0, 0);\n            gainHeart(1);\n            onRingCollected(1);\n          }\n        }\n      } else if (entry.state === 'collecting') {\n        entry.animT += dt;\n        const alpha = Math.min(1, entry.animT / RING_COLLECT_DURATION);\n        entry.spin += RING_SPIN_SPEED * dt;\n        grp.position.copy(tmp2);\n        grp.rotation.z = entry.spin;\n        const shrink = THREE.MathUtils.lerp(1, 0.05, alpha);\n        grp.scale.setScalar(RING_SCALE * shrink);\n        if (alpha >= 1) {\n          entry.state = 'done';\n          grp.visible = false;\n        }\n      }\n    });\n  }\n\n\n  function prewarm(renderer, camera) {\n    const prevSize = renderer.getSize(new THREE.Vector2());\n    const tmpCamPos = new THREE.Vector3();\n    const tmpCamDir = new THREE.Vector3();\n    const tmpWarmPos = new THREE.Vector3();\n    const warmState = [];\n\n    camera.getWorldPosition(tmpCamPos);\n    camera.getWorldDirection(tmpCamDir);\n    tmpWarmPos.copy(tmpCamPos).add(tmpCamDir.multiplyScalar(20));\n\n    const warmPickup = (entry, offsetX = 0) => {\n      if (!entry?.group) return;\n      warmState.push({\n        type: 'pickup',\n        entry,\n        visible: entry.group.visible,\n        coreVisible: entry.core.visible,\n        position: entry.group.position.clone(),\n        rotation: entry.group.rotation.clone()\n      });\n      entry.group.visible = true;\n      entry.core.visible = true;\n      entry.group.position.copy(tmpWarmPos).add(new THREE.Vector3(offsetX, 0, 0));\n      entry.group.rotation.set(0, 0, 0);\n    };\n\n    const warmRing = (entry, offsetX = 0) => {\n      if (!entry?.mesh) return;\n      warmState.push({\n        type: 'ring',\n        entry,\n        visible: entry.mesh.visible,\n        position: entry.mesh.position.clone(),\n        rotation: entry.mesh.rotation.clone(),\n        scale: entry.mesh.scale.clone()\n      });\n      entry.mesh.visible = true;\n      entry.mesh.position.copy(tmpWarmPos).add(new THREE.Vector3(offsetX, 0, 0));\n      entry.mesh.rotation.set(0, 0, 0);\n      entry.mesh.scale.setScalar(RING_SCALE);\n    };\n\n    warmPickup(pickups[0], -8);\n    warmPickup(bluePickups[0], -4);\n    warmPickup(wingPickups[0], 6);\n    warmPickup(bombPickups[0], 10);\n    warmRing(ringPickups[0], 0);\n\n    renderer.setSize(64, 64, false);\n    renderer.render(scene, camera);\n    renderer.setSize(prevSize.x, prevSize.y, false);\n\n    warmState.forEach(state => {\n      if (state.type === 'pickup') {\n        const entry = state.entry;\n        entry.group.visible = state.visible;\n        entry.core.visible = state.coreVisible;\n        entry.group.position.copy(state.position);\n        entry.group.rotation.copy(state.rotation);\n      } else if (state.type === 'ring') {\n        const entry = state.entry;\n        entry.mesh.visible = state.visible;\n        entry.mesh.position.copy(state.position);\n        entry.mesh.rotation.copy(state.rotation);\n        entry.mesh.scale.copy(state.scale);\n      }\n    });\n  }\n\n  function idleCull(playerZ = 0) {\n    for (let i = 0; i < pickups.length; i++) {\n      const entry = pickups[i];\n      if (entry.pending) {\n        if (entry.group.position.z > playerZ + 30) {\n          entry.pending = false;\n          entry.active = false;\n          entry.core.visible = false;\n        }\n        continue;\n      }\n      if (!entry.active) continue;\n      if (entry.group.position.z > playerZ + 30) {\n        setPickupInactive(entry);\n      }\n    }\n    for (let i = 0; i < bluePickups.length; i++) {\n      const entry = bluePickups[i];\n      if (entry.pending) {\n        if (entry.group.position.z > playerZ + 30) {\n          entry.pending = false;\n          entry.active = false;\n          entry.core.visible = false;\n        }\n        continue;\n      }\n      if (!entry.active) continue;\n      if (entry.group.position.z > playerZ + 30) {\n        setPickupInactive(entry);\n      }\n    }\n    for (let i = 0; i < wingPickups.length; i++) {\n      const entry = wingPickups[i];\n      if (entry.pending) {\n        if (entry.group.position.z > playerZ + 30) {\n          entry.pending = false;\n          entry.active = false;\n          entry.core.visible = false;\n        }\n        continue;\n      }\n      if (!entry.active) continue;\n      if (entry.group.position.z > playerZ + 30) {\n        setWingPickupInactive(entry);\n      }\n    }\n    for (let i = 0; i < bombPickups.length; i++) {\n      const entry = bombPickups[i];\n      if (entry.pending) {\n        if (entry.group.position.z > playerZ + 30) {\n          entry.pending = false;\n          entry.active = false;\n          entry.core.visible = false;\n        }\n        continue;\n      }\n      if (!entry.active) continue;\n      if (entry.group.position.z > playerZ + 30) {\n        setPickupInactive(entry);\n      }\n    }\n    for (let i = 0; i < ringPickups.length; i++) {\n      const entry = ringPickups[i];\n      if (entry.state !== 'idle') continue;\n      const grp = entry.mesh;\n      if (grp.position.z > playerZ + 30) {\n        entry.state = 'done';\n        grp.visible = false;\n      }\n    }\n  }\n\n  function spawnHealRingAt(position) {\n    if (!position) return false;\n    const entry = ringPickups.find(p => p.state === 'done' && !p.mesh.visible);\n    if (!entry) return false;\n    entry.mesh.position.copy(position);\n    entry.mesh.rotation.set(0, 0, 0);\n    entry.mesh.scale.setScalar(RING_SCALE);\n    entry.mesh.visible = true;\n    entry.baseY = position.y;\n    entry.state = 'idle';\n    entry.animT = 0;\n    entry.spin = 0;\n    return true;\n  }\n\n  function materializeAll() {\n    const out = [];\n    pickups.forEach(entry => {\n      if (!entry.spawnRef) return;\n      entry.pending = false;\n      entry.active = true;\n      entry.core.visible = true;\n      entry.group.visible = true;\n      out.push(entry.group);\n    });\n    bluePickups.forEach(entry => {\n      if (!entry.spawnRef) return;\n      entry.pending = false;\n      entry.active = true;\n      entry.core.visible = true;\n      entry.group.visible = true;\n      out.push(entry.group);\n    });\n    wingPickups.forEach(entry => {\n      if (!entry.spawnRef) return;\n      entry.pending = false;\n      entry.active = true;\n      entry.core.visible = true;\n      entry.group.visible = true;\n      out.push(entry.group);\n    });\n    bombPickups.forEach(entry => {\n      if (!entry.spawnRef) return;\n      entry.pending = false;\n      entry.active = true;\n      entry.core.visible = true;\n      entry.group.visible = true;\n      out.push(entry.group);\n    });\n    ringPickups.forEach(entry => {\n      if (!entry.spawnRef) return;\n      entry.state = 'idle';\n      entry.mesh.visible = true;\n      out.push(entry.mesh);\n    });\n    return out;\n  }\n\n  return { update, prewarm, idleCull, spawnHealRingAt, materializeAll };\n}\n","/* platform‑system.js  – spinning 4‑gun turret “plat.glb” */\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { addScore }   from './hud.js';                 // +100 pts on death\nimport { toLambert } from './material-utils.js';\n\nexport async function initPlatformSystem(scene, {\nspawn       = null,\n  spawnArray  = [],  playerObj,\n    camera,\n  canFire     = null,\n  spinRate     = THREE.MathUtils.degToRad(30),   // rad · s‑¹  (≈30°/s)\n  gunArc       = THREE.MathUtils.degToRad(30),   // half‑angle of each cone\n  fireInterval = 1.2,                            // seconds / gun\n  materialMode = 'standard'\n} = {}) {\n\n    const cam = camera;\n\n      /* choose spawn point ------------------------------------------ */\n  if (!spawn) {\n    /* prefer the first element in spawnArray if supplied          */\n    if (Array.isArray(spawnArray) && spawnArray.length) {\n      spawn = spawnArray[0];\n    } else {\n      spawn = { x: 0, y: 0, z: 0 };   // safe-fallback origin\n    }\n  }\n\nconst ACTIVATE_DIST = 200;   // same 200-unit trigger used by fighters\n\n\n  /* ── load once ───────────────────────────────────────────── */\n  const root = (await new GLTFLoader().loadAsync('./models/plat.glb')).scene;\n  root.scale.setScalar(8);\n  root.position.set(spawn.x, spawn.y, spawn.z);\n  scene.add(root);\n\nroot.visible         = false;     // stay hidden until activated\nroot.userData.active = false;     // track dormant / awake\n\n  /* ── four hard‑points: +X, +Z, −X, −Z (local space) ──────── */\n  const GUN_DIRS = [\n    new THREE.Vector3( 0.66, 0.025,  0),\n    new THREE.Vector3( 0, 0.025,  0.66),\n    new THREE.Vector3(-0.66, 0.025,  0),\n    new THREE.Vector3( 0, 0.025, -0.66)\n  ];\n  const muzzleR   = 3.2;                               // radius from centre\n  const GUN_POS   = GUN_DIRS.map(v=>v.clone().multiplyScalar(muzzleR));\n\n  /* ── per‑gun cooldown timers ─────────────────────────────── */\n  const cd = new Float32Array(4).fill(0);\n\n  /* ── laser pool (orange bolts) ───────────────────────────── */\n  const LASER_SPD = 160, LASER_LIFE = 2;\n  const geo = new THREE.BoxGeometry(0.3,0.3,6).translate(0,0,3);\n  const mat = new THREE.MeshBasicMaterial({ color: 0xff6600 });\n  const pool = Array.from({length:32},()=>{\n    const m = new THREE.Mesh(geo,mat); m.visible=false; scene.add(m); return m;\n  });\n\n  function fireGun(i){\n    const bolt = pool.find(b=>!b.visible); if(!bolt) return;\n    /* spawn position */\n    const p = GUN_POS[i].clone(); root.localToWorld(p);\n    bolt.position.copy(p);\n    /* orient toward player */\nplayerObj.getWorldPosition(tmpWorldV);  // → world\n  bolt.lookAt(tmpWorldV);                 // shoot at live player\n    bolt.visible       = true;\n    bolt.userData.life = LASER_LIFE;\n    bolt.userData.dir  =  1;          // enemy → player\nbolt.userData.bounced = false;    // not yet reflected\n\n    cd[i]              = fireInterval;         // reset that gun’s CD\n  }\n\n  const activeLasers = [];\n  function getActiveLasers(){\n    activeLasers.length = 0;\n    for (let i = 0; i < pool.length; i++) {\n      const b = pool[i];\n      if (b.visible) activeLasers.push(b);\n    }\n    return activeLasers;\n  }\n\n  /* ── basic hp / flash setup (same as spider) ─────────────── */\n  /* ── harvest every child mesh so we can tint them safely ── */\n  const meshList = [];\n  const useLambert = materialMode === 'lambert';\n  root.traverse(o=>{\n    if (o.isMesh) {\n      /* clone the material so flashing this turret\n         never affects other instances that share the GLTF */\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      meshList.push(o);\n    }\n  });\n\n/* ── green lock-on ring so charge shots can find us ────────── */\n/* use the same thin-square (diamond) ring the fighters use */\nconst lrGeo = new THREE.RingGeometry(1.6, 1.9, 4);   // outer, inner, segments\nconst lrMat = new THREE.MeshBasicMaterial({ color: 0x00ff7f,\n                                            side : THREE.DoubleSide });\nconst lockRing = new THREE.Mesh(lrGeo, lrMat);\n/* no rotation → it faces camera once we billboard it in update() */\n lockRing.visible      = false;\n lockRing.position.y   = 1;\n lockRing.scale.setScalar(5);      // ≈ same screen size as fighter rings\n scene.add(lockRing);\nroot.userData.lockRing = lockRing;  // laser-system toggles this\n\n\n  /* ── basic hp / flash setup (same as spider) ─────────────── */\n  root.userData = {\n    enemy      : true,\n    enemyRoot  : true,\n    hp         : 5,\n    flashT     : 0,\n    meshes     : meshList,\n    blink(){\n      this.flashT = 0.15;\n      meshList.forEach(m=>{\n        /* some materials (e.g. MeshBasicMaterial) lack ‘emissive’ —\n           test first so we never crash again */\n        if (m.material.emissive) m.material.emissive.setRGB(1,0,0);\n      });\n    }\n  };\n\nroot.userData.lockRing = lockRing;\n\n  /* ── update loop ─────────────────────────────────────────── */\n  const vPlayerDir = new THREE.Vector3();   // scratch – player direction WS\n\n  const vPlayerWS = new THREE.Vector3();    // player world‑space\nconst vRootWS   = new THREE.Vector3();    // root  world‑space\n\n  const tmpWorldV = new THREE.Vector3();\nconst tmpWorldQ = new THREE.Quaternion();\nconst tmpQuat        = new THREE.Quaternion();\nconst tmpParentQuat  = new THREE.Quaternion();\nconst qWorldParent = new THREE.Quaternion();   // temp\nconst qLocal       = new THREE.Quaternion();   // temp\n\n  const tmp = new THREE.Vector3(), dir = new THREE.Vector3();\n  const COS_ARC = Math.cos(gunArc);              // pre‑compute threshold\n\n  function update(dt){\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n    /* continuous spin */\n    root.rotateY(spinRate * dt * 10);\n\n      /* ―― DESPAWN once player is well ahead ――――――――――――――――― */\n  const DESPAWN_Z  = 100;              // distance threshold (units)\n  playerObj.getWorldPosition(vPlayerWS);\n  root.getWorldPosition(vRootWS);\n\nif (!root.userData.active) {\n  if (vPlayerWS.distanceToSquared(vRootWS) > ACTIVATE_DIST * ACTIVATE_DIST) {\n    return;                        // still dormant – skip everything\n  }\n  /* player is close enough → wake up */\n  root.visible         = true;\n  root.userData.active = true;\n  /* optional: cd.fill(0);  // fire immediately if you prefer */\n}\n\n  if (!root.userData.dead && vPlayerWS.z < vRootWS.z - DESPAWN_Z) {\n    root.visible        = false;       // stop rendering & firing\n    root.userData.active = false;   // flag so update() knows we’re asleep\n    root.userData.dead  = true;        // collisions skip it\n    return;                            // nothing else to do\n  }\n\n    /* fade red flash */\n\n    /* billboard the lock-ring when it’s showing */\nif (lockRing.visible && cam){                      // guard against null cam\n  /* 1. keep the ring centred on the turret */\n  root.getWorldPosition(lockRing.position);\n\n  /* 2. face whatever the *current* rail camera is seeing */\n  cam.getWorldQuaternion(tmpWorldQ);          // → world\n  lockRing.quaternion.copy(tmpWorldQ);        // face player *now*\n}\n\n    if (root.userData.flashT > 0){\n      root.userData.flashT -= dt;\n      if (root.userData.flashT <= 0){\n        meshList.forEach(m=>{\n          if (m.material.emissive) m.material.emissive.setRGB(0,0,0);\n        });\n      }\n    }\n\n    /* move & cull our bolts */\n    pool.forEach(b=>{\n      if(!b.visible) return;\nb.translateZ(LASER_SPD * dt * (b.userData.dir ?? 1));\n      b.userData.life -= dt;\n      if (b.userData.life <= 0) b.visible = false;\n    });\n\n    if (!root.visible) return;                 // dead already?\n\n    /* vector to player in world XZ plane */\n  /* direction to player in the X‑Z plane (world space) */\n  playerObj.getWorldPosition(vPlayerWS);\n  root.getWorldPosition(vRootWS);\n  tmp.copy(vPlayerWS).sub(vRootWS);    // now both in world space\n  tmp.y = 0;\n    if (tmp.lengthSq() < 1e-4) return;         // player on top\n    tmp.normalize();\n\n/* ---------- per‑gun firing logic (robust) --------------- */\nplayerObj.getWorldPosition(vPlayerWS);\nroot.getWorldPosition(vRootWS);\nvPlayerDir.copy(vPlayerWS).sub(vRootWS).setY(0).normalize();\n\nfor (let i = 0; i < 4; ++i) {\n  cd[i] -= dt;                    // tick cooldown\n\n\n\n  if (cd[i] > 0) continue;        // still cooling\n\n  // gun’s forward vector → world, flattened\n  dir.copy(GUN_DIRS[i])\n     .applyQuaternion(root.quaternion)\n     .setY(0).normalize();\n\n  // fire if player within ±30°\n  if (allowFire && dir.dot(vPlayerDir) >= 0.866) {   // cos 30° = 0.866\n    fireGun(i);\n  }\n}}\n\n\n  /* expose what the other systems need */\n  return {\n    update,\n    getActiveLasers,\n    getMesh : () => root,\n    getActiveShips : () => root.visible ? [root] : []   // NEW – for main.js\n    , prewarm(renderer, camera) {\n      const prevVis = root.visible;\n      const prevCull = root.frustumCulled;\n      root.visible = true;\n      root.frustumCulled = false;\n      renderer.render(scene, camera);\n      root.visible = prevVis;\n      root.frustumCulled = prevCull;\n    }\n\n  };\n}\n","/* station‑turret.js – auto‑turret that defends the space‑station boss\n   ------------------------------------------------------------------\n   initStationTurretSystem(scene,{\n     playerObj,      // the player ship mesh\n     stationMesh,    // the big static station mesh (for LOS ray)\n     camera,         // main PerspectiveCamera (for lock‑ring billboarding)\n     spawn           // {x,y,z} position for this turret\n   })\n     → returns {\n         update(dt),\n         getActiveShips(),    // for collision / lock‑on\n         getActiveLasers()    // for collision\n       }\n*/\n\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { toLambert } from './material-utils.js';\n\nconst loader = new GLTFLoader();\nconst _turretCache = { proto: null, promise: null };\nasync function getTurretProto(path = './models/turret.glb') {\n  if (_turretCache.proto) return _turretCache.proto;\n  if (!_turretCache.promise) _turretCache.promise = loader.loadAsync(path);\n  const gltf = await _turretCache.promise;\n  _turretCache.proto = gltf.scene;\n  return _turretCache.proto;\n}\n\nexport async function initStationTurretSystem(scene, {\n  playerObj,\n  stationMesh,\n  camera      = null,\n  spawn       = { x: 0, y: 0, z: 0 },\n  boltPool    = null,\n  canFire     = null,\n  materialMode = 'standard'\n} = {}) {\n\n  /* ── constants ────────────────────────────────────────────── */\n  const ACTIVATE_DIST2 = 600 * 600;   // 200‑u sphere (squared)\n  const DESPAWN_Z_GAP  = 100;         // despawn once player is 100 u ahead\n  const FIRE_INT       = 1.0;         // seconds between shots\n  const LASER_SPEED    = 160;\n  const LASER_LIFE     = 3.0;         // seconds (shorter to reduce active count)\n\n  /* ── load turret model (cached) ───────────────────────────── */\n  const proto = (await getTurretProto()).clone(true);\n  const turret = proto;\n  turret.scale.setScalar(5);\n  turret.position.set(spawn.x, spawn.y, spawn.z);\n  scene.add(turret);\n\n  turret.visible          = false;  // hidden until activation\n  turret.userData.active  = false;\n  turret.userData.enemy   = true;\n  turret.userData.enemyRoot = true;\n  turret.userData.hp      = 3;\n  turret.userData.flashT  = 0;\n  turret.userData.dead    = false;\n\n  /* ── clone materials & store mesh list for flashing ───────── */\n  const meshList = [];\n  const useLambert = materialMode === 'lambert';\n  turret.traverse(o => {\n    if (o.isMesh) {\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      meshList.push(o);\n    }\n  });\n\nturret.userData.meshes = meshList;\n\n  turret.userData.blink = function () {\n    this.flashT = 0.15;\n    meshList.forEach(m => {\n      if (m.material.emissive) m.material.emissive.setRGB(1, 0, 0);\n    });\n  };\n\n  /* ── optional lock‑on ring (same geo as fighters) ─────────── */\n  const lrGeo = new THREE.RingGeometry(1.6, 1.9, 4);\n  const lrMat = new THREE.MeshBasicMaterial({ color: 0x00ff7f, side: THREE.DoubleSide });\n  const lockRing = new THREE.Mesh(lrGeo, lrMat);\n  lockRing.visible = false;\n  lockRing.scale.setScalar(4);         // slightly smaller than platform ring\n  scene.add(lockRing);\n  turret.userData.lockRing = lockRing;\n\n  /* ── shared bolt pool (instanced) ────────────────────────── */\n  function getActiveLasers() { return []; }\n\n  /* ── helpers ------------------------------------------------ */\n  const raycaster       = new THREE.Raycaster();\n  const playerWorldPos  = new THREE.Vector3();\n  const lastPlayerPos   = new THREE.Vector3();\n  const playerVel       = new THREE.Vector3();\n  const turretWorldPos  = new THREE.Vector3();\n  const leadTarget      = new THREE.Vector3();\n  const fwdVec          = new THREE.Vector3();\n  const tmpPos          = new THREE.Vector3();\n  const tmpQuat         = new THREE.Quaternion();\n  let   fireTimer       = 0;\n  const BOLT_POOL = boltPool ?? scene.userData?.boltPool ?? null;\n  const MAX_LEAD_TIME = 0.75;\n  let hasPlayerPrev = false;\n\n  function fireBolt() {\n    if (!boltPool) return;\n    const handle = boltPool.alloc({ big:false, life: LASER_LIFE, dir: 1, bounced: false });\n    if (!handle) return;\n\n    /* spawn bolt 2 u in front of the muzzle (-Z after lookAt) */\n    turret.getWorldQuaternion(tmpQuat);\n    turret.getWorldPosition(tmpPos);\n    fwdVec.set(0, 0, -1).applyQuaternion(tmpQuat);\n    tmpPos.addScaledVector(fwdVec, 2);\n\n    boltPool.setTransform(handle, tmpPos, tmpQuat);\n    turret.userData.activeBoltHandle = handle;\n  }\n\n  /* ── per‑frame update ─────────────────────────────────────── */\n  function update(dt) {\n    const allowFire = typeof canFire === 'function' ? canFire() : true;\n\n    /* --- flash fade ----------------------------------------- */\n    if (turret.userData.flashT > 0) {\n      turret.userData.flashT -= dt;\n      if (turret.userData.flashT <= 0) {\n        meshList.forEach(m => {\n          if (m.material.emissive) m.material.emissive.setRGB(0, 0, 0);\n        });\n      }\n    }\n\n    /* --- update bolt pool ----------------------------------- */\n    // bolt movement handled by shared pool update\n\n    /* if turret already despawned, nothing else to do */\n    if (turret.userData.dead) return;\n\n    /* positions for distance / despawn checks */\n    playerObj.getWorldPosition(playerWorldPos);\n    turret.getWorldPosition(turretWorldPos);\n    if (hasPlayerPrev && dt > 0) {\n      playerVel.copy(playerWorldPos).sub(lastPlayerPos).multiplyScalar(1 / dt);\n    } else {\n      playerVel.set(0, 0, 0);\n      hasPlayerPrev = true;\n    }\n    lastPlayerPos.copy(playerWorldPos);\n\n    /* --- despawn once player is far ahead ------------------- */\n    if (playerWorldPos.z < turretWorldPos.z - DESPAWN_Z_GAP) {\n      turret.visible          = false;\n      turret.userData.active  = false;\n      turret.userData.dead    = true;\n      return;\n    }\n\n    /* --- activation gate (200‑unit sphere) ------------------ */\n    if (!turret.userData.active) {\n      if (playerWorldPos.distanceToSquared(turretWorldPos) < ACTIVATE_DIST2) {\n        turret.visible         = true;\n        turret.userData.active = true;\n        fireTimer              = 0;     // reset cooldown\n      } else {\n        return;                         // stay dormant\n      }\n    }\n\n    /* --- face the player (lead aim) -------------------------- */\n    const dist = turretWorldPos.distanceTo(playerWorldPos);\n    const leadTime = Math.min(dist / LASER_SPEED, MAX_LEAD_TIME);\n    leadTarget.copy(playerWorldPos).addScaledVector(playerVel, leadTime);\n    turret.lookAt(leadTarget);\n\n    /* billboard the lock‑ring if visible --------------------- */\n    if (lockRing.visible && camera) {\n      turret.getWorldPosition(lockRing.position);\n      camera.getWorldQuaternion(lockRing.quaternion);\n    }\n\n    /* --- fire logic ----------------------------------------- */\n    fireTimer += dt;\n    if (fireTimer >= FIRE_INT) {\n      fireTimer = 0;\n\n      /* LOS raycast to avoid shooting through the station */\n      fwdVec.subVectors(leadTarget, turretWorldPos).normalize();\n      raycaster.set(turretWorldPos, fwdVec);\n\n      const hit = raycaster.intersectObject(stationMesh, true);\n      const hasClearShot = hit.length === 0;\n\n      if (allowFire && hasClearShot) fireBolt();\n    }\n  }\n\n  /* ── helpers exposed to other systems ────────────────────── */\n  function getActiveShips() { return turret.visible ? [turret] : []; }\n\n  function destroy() {\n    if (turret.userData.dead) return false;\n    turret.visible = false;\n    turret.userData.active = false;\n    turret.userData.dead = true;\n    if (lockRing) lockRing.visible = false;\n    return true;\n  }\n\n  function getMesh() { return turret; }\n\n  return { update, getActiveShips, getActiveLasers, destroy, getMesh };\n}\n","import * as THREE from './libs/build/three.module.js';\n\n/**\n * Shared instanced bolt pool for all enemies/boss/turrets.\n * Usage:\n *   const pool = createBoltPool(scene, { smallCount: 200, bigCount: 30 });\n *   const idx = pool.alloc({ big:false, life:2, dir:1 });\n *   pool.setTransform(idx, position, quaternion, scale);\n *   // each frame:\n *   pool.update(dt);\n *   pool.getActive(); // array of active bolt records\n */\nexport function createBoltPool(scene, {\n  smallCount = 200,\n  bigCount   = 30,\n  smallColor = 0xff6600,\n  bigColor   = 0xff9900\n} = {}) {\n\n  const geoSmall = new THREE.BoxGeometry(0.3, 0.3, 6).translate(0, 0, 3);\n  const matSmall = new THREE.MeshBasicMaterial({ color: smallColor });\n  const meshSmall = new THREE.InstancedMesh(geoSmall, matSmall, smallCount);\n  meshSmall.instanceMatrix.setUsage(THREE.DynamicDrawUsage);\n  meshSmall.visible = true;\n  meshSmall.frustumCulled = false;   // large spread; skip cull\n  scene.add(meshSmall);\n\n  const geoBig = new THREE.BoxGeometry(0.6, 0.6, 12).translate(0, 0, 6);\n  const matBig = new THREE.MeshBasicMaterial({ color: bigColor });\n  const meshBig = new THREE.InstancedMesh(geoBig, matBig, bigCount);\n  meshBig.instanceMatrix.setUsage(THREE.DynamicDrawUsage);\n  meshBig.visible = true;\n  meshBig.frustumCulled = false;\n  scene.add(meshBig);\n\n  const small = new Array(smallCount).fill(null).map(() => ({\n    active: false,\n    life: 0,\n    dir: 1,\n    bounced: false,\n    scale: 1,\n    prev: new THREE.Vector3(),\n    pos: new THREE.Vector3(),\n    quat: new THREE.Quaternion()\n  }));\n  const big = new Array(bigCount).fill(null).map(() => ({\n    active: false,\n    life: 0,\n    dir: 1,\n    bounced: false,\n    scale: 1,\n    prev: new THREE.Vector3(),\n    pos: new THREE.Vector3(),\n    quat: new THREE.Quaternion()\n  }));\n\n  const activeList = [];\n  const dirVec = new THREE.Vector3();\n  function prewarm(renderer, camera) {\n    // fabricate a couple of instances to force shader/program upload and render once offscreen\n    const dummyHandle = alloc({ big:false, life: 0.01, dir: 1 });\n    const dummyHandleBig = alloc({ big:true, life: 0.01, dir: 1 });\n    setTransform(dummyHandle, new THREE.Vector3(), new THREE.Quaternion());\n    setTransform(dummyHandleBig, new THREE.Vector3(), new THREE.Quaternion());\n    update(0); // flush matrices\n    const prevSize = renderer.getSize(new THREE.Vector2());\n    renderer.setSize(64, 64, false);\n    renderer.render(scene, camera);\n    renderer.setSize(prevSize.x, prevSize.y, false);\n    free(dummyHandle);\n    free(dummyHandleBig);\n  }\n\n  function alloc({ big: isBig = false, life = 2, dir = 1, bounced = false, scale = 1 } = {}) {\n    const arr = isBig ? big : small;\n    const idx = arr.findIndex(b => !b.active);\n    if (idx === -1) return null;\n    const b = arr[idx];\n    b.active = true;\n    b.life = life;\n    b.dir = dir;\n    b.bounced = bounced;\n    b.scale = scale;\n    return { isBig, idx };\n  }\n\n  function setTransform(handle, position, quaternion, scaleOverride) {\n    if (!handle) return;\n    const arr = handle.isBig ? big : small;\n    const b = arr[handle.idx];\n    b.pos.copy(position);\n    b.quat.copy(quaternion);\n    b.scale = scaleOverride ?? b.scale;\n    b.bounced = handle.bounced ?? b.bounced;\n    b.dir = handle.dir ?? b.dir;\n  }\n\n  function free(handle) {\n    if (!handle) return;\n    const arr = handle.isBig ? big : small;\n    const b = arr[handle.idx];\n    b.active = false;\n    b.life = 0;\n  }\n\n  const _m = new THREE.Matrix4();\n  const _scale = new THREE.Vector3();\n  function flushInstances(arr, mesh) {\n    let count = 0;\n    for (let i = 0; i < arr.length; i++) {\n      const b = arr[i];\n      if (!b.active) continue;\n      _scale.set(b.scale, b.scale, b.scale);\n      _m.compose(b.pos, b.quat, _scale);\n      mesh.setMatrixAt(count, _m);\n      b._drawIndex = count;\n      count++;\n    }\n    mesh.count = count;\n    mesh.instanceMatrix.needsUpdate = true;\n  }\n\n  function update(dt) {\n    activeList.length = 0;\n    small.forEach(b => {\n      if (!b.active) return;\n      b.prev.copy(b.pos);\n      dirVec.set(0, 0, 1).applyQuaternion(b.quat);\n      b.pos.addScaledVector(dirVec, 160 * dt * b.dir);\n      b.life -= dt;\n      if (b.life <= 0) b.active = false;\n    });\n    big.forEach(b => {\n      if (!b.active) return;\n      b.prev.copy(b.pos);\n      dirVec.set(0, 0, 1).applyQuaternion(b.quat);\n      b.pos.addScaledVector(dirVec, 200 * dt * b.dir);\n      b.life -= dt;\n      if (b.life <= 0) { b.active = false; b.scale = 1; }\n    });\n\n    small.forEach(b => {\n      if (b.active) activeList.push({\n        position: b.pos,\n        prev: b.prev,\n        userData: b,   // mutate dir/bounced directly\n        handle: b,\n        isBig: false,\n        visible: true\n      });\n    });\n    big.forEach(b => {\n      if (b.active) activeList.push({\n        position: b.pos,\n        prev: b.prev,\n        userData: b,\n        handle: b,\n        isBig: true,\n        visible: true\n      });\n    });\n\n    flushInstances(small, meshSmall);\n    flushInstances(big, meshBig);\n  }\n\n  function getActive() { return activeList; }\n\n  return { alloc, setTransform, free, update, getActive, meshSmall, meshBig, prewarm };\n}\n","/*  station-boss.js  – static space-station boss  */\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport * as BufferGeometryUtils from './libs/examples/jsm/utils/BufferGeometryUtils.js';\n\nconst MATERIAL_TEXTURE_KEYS = [\n  'map',\n  'aoMap',\n  'alphaMap',\n  'bumpMap',\n  'displacementMap',\n  'emissiveMap',\n  'envMap',\n  'lightMap',\n  'metalnessMap',\n  'normalMap',\n  'roughnessMap',\n  'specularMap',\n  'clearcoatMap',\n  'clearcoatRoughnessMap',\n  'sheenColorMap',\n  'sheenRoughnessMap',\n  'iridescenceMap',\n  'iridescenceThicknessMap',\n  'transmissionMap',\n  'thicknessMap'\n];\n\nfunction capMaterialAnisotropy(material, cap) {\n  if (!material || typeof cap !== 'number') return;\n  if (Array.isArray(material)) {\n    material.forEach(mat => capMaterialAnisotropy(mat, cap));\n    return;\n  }\n  for (const key of MATERIAL_TEXTURE_KEYS) {\n    const tex = material[key];\n    if (tex && tex.isTexture) {\n      tex.anisotropy = Math.min(tex.anisotropy ?? cap, cap);\n    }\n  }\n}\n\nfunction toLambert(material) {\n  if (!material) return material;\n  if (Array.isArray(material)) return material.map(toLambert);\n  return new THREE.MeshLambertMaterial({\n    color: material.color ? material.color.clone() : new THREE.Color(0xffffff),\n    map: material.map ?? null,\n    emissive: material.emissive ? material.emissive.clone() : new THREE.Color(0x000000),\n    emissiveMap: material.emissiveMap ?? null,\n    emissiveIntensity: material.emissiveIntensity ?? 1,\n    transparent: material.transparent ?? false,\n    opacity: material.opacity ?? 1,\n    alphaTest: material.alphaTest ?? 0,\n    side: material.side ?? THREE.FrontSide,\n    depthWrite: material.depthWrite ?? true,\n    depthTest: material.depthTest ?? true\n  });\n}\n\nfunction freezeStaticTransforms(root) {\n  root.updateMatrixWorld(true);\n  root.traverse(o => {\n    o.matrixAutoUpdate = false;\n  });\n}\n\n/** Build a spatial hash (uniform grid) for triangle AABBs */\nfunction makeSpatialHash(cellSize = 4) {\n  const map = new Map();\n  const keyOf = (ix, iy, iz) => `${ix}|${iy}|${iz}`;\n  function insertTri(aabbMin, aabbMax, triIndex) {\n    const cs = cellSize;\n    const min = new THREE.Vector3(\n      Math.floor(aabbMin.x / cs),\n      Math.floor(aabbMin.y / cs),\n      Math.floor(aabbMin.z / cs)\n    );\n    const max = new THREE.Vector3(\n      Math.floor(aabbMax.x / cs),\n      Math.floor(aabbMax.y / cs),\n      Math.floor(aabbMax.z / cs)\n    );\n    for (let ix = min.x; ix <= max.x; ix++) {\n      for (let iy = min.y; iy <= max.y; iy++) {\n        for (let iz = min.z; iz <= max.z; iz++) {\n          const k = keyOf(ix, iy, iz);\n          let arr = map.get(k);\n          if (!arr) { arr = []; map.set(k, arr); }\n          arr.push(triIndex);\n        }\n      }\n    }\n  }\n  function queryAABB(aabbMin, aabbMax, out = []) {\n    const seen = new Set();\n    const cs = cellSize;\n    const min = new THREE.Vector3(\n      Math.floor(aabbMin.x / cs),\n      Math.floor(aabbMin.y / cs),\n      Math.floor(aabbMin.z / cs)\n    );\n    const max = new THREE.Vector3(\n      Math.floor(aabbMax.x / cs),\n      Math.floor(aabbMax.y / cs),\n      Math.floor(aabbMax.z / cs)\n    );\n    for (let ix = min.x; ix <= max.x; ix++) {\n      for (let iy = min.y; iy <= max.y; iy++) {\n        for (let iz = min.z; iz <= max.z; iz++) {\n          const k = `${ix}|${iy}|${iz}`;\n          const arr = map.get(k);\n          if (!arr) continue;\n          for (const idx of arr) {\n            if (!seen.has(idx)) { seen.add(idx); out.push(idx); }\n          }\n        }\n      }\n    }\n    return out;\n  }\n  return { insertTri, queryAABB, cellSize };\n}\n\n/** Closest point on triangle (Christer Ericson, Real-Time Collision Detection) */\nfunction closestPointOnTri(p, a, b, c, out, _v1, _v2, _v3, _v4) {\n  // Compute vectors\n  const ab = _v1.subVectors(b, a);\n  const ac = _v2.subVectors(c, a);\n  const ap = _v3.subVectors(p, a);\n\n  const d1 = ab.dot(ap);\n  const d2 = ac.dot(ap);\n  if (d1 <= 0 && d2 <= 0) { out.copy(a); return out; }\n\n  const bp = _v3.subVectors(p, b);\n  const d3 = ab.dot(bp);\n  const d4 = ac.dot(bp);\n  if (d3 >= 0 && d4 <= d3) { out.copy(b); return out; }\n\n  const vc = d1 * d4 - d3 * d2;\n  if (vc <= 0 && d1 >= 0 && d3 <= 0) {\n    const v = d1 / (d1 - d3);\n    out.copy(ab).multiplyScalar(v).add(a);\n    return out;\n  }\n\n  const cp = _v3.subVectors(p, c);\n  const d5 = ab.dot(cp);\n  const d6 = ac.dot(cp);\n  if (d6 >= 0 && d5 <= d6) { out.copy(c); return out; }\n\n  const vb = d5 * d2 - d1 * d6;\n  if (vb <= 0 && d2 >= 0 && d6 <= 0) {\n    const w = d2 / (d2 - d6);\n    out.copy(ac).multiplyScalar(w).add(a);\n    return out;\n  }\n\n  const va = d3 * d6 - d5 * d4;\n  if (va <= 0 && (d4 - d3) >= 0 && (d5 - d6) >= 0) {\n    const w = (d4 - d3) / ((d4 - d3) + (d5 - d6));\n    out.copy(_v4.subVectors(c, b)).multiplyScalar(w).add(b);\n    return out;\n  }\n\n  // Inside face region\n  const denom = 1.0 / (va + vb + vc);\n  const v = vb * denom, w = vc * denom;\n  out.copy(a).addScaledVector(ab, v).addScaledVector(ac, w);\n  return out;\n}\n\n/** Ray-triangle (Möller–Trumbore) — returns t or Infinity */\nfunction rayTri(rayOrig, rayDir, a, b, c, _v1, _v2, _v3, _v4, _v5) {\n  const EPS = 1e-8;\n  const edge1 = _v1.subVectors(b, a);\n  const edge2 = _v2.subVectors(c, a);\n  const pvec = _v3.crossVectors(rayDir, edge2);\n  const det = edge1.dot(pvec);\n  if (det > -EPS && det < EPS) return Infinity;          // parallel\n  const invDet = 1 / det;\n  const tvec = _v4.subVectors(rayOrig, a);\n  const u = tvec.dot(pvec) * invDet;\n  if (u < 0 || u > 1) return Infinity;\n  const qvec = _v5.crossVectors(tvec, edge1);\n  const v = rayDir.dot(qvec) * invDet;\n  if (v < 0 || u + v > 1) return Infinity;\n  const t = edge2.dot(qvec) * invDet;\n  return t > EPS ? t : Infinity;\n}\n\nfunction buildMeshCollider(root, cellSize = 4, sceneForDebug = null) {\n  // scratch vectors\n  const _v1 = new THREE.Vector3();\n  const _v2 = new THREE.Vector3();\n  const _v3 = new THREE.Vector3();\n  const _v4 = new THREE.Vector3();\n  const _v5 = new THREE.Vector3();\n  const _aabbMin = new THREE.Vector3();\n  const _aabbMax = new THREE.Vector3();\n  const _expandedAABB = new THREE.Box3();\n  const _closest = new THREE.Vector3();\n  const _triN = new THREE.Vector3();\n\n  // 1) bake world-space geometry\n  const geos = [];\n  root.updateMatrixWorld(true);\n  root.traverse(o => {\n    if (o.isMesh && o.geometry) {\n      const geo = o.geometry.clone();\n      geo.applyMatrix4(o.matrixWorld);\n      geos.push(geo);\n    }\n  });\n  const merged = BufferGeometryUtils.mergeGeometries(geos, false);\n\n  // 2) extract triangles & spatial hash\n  const pos = merged.getAttribute('position');\n  const index = merged.index\n    ? merged.index.array\n    : Array.from({ length: pos.count }, (_, i) => i);\n\n  const triCount = index.length / 3;\n  const tris = new Array(triCount);\n  const hash = makeSpatialHash(cellSize);\n\n  for (let t = 0; t < triCount; t++) {\n    const i0 = index[t * 3 + 0];\n    const i1 = index[t * 3 + 1];\n    const i2 = index[t * 3 + 2];\n    const a = new THREE.Vector3(pos.getX(i0), pos.getY(i0), pos.getZ(i0));\n    const b = new THREE.Vector3(pos.getX(i1), pos.getY(i1), pos.getZ(i1));\n    const c = new THREE.Vector3(pos.getX(i2), pos.getY(i2), pos.getZ(i2));\n    // precompute triangle normal for push-out\n    _triN.copy(b).sub(a).cross(_v2.copy(c).sub(a)).normalize();\n    tris[t] = { a, b, c, n: _triN.clone() };\n\n    // insert AABB into grid\n    _aabbMin.set(\n      Math.min(a.x, b.x, c.x),\n      Math.min(a.y, b.y, c.y),\n      Math.min(a.z, b.z, c.z)\n    );\n    _aabbMax.set(\n      Math.max(a.x, b.x, c.x),\n      Math.max(a.y, b.y, c.y),\n      Math.max(a.z, b.z, c.z)\n    );\n    hash.insertTri(_aabbMin, _aabbMax, t);\n  }\n\n  // 3) broad AABB\n  const worldAABB = new THREE.Box3().setFromObject(root);\n\n  // scratch arrays/boxes used by collider\n  const _candIdx = [];\n  function _segmentAABB(a, b, r, outMin, outMax) {\n    outMin.set(Math.min(a.x, b.x) - r, Math.min(a.y, b.y) - r, Math.min(a.z, b.z) - r);\n    outMax.set(Math.max(a.x, b.x) + r, Math.max(a.y, b.y) + r, Math.max(a.z, b.z) + r);\n    const box = new THREE.Box3(outMin.clone(), outMax.clone());\n    return box;\n  }\n\n  /** Query candidates near an AABB */\n  function _gatherCandidates(aabbMin, aabbMax, outIdx = []) {\n    outIdx.length = 0;\n    return hash.queryAABB(aabbMin, aabbMax, outIdx);\n  }\n\n  /** Sphere penetration test against triangles.\n   *  Returns {hit, point, normal, depth} */\n  function testSphere(center, radius) {\n    // quick reject using an expanded copy (keep worldAABB untouched)\n    _expandedAABB.copy(worldAABB).expandByScalar(radius);\n    if (!_expandedAABB.containsPoint(center)) return { hit: false };\n\n    const out = { hit: false, point: new THREE.Vector3(), normal: new THREE.Vector3(), depth: 0 };\n\n    _aabbMin.set(center.x - radius, center.y - radius, center.z - radius);\n    _aabbMax.set(center.x + radius, center.y + radius, center.z + radius);\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    let bestDepth = 0;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const cp = closestPointOnTri(center, tri.a, tri.b, tri.c, _closest, _v1, _v2, _v3, _v4);\n      const dist2 = center.distanceToSquared(cp);\n      if (dist2 <= radius * radius) {\n        const d = Math.sqrt(dist2);\n        const depth = radius - d;\n        if (depth > bestDepth) {\n          bestDepth = depth;\n          out.hit = true;\n          out.point.copy(cp);\n          out.normal.copy(tri.n); // push along triangle normal\n          out.depth = depth;\n        }\n      }\n    }\n    return out;\n  }\n\n  /** Constrain a point motion (prev → next) by sphere collision; returns slide. */\n  function constrainPoint(prev, desired, radius, maxIterations = 3) {\n    const result = { position: new THREE.Vector3().copy(desired), hit: false, iterations: 0, normal: new THREE.Vector3() };\n\n    // If the move crosses the big AABB, we bother checking; else nothing to do.\n    const segAABB = _segmentAABB(prev, desired, radius, _aabbMin, _aabbMax);\n    if (!segAABB.intersectsBox(worldAABB)) return result;\n\n    // Iterative push-out + slide\n    for (let k = 0; k < maxIterations; k++) {\n      const probe = testSphere(result.position, radius);\n      if (!probe.hit) break;\n\n      // push out\n      const push = _v1.copy(probe.normal).multiplyScalar(probe.depth + 1e-3);\n      result.position.add(push);\n      result.hit = true;\n      result.normal.copy(probe.normal);\n      result.iterations++;\n    }\n    return result;\n  }\n\n  /** Ray/segment vs mesh — returns {hit, t, point, normal} or {hit:false} */\n  function linecast(origin, dir, maxDist = Infinity) {\n    // fast coarse AABB reject\n    const rayBox = new THREE.Ray(origin, dir);\n    const tBox = rayBox.intersectBox(worldAABB, new THREE.Vector3());\n    if (tBox === null || tBox > maxDist) return { hit: false };\n\n    const end = _v1.copy(dir).multiplyScalar(maxDist).add(origin);\n    _aabbMin.set(Math.min(origin.x, end.x), Math.min(origin.y, end.y), Math.min(origin.z, end.z));\n    _aabbMax.set(Math.max(origin.x, end.x), Math.max(origin.y, end.y), Math.max(origin.z, end.z));\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    let bestT = maxDist;\n    let bestN = null;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const t = rayTri(origin, dir, tri.a, tri.b, tri.c, _v1, _v2, _v3, _v4, _v5);\n      if (t < bestT) { bestT = t; bestN = tri.n; }\n    }\n    if (bestT !== maxDist) {\n      const point = _v1.copy(dir).multiplyScalar(bestT).add(origin);\n      return { hit: true, t: bestT, point: point.clone(), normal: bestN.clone() };\n    }\n    return { hit: false };\n  }\n\n  /** Point-in-solid test (odd-even rule along +X) */\n  function isPointInside(pt) {\n    if (!worldAABB.containsPoint(pt)) return false;\n\n    // Build an AABB from the point to max.x so the hash query is small\n    _aabbMin.set(pt.x, pt.y, pt.z);\n    _aabbMax.copy(worldAABB.max);\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    const dir = _v2.set(1, 0, 0);           // +X ray\n    let crossings = 0;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const t = rayTri(pt, dir, tri.a, tri.b, tri.c, _v1, _v2, _v3, _v4, _v5);\n      if (t !== Infinity && t > 1e-5) crossings++;\n    }\n    return crossings % 2 === 1;             // odd → inside\n  }\n\n  /** Optional helper to visualize the merged collider (wireframe) */\n  function addDebugWire(material = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true, transparent: true, opacity: 0.15 })) {\n    if (!sceneForDebug) return null;\n    const m = new THREE.Mesh(merged, material);\n    sceneForDebug.add(m);\n    return m;\n  }\n\n  const collider = { testSphere, constrainPoint, linecast, isPointInside, addDebugWire, worldAABB };\n  return collider;\n}\n\n\n/**\n * initStationBoss(scene,{\n *   playerObj,            // player mesh (for flash timer / distance check)\n *   camera                // camera (for lock-ring billboarding)\n *   onDestroyed           // optional callback when HP hits 0\n *   colliderCellSize      // optional spatial hash cell size\n * })  → { update(dt,t), getMesh(), damageStation(), getActiveShips() }\n */\nexport async function initStationBoss(scene, {\n  playerObj,\n  camera,\n  onDestroyed = () => {},\n  colliderCellSize = 4,\n  anisotropyCap = 1,\n  freezeTransforms = true\n} = {}) {\n  const CULL_Z_BEHIND = 80;  // despawn once player is far ahead\n\n  /* ── load & place the model ─────────────────────────────────── */\n  const station = (await new GLTFLoader().loadAsync('./models/station.glb')).scene;\n  station.scale.setScalar(72);                    // huge!\n  station.position.set(30, -40, -4000);              // from spawns.json\n  scene.add(station);\n\n  /* ── enemy flags & HP ───────────────────────────────────────── */\n  station.visible            = true;              // always present\n  station.userData.enemy     = true;\n  station.userData.enemyRoot = true;\n  station.userData.hp        = 100;\n  station.userData.flashT    = 0;\n  station.userData.dead      = false;\n  station.userData.onDestroyed = onDestroyed;\n\n  /* clone materials so emissive flash is local to this mesh */\n  const meshList = [];\n  station.traverse(o => {\n    if (o.isMesh) {\n      o.material = toLambert(o.material);\n      capMaterialAnisotropy(o.material, anisotropyCap);\n      meshList.push(o);\n    }\n  });\n  if (freezeTransforms) {\n    freezeStaticTransforms(station);\n  }\n\n  /* ── build accurate triangle collider ───────────────────── */\n  const collider = buildMeshCollider(station, colliderCellSize, scene);\n  station.userData.collider = collider;\n\n  station.userData.meshes = meshList;\n\n  station.userData.blink = () => {\n    station.userData.flashT = 0.15;\n    meshList.forEach(m => {\n      if (m.material.emissive) m.material.emissive.setRGB(1, 0, 0);\n    });\n  };\n\n  /* ── optional lock-on ring ─────────────────────────────────── */\n  const ringGeo = new THREE.RingGeometry(1.6, 1.9, 4);\n  const ringMat = new THREE.MeshBasicMaterial({ color: 0x00ff7f, side: THREE.DoubleSide });\n  const lockRing = new THREE.Mesh(ringGeo, ringMat);\n  lockRing.visible = false;\n  lockRing.scale.setScalar(15);\n  scene.add(lockRing);\n  station.userData.lockRing = lockRing;\n\n  /* ── expose helpers ────────────────────────────────────────── */\n  function getMesh() { return station; }\n  function getActiveShips() { return station.visible ? [station] : []; }\n\n  /* damage + flash */\n  function damageStation(dmg = 1) {\n    if (station.userData.dead) return;\n    station.userData.hp = Math.max(0, station.userData.hp - dmg);\n    station.userData.blink();\n    if (station.userData.hp === 0) {\n      station.visible           = false;\n      station.userData.dead     = true;\n      station.userData.onDestroyed?.();\n    }\n  }\n\n  /* ── per-frame update (flash fade & lock-ring) ─────────────── */\n  const tmpQuat = new THREE.Quaternion();\n  const tmpPlayer = new THREE.Vector3();\n  function update(dt /*, tPlayer */) {\n    /* despawn once safely behind the player */\n    if (!station.userData.dead && playerObj) {\n      playerObj.getWorldPosition(tmpPlayer);\n      if (station.position.z > tmpPlayer.z + CULL_Z_BEHIND) {\n        station.visible        = false;\n        station.userData.dead  = true;\n        lockRing.visible       = false;\n        return;\n      }\n    }\n\n    /* fade emissive flash */\n    if (station.userData.flashT > 0) {\n      station.userData.flashT -= dt;\n      if (station.userData.flashT <= 0) {\n        meshList.forEach(m => {\n          if (m.material.emissive) m.material.emissive.setRGB(0, 0, 0);\n        });\n      }\n    }\n\n    /* billboard lock-ring */\n    if (lockRing.visible && camera) {\n      station.getWorldPosition(lockRing.position);\n      camera.getWorldQuaternion(tmpQuat);\n      lockRing.quaternion.copy(tmpQuat);\n    }\n  }\n\n  const prewarmPos = new THREE.Vector3();\n  const prewarmDir = new THREE.Vector3();\n  function prewarm(renderer, camera) {\n    if (!renderer || !camera) return;\n    const PREWARM_LAYER = 5;\n    const prevTarget = renderer.getRenderTarget();\n    const prevCameraMask = camera.layers.mask;\n    const prevVis = station.visible;\n    const prevPos = station.position.clone();\n    const prevQuat = station.quaternion.clone();\n    const prevLayers = [];\n    const prevCulls = [];\n\n    station.visible = true;\n    camera.getWorldPosition(prewarmPos);\n    camera.getWorldDirection(prewarmDir);\n    station.position.copy(prewarmPos).addScaledVector(prewarmDir, 120);\n    station.quaternion.copy(camera.quaternion);\n\n    station.traverse(o => {\n      prevLayers.push([o, o.layers.mask]);\n      o.layers.set(PREWARM_LAYER);\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    camera.layers.set(PREWARM_LAYER);\n\n    const rt = new THREE.WebGLRenderTarget(16, 16);\n    if ('outputColorSpace' in renderer && renderer.outputColorSpace) {\n      rt.texture.colorSpace = renderer.outputColorSpace;\n    }\n    renderer.setRenderTarget(rt);\n    renderer.render(scene, camera);\n    renderer.setRenderTarget(prevTarget);\n    rt.dispose();\n\n    camera.layers.mask = prevCameraMask;\n    station.visible = prevVis;\n    station.position.copy(prevPos);\n    station.quaternion.copy(prevQuat);\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    prevLayers.forEach(([o, mask]) => { o.layers.mask = mask; });\n  }\n\n  return { update, getMesh, damageStation, getActiveShips, prewarm };\n}\n","// asteroid-passage.js — static “asteroid with tunnel” + accurate mesh collisions\n// Usage:\n//   import { initAsteroidPassage } from './asteroid-passage.js';\n//   const passage = await initAsteroidPassage(scene, { position:{x:..,y:..,z:..} });\n//   // per frame (player):\n//   steerNode.position.copy(\n//     passage.collider.constrainPoint(prevPos, desiredPos, playerRadius).position\n//   );\n//   // lasers: passage.collider.linecast(origin, dir, maxDist)\n\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport * as BufferGeometryUtils from './libs/examples/jsm/utils/BufferGeometryUtils.js';\n\nconst MATERIAL_TEXTURE_KEYS = [\n  'map',\n  'aoMap',\n  'alphaMap',\n  'bumpMap',\n  'displacementMap',\n  'emissiveMap',\n  'envMap',\n  'lightMap',\n  'metalnessMap',\n  'normalMap',\n  'roughnessMap',\n  'specularMap',\n  'clearcoatMap',\n  'clearcoatRoughnessMap',\n  'sheenColorMap',\n  'sheenRoughnessMap',\n  'iridescenceMap',\n  'iridescenceThicknessMap',\n  'transmissionMap',\n  'thicknessMap'\n];\n\nfunction capMaterialAnisotropy(material, cap) {\n  if (!material || typeof cap !== 'number') return;\n  if (Array.isArray(material)) {\n    material.forEach(mat => capMaterialAnisotropy(mat, cap));\n    return;\n  }\n  for (const key of MATERIAL_TEXTURE_KEYS) {\n    const tex = material[key];\n    if (tex && tex.isTexture) {\n      tex.anisotropy = Math.min(tex.anisotropy ?? cap, cap);\n    }\n  }\n}\n\nfunction freezeStaticTransforms(root) {\n  root.updateMatrixWorld(true);\n  root.traverse(o => {\n    o.matrixAutoUpdate = false;\n  });\n}\n\n/** Build a spatial hash (uniform grid) for triangle AABBs */\nfunction makeSpatialHash(cellSize = 4) {\n  const map = new Map();\n  const keyOf = (ix, iy, iz) => `${ix}|${iy}|${iz}`;\n  function insertTri(aabbMin, aabbMax, triIndex) {\n    const cs = cellSize;\n    const min = new THREE.Vector3(\n      Math.floor(aabbMin.x / cs),\n      Math.floor(aabbMin.y / cs),\n      Math.floor(aabbMin.z / cs)\n    );\n    const max = new THREE.Vector3(\n      Math.floor(aabbMax.x / cs),\n      Math.floor(aabbMax.y / cs),\n      Math.floor(aabbMax.z / cs)\n    );\n    for (let ix = min.x; ix <= max.x; ix++) {\n      for (let iy = min.y; iy <= max.y; iy++) {\n        for (let iz = min.z; iz <= max.z; iz++) {\n          const k = keyOf(ix, iy, iz);\n          let arr = map.get(k);\n          if (!arr) { arr = []; map.set(k, arr); }\n          arr.push(triIndex);\n        }\n      }\n    }\n  }\n  function queryAABB(aabbMin, aabbMax, out = []) {\n    const seen = new Set();\n    const cs = cellSize;\n    const min = new THREE.Vector3(\n      Math.floor(aabbMin.x / cs),\n      Math.floor(aabbMin.y / cs),\n      Math.floor(aabbMin.z / cs)\n    );\n    const max = new THREE.Vector3(\n      Math.floor(aabbMax.x / cs),\n      Math.floor(aabbMax.y / cs),\n      Math.floor(aabbMax.z / cs)\n    );\n    for (let ix = min.x; ix <= max.x; ix++) {\n      for (let iy = min.y; iy <= max.y; iy++) {\n        for (let iz = min.z; iz <= max.z; iz++) {\n          const k = `${ix}|${iy}|${iz}`;\n          const arr = map.get(k);\n          if (!arr) continue;\n          for (const idx of arr) {\n            if (!seen.has(idx)) { seen.add(idx); out.push(idx); }\n          }\n        }\n      }\n    }\n    return out;\n  }\n  return { insertTri, queryAABB, cellSize };\n}\n\n/** Closest point on triangle (Christer Ericson, Real-Time Collision Detection) */\nfunction closestPointOnTri(p, a, b, c, out) {\n  // Compute vectors\n  const ab = _v1.subVectors(b, a);\n  const ac = _v2.subVectors(c, a);\n  const ap = _v3.subVectors(p, a);\n\n  const d1 = ab.dot(ap);\n  const d2 = ac.dot(ap);\n  if (d1 <= 0 && d2 <= 0) { out.copy(a); return out; }\n\n  const bp = _v3.subVectors(p, b);\n  const d3 = ab.dot(bp);\n  const d4 = ac.dot(bp);\n  if (d3 >= 0 && d4 <= d3) { out.copy(b); return out; }\n\n  const vc = d1 * d4 - d3 * d2;\n  if (vc <= 0 && d1 >= 0 && d3 <= 0) {\n    const v = d1 / (d1 - d3);\n    out.copy(ab).multiplyScalar(v).add(a);\n    return out;\n  }\n\n  const cp = _v3.subVectors(p, c);\n  const d5 = ab.dot(cp);\n  const d6 = ac.dot(cp);\n  if (d6 >= 0 && d5 <= d6) { out.copy(c); return out; }\n\n  const vb = d5 * d2 - d1 * d6;\n  if (vb <= 0 && d2 >= 0 && d6 <= 0) {\n    const w = d2 / (d2 - d6);\n    out.copy(ac).multiplyScalar(w).add(a);\n    return out;\n  }\n\n  const va = d3 * d6 - d5 * d4;\n  if (va <= 0 && (d4 - d3) >= 0 && (d5 - d6) >= 0) {\n    const w = (d4 - d3) / ((d4 - d3) + (d5 - d6));\n    out.copy(_v4.subVectors(c, b)).multiplyScalar(w).add(b);\n    return out;\n  }\n\n  // Inside face region\n  const denom = 1.0 / (va + vb + vc);\n  const v = vb * denom, w = vc * denom;\n  out.copy(a).addScaledVector(ab, v).addScaledVector(ac, w);\n  return out;\n}\n\n/** Ray-triangle (Möller–Trumbore) — returns t or Infinity */\nfunction rayTri(rayOrig, rayDir, a, b, c) {\n  const EPS = 1e-8;\n  const edge1 = _v1.subVectors(b, a);\n  const edge2 = _v2.subVectors(c, a);\n  const pvec = _v3.crossVectors(rayDir, edge2);\n  const det = edge1.dot(pvec);\n  if (det > -EPS && det < EPS) return Infinity;          // parallel\n  const invDet = 1 / det;\n  const tvec = _v4.subVectors(rayOrig, a);\n  const u = tvec.dot(pvec) * invDet;\n  if (u < 0 || u > 1) return Infinity;\n  const qvec = _v5.crossVectors(tvec, edge1);\n  const v = rayDir.dot(qvec) * invDet;\n  if (v < 0 || u + v > 1) return Infinity;\n  const t = edge2.dot(qvec) * invDet;\n  return t > EPS ? t : Infinity;\n}\n\n// scratch vectors\nconst _v1 = new THREE.Vector3();\nconst _v2 = new THREE.Vector3();\nconst _v3 = new THREE.Vector3();\nconst _v4 = new THREE.Vector3();\nconst _v5 = new THREE.Vector3();\nconst _aabbMin = new THREE.Vector3();\nconst _aabbMax = new THREE.Vector3();\nconst _expandedAABB = new THREE.Box3();\nconst _closest = new THREE.Vector3();\nconst _triN = new THREE.Vector3();\nconst _tmpSize = new THREE.Vector3();\n\nexport async function initAsteroidPassage(\n  scene,\n  {\n    path = './models/asteroid_passage.glb',\n    position = { x: 0, y: 0, z: -900 },\n    rotation = { x: 0, y: 0, z: 45 },\n    scale = 30,\n    cellSize = 'auto',        // spatial hash cell size (world units)\n    visible = true,\n    materialMode = 'default',\n    anisotropyCap = 1,\n    freezeTransforms = true\n  } = {}\n) {\n  // 1) Load GLB and bake a single world-space geometry\n  const gltf = await new GLTFLoader().loadAsync(path);\n  const root = gltf.scene;\n  root.position.set(position.x, position.y, position.z);\n  root.rotation.set(rotation.x, rotation.y, rotation.z);\n  root.scale.setScalar(scale);\n  root.visible = visible;\n  scene.add(root);\n\n  // Clone each mesh’s geometry into world space & merge\n  const geos = [];\n  root.updateMatrixWorld(true);\n  const useLambert = materialMode === 'lambert';\n  const toLambert = (material) => {\n    if (!material) return material;\n    if (Array.isArray(material)) return material.map(toLambert);\n    const lambert = new THREE.MeshLambertMaterial({\n      color: material.color ? material.color.clone() : new THREE.Color(0xffffff),\n      map: material.map ?? null,\n      emissive: material.emissive ? material.emissive.clone() : new THREE.Color(0x000000),\n      emissiveMap: material.emissiveMap ?? null,\n      emissiveIntensity: material.emissiveIntensity ?? 1,\n      transparent: material.transparent ?? false,\n      opacity: material.opacity ?? 1,\n      alphaTest: material.alphaTest ?? 0,\n      side: material.side ?? THREE.FrontSide,\n      depthWrite: material.depthWrite ?? true,\n      depthTest: material.depthTest ?? true\n    });\n    return lambert;\n  };\n  root.traverse(o => {\n    if (o.isMesh && o.geometry) {\n      if (o.visible === false) return;\n      const geo = o.geometry.clone();\n      geo.applyMatrix4(o.matrixWorld); // bake to world\n      geos.push(geo);\n      // give it its own material instance if you want flashes later\n      o.material = useLambert ? toLambert(o.material) : o.material.clone();\n      capMaterialAnisotropy(o.material, anisotropyCap);\n      // thin wireframe for debugging (toggle .visible when needed)\n      // o.material.wireframe = true;\n    }\n  });\n  if (freezeTransforms) {\n    freezeStaticTransforms(root);\n  }\n  const merged = BufferGeometryUtils.mergeGeometries(geos, false);\n\n  // 2) Extract triangle list & build spatial hash\n  const pos = merged.getAttribute('position');\n  const index = merged.index\n    ? merged.index.array\n    : Array.from({ length: pos.count }, (_, i) => i);\n\n  const triCount = index.length / 3;\n  if (cellSize === 'auto' || cellSize === null || !Number.isFinite(cellSize) || cellSize <= 0) {\n    if (!merged.boundingBox) merged.computeBoundingBox();\n    const box = merged.boundingBox;\n    box.getSize(_tmpSize);\n    const maxDim = Math.max(_tmpSize.x, _tmpSize.y, _tmpSize.z);\n    const minDim = Math.min(_tmpSize.x, _tmpSize.y, _tmpSize.z);\n    const midDim = _tmpSize.x + _tmpSize.y + _tmpSize.z - maxDim - minDim;\n    const thickness = Math.max(minDim, maxDim * 0.15);\n    const volume = Math.max(maxDim * midDim * thickness, 1e-3);\n    const density = triCount / volume;\n    const targetTrisPerCell = 140;\n    const raw = Math.cbrt(targetTrisPerCell / Math.max(density, 1e-6));\n    cellSize = THREE.MathUtils.clamp(raw, 4, 18);\n  }\n  const tris = new Array(triCount);\n  const hash = makeSpatialHash(cellSize);\n\n  for (let t = 0; t < triCount; t++) {\n    const i0 = index[t * 3 + 0];\n    const i1 = index[t * 3 + 1];\n    const i2 = index[t * 3 + 2];\n    const a = new THREE.Vector3(pos.getX(i0), pos.getY(i0), pos.getZ(i0));\n    const b = new THREE.Vector3(pos.getX(i1), pos.getY(i1), pos.getZ(i1));\n    const c = new THREE.Vector3(pos.getX(i2), pos.getY(i2), pos.getZ(i2));\n    // precompute triangle normal for push-out\n    _triN.copy(b).sub(a).cross(_v2.copy(c).sub(a)).normalize();\n    tris[t] = { a, b, c, n: _triN.clone() };\n\n    // insert AABB into grid\n    _aabbMin.set(\n      Math.min(a.x, b.x, c.x),\n      Math.min(a.y, b.y, c.y),\n      Math.min(a.z, b.z, c.z)\n    );\n    _aabbMax.set(\n      Math.max(a.x, b.x, c.x),\n      Math.max(a.y, b.y, c.y),\n      Math.max(a.z, b.z, c.z)\n    );\n    hash.insertTri(_aabbMin, _aabbMax, t);\n  }\n\n  // 3) Build a broad AABB for the whole set piece (quick reject)\n  const worldAABB = new THREE.Box3().setFromObject(root);\n\n  // 4) Precise queries -------------------------------------------------\n\n  /** Query candidates near an AABB */\n  function _gatherCandidates(aabbMin, aabbMax, outIdx = []) {\n    outIdx.length = 0;\n    return hash.queryAABB(aabbMin, aabbMax, outIdx);\n  }\n\n  /** Sphere penetration test against triangles.\n   *  Returns {hit, point, normal, depth} */\n  function testSphere(center, radius) {\n    // quick reject using an expanded copy (keep worldAABB untouched)\n    _expandedAABB.copy(worldAABB).expandByScalar(radius);\n    if (!_expandedAABB.containsPoint(center)) return { hit: false };\n\n    const out = { hit: false, point: new THREE.Vector3(), normal: new THREE.Vector3(), depth: 0 };\n\n    _aabbMin.set(center.x - radius, center.y - radius, center.z - radius);\n    _aabbMax.set(center.x + radius, center.y + radius, center.z + radius);\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    let bestDepth = 0;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const cp = closestPointOnTri(center, tri.a, tri.b, tri.c, _closest);\n      const dist2 = center.distanceToSquared(cp);\n      if (dist2 <= radius * radius) {\n        const d = Math.sqrt(dist2);\n        const depth = radius - d;\n        if (depth > bestDepth) {\n          bestDepth = depth;\n          out.hit = true;\n          out.point.copy(cp);\n          out.normal.copy(tri.n); // push along triangle normal\n          out.depth = depth;\n        }\n      }\n    }\n    return out;\n  }\n\n  /** Constrain a point motion (prev → next) by sphere collision; returns slide.\n   *  Good for clamping player steering against the tunnel walls. */\n  function constrainPoint(prev, desired, radius, maxIterations = 3) {\n    const result = { position: new THREE.Vector3().copy(desired), hit: false, iterations: 0, normal: new THREE.Vector3() };\n\n    // If the move crosses the big AABB, we bother checking; else nothing to do.\n    const segAABB = _segmentAABB(prev, desired, radius, _aabbMin, _aabbMax);\n    if (!segAABB.intersectsBox(worldAABB)) return result;\n\n    // Iterative push-out + slide\n    for (let k = 0; k < maxIterations; k++) {\n      const probe = testSphere(result.position, radius);\n      if (!probe.hit) break;\n\n      // push out\n      const push = _v1.copy(probe.normal).multiplyScalar(probe.depth + 1e-3);\n      result.position.add(push);\n      result.hit = true;\n      result.normal.copy(probe.normal);\n      result.iterations++;\n      // optional: project remaining motion onto tangent plane (simple slide)\n    }\n    return result;\n  }\n\n  /** Ray/segment vs mesh — returns {hit, t, point, normal} or {hit:false} */\n  function linecast(origin, dir, maxDist = Infinity) {\n    // fast coarse AABB reject\n    const rayBox = new THREE.Ray(origin, dir);\n    const tBox = rayBox.intersectBox(worldAABB, new THREE.Vector3());\n    if (tBox === null || tBox > maxDist) return { hit: false };\n\n    const end = _v1.copy(dir).multiplyScalar(maxDist).add(origin);\n    _aabbMin.set(Math.min(origin.x, end.x), Math.min(origin.y, end.y), Math.min(origin.z, end.z));\n    _aabbMax.set(Math.max(origin.x, end.x), Math.max(origin.y, end.y), Math.max(origin.z, end.z));\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    let bestT = maxDist;\n    let bestN = null;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const t = rayTri(origin, dir, tri.a, tri.b, tri.c);\n      if (t < bestT) { bestT = t; bestN = tri.n; }\n    }\n    if (bestT !== maxDist) {\n      const point = _v1.copy(dir).multiplyScalar(bestT).add(origin);\n      return { hit: true, t: bestT, point: point.clone(), normal: bestN.clone() };\n    }\n    return { hit: false };\n  }\n\n  /** Point-in-solid test (odd-even rule along +X) */\n  function isPointInside(pt) {\n    if (!worldAABB.containsPoint(pt)) return false;\n\n    // Build an AABB from the point to max.x so the hash query is small\n    _aabbMin.set(pt.x, pt.y, pt.z);\n    _aabbMax.copy(worldAABB.max);\n    const cand = _gatherCandidates(_aabbMin, _aabbMax, _candIdx);\n\n    const dir = _v2.set(1, 0, 0);           // +X ray\n    let crossings = 0;\n    for (let i = 0; i < cand.length; i++) {\n      const tri = tris[cand[i]];\n      const t = rayTri(pt, dir, tri.a, tri.b, tri.c);\n      if (t !== Infinity && t > 1e-5) crossings++;\n    }\n    return crossings % 2 === 1;             // odd → inside\n  }\n\n  /** Optional helper to visualize the merged collider (wireframe) */\n  function addDebugWire(material = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true, transparent: true, opacity: 0.15 })) {\n    const m = new THREE.Mesh(merged, material);\n    // Keep it at world coordinates (not parented under root), purely debug:\n    scene.add(m);\n    return m;\n  }\n\n  // scratch arrays/boxes used by collider\n  const _candIdx = [];\n  function _segmentAABB(a, b, r, outMin, outMax) {\n    outMin.set(Math.min(a.x, b.x) - r, Math.min(a.y, b.y) - r, Math.min(a.z, b.z) - r);\n    outMax.set(Math.max(a.x, b.x) + r, Math.max(a.y, b.y) + r, Math.max(a.z, b.z) + r);\n    const box = new THREE.Box3(outMin.clone(), outMax.clone());\n    return box;\n  }\n\n  // Expose\n  const collider = { testSphere, constrainPoint, linecast, isPointInside, addDebugWire, worldAABB };\n  collider.mesh = root;\n  root.userData.collider = collider; // convenient handle\n\n  function prewarm(renderer, camera) {\n    const prevVis = root.visible;\n    root.visible = true;\n    const prevCulls = [];\n    root.traverse(o => {\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    renderer.render(scene, camera);\n    root.visible = prevVis;\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n  }\n\n  return {\n    getMesh: () => root,\n    collider,\n    update: () => {}, // static set piece (no per-frame work required)\n    prewarm\n  };\n}\n","import {\n\tControls,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3,\n\tPlane,\n\tRay,\n\tMathUtils\n} from '../../../build/three.module.js';\n\n/**\n * Fires when the camera has been transformed by the controls.\n *\n * @event OrbitControls#change\n * @type {Object}\n */\nconst _changeEvent = { type: 'change' };\n\n/**\n * Fires when an interaction was initiated.\n *\n * @event OrbitControls#start\n * @type {Object}\n */\nconst _startEvent = { type: 'start' };\n\n/**\n * Fires when an interaction has finished.\n *\n * @event OrbitControls#end\n * @type {Object}\n */\nconst _endEvent = { type: 'end' };\n\nconst _ray = new Ray();\nconst _plane = new Plane();\nconst _TILT_LIMIT = Math.cos( 70 * MathUtils.DEG2RAD );\n\nconst _v = new Vector3();\nconst _twoPI = 2 * Math.PI;\n\nconst _STATE = {\n\tNONE: - 1,\n\tROTATE: 0,\n\tDOLLY: 1,\n\tPAN: 2,\n\tTOUCH_ROTATE: 3,\n\tTOUCH_PAN: 4,\n\tTOUCH_DOLLY_PAN: 5,\n\tTOUCH_DOLLY_ROTATE: 6\n};\nconst _EPS = 0.000001;\n\n\n/**\n * Orbit controls allow the camera to orbit around a target.\n *\n * OrbitControls performs orbiting, dollying (zooming), and panning. Unlike {@link TrackballControls},\n * it maintains the \"up\" direction `object.up` (+Y by default).\n *\n * - Orbit: Left mouse / touch: one-finger move.\n * - Zoom: Middle mouse, or mousewheel / touch: two-finger spread or squish.\n * - Pan: Right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move.\n *\n * ```js\n * const controls = new OrbitControls( camera, renderer.domElement );\n *\n * // controls.update() must be called after any manual changes to the camera's transform\n * camera.position.set( 0, 20, 100 );\n * controls.update();\n *\n * function animate() {\n *\n * \t// required if controls.enableDamping or controls.autoRotate are set to true\n * \tcontrols.update();\n *\n * \trenderer.render( scene, camera );\n *\n * }\n * ```\n *\n * @augments Controls\n * @three_import import { OrbitControls } from 'three/addons/controls/OrbitControls.js';\n */\nclass OrbitControls extends Controls {\n\n\t/**\n\t * Constructs a new controls instance.\n\t *\n\t * @param {Object3D} object - The object that is managed by the controls.\n\t * @param {?HTMLDOMElement} domElement - The HTML element used for event listeners.\n\t */\n\tconstructor( object, domElement = null ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.state = _STATE.NONE;\n\n\t\t/**\n\t\t * The focus point of the controls, the `object` orbits around this.\n\t\t * It can be updated manually at any point to change the focus of the controls.\n\t\t *\n\t\t * @type {Vector3}\n\t\t */\n\t\tthis.target = new Vector3();\n\n\t\t/**\n\t\t * The focus point of the `minTargetRadius` and `maxTargetRadius` limits.\n\t\t * It can be updated manually at any point to change the center of interest\n\t\t * for the `target`.\n\t\t *\n\t\t * @type {Vector3}\n\t\t */\n\t\tthis.cursor = new Vector3();\n\n\t\t/**\n\t\t * How far you can dolly in (perspective camera only).\n\t\t *\n\t\t * @type {number}\n\t\t * @default 0\n\t\t */\n\t\tthis.minDistance = 0;\n\n\t\t/**\n\t\t * How far you can dolly out (perspective camera only).\n\t\t *\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tthis.maxDistance = Infinity;\n\n\t\t/**\n\t\t * How far you can zoom in (orthographic camera only).\n\t\t *\n\t\t * @type {number}\n\t\t * @default 0\n\t\t */\n\t\tthis.minZoom = 0;\n\n\t\t/**\n\t\t * How far you can zoom out (orthographic camera only).\n\t\t *\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tthis.maxZoom = Infinity;\n\n\t\t/**\n\t\t * How close you can get the target to the 3D `cursor`.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 0\n\t\t */\n\t\tthis.minTargetRadius = 0;\n\n\t\t/**\n\t\t * How far you can move the target from the 3D `cursor`.\n\t\t *\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tthis.maxTargetRadius = Infinity;\n\n\t\t/**\n\t\t * How far you can orbit vertically, lower limit. Range is `[0, Math.PI]` radians.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 0\n\t\t */\n\t\tthis.minPolarAngle = 0;\n\n\t\t/**\n\t\t * How far you can orbit vertically, upper limit. Range is `[0, Math.PI]` radians.\n\t\t *\n\t\t * @type {number}\n\t\t * @default Math.PI\n\t\t */\n\t\tthis.maxPolarAngle = Math.PI;\n\n\t\t/**\n\t\t * How far you can orbit horizontally, lower limit. If set, the interval `[ min, max ]`\n\t\t * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.\n\t\t *\n\t\t * @type {number}\n\t\t * @default -Infinity\n\t\t */\n\t\tthis.minAzimuthAngle = - Infinity;\n\n\t\t/**\n\t\t * How far you can orbit horizontally, upper limit. If set, the interval `[ min, max ]`\n\t\t * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.\n\t\t *\n\t\t * @type {number}\n\t\t * @default -Infinity\n\t\t */\n\t\tthis.maxAzimuthAngle = Infinity;\n\n\t\t/**\n\t\t * Set to `true` to enable damping (inertia), which can be used to give a sense of weight\n\t\t * to the controls. Note that if this is enabled, you must call `update()` in your animation\n\t\t * loop.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.enableDamping = false;\n\n\t\t/**\n\t\t * The damping inertia used if `enableDamping` is set to `true`.\n\t\t *\n\t\t * Note that for this to work, you must call `update()` in your animation loop.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 0.05\n\t\t */\n\t\tthis.dampingFactor = 0.05;\n\n\t\t/**\n\t\t * Enable or disable zooming (dollying) of the camera.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.enableZoom = true;\n\n\t\t/**\n\t\t * Speed of zooming / dollying.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t/**\n\t\t * Enable or disable horizontal and vertical rotation of the camera.\n\t\t *\n\t\t * Note that it is possible to disable a single axis by setting the min and max of the\n\t\t * `minPolarAngle` or `minAzimuthAngle` to the same value, which will cause the vertical\n\t\t * or horizontal rotation to be fixed at that value.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.enableRotate = true;\n\n\t\t/**\n\t\t * Speed of rotation.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t/**\n\t\t * How fast to rotate the camera when the keyboard is used.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.keyRotateSpeed = 1.0;\n\n\t\t/**\n\t\t * Enable or disable camera panning.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.enablePan = true;\n\n\t\t/**\n\t\t * Speed of panning.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tthis.panSpeed = 1.0;\n\n\t\t/**\n\t\t * Defines how the camera's position is translated when panning. If `true`, the camera pans\n\t\t * in screen space. Otherwise, the camera pans in the plane orthogonal to the camera's up\n\t\t * direction.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.screenSpacePanning = true;\n\n\t\t/**\n\t\t * How fast to pan the camera when the keyboard is used in\n\t\t * pixels per keypress.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 7\n\t\t */\n\t\tthis.keyPanSpeed = 7.0;\n\n\t\t/**\n\t\t * Setting this property to `true` allows to zoom to the cursor's position.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.zoomToCursor = false;\n\n\t\t/**\n\t\t * Set to true to automatically rotate around the target\n\t\t *\n\t\t * Note that if this is enabled, you must call `update()` in your animation loop.\n\t\t * If you want the auto-rotate speed to be independent of the frame rate (the refresh\n\t\t * rate of the display), you must pass the time `deltaTime`, in seconds, to `update()`.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.autoRotate = false;\n\n\t\t/**\n\t\t * How fast to rotate around the target if `autoRotate` is `true`. The default  equates to 30 seconds\n\t\t * per orbit at 60fps.\n\t\t *\n\t\t * Note that if `autoRotate` is enabled, you must call `update()` in your animation loop.\n\t\t *\n\t\t * @type {number}\n\t\t * @default 2\n\t\t */\n\t\tthis.autoRotateSpeed = 2.0;\n\n\t\t/**\n\t\t * This object contains references to the keycodes for controlling camera panning.\n\t\t *\n\t\t * ```js\n\t\t * controls.keys = {\n\t\t * \tLEFT: 'ArrowLeft', //left arrow\n\t\t * \tUP: 'ArrowUp', // up arrow\n\t\t * \tRIGHT: 'ArrowRight', // right arrow\n\t\t * \tBOTTOM: 'ArrowDown' // down arrow\n\t\t * }\n\t\t * ```\n\t\t * @type {Object}\n\t\t */\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t/**\n\t\t * This object contains references to the mouse actions used by the controls.\n\t\t *\n\t\t * ```js\n\t\t * controls.mouseButtons = {\n\t\t * \tLEFT: THREE.MOUSE.ROTATE,\n\t\t * \tMIDDLE: THREE.MOUSE.DOLLY,\n\t\t * \tRIGHT: THREE.MOUSE.PAN\n\t\t * }\n\t\t * ```\n\t\t * @type {Object}\n\t\t */\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t/**\n\t\t * This object contains references to the touch actions used by the controls.\n\t\t *\n\t\t * ```js\n\t\t * controls.mouseButtons = {\n\t\t * \tONE: THREE.TOUCH.ROTATE,\n\t\t * \tTWO: THREE.TOUCH.DOLLY_PAN\n\t\t * }\n\t\t * ```\n\t\t * @type {Object}\n\t\t */\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t/**\n\t\t * Used internally by `saveState()` and `reset()`.\n\t\t *\n\t\t * @type {Vector3}\n\t\t */\n\t\tthis.target0 = this.target.clone();\n\n\t\t/**\n\t\t * Used internally by `saveState()` and `reset()`.\n\t\t *\n\t\t * @type {Vector3}\n\t\t */\n\t\tthis.position0 = this.object.position.clone();\n\n\t\t/**\n\t\t * Used internally by `saveState()` and `reset()`.\n\t\t *\n\t\t * @type {number}\n\t\t */\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t// internals\n\n\t\tthis._lastPosition = new Vector3();\n\t\tthis._lastQuaternion = new Quaternion();\n\t\tthis._lastTargetPosition = new Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tthis._quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\tthis._quatInverse = this._quat.clone().invert();\n\n\t\t// current position in spherical coordinates\n\t\tthis._spherical = new Spherical();\n\t\tthis._sphericalDelta = new Spherical();\n\n\t\tthis._scale = 1;\n\t\tthis._panOffset = new Vector3();\n\n\t\tthis._rotateStart = new Vector2();\n\t\tthis._rotateEnd = new Vector2();\n\t\tthis._rotateDelta = new Vector2();\n\n\t\tthis._panStart = new Vector2();\n\t\tthis._panEnd = new Vector2();\n\t\tthis._panDelta = new Vector2();\n\n\t\tthis._dollyStart = new Vector2();\n\t\tthis._dollyEnd = new Vector2();\n\t\tthis._dollyDelta = new Vector2();\n\n\t\tthis._dollyDirection = new Vector3();\n\t\tthis._mouse = new Vector2();\n\t\tthis._performCursorZoom = false;\n\n\t\tthis._pointers = [];\n\t\tthis._pointerPositions = {};\n\n\t\tthis._controlActive = false;\n\n\t\t// event listeners\n\n\t\tthis._onPointerMove = onPointerMove.bind( this );\n\t\tthis._onPointerDown = onPointerDown.bind( this );\n\t\tthis._onPointerUp = onPointerUp.bind( this );\n\t\tthis._onContextMenu = onContextMenu.bind( this );\n\t\tthis._onMouseWheel = onMouseWheel.bind( this );\n\t\tthis._onKeyDown = onKeyDown.bind( this );\n\n\t\tthis._onTouchStart = onTouchStart.bind( this );\n\t\tthis._onTouchMove = onTouchMove.bind( this );\n\n\t\tthis._onMouseDown = onMouseDown.bind( this );\n\t\tthis._onMouseMove = onMouseMove.bind( this );\n\n\t\tthis._interceptControlDown = interceptControlDown.bind( this );\n\t\tthis._interceptControlUp = interceptControlUp.bind( this );\n\n\t\t//\n\n\t\tif ( this.domElement !== null ) {\n\n\t\t\tthis.connect( this.domElement );\n\n\t\t}\n\n\t\tthis.update();\n\n\t}\n\n\tconnect( element ) {\n\n\t\tsuper.connect( element );\n\n\t\tthis.domElement.addEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.addEventListener( 'pointercancel', this._onPointerUp );\n\n\t\tthis.domElement.addEventListener( 'contextmenu', this._onContextMenu );\n\t\tthis.domElement.addEventListener( 'wheel', this._onMouseWheel, { passive: false } );\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\t\tdocument.addEventListener( 'keydown', this._interceptControlDown, { passive: true, capture: true } );\n\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t}\n\n\tdisconnect() {\n\n\t\tthis.domElement.removeEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\t\tthis.domElement.removeEventListener( 'pointercancel', this._onPointerUp );\n\n\t\tthis.domElement.removeEventListener( 'wheel', this._onMouseWheel );\n\t\tthis.domElement.removeEventListener( 'contextmenu', this._onContextMenu );\n\n\t\tthis.stopListenToKeyEvents();\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\t\tdocument.removeEventListener( 'keydown', this._interceptControlDown, { capture: true } );\n\n\t\tthis.domElement.style.touchAction = 'auto';\n\n\t}\n\n\tdispose() {\n\n\t\tthis.disconnect();\n\n\t}\n\n\t/**\n\t * Get the current vertical rotation, in radians.\n\t *\n\t * @return {number} The current vertical rotation, in radians.\n\t */\n\tgetPolarAngle() {\n\n\t\treturn this._spherical.phi;\n\n\t}\n\n\t/**\n\t * Get the current horizontal rotation, in radians.\n\t *\n\t * @return {number} The current horizontal rotation, in radians.\n\t */\n\tgetAzimuthalAngle() {\n\n\t\treturn this._spherical.theta;\n\n\t}\n\n\t/**\n\t * Returns the distance from the camera to the target.\n\t *\n\t * @return {number} The distance from the camera to the target.\n\t */\n\tgetDistance() {\n\n\t\treturn this.object.position.distanceTo( this.target );\n\n\t}\n\n\t/**\n\t * Adds key event listeners to the given DOM element.\n\t * `window` is a recommended argument for using this method.\n\t *\n\t * @param {HTMLDOMElement} domElement - The DOM element\n\t */\n\tlistenToKeyEvents( domElement ) {\n\n\t\tdomElement.addEventListener( 'keydown', this._onKeyDown );\n\t\tthis._domElementKeyEvents = domElement;\n\n\t}\n\n\t/**\n\t * Removes the key event listener previously defined with `listenToKeyEvents()`.\n\t */\n\tstopListenToKeyEvents() {\n\n\t\tif ( this._domElementKeyEvents !== null ) {\n\n\t\t\tthis._domElementKeyEvents.removeEventListener( 'keydown', this._onKeyDown );\n\t\t\tthis._domElementKeyEvents = null;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Save the current state of the controls. This can later be recovered with `reset()`.\n\t */\n\tsaveState() {\n\n\t\tthis.target0.copy( this.target );\n\t\tthis.position0.copy( this.object.position );\n\t\tthis.zoom0 = this.object.zoom;\n\n\t}\n\n\t/**\n\t * Reset the controls to their state from either the last time the `saveState()`\n\t * was called, or the initial state.\n\t */\n\treset() {\n\n\t\tthis.target.copy( this.target0 );\n\t\tthis.object.position.copy( this.position0 );\n\t\tthis.object.zoom = this.zoom0;\n\n\t\tthis.object.updateProjectionMatrix();\n\t\tthis.dispatchEvent( _changeEvent );\n\n\t\tthis.update();\n\n\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tupdate( deltaTime = null ) {\n\n\t\tconst position = this.object.position;\n\n\t\t_v.copy( position ).sub( this.target );\n\n\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t_v.applyQuaternion( this._quat );\n\n\t\t// angle from z-axis around y-axis\n\t\tthis._spherical.setFromVector3( _v );\n\n\t\tif ( this.autoRotate && this.state === _STATE.NONE ) {\n\n\t\t\tthis._rotateLeft( this._getAutoRotationAngle( deltaTime ) );\n\n\t\t}\n\n\t\tif ( this.enableDamping ) {\n\n\t\t\tthis._spherical.theta += this._sphericalDelta.theta * this.dampingFactor;\n\t\t\tthis._spherical.phi += this._sphericalDelta.phi * this.dampingFactor;\n\n\t\t} else {\n\n\t\t\tthis._spherical.theta += this._sphericalDelta.theta;\n\t\t\tthis._spherical.phi += this._sphericalDelta.phi;\n\n\t\t}\n\n\t\t// restrict theta to be between desired limits\n\n\t\tlet min = this.minAzimuthAngle;\n\t\tlet max = this.maxAzimuthAngle;\n\n\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\tif ( min < - Math.PI ) min += _twoPI; else if ( min > Math.PI ) min -= _twoPI;\n\n\t\t\tif ( max < - Math.PI ) max += _twoPI; else if ( max > Math.PI ) max -= _twoPI;\n\n\t\t\tif ( min <= max ) {\n\n\t\t\t\tthis._spherical.theta = Math.max( min, Math.min( max, this._spherical.theta ) );\n\n\t\t\t} else {\n\n\t\t\t\tthis._spherical.theta = ( this._spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\tMath.max( min, this._spherical.theta ) :\n\t\t\t\t\tMath.min( max, this._spherical.theta );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// restrict phi to be between desired limits\n\t\tthis._spherical.phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, this._spherical.phi ) );\n\n\t\tthis._spherical.makeSafe();\n\n\n\t\t// move target to panned location\n\n\t\tif ( this.enableDamping === true ) {\n\n\t\t\tthis.target.addScaledVector( this._panOffset, this.dampingFactor );\n\n\t\t} else {\n\n\t\t\tthis.target.add( this._panOffset );\n\n\t\t}\n\n\t\t// Limit the target distance from the cursor to create a sphere around the center of interest\n\t\tthis.target.sub( this.cursor );\n\t\tthis.target.clampLength( this.minTargetRadius, this.maxTargetRadius );\n\t\tthis.target.add( this.cursor );\n\n\t\tlet zoomChanged = false;\n\t\t// adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera\n\t\t// we adjust zoom later in these cases\n\t\tif ( this.zoomToCursor && this._performCursorZoom || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._spherical.radius = this._clampDistance( this._spherical.radius );\n\n\t\t} else {\n\n\t\t\tconst prevRadius = this._spherical.radius;\n\t\t\tthis._spherical.radius = this._clampDistance( this._spherical.radius * this._scale );\n\t\t\tzoomChanged = prevRadius != this._spherical.radius;\n\n\t\t}\n\n\t\t_v.setFromSpherical( this._spherical );\n\n\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t_v.applyQuaternion( this._quatInverse );\n\n\t\tposition.copy( this.target ).add( _v );\n\n\t\tthis.object.lookAt( this.target );\n\n\t\tif ( this.enableDamping === true ) {\n\n\t\t\tthis._sphericalDelta.theta *= ( 1 - this.dampingFactor );\n\t\t\tthis._sphericalDelta.phi *= ( 1 - this.dampingFactor );\n\n\t\t\tthis._panOffset.multiplyScalar( 1 - this.dampingFactor );\n\n\t\t} else {\n\n\t\t\tthis._sphericalDelta.set( 0, 0, 0 );\n\n\t\t\tthis._panOffset.set( 0, 0, 0 );\n\n\t\t}\n\n\t\t// adjust camera position\n\t\tif ( this.zoomToCursor && this._performCursorZoom ) {\n\n\t\t\tlet newRadius = null;\n\t\t\tif ( this.object.isPerspectiveCamera ) {\n\n\t\t\t\t// move the camera down the pointer ray\n\t\t\t\t// this method avoids floating point error\n\t\t\t\tconst prevRadius = _v.length();\n\t\t\t\tnewRadius = this._clampDistance( prevRadius * this._scale );\n\n\t\t\t\tconst radiusDelta = prevRadius - newRadius;\n\t\t\t\tthis.object.position.addScaledVector( this._dollyDirection, radiusDelta );\n\t\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\t\tzoomChanged = !! radiusDelta;\n\n\t\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\t\t// adjust the ortho camera position based on zoom changes\n\t\t\t\tconst mouseBefore = new Vector3( this._mouse.x, this._mouse.y, 0 );\n\t\t\t\tmouseBefore.unproject( this.object );\n\n\t\t\t\tconst prevZoom = this.object.zoom;\n\t\t\t\tthis.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );\n\t\t\t\tthis.object.updateProjectionMatrix();\n\n\t\t\t\tzoomChanged = prevZoom !== this.object.zoom;\n\n\t\t\t\tconst mouseAfter = new Vector3( this._mouse.x, this._mouse.y, 0 );\n\t\t\t\tmouseAfter.unproject( this.object );\n\n\t\t\t\tthis.object.position.sub( mouseAfter ).add( mouseBefore );\n\t\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\t\tnewRadius = _v.length();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.' );\n\t\t\t\tthis.zoomToCursor = false;\n\n\t\t\t}\n\n\t\t\t// handle the placement of the target\n\t\t\tif ( newRadius !== null ) {\n\n\t\t\t\tif ( this.screenSpacePanning ) {\n\n\t\t\t\t\t// position the orbit target in front of the new camera position\n\t\t\t\t\tthis.target.set( 0, 0, - 1 )\n\t\t\t\t\t\t.transformDirection( this.object.matrix )\n\t\t\t\t\t\t.multiplyScalar( newRadius )\n\t\t\t\t\t\t.add( this.object.position );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// get the ray and translation plane to compute target\n\t\t\t\t\t_ray.origin.copy( this.object.position );\n\t\t\t\t\t_ray.direction.set( 0, 0, - 1 ).transformDirection( this.object.matrix );\n\n\t\t\t\t\t// if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid\n\t\t\t\t\t// extremely large values\n\t\t\t\t\tif ( Math.abs( this.object.up.dot( _ray.direction ) ) < _TILT_LIMIT ) {\n\n\t\t\t\t\t\tthis.object.lookAt( this.target );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_plane.setFromNormalAndCoplanarPoint( this.object.up, this.target );\n\t\t\t\t\t\t_ray.intersectPlane( _plane, this.target );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\tconst prevZoom = this.object.zoom;\n\t\t\tthis.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );\n\n\t\t\tif ( prevZoom !== this.object.zoom ) {\n\n\t\t\t\tthis.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis._scale = 1;\n\t\tthis._performCursorZoom = false;\n\n\t\t// update condition is:\n\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\tif ( zoomChanged ||\n\t\t\tthis._lastPosition.distanceToSquared( this.object.position ) > _EPS ||\n\t\t\t8 * ( 1 - this._lastQuaternion.dot( this.object.quaternion ) ) > _EPS ||\n\t\t\tthis._lastTargetPosition.distanceToSquared( this.target ) > _EPS ) {\n\n\t\t\tthis.dispatchEvent( _changeEvent );\n\n\t\t\tthis._lastPosition.copy( this.object.position );\n\t\t\tthis._lastQuaternion.copy( this.object.quaternion );\n\t\t\tthis._lastTargetPosition.copy( this.target );\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t_getAutoRotationAngle( deltaTime ) {\n\n\t\tif ( deltaTime !== null ) {\n\n\t\t\treturn ( _twoPI / 60 * this.autoRotateSpeed ) * deltaTime;\n\n\t\t} else {\n\n\t\t\treturn _twoPI / 60 / 60 * this.autoRotateSpeed;\n\n\t\t}\n\n\t}\n\n\t_getZoomScale( delta ) {\n\n\t\tconst normalizedDelta = Math.abs( delta * 0.01 );\n\t\treturn Math.pow( 0.95, this.zoomSpeed * normalizedDelta );\n\n\t}\n\n\t_rotateLeft( angle ) {\n\n\t\tthis._sphericalDelta.theta -= angle;\n\n\t}\n\n\t_rotateUp( angle ) {\n\n\t\tthis._sphericalDelta.phi -= angle;\n\n\t}\n\n\t_panLeft( distance, objectMatrix ) {\n\n\t\t_v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t_v.multiplyScalar( - distance );\n\n\t\tthis._panOffset.add( _v );\n\n\t}\n\n\t_panUp( distance, objectMatrix ) {\n\n\t\tif ( this.screenSpacePanning === true ) {\n\n\t\t\t_v.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t} else {\n\n\t\t\t_v.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t_v.crossVectors( this.object.up, _v );\n\n\t\t}\n\n\t\t_v.multiplyScalar( distance );\n\n\t\tthis._panOffset.add( _v );\n\n\t}\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\t_pan( deltaX, deltaY ) {\n\n\t\tconst element = this.domElement;\n\n\t\tif ( this.object.isPerspectiveCamera ) {\n\n\t\t\t// perspective\n\t\t\tconst position = this.object.position;\n\t\t\t_v.copy( position ).sub( this.target );\n\t\t\tlet targetDistance = _v.length();\n\n\t\t\t// half of the fov is center to top of screen\n\t\t\ttargetDistance *= Math.tan( ( this.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\tthis._panLeft( 2 * deltaX * targetDistance / element.clientHeight, this.object.matrix );\n\t\t\tthis._panUp( 2 * deltaY * targetDistance / element.clientHeight, this.object.matrix );\n\n\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\t// orthographic\n\t\t\tthis._panLeft( deltaX * ( this.object.right - this.object.left ) / this.object.zoom / element.clientWidth, this.object.matrix );\n\t\t\tthis._panUp( deltaY * ( this.object.top - this.object.bottom ) / this.object.zoom / element.clientHeight, this.object.matrix );\n\n\t\t} else {\n\n\t\t\t// camera neither orthographic nor perspective\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\tthis.enablePan = false;\n\n\t\t}\n\n\t}\n\n\t_dollyOut( dollyScale ) {\n\n\t\tif ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._scale /= dollyScale;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tthis.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t_dollyIn( dollyScale ) {\n\n\t\tif ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._scale *= dollyScale;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tthis.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t_updateZoomParameters( x, y ) {\n\n\t\tif ( ! this.zoomToCursor ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis._performCursorZoom = true;\n\n\t\tconst rect = this.domElement.getBoundingClientRect();\n\t\tconst dx = x - rect.left;\n\t\tconst dy = y - rect.top;\n\t\tconst w = rect.width;\n\t\tconst h = rect.height;\n\n\t\tthis._mouse.x = ( dx / w ) * 2 - 1;\n\t\tthis._mouse.y = - ( dy / h ) * 2 + 1;\n\n\t\tthis._dollyDirection.set( this._mouse.x, this._mouse.y, 1 ).unproject( this.object ).sub( this.object.position ).normalize();\n\n\t}\n\n\t_clampDistance( dist ) {\n\n\t\treturn Math.max( this.minDistance, Math.min( this.maxDistance, dist ) );\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\t_handleMouseDownRotate( event ) {\n\n\t\tthis._rotateStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseDownDolly( event ) {\n\n\t\tthis._updateZoomParameters( event.clientX, event.clientX );\n\t\tthis._dollyStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseDownPan( event ) {\n\n\t\tthis._panStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseMoveRotate( event ) {\n\n\t\tthis._rotateEnd.set( event.clientX, event.clientY );\n\n\t\tthis._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );\n\n\t\tconst element = this.domElement;\n\n\t\tthis._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tthis._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );\n\n\t\tthis._rotateStart.copy( this._rotateEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseMoveDolly( event ) {\n\n\t\tthis._dollyEnd.set( event.clientX, event.clientY );\n\n\t\tthis._dollyDelta.subVectors( this._dollyEnd, this._dollyStart );\n\n\t\tif ( this._dollyDelta.y > 0 ) {\n\n\t\t\tthis._dollyOut( this._getZoomScale( this._dollyDelta.y ) );\n\n\t\t} else if ( this._dollyDelta.y < 0 ) {\n\n\t\t\tthis._dollyIn( this._getZoomScale( this._dollyDelta.y ) );\n\n\t\t}\n\n\t\tthis._dollyStart.copy( this._dollyEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseMovePan( event ) {\n\n\t\tthis._panEnd.set( event.clientX, event.clientY );\n\n\t\tthis._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );\n\n\t\tthis._pan( this._panDelta.x, this._panDelta.y );\n\n\t\tthis._panStart.copy( this._panEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseWheel( event ) {\n\n\t\tthis._updateZoomParameters( event.clientX, event.clientY );\n\n\t\tif ( event.deltaY < 0 ) {\n\n\t\t\tthis._dollyIn( this._getZoomScale( event.deltaY ) );\n\n\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\tthis._dollyOut( this._getZoomScale( event.deltaY ) );\n\n\t\t}\n\n\t\tthis.update();\n\n\t}\n\n\t_handleKeyDown( event ) {\n\n\t\tlet needsUpdate = false;\n\n\t\tswitch ( event.code ) {\n\n\t\t\tcase this.keys.UP:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tif ( this.enableRotate ) {\n\n\t\t\t\t\t\tthis._rotateUp( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( this.enablePan ) {\n\n\t\t\t\t\t\tthis._pan( 0, this.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.BOTTOM:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tif ( this.enableRotate ) {\n\n\t\t\t\t\t\tthis._rotateUp( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( this.enablePan ) {\n\n\t\t\t\t\t\tthis._pan( 0, - this.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.LEFT:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tif ( this.enableRotate ) {\n\n\t\t\t\t\t\tthis._rotateLeft( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( this.enablePan ) {\n\n\t\t\t\t\t\tthis._pan( this.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.RIGHT:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tif ( this.enableRotate ) {\n\n\t\t\t\t\t\tthis._rotateLeft( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( this.enablePan ) {\n\n\t\t\t\t\t\tthis._pan( - this.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( needsUpdate ) {\n\n\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.update();\n\n\t\t}\n\n\n\t}\n\n\t_handleTouchStartRotate( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._rotateStart.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._rotateStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\t_handleTouchStartPan( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._panStart.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._panStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\t_handleTouchStartDolly( event ) {\n\n\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\tconst dx = event.pageX - position.x;\n\t\tconst dy = event.pageY - position.y;\n\n\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tthis._dollyStart.set( 0, distance );\n\n\t}\n\n\t_handleTouchStartDollyPan( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchStartDolly( event );\n\n\t\tif ( this.enablePan ) this._handleTouchStartPan( event );\n\n\t}\n\n\t_handleTouchStartDollyRotate( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchStartDolly( event );\n\n\t\tif ( this.enableRotate ) this._handleTouchStartRotate( event );\n\n\t}\n\n\t_handleTouchMoveRotate( event ) {\n\n\t\tif ( this._pointers.length == 1 ) {\n\n\t\t\tthis._rotateEnd.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._rotateEnd.set( x, y );\n\n\t\t}\n\n\t\tthis._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );\n\n\t\tconst element = this.domElement;\n\n\t\tthis._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tthis._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );\n\n\t\tthis._rotateStart.copy( this._rotateEnd );\n\n\t}\n\n\t_handleTouchMovePan( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._panEnd.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._panEnd.set( x, y );\n\n\t\t}\n\n\t\tthis._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );\n\n\t\tthis._pan( this._panDelta.x, this._panDelta.y );\n\n\t\tthis._panStart.copy( this._panEnd );\n\n\t}\n\n\t_handleTouchMoveDolly( event ) {\n\n\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\tconst dx = event.pageX - position.x;\n\t\tconst dy = event.pageY - position.y;\n\n\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tthis._dollyEnd.set( 0, distance );\n\n\t\tthis._dollyDelta.set( 0, Math.pow( this._dollyEnd.y / this._dollyStart.y, this.zoomSpeed ) );\n\n\t\tthis._dollyOut( this._dollyDelta.y );\n\n\t\tthis._dollyStart.copy( this._dollyEnd );\n\n\t\tconst centerX = ( event.pageX + position.x ) * 0.5;\n\t\tconst centerY = ( event.pageY + position.y ) * 0.5;\n\n\t\tthis._updateZoomParameters( centerX, centerY );\n\n\t}\n\n\t_handleTouchMoveDollyPan( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchMoveDolly( event );\n\n\t\tif ( this.enablePan ) this._handleTouchMovePan( event );\n\n\t}\n\n\t_handleTouchMoveDollyRotate( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchMoveDolly( event );\n\n\t\tif ( this.enableRotate ) this._handleTouchMoveRotate( event );\n\n\t}\n\n\t// pointers\n\n\t_addPointer( event ) {\n\n\t\tthis._pointers.push( event.pointerId );\n\n\t}\n\n\t_removePointer( event ) {\n\n\t\tdelete this._pointerPositions[ event.pointerId ];\n\n\t\tfor ( let i = 0; i < this._pointers.length; i ++ ) {\n\n\t\t\tif ( this._pointers[ i ] == event.pointerId ) {\n\n\t\t\t\tthis._pointers.splice( i, 1 );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_isTrackingPointer( event ) {\n\n\t\tfor ( let i = 0; i < this._pointers.length; i ++ ) {\n\n\t\t\tif ( this._pointers[ i ] == event.pointerId ) return true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t_trackPointer( event ) {\n\n\t\tlet position = this._pointerPositions[ event.pointerId ];\n\n\t\tif ( position === undefined ) {\n\n\t\t\tposition = new Vector2();\n\t\t\tthis._pointerPositions[ event.pointerId ] = position;\n\n\t\t}\n\n\t\tposition.set( event.pageX, event.pageY );\n\n\t}\n\n\t_getSecondPointerPosition( event ) {\n\n\t\tconst pointerId = ( event.pointerId === this._pointers[ 0 ] ) ? this._pointers[ 1 ] : this._pointers[ 0 ];\n\n\t\treturn this._pointerPositions[ pointerId ];\n\n\t}\n\n\t//\n\n\t_customWheelEvent( event ) {\n\n\t\tconst mode = event.deltaMode;\n\n\t\t// minimal wheel event altered to meet delta-zoom demand\n\t\tconst newEvent = {\n\t\t\tclientX: event.clientX,\n\t\t\tclientY: event.clientY,\n\t\t\tdeltaY: event.deltaY,\n\t\t};\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 1: // LINE_MODE\n\t\t\t\tnewEvent.deltaY *= 16;\n\t\t\t\tbreak;\n\n\t\t\tcase 2: // PAGE_MODE\n\t\t\t\tnewEvent.deltaY *= 100;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t// detect if event was triggered by pinching\n\t\tif ( event.ctrlKey && ! this._controlActive ) {\n\n\t\t\tnewEvent.deltaY *= 10;\n\n\t\t}\n\n\t\treturn newEvent;\n\n\t}\n\n}\n\nfunction onPointerDown( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tif ( this._pointers.length === 0 ) {\n\n\t\tthis.domElement.setPointerCapture( event.pointerId );\n\n\t\tthis.domElement.addEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.addEventListener( 'pointerup', this._onPointerUp );\n\n\t}\n\n\t//\n\n\tif ( this._isTrackingPointer( event ) ) return;\n\n\t//\n\n\tthis._addPointer( event );\n\n\tif ( event.pointerType === 'touch' ) {\n\n\t\tthis._onTouchStart( event );\n\n\t} else {\n\n\t\tthis._onMouseDown( event );\n\n\t}\n\n}\n\nfunction onPointerMove( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tif ( event.pointerType === 'touch' ) {\n\n\t\tthis._onTouchMove( event );\n\n\t} else {\n\n\t\tthis._onMouseMove( event );\n\n\t}\n\n}\n\nfunction onPointerUp( event ) {\n\n\tthis._removePointer( event );\n\n\tswitch ( this._pointers.length ) {\n\n\t\tcase 0:\n\n\t\t\tthis.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\n\t\t\tthis.dispatchEvent( _endEvent );\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t\t\tbreak;\n\n\t\tcase 1:\n\n\t\t\tconst pointerId = this._pointers[ 0 ];\n\t\t\tconst position = this._pointerPositions[ pointerId ];\n\n\t\t\t// minimal placeholder event - allows state correction on pointer-up\n\t\t\tthis._onTouchStart( { pointerId: pointerId, pageX: position.x, pageY: position.y } );\n\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onMouseDown( event ) {\n\n\tlet mouseAction;\n\n\tswitch ( event.button ) {\n\n\t\tcase 0:\n\n\t\t\tmouseAction = this.mouseButtons.LEFT;\n\t\t\tbreak;\n\n\t\tcase 1:\n\n\t\t\tmouseAction = this.mouseButtons.MIDDLE;\n\t\t\tbreak;\n\n\t\tcase 2:\n\n\t\t\tmouseAction = this.mouseButtons.RIGHT;\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tmouseAction = - 1;\n\n\t}\n\n\tswitch ( mouseAction ) {\n\n\t\tcase MOUSE.DOLLY:\n\n\t\t\tif ( this.enableZoom === false ) return;\n\n\t\t\tthis._handleMouseDownDolly( event );\n\n\t\t\tthis.state = _STATE.DOLLY;\n\n\t\t\tbreak;\n\n\t\tcase MOUSE.ROTATE:\n\n\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\tthis._handleMouseDownPan( event );\n\n\t\t\t\tthis.state = _STATE.PAN;\n\n\t\t\t} else {\n\n\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\tthis._handleMouseDownRotate( event );\n\n\t\t\t\tthis.state = _STATE.ROTATE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase MOUSE.PAN:\n\n\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\tthis._handleMouseDownRotate( event );\n\n\t\t\t\tthis.state = _STATE.ROTATE;\n\n\t\t\t} else {\n\n\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\tthis._handleMouseDownPan( event );\n\n\t\t\t\tthis.state = _STATE.PAN;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tif ( this.state !== _STATE.NONE ) {\n\n\t\tthis.dispatchEvent( _startEvent );\n\n\t}\n\n}\n\nfunction onMouseMove( event ) {\n\n\tswitch ( this.state ) {\n\n\t\tcase _STATE.ROTATE:\n\n\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\tthis._handleMouseMoveRotate( event );\n\n\t\t\tbreak;\n\n\t\tcase _STATE.DOLLY:\n\n\t\t\tif ( this.enableZoom === false ) return;\n\n\t\t\tthis._handleMouseMoveDolly( event );\n\n\t\t\tbreak;\n\n\t\tcase _STATE.PAN:\n\n\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\tthis._handleMouseMovePan( event );\n\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onMouseWheel( event ) {\n\n\tif ( this.enabled === false || this.enableZoom === false || this.state !== _STATE.NONE ) return;\n\n\tevent.preventDefault();\n\n\tthis.dispatchEvent( _startEvent );\n\n\tthis._handleMouseWheel( this._customWheelEvent( event ) );\n\n\tthis.dispatchEvent( _endEvent );\n\n}\n\nfunction onKeyDown( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tthis._handleKeyDown( event );\n\n}\n\nfunction onTouchStart( event ) {\n\n\tthis._trackPointer( event );\n\n\tswitch ( this._pointers.length ) {\n\n\t\tcase 1:\n\n\t\t\tswitch ( this.touches.ONE ) {\n\n\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartRotate( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_ROTATE;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartPan( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_PAN;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tthis.state = _STATE.NONE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase 2:\n\n\t\t\tswitch ( this.touches.TWO ) {\n\n\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\tif ( this.enableZoom === false && this.enablePan === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartDollyPan( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\tif ( this.enableZoom === false && this.enableRotate === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartDollyRotate( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tthis.state = _STATE.NONE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tif ( this.state !== _STATE.NONE ) {\n\n\t\tthis.dispatchEvent( _startEvent );\n\n\t}\n\n}\n\nfunction onTouchMove( event ) {\n\n\tthis._trackPointer( event );\n\n\tswitch ( this.state ) {\n\n\t\tcase _STATE.TOUCH_ROTATE:\n\n\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\tthis._handleTouchMoveRotate( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_PAN:\n\n\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\tthis._handleTouchMovePan( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_DOLLY_PAN:\n\n\t\t\tif ( this.enableZoom === false && this.enablePan === false ) return;\n\n\t\t\tthis._handleTouchMoveDollyPan( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\tif ( this.enableZoom === false && this.enableRotate === false ) return;\n\n\t\t\tthis._handleTouchMoveDollyRotate( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n}\n\nfunction onContextMenu( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tevent.preventDefault();\n\n}\n\nfunction interceptControlDown( event ) {\n\n\tif ( event.key === 'Control' ) {\n\n\t\tthis._controlActive = true;\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\n\t\tdocument.addEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );\n\n\t}\n\n}\n\nfunction interceptControlUp( event ) {\n\n\tif ( event.key === 'Control' ) {\n\n\t\tthis._controlActive = false;\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\n\t\tdocument.removeEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );\n\n\t}\n\n}\n\nexport { OrbitControls };\n","import {\n\tBoxGeometry,\n\tBufferGeometry,\n\tControls,\n\tCylinderGeometry,\n\tDoubleSide,\n\tEuler,\n\tFloat32BufferAttribute,\n\tLine,\n\tLineBasicMaterial,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tObject3D,\n\tOctahedronGeometry,\n\tPlaneGeometry,\n\tQuaternion,\n\tRaycaster,\n\tSphereGeometry,\n\tTorusGeometry,\n\tVector3\n} from '../../../build/three.module.js';\n\nconst _raycaster = new Raycaster();\n\nconst _tempVector = new Vector3();\nconst _tempVector2 = new Vector3();\nconst _tempQuaternion = new Quaternion();\nconst _unit = {\n\tX: new Vector3( 1, 0, 0 ),\n\tY: new Vector3( 0, 1, 0 ),\n\tZ: new Vector3( 0, 0, 1 )\n};\n\n/**\n * Fires if any type of change (object or property change) is performed. Property changes\n * are separate events you can add event listeners to. The event type is \"propertyname-changed\".\n *\n * @event TransformControls#change\n * @type {Object}\n */\nconst _changeEvent = { type: 'change' };\n\n/**\n * Fires if a pointer (mouse/touch) becomes active.\n *\n * @event TransformControls#mouseDown\n * @type {Object}\n */\nconst _mouseDownEvent = { type: 'mouseDown', mode: null };\n\n/**\n * Fires if a pointer (mouse/touch) is no longer active.\n *\n * @event TransformControls#mouseUp\n * @type {Object}\n */\nconst _mouseUpEvent = { type: 'mouseUp', mode: null };\n\n/**\n * Fires if the controlled 3D object is changed.\n *\n * @event TransformControls#objectChange\n * @type {Object}\n */\nconst _objectChangeEvent = { type: 'objectChange' };\n\n/**\n * This class can be used to transform objects in 3D space by adapting a similar interaction model\n * of DCC tools like Blender. Unlike other controls, it is not intended to transform the scene's camera.\n *\n * `TransformControls` expects that its attached 3D object is part of the scene graph.\n *\n * @augments Controls\n * @three_import import { TransformControls } from 'three/addons/controls/TransformControls.js';\n */\nclass TransformControls extends Controls {\n\n\t/**\n\t * Constructs a new controls instance.\n\t *\n\t * @param {Camera} camera - The camera of the rendered scene.\n\t * @param {?HTMLDOMElement} domElement - The HTML element used for event listeners.\n\t */\n\tconstructor( camera, domElement = null ) {\n\n\t\tsuper( undefined, domElement );\n\n\t\tconst root = new TransformControlsRoot( this );\n\t\tthis._root = root;\n\n\t\tconst gizmo = new TransformControlsGizmo();\n\t\tthis._gizmo = gizmo;\n\t\troot.add( gizmo );\n\n\t\tconst plane = new TransformControlsPlane();\n\t\tthis._plane = plane;\n\t\troot.add( plane );\n\n\t\tconst scope = this;\n\n\t\t// Defined getter, setter and store for a property\n\t\tfunction defineProperty( propName, defaultValue ) {\n\n\t\t\tlet propValue = defaultValue;\n\n\t\t\tObject.defineProperty( scope, propName, {\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn propValue !== undefined ? propValue : defaultValue;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tif ( propValue !== value ) {\n\n\t\t\t\t\t\tpropValue = value;\n\t\t\t\t\t\tplane[ propName ] = value;\n\t\t\t\t\t\tgizmo[ propName ] = value;\n\n\t\t\t\t\t\tscope.dispatchEvent( { type: propName + '-changed', value: value } );\n\t\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tscope[ propName ] = defaultValue;\n\t\t\tplane[ propName ] = defaultValue;\n\t\t\tgizmo[ propName ] = defaultValue;\n\n\t\t}\n\n\t\t// Define properties with getters/setter\n\t\t// Setting the defined property will automatically trigger change event\n\t\t// Defined properties are passed down to gizmo and plane\n\n\t\t/**\n\t\t * The camera of the rendered scene.\n\t\t *\n\t\t * @name TransformControls#camera\n\t\t * @type {Camera}\n\t\t */\n\t\tdefineProperty( 'camera', camera );\n\t\tdefineProperty( 'object', undefined );\n\t\tdefineProperty( 'enabled', true );\n\n\t\t/**\n\t\t * The current transformation axis.\n\t\t *\n\t\t * @name TransformControls#axis\n\t\t * @type {string}\n\t\t */\n\t\tdefineProperty( 'axis', null );\n\n\t\t/**\n\t\t * The current transformation axis.\n\t\t *\n\t\t * @name TransformControls#mode\n\t\t * @type {('translate'|'rotate'|'scale')}\n\t\t * @default 'translate'\n\t\t */\n\t\tdefineProperty( 'mode', 'translate' );\n\n\t\t/**\n\t\t * By default, 3D objects are continuously translated. If you set this property to a numeric\n\t\t * value (world units), you can define in which steps the 3D object should be translated.\n\t\t *\n\t\t * @name TransformControls#translationSnap\n\t\t * @type {?number}\n\t\t * @default null\n\t\t */\n\t\tdefineProperty( 'translationSnap', null );\n\n\t\t/**\n\t\t * By default, 3D objects are continuously rotated. If you set this property to a numeric\n\t\t * value (radians), you can define in which steps the 3D object should be rotated.\n\t\t *\n\t\t * @name TransformControls#rotationSnap\n\t\t * @type {?number}\n\t\t * @default null\n\t\t */\n\t\tdefineProperty( 'rotationSnap', null );\n\n\t\t/**\n\t\t * By default, 3D objects are continuously scaled. If you set this property to a numeric\n\t\t * value, you can define in which steps the 3D object should be scaled.\n\t\t *\n\t\t * @name TransformControls#scaleSnap\n\t\t * @type {?number}\n\t\t * @default null\n\t\t */\n\t\tdefineProperty( 'scaleSnap', null );\n\n\t\t/**\n\t\t * Defines in which coordinate space transformations should be performed.\n\t\t *\n\t\t * @name TransformControls#space\n\t\t * @type {('world'|'local')}\n\t\t * @default 'world'\n\t\t */\n\t\tdefineProperty( 'space', 'world' );\n\n\t\t/**\n\t\t * The size of the helper UI (axes/planes).\n\t\t *\n\t\t * @name TransformControls#size\n\t\t * @type {number}\n\t\t * @default 1\n\t\t */\n\t\tdefineProperty( 'size', 1 );\n\n\t\t/**\n\t\t * Whether dragging is currently performed or not.\n\t\t *\n\t\t * @name TransformControls#dragging\n\t\t * @type {boolean}\n\t\t * @readonly\n\t\t * @default false\n\t\t */\n\t\tdefineProperty( 'dragging', false );\n\n\t\t/**\n\t\t * Whether the x-axis helper should be visible or not.\n\t\t *\n\t\t * @name TransformControls#showX\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tdefineProperty( 'showX', true );\n\n\t\t/**\n\t\t * Whether the y-axis helper should be visible or not.\n\t\t *\n\t\t * @name TransformControls#showY\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tdefineProperty( 'showY', true );\n\n\t\t/**\n\t\t * Whether the z-axis helper should be visible or not.\n\t\t *\n\t\t * @name TransformControls#showZ\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tdefineProperty( 'showZ', true );\n\n\t\t/**\n\t\t * The minimum allowed X position during translation.\n\t\t *\n\t\t * @name TransformControls#minX\n\t\t * @type {number}\n\t\t * @default -Infinity\n\t\t */\n\t\tdefineProperty( 'minX', - Infinity );\n\n\t\t/**\n\t\t * The maximum allowed X position during translation.\n\t\t *\n\t\t * @name TransformControls#maxX\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tdefineProperty( 'maxX', Infinity );\n\n\t\t/**\n\t\t * The minimum allowed y position during translation.\n\t\t *\n\t\t * @name TransformControls#minY\n\t\t * @type {number}\n\t\t * @default -Infinity\n\t\t */\n\t\tdefineProperty( 'minY', - Infinity );\n\n\t\t/**\n\t\t * The maximum allowed Y position during translation.\n\t\t *\n\t\t * @name TransformControls#maxY\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tdefineProperty( 'maxY', Infinity );\n\n\t\t/**\n\t\t * The minimum allowed z position during translation.\n\t\t *\n\t\t * @name TransformControls#minZ\n\t\t * @type {number}\n\t\t * @default -Infinity\n\t\t */\n\t\tdefineProperty( 'minZ', - Infinity );\n\n\t\t/**\n\t\t * The maximum allowed Z position during translation.\n\t\t *\n\t\t * @name TransformControls#maxZ\n\t\t * @type {number}\n\t\t * @default Infinity\n\t\t */\n\t\tdefineProperty( 'maxZ', Infinity );\n\n\t\t// Reusable utility variables\n\n\t\tconst worldPosition = new Vector3();\n\t\tconst worldPositionStart = new Vector3();\n\t\tconst worldQuaternion = new Quaternion();\n\t\tconst worldQuaternionStart = new Quaternion();\n\t\tconst cameraPosition = new Vector3();\n\t\tconst cameraQuaternion = new Quaternion();\n\t\tconst pointStart = new Vector3();\n\t\tconst pointEnd = new Vector3();\n\t\tconst rotationAxis = new Vector3();\n\t\tconst rotationAngle = 0;\n\t\tconst eye = new Vector3();\n\n\t\t// TODO: remove properties unused in plane and gizmo\n\n\t\tdefineProperty( 'worldPosition', worldPosition );\n\t\tdefineProperty( 'worldPositionStart', worldPositionStart );\n\t\tdefineProperty( 'worldQuaternion', worldQuaternion );\n\t\tdefineProperty( 'worldQuaternionStart', worldQuaternionStart );\n\t\tdefineProperty( 'cameraPosition', cameraPosition );\n\t\tdefineProperty( 'cameraQuaternion', cameraQuaternion );\n\t\tdefineProperty( 'pointStart', pointStart );\n\t\tdefineProperty( 'pointEnd', pointEnd );\n\t\tdefineProperty( 'rotationAxis', rotationAxis );\n\t\tdefineProperty( 'rotationAngle', rotationAngle );\n\t\tdefineProperty( 'eye', eye );\n\n\t\tthis._offset = new Vector3();\n\t\tthis._startNorm = new Vector3();\n\t\tthis._endNorm = new Vector3();\n\t\tthis._cameraScale = new Vector3();\n\n\t\tthis._parentPosition = new Vector3();\n\t\tthis._parentQuaternion = new Quaternion();\n\t\tthis._parentQuaternionInv = new Quaternion();\n\t\tthis._parentScale = new Vector3();\n\n\t\tthis._worldScaleStart = new Vector3();\n\t\tthis._worldQuaternionInv = new Quaternion();\n\t\tthis._worldScale = new Vector3();\n\n\t\tthis._positionStart = new Vector3();\n\t\tthis._quaternionStart = new Quaternion();\n\t\tthis._scaleStart = new Vector3();\n\n\t\tthis._getPointer = getPointer.bind( this );\n\t\tthis._onPointerDown = onPointerDown.bind( this );\n\t\tthis._onPointerHover = onPointerHover.bind( this );\n\t\tthis._onPointerMove = onPointerMove.bind( this );\n\t\tthis._onPointerUp = onPointerUp.bind( this );\n\n\t\tif ( domElement !== null ) {\n\n\t\t\tthis.connect( domElement );\n\n\t\t}\n\n\t}\n\n\tconnect( element ) {\n\n\t\tsuper.connect( element );\n\n\t\tthis.domElement.addEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.addEventListener( 'pointermove', this._onPointerHover );\n\t\tthis.domElement.addEventListener( 'pointerup', this._onPointerUp );\n\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t}\n\n\tdisconnect() {\n\n\t\tthis.domElement.removeEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerHover );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\n\t\tthis.domElement.style.touchAction = 'auto';\n\n\t}\n\n\t/**\n\t * Returns the visual representation of the controls. Add the helper to your scene to\n\t * visually transform the attached  3D object.\n\t *\n\t * @return {TransformControlsRoot} The helper.\n\t */\n\tgetHelper() {\n\n\t\treturn this._root;\n\n\t}\n\n\tpointerHover( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true ) return;\n\n\t\tif ( pointer !== null ) _raycaster.setFromCamera( pointer, this.camera );\n\n\t\tconst intersect = intersectObjectWithRay( this._gizmo.picker[ this.mode ], _raycaster );\n\n\t\tif ( intersect ) {\n\n\t\t\tthis.axis = intersect.object.name;\n\n\t\t} else {\n\n\t\t\tthis.axis = null;\n\n\t\t}\n\n\t}\n\n\tpointerDown( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true || ( pointer != null && pointer.button !== 0 ) ) return;\n\n\t\tif ( this.axis !== null ) {\n\n\t\t\tif ( pointer !== null ) _raycaster.setFromCamera( pointer, this.camera );\n\n\t\t\tconst planeIntersect = intersectObjectWithRay( this._plane, _raycaster, true );\n\n\t\t\tif ( planeIntersect ) {\n\n\t\t\t\tthis.object.updateMatrixWorld();\n\t\t\t\tthis.object.parent.updateMatrixWorld();\n\n\t\t\t\tthis._positionStart.copy( this.object.position );\n\t\t\t\tthis._quaternionStart.copy( this.object.quaternion );\n\t\t\t\tthis._scaleStart.copy( this.object.scale );\n\n\t\t\t\tthis.object.matrixWorld.decompose( this.worldPositionStart, this.worldQuaternionStart, this._worldScaleStart );\n\n\t\t\t\tthis.pointStart.copy( planeIntersect.point ).sub( this.worldPositionStart );\n\n\t\t\t}\n\n\t\t\tthis.dragging = true;\n\t\t\t_mouseDownEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( _mouseDownEvent );\n\n\t\t}\n\n\t}\n\n\tpointerMove( pointer ) {\n\n\t\tconst axis = this.axis;\n\t\tconst mode = this.mode;\n\t\tconst object = this.object;\n\t\tlet space = this.space;\n\n\t\tif ( mode === 'scale' ) {\n\n\t\t\tspace = 'local';\n\n\t\t} else if ( axis === 'E' || axis === 'XYZE' || axis === 'XYZ' ) {\n\n\t\t\tspace = 'world';\n\n\t\t}\n\n\t\tif ( object === undefined || axis === null || this.dragging === false || ( pointer !== null && pointer.button !== - 1 ) ) return;\n\n\t\tif ( pointer !== null ) _raycaster.setFromCamera( pointer, this.camera );\n\n\t\tconst planeIntersect = intersectObjectWithRay( this._plane, _raycaster, true );\n\n\t\tif ( ! planeIntersect ) return;\n\n\t\tthis.pointEnd.copy( planeIntersect.point ).sub( this.worldPositionStart );\n\n\t\tif ( mode === 'translate' ) {\n\n\t\t\t// Apply translate\n\n\t\t\tthis._offset.copy( this.pointEnd ).sub( this.pointStart );\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\tthis._offset.applyQuaternion( this._worldQuaternionInv );\n\n\t\t\t}\n\n\t\t\tif ( axis.indexOf( 'X' ) === - 1 ) this._offset.x = 0;\n\t\t\tif ( axis.indexOf( 'Y' ) === - 1 ) this._offset.y = 0;\n\t\t\tif ( axis.indexOf( 'Z' ) === - 1 ) this._offset.z = 0;\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\tthis._offset.applyQuaternion( this._quaternionStart ).divide( this._parentScale );\n\n\t\t\t} else {\n\n\t\t\t\tthis._offset.applyQuaternion( this._parentQuaternionInv ).divide( this._parentScale );\n\n\t\t\t}\n\n\t\t\tobject.position.copy( this._offset ).add( this._positionStart );\n\n\t\t\t// Apply translation snap\n\n\t\t\tif ( this.translationSnap ) {\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\tobject.position.applyQuaternion( _tempQuaternion.copy( this._quaternionStart ).invert() );\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.position.applyQuaternion( this._quaternionStart );\n\n\t\t\t\t}\n\n\t\t\t\tif ( space === 'world' ) {\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tobject.position.x = Math.max( this.minX, Math.min( this.maxX, object.position.x ) );\n\t\t\tobject.position.y = Math.max( this.minY, Math.min( this.maxY, object.position.y ) );\n\t\t\tobject.position.z = Math.max( this.minZ, Math.min( this.maxZ, object.position.z ) );\n\n\t\t} else if ( mode === 'scale' ) {\n\n\t\t\tif ( axis.search( 'XYZ' ) !== - 1 ) {\n\n\t\t\t\tlet d = this.pointEnd.length() / this.pointStart.length();\n\n\t\t\t\tif ( this.pointEnd.dot( this.pointStart ) < 0 ) d *= - 1;\n\n\t\t\t\t_tempVector2.set( d, d, d );\n\n\t\t\t} else {\n\n\t\t\t\t_tempVector.copy( this.pointStart );\n\t\t\t\t_tempVector2.copy( this.pointEnd );\n\n\t\t\t\t_tempVector.applyQuaternion( this._worldQuaternionInv );\n\t\t\t\t_tempVector2.applyQuaternion( this._worldQuaternionInv );\n\n\t\t\t\t_tempVector2.divide( _tempVector );\n\n\t\t\t\tif ( axis.search( 'X' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.x = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.y = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.z = 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Apply scale\n\n\t\t\tobject.scale.copy( this._scaleStart ).multiply( _tempVector2 );\n\n\t\t\tif ( this.scaleSnap ) {\n\n\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.x = Math.round( object.scale.x / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.y = Math.round( object.scale.y / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.z = Math.round( object.scale.z / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( mode === 'rotate' ) {\n\n\t\t\tthis._offset.copy( this.pointEnd ).sub( this.pointStart );\n\n\t\t\tconst ROTATION_SPEED = 20 / this.worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n\t\t\tlet _inPlaneRotation = false;\n\n\t\t\tif ( axis === 'XYZE' ) {\n\n\t\t\t\tthis.rotationAxis.copy( this._offset ).cross( this.eye ).normalize();\n\t\t\t\tthis.rotationAngle = this._offset.dot( _tempVector.copy( this.rotationAxis ).cross( this.eye ) ) * ROTATION_SPEED;\n\n\t\t\t} else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n\t\t\t\tthis.rotationAxis.copy( _unit[ axis ] );\n\n\t\t\t\t_tempVector.copy( _unit[ axis ] );\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\t_tempVector.applyQuaternion( this.worldQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\t_tempVector.cross( this.eye );\n\n\t\t\t\t// When _tempVector is 0 after cross with this.eye the vectors are parallel and should use in-plane rotation logic.\n\t\t\t\tif ( _tempVector.length() === 0 ) {\n\n\t\t\t\t\t_inPlaneRotation = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis.rotationAngle = this._offset.dot( _tempVector.normalize() ) * ROTATION_SPEED;\n\n\t\t\t\t}\n\n\n\t\t\t}\n\n\t\t\tif ( axis === 'E' || _inPlaneRotation ) {\n\n\t\t\t\tthis.rotationAxis.copy( this.eye );\n\t\t\t\tthis.rotationAngle = this.pointEnd.angleTo( this.pointStart );\n\n\t\t\t\tthis._startNorm.copy( this.pointStart ).normalize();\n\t\t\t\tthis._endNorm.copy( this.pointEnd ).normalize();\n\n\t\t\t\tthis.rotationAngle *= ( this._endNorm.cross( this._startNorm ).dot( this.eye ) < 0 ? 1 : - 1 );\n\n\t\t\t}\n\n\t\t\t// Apply rotation snap\n\n\t\t\tif ( this.rotationSnap ) this.rotationAngle = Math.round( this.rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n\t\t\t// Apply rotate\n\t\t\tif ( space === 'local' && axis !== 'E' && axis !== 'XYZE' ) {\n\n\t\t\t\tobject.quaternion.copy( this._quaternionStart );\n\t\t\t\tobject.quaternion.multiply( _tempQuaternion.setFromAxisAngle( this.rotationAxis, this.rotationAngle ) ).normalize();\n\n\t\t\t} else {\n\n\t\t\t\tthis.rotationAxis.applyQuaternion( this._parentQuaternionInv );\n\t\t\t\tobject.quaternion.copy( _tempQuaternion.setFromAxisAngle( this.rotationAxis, this.rotationAngle ) );\n\t\t\t\tobject.quaternion.multiply( this._quaternionStart ).normalize();\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.dispatchEvent( _changeEvent );\n\t\tthis.dispatchEvent( _objectChangeEvent );\n\n\t}\n\n\tpointerUp( pointer ) {\n\n\t\tif ( pointer !== null && pointer.button !== 0 ) return;\n\n\t\tif ( this.dragging && ( this.axis !== null ) ) {\n\n\t\t\t_mouseUpEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( _mouseUpEvent );\n\n\t\t}\n\n\t\tthis.dragging = false;\n\t\tthis.axis = null;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.disconnect();\n\n\t\tthis._root.dispose();\n\n\t}\n\n\t/**\n\t * Sets the 3D object that should be transformed and ensures the controls UI is visible.\n\t *\n\t * @param {Object3D} object -  The 3D object that should be transformed.\n\t * @return {TransformControls} A reference to this controls.\n\t */\n\tattach( object ) {\n\n\t\tthis.object = object;\n\t\tthis._root.visible = true;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Removes the current 3D object from the controls and makes the helper UI invisible.\n\t *\n\t * @return {TransformControls} A reference to this controls.\n\t */\n\tdetach() {\n\n\t\tthis.object = undefined;\n\t\tthis.axis = null;\n\n\t\tthis._root.visible = false;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Resets the object's position, rotation and scale to when the current transform began.\n\t */\n\treset() {\n\n\t\tif ( ! this.enabled ) return;\n\n\t\tif ( this.dragging ) {\n\n\t\t\tthis.object.position.copy( this._positionStart );\n\t\t\tthis.object.quaternion.copy( this._quaternionStart );\n\t\t\tthis.object.scale.copy( this._scaleStart );\n\n\t\t\tthis.dispatchEvent( _changeEvent );\n\t\t\tthis.dispatchEvent( _objectChangeEvent );\n\n\t\t\tthis.pointStart.copy( this.pointEnd );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns the raycaster that is used for user interaction. This object is shared between all\n\t * instances of `TransformControls`.\n\t *\n\t * @returns {Raycaster} The internal raycaster.\n\t */\n\tgetRaycaster() {\n\n\t\treturn _raycaster;\n\n\t}\n\n\t/**\n\t * Returns the transformation mode.\n\t *\n\t * @returns {'translate'|'rotate'|'scale'} The transformation mode.\n\t */\n\tgetMode() {\n\n\t\treturn this.mode;\n\n\t}\n\n\t/**\n\t * Sets the given transformation mode.\n\t *\n\t * @param {'translate'|'rotate'|'scale'} mode - The transformation mode to set.\n\t */\n\tsetMode( mode ) {\n\n\t\tthis.mode = mode;\n\n\t}\n\n\t/**\n\t * Sets the translation snap.\n\t *\n\t * @param {?number} translationSnap - The translation snap to set.\n\t */\n\tsetTranslationSnap( translationSnap ) {\n\n\t\tthis.translationSnap = translationSnap;\n\n\t}\n\n\t/**\n\t * Sets the rotation snap.\n\t *\n\t * @param {?number} rotationSnap - The rotation snap to set.\n\t */\n\tsetRotationSnap( rotationSnap ) {\n\n\t\tthis.rotationSnap = rotationSnap;\n\n\t}\n\n\t/**\n\t * Sets the scale snap.\n\t *\n\t * @param {?number} scaleSnap - The scale snap to set.\n\t */\n\tsetScaleSnap( scaleSnap ) {\n\n\t\tthis.scaleSnap = scaleSnap;\n\n\t}\n\n\t/**\n\t * Sets the size of the helper UI.\n\t *\n\t * @param {number} size - The size to set.\n\t */\n\tsetSize( size ) {\n\n\t\tthis.size = size;\n\n\t}\n\n\t/**\n\t * Sets the coordinate space in which transformations are applied.\n\t *\n\t * @param {'world'|'local'} space - The space to set.\n\t */\n\tsetSpace( space ) {\n\n\t\tthis.space = space;\n\n\t}\n\n}\n\n// mouse / touch event handlers\n\nfunction getPointer( event ) {\n\n\tif ( this.domElement.ownerDocument.pointerLockElement ) {\n\n\t\treturn {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tbutton: event.button\n\t\t};\n\n\t} else {\n\n\t\tconst rect = this.domElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\tx: ( event.clientX - rect.left ) / rect.width * 2 - 1,\n\t\t\ty: - ( event.clientY - rect.top ) / rect.height * 2 + 1,\n\t\t\tbutton: event.button\n\t\t};\n\n\t}\n\n}\n\nfunction onPointerHover( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tswitch ( event.pointerType ) {\n\n\t\tcase 'mouse':\n\t\tcase 'pen':\n\t\t\tthis.pointerHover( this._getPointer( event ) );\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onPointerDown( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tif ( ! document.pointerLockElement ) {\n\n\t\tthis.domElement.setPointerCapture( event.pointerId );\n\n\t}\n\n\tthis.domElement.addEventListener( 'pointermove', this._onPointerMove );\n\n\tthis.pointerHover( this._getPointer( event ) );\n\tthis.pointerDown( this._getPointer( event ) );\n\n}\n\nfunction onPointerMove( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tthis.pointerMove( this._getPointer( event ) );\n\n}\n\nfunction onPointerUp( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tthis.domElement.releasePointerCapture( event.pointerId );\n\n\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\n\tthis.pointerUp( this._getPointer( event ) );\n\n}\n\nfunction intersectObjectWithRay( object, raycaster, includeInvisible ) {\n\n\tconst allIntersections = raycaster.intersectObject( object, true );\n\n\tfor ( let i = 0; i < allIntersections.length; i ++ ) {\n\n\t\tif ( allIntersections[ i ].object.visible || includeInvisible ) {\n\n\t\t\treturn allIntersections[ i ];\n\n\t\t}\n\n\t}\n\n\treturn false;\n\n}\n\n//\n\n// Reusable utility variables\n\nconst _tempEuler = new Euler();\nconst _alignVector = new Vector3( 0, 1, 0 );\nconst _zeroVector = new Vector3( 0, 0, 0 );\nconst _lookAtMatrix = new Matrix4();\nconst _tempQuaternion2 = new Quaternion();\nconst _identityQuaternion = new Quaternion();\nconst _dirVector = new Vector3();\nconst _tempMatrix = new Matrix4();\n\nconst _unitX = new Vector3( 1, 0, 0 );\nconst _unitY = new Vector3( 0, 1, 0 );\nconst _unitZ = new Vector3( 0, 0, 1 );\n\nconst _v1 = new Vector3();\nconst _v2 = new Vector3();\nconst _v3 = new Vector3();\n\nclass TransformControlsRoot extends Object3D {\n\n\tconstructor( controls ) {\n\n\t\tsuper();\n\n\t\tthis.isTransformControlsRoot = true;\n\n\t\tthis.controls = controls;\n\t\tthis.visible = false;\n\n\t}\n\n\t// updateMatrixWorld updates key transformation variables\n\tupdateMatrixWorld( force ) {\n\n\t\tconst controls = this.controls;\n\n\t\tif ( controls.object !== undefined ) {\n\n\t\t\tcontrols.object.updateMatrixWorld();\n\n\t\t\tif ( controls.object.parent === null ) {\n\n\t\t\t\tconsole.error( 'TransformControls: The attached 3D object must be a part of the scene graph.' );\n\n\t\t\t} else {\n\n\t\t\t\tcontrols.object.parent.matrixWorld.decompose( controls._parentPosition, controls._parentQuaternion, controls._parentScale );\n\n\t\t\t}\n\n\t\t\tcontrols.object.matrixWorld.decompose( controls.worldPosition, controls.worldQuaternion, controls._worldScale );\n\n\t\t\tcontrols._parentQuaternionInv.copy( controls._parentQuaternion ).invert();\n\t\t\tcontrols._worldQuaternionInv.copy( controls.worldQuaternion ).invert();\n\n\t\t}\n\n\t\tcontrols.camera.updateMatrixWorld();\n\t\tcontrols.camera.matrixWorld.decompose( controls.cameraPosition, controls.cameraQuaternion, controls._cameraScale );\n\n\t\tif ( controls.camera.isOrthographicCamera ) {\n\n\t\t\tcontrols.camera.getWorldDirection( controls.eye ).negate();\n\n\t\t} else {\n\n\t\t\tcontrols.eye.copy( controls.cameraPosition ).sub( controls.worldPosition ).normalize();\n\n\t\t}\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.traverse( function ( child ) {\n\n\t\t\tif ( child.geometry ) child.geometry.dispose();\n\t\t\tif ( child.material ) child.material.dispose();\n\n\t\t} );\n\n\t}\n\n}\n\nclass TransformControlsGizmo extends Object3D {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.isTransformControlsGizmo = true;\n\n\t\tthis.type = 'TransformControlsGizmo';\n\n\t\t// shared materials\n\n\t\tconst gizmoMaterial = new MeshBasicMaterial( {\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\tfog: false,\n\t\t\ttoneMapped: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tconst gizmoLineMaterial = new LineBasicMaterial( {\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\tfog: false,\n\t\t\ttoneMapped: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\t// Make unique material for each axis/color\n\n\t\tconst matInvisible = gizmoMaterial.clone();\n\t\tmatInvisible.opacity = 0.15;\n\n\t\tconst matHelper = gizmoLineMaterial.clone();\n\t\tmatHelper.opacity = 0.5;\n\n\t\tconst matRed = gizmoMaterial.clone();\n\t\tmatRed.color.setHex( 0xff0000 );\n\n\t\tconst matGreen = gizmoMaterial.clone();\n\t\tmatGreen.color.setHex( 0x00ff00 );\n\n\t\tconst matBlue = gizmoMaterial.clone();\n\t\tmatBlue.color.setHex( 0x0000ff );\n\n\t\tconst matRedTransparent = gizmoMaterial.clone();\n\t\tmatRedTransparent.color.setHex( 0xff0000 );\n\t\tmatRedTransparent.opacity = 0.5;\n\n\t\tconst matGreenTransparent = gizmoMaterial.clone();\n\t\tmatGreenTransparent.color.setHex( 0x00ff00 );\n\t\tmatGreenTransparent.opacity = 0.5;\n\n\t\tconst matBlueTransparent = gizmoMaterial.clone();\n\t\tmatBlueTransparent.color.setHex( 0x0000ff );\n\t\tmatBlueTransparent.opacity = 0.5;\n\n\t\tconst matWhiteTransparent = gizmoMaterial.clone();\n\t\tmatWhiteTransparent.opacity = 0.25;\n\n\t\tconst matYellowTransparent = gizmoMaterial.clone();\n\t\tmatYellowTransparent.color.setHex( 0xffff00 );\n\t\tmatYellowTransparent.opacity = 0.25;\n\n\t\tconst matYellow = gizmoMaterial.clone();\n\t\tmatYellow.color.setHex( 0xffff00 );\n\n\t\tconst matGray = gizmoMaterial.clone();\n\t\tmatGray.color.setHex( 0x787878 );\n\n\t\t// reusable geometry\n\n\t\tconst arrowGeometry = new CylinderGeometry( 0, 0.04, 0.1, 12 );\n\t\tarrowGeometry.translate( 0, 0.05, 0 );\n\n\t\tconst scaleHandleGeometry = new BoxGeometry( 0.08, 0.08, 0.08 );\n\t\tscaleHandleGeometry.translate( 0, 0.04, 0 );\n\n\t\tconst lineGeometry = new BufferGeometry();\n\t\tlineGeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n\t\tconst lineGeometry2 = new CylinderGeometry( 0.0075, 0.0075, 0.5, 3 );\n\t\tlineGeometry2.translate( 0, 0.25, 0 );\n\n\t\tfunction CircleGeometry( radius, arc ) {\n\n\t\t\tconst geometry = new TorusGeometry( radius, 0.0075, 3, 64, arc * Math.PI * 2 );\n\t\t\tgeometry.rotateY( Math.PI / 2 );\n\t\t\tgeometry.rotateX( Math.PI / 2 );\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\t// Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\t\tfunction TranslateHelperGeometry() {\n\n\t\t\tconst geometry = new BufferGeometry();\n\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\t// Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\t\tconst gizmoTranslate = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( arrowGeometry, matRed ), [ 0.5, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matRed ), [ - 0.5, 0, 0 ], [ 0, 0, Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matRed ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, 0.5, 0 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, - 0.5, 0 ], [ Math.PI, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matGreen ) ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, - 0.5 ], [ - Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matBlue ), null, [ Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.1, 0 ), matWhiteTransparent.clone() ), [ 0, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matBlueTransparent.clone() ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matRedTransparent.clone() ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matGreenTransparent.clone() ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst pickerTranslate = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0.3, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ - 0.3, 0, 0 ], [ 0, 0, Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0.3, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, - 0.3, 0 ], [ 0, 0, Math.PI ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, 0.3 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, - 0.3 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.2, 0 ), matInvisible ) ]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst helperTranslate = {\n\t\t\tSTART: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tEND: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tDELTA: [\n\t\t\t\t[ new Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\tconst gizmoRotate = {\n\t\t\tXYZE: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 1 ), matGray ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matRed ) ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matGreen ), null, [ 0, 0, - Math.PI / 2 ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matBlue ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tE: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.75, 1 ), matYellowTransparent ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst helperRotate = {\n\t\t\tAXIS: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\tconst pickerRotate = {\n\t\t\tXYZE: [\n\t\t\t\t[ new Mesh( new SphereGeometry( 0.25, 10, 8 ), matInvisible ) ]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, - Math.PI / 2, - Math.PI / 2 ]],\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t],\n\t\t\tE: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.75, 0.1, 2, 24 ), matInvisible ) ]\n\t\t\t]\n\t\t};\n\n\t\tconst gizmoScale = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matRed ), [ 0.5, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matRed ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matRed ), [ - 0.5, 0, 0 ], [ 0, 0, Math.PI / 2 ]],\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.5, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matGreen ) ],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matGreen ), [ 0, - 0.5, 0 ], [ 0, 0, Math.PI ]],\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matBlue ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, - 0.5 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matBlueTransparent ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matRedTransparent ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matGreenTransparent ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.1, 0.1, 0.1 ), matWhiteTransparent.clone() ) ],\n\t\t\t]\n\t\t};\n\n\t\tconst pickerScale = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0.3, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ - 0.3, 0, 0 ], [ 0, 0, Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0.3, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, - 0.3, 0 ], [ 0, 0, Math.PI ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, 0.3 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, - 0.3 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0.15, 0 ]],\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]],\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]],\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 0 ]],\n\t\t\t]\n\t\t};\n\n\t\tconst helperScale = {\n\t\t\tX: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\t// Creates an Object3D with gizmos described in custom hierarchy definition.\n\n\t\tfunction setupGizmo( gizmoMap ) {\n\n\t\t\tconst gizmo = new Object3D();\n\n\t\t\tfor ( const name in gizmoMap ) {\n\n\t\t\t\tfor ( let i = gizmoMap[ name ].length; i --; ) {\n\n\t\t\t\t\tconst object = gizmoMap[ name ][ i ][ 0 ].clone();\n\t\t\t\t\tconst position = gizmoMap[ name ][ i ][ 1 ];\n\t\t\t\t\tconst rotation = gizmoMap[ name ][ i ][ 2 ];\n\t\t\t\t\tconst scale = gizmoMap[ name ][ i ][ 3 ];\n\t\t\t\t\tconst tag = gizmoMap[ name ][ i ][ 4 ];\n\n\t\t\t\t\t// name and tag properties are essential for picking and updating logic.\n\t\t\t\t\tobject.name = name;\n\t\t\t\t\tobject.tag = tag;\n\n\t\t\t\t\tif ( position ) {\n\n\t\t\t\t\t\tobject.position.set( position[ 0 ], position[ 1 ], position[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( rotation ) {\n\n\t\t\t\t\t\tobject.rotation.set( rotation[ 0 ], rotation[ 1 ], rotation[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( scale ) {\n\n\t\t\t\t\t\tobject.scale.set( scale[ 0 ], scale[ 1 ], scale[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\tconst tempGeometry = object.geometry.clone();\n\t\t\t\t\ttempGeometry.applyMatrix4( object.matrix );\n\t\t\t\t\tobject.geometry = tempGeometry;\n\t\t\t\t\tobject.renderOrder = Infinity;\n\n\t\t\t\t\tobject.position.set( 0, 0, 0 );\n\t\t\t\t\tobject.rotation.set( 0, 0, 0 );\n\t\t\t\t\tobject.scale.set( 1, 1, 1 );\n\n\t\t\t\t\tgizmo.add( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn gizmo;\n\n\t\t}\n\n\t\t// Gizmo creation\n\n\t\tthis.gizmo = {};\n\t\tthis.picker = {};\n\t\tthis.helper = {};\n\n\t\tthis.add( this.gizmo[ 'translate' ] = setupGizmo( gizmoTranslate ) );\n\t\tthis.add( this.gizmo[ 'rotate' ] = setupGizmo( gizmoRotate ) );\n\t\tthis.add( this.gizmo[ 'scale' ] = setupGizmo( gizmoScale ) );\n\t\tthis.add( this.picker[ 'translate' ] = setupGizmo( pickerTranslate ) );\n\t\tthis.add( this.picker[ 'rotate' ] = setupGizmo( pickerRotate ) );\n\t\tthis.add( this.picker[ 'scale' ] = setupGizmo( pickerScale ) );\n\t\tthis.add( this.helper[ 'translate' ] = setupGizmo( helperTranslate ) );\n\t\tthis.add( this.helper[ 'rotate' ] = setupGizmo( helperRotate ) );\n\t\tthis.add( this.helper[ 'scale' ] = setupGizmo( helperScale ) );\n\n\t\t// Pickers should be hidden always\n\n\t\tthis.picker[ 'translate' ].visible = false;\n\t\tthis.picker[ 'rotate' ].visible = false;\n\t\tthis.picker[ 'scale' ].visible = false;\n\n\t}\n\n\t// updateMatrixWorld will update transformations and appearance of individual handles\n\n\tupdateMatrixWorld( force ) {\n\n\t\tconst space = ( this.mode === 'scale' ) ? 'local' : this.space; // scale always oriented to local rotation\n\n\t\tconst quaternion = ( space === 'local' ) ? this.worldQuaternion : _identityQuaternion;\n\n\t\t// Show only gizmos for current transform mode\n\n\t\tthis.gizmo[ 'translate' ].visible = this.mode === 'translate';\n\t\tthis.gizmo[ 'rotate' ].visible = this.mode === 'rotate';\n\t\tthis.gizmo[ 'scale' ].visible = this.mode === 'scale';\n\n\t\tthis.helper[ 'translate' ].visible = this.mode === 'translate';\n\t\tthis.helper[ 'rotate' ].visible = this.mode === 'rotate';\n\t\tthis.helper[ 'scale' ].visible = this.mode === 'scale';\n\n\n\t\tlet handles = [];\n\t\thandles = handles.concat( this.picker[ this.mode ].children );\n\t\thandles = handles.concat( this.gizmo[ this.mode ].children );\n\t\thandles = handles.concat( this.helper[ this.mode ].children );\n\n\t\tfor ( let i = 0; i < handles.length; i ++ ) {\n\n\t\t\tconst handle = handles[ i ];\n\n\t\t\t// hide aligned to camera\n\n\t\t\thandle.visible = true;\n\t\t\thandle.rotation.set( 0, 0, 0 );\n\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\tlet factor;\n\n\t\t\tif ( this.camera.isOrthographicCamera ) {\n\n\t\t\t\tfactor = ( this.camera.top - this.camera.bottom ) / this.camera.zoom;\n\n\t\t\t} else {\n\n\t\t\t\tfactor = this.worldPosition.distanceTo( this.cameraPosition ) * Math.min( 1.9 * Math.tan( Math.PI * this.camera.fov / 360 ) / this.camera.zoom, 7 );\n\n\t\t\t}\n\n\t\t\thandle.scale.set( 1, 1, 1 ).multiplyScalar( factor * this.size / 4 );\n\n\t\t\t// TODO: simplify helpers and consider decoupling from gizmo\n\n\t\t\tif ( handle.tag === 'helper' ) {\n\n\t\t\t\thandle.visible = false;\n\n\t\t\t\tif ( handle.name === 'AXIS' ) {\n\n\t\t\t\t\thandle.visible = !! this.axis;\n\n\t\t\t\t\tif ( this.axis === 'X' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, 0, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Y' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, 0, Math.PI / 2 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Z' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'XYZE' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\t_alignVector.copy( this.rotationAxis );\n\t\t\t\t\t\thandle.quaternion.setFromRotationMatrix( _lookAtMatrix.lookAt( _zeroVector, _alignVector, _unitY ) );\n\t\t\t\t\t\thandle.quaternion.multiply( _tempQuaternion );\n\t\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'E' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t} else if ( handle.name === 'START' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'END' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPosition );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'DELTA' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.quaternion.copy( this.worldQuaternionStart );\n\t\t\t\t\t_tempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( - 1 );\n\t\t\t\t\t_tempVector.applyQuaternion( this.worldQuaternionStart.clone().invert() );\n\t\t\t\t\thandle.scale.copy( _tempVector );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else {\n\n\t\t\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\t\t\tif ( this.dragging ) {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis ) {\n\n\t\t\t\t\t\thandle.visible = this.axis.search( handle.name ) !== - 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// If updating helper, skip rest of the loop\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\t// Align handles to current local or world rotation\n\n\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\tif ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n\t\t\t\t// Hide translate and scale axis facing the camera\n\n\t\t\t\tconst AXIS_HIDE_THRESHOLD = 0.99;\n\t\t\t\tconst PLANE_HIDE_THRESHOLD = 0.2;\n\n\t\t\t\tif ( handle.name === 'X' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XY' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'YZ' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XZ' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_THRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( this.mode === 'rotate' ) {\n\n\t\t\t\t// Align handles to current local or world rotation\n\n\t\t\t\t_tempQuaternion2.copy( quaternion );\n\t\t\t\t_alignVector.copy( this.eye ).applyQuaternion( _tempQuaternion.copy( quaternion ).invert() );\n\n\t\t\t\tif ( handle.name.search( 'E' ) !== - 1 ) {\n\n\t\t\t\t\thandle.quaternion.setFromRotationMatrix( _lookAtMatrix.lookAt( this.eye, _zeroVector, _unitY ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'X' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitX, Math.atan2( - _alignVector.y, _alignVector.z ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitY, Math.atan2( _alignVector.x, _alignVector.z ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitZ, Math.atan2( _alignVector.y, _alignVector.x ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Hide disabled axes\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'X' ) === - 1 || this.showX );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'Y' ) === - 1 || this.showY );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'Z' ) === - 1 || this.showZ );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'E' ) === - 1 || ( this.showX && this.showY && this.showZ ) );\n\n\t\t\t// highlight selected axis\n\n\t\t\thandle.material._color = handle.material._color || handle.material.color.clone();\n\t\t\thandle.material._opacity = handle.material._opacity || handle.material.opacity;\n\n\t\t\thandle.material.color.copy( handle.material._color );\n\t\t\thandle.material.opacity = handle.material._opacity;\n\n\t\t\tif ( this.enabled && this.axis ) {\n\n\t\t\t\tif ( handle.name === this.axis ) {\n\n\t\t\t\t\thandle.material.color.setHex( 0xffff00 );\n\t\t\t\t\thandle.material.opacity = 1.0;\n\n\t\t\t\t} else if ( this.axis.split( '' ).some( function ( a ) {\n\n\t\t\t\t\treturn handle.name === a;\n\n\t\t\t\t} ) ) {\n\n\t\t\t\t\thandle.material.color.setHex( 0xffff00 );\n\t\t\t\t\thandle.material.opacity = 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n}\n\n//\n\nclass TransformControlsPlane extends Mesh {\n\n\tconstructor() {\n\n\t\tsuper(\n\t\t\tnew PlaneGeometry( 100000, 100000, 2, 2 ),\n\t\t\tnew MeshBasicMaterial( { visible: false, wireframe: true, side: DoubleSide, transparent: true, opacity: 0.1, toneMapped: false } )\n\t\t);\n\n\t\tthis.isTransformControlsPlane = true;\n\n\t\tthis.type = 'TransformControlsPlane';\n\n\t}\n\n\tupdateMatrixWorld( force ) {\n\n\t\tlet space = this.space;\n\n\t\tthis.position.copy( this.worldPosition );\n\n\t\tif ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n\t\t_v1.copy( _unitX ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\t\t_v2.copy( _unitY ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\t\t_v3.copy( _unitZ ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\n\t\t// Align the plane for current transform mode, axis and space.\n\n\t\t_alignVector.copy( _v2 );\n\n\t\tswitch ( this.mode ) {\n\n\t\t\tcase 'translate':\n\t\t\tcase 'scale':\n\t\t\t\tswitch ( this.axis ) {\n\n\t\t\t\t\tcase 'X':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v1 );\n\t\t\t\t\t\t_dirVector.copy( _v1 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Y':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v2 );\n\t\t\t\t\t\t_dirVector.copy( _v2 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Z':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v3 );\n\t\t\t\t\t\t_dirVector.copy( _v3 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XY':\n\t\t\t\t\t\t_dirVector.copy( _v3 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'YZ':\n\t\t\t\t\t\t_dirVector.copy( _v1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XZ':\n\t\t\t\t\t\t_alignVector.copy( _v3 );\n\t\t\t\t\t\t_dirVector.copy( _v2 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XYZ':\n\t\t\t\t\tcase 'E':\n\t\t\t\t\t\t_dirVector.set( 0, 0, 0 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'rotate':\n\t\t\tdefault:\n\t\t\t\t// special case for rotate\n\t\t\t\t_dirVector.set( 0, 0, 0 );\n\n\t\t}\n\n\t\tif ( _dirVector.length() === 0 ) {\n\n\t\t\t// If in rotate mode, make the plane parallel to camera\n\t\t\tthis.quaternion.copy( this.cameraQuaternion );\n\n\t\t} else {\n\n\t\t\t_tempMatrix.lookAt( _tempVector.set( 0, 0, 0 ), _dirVector, _alignVector );\n\n\t\t\tthis.quaternion.setFromRotationMatrix( _tempMatrix );\n\n\t\t}\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n}\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };\n","/*****************************************************************\n main.js — on-rails shooter (compact modular version)\n******************************************************************/\n\nimport * as THREE from './libs/build/three.module.js';\nimport { GLTFLoader } from './libs/examples/jsm/loaders/GLTFLoader.js';\nimport { initBossAndross } from './boss-andross.js';\n\nimport { initAsteroids       } from './asteroids.js';\nimport { initPlayerShip      } from './player-ship.js';\nimport { initAllyShip        } from './ally-ship.js';\nimport { createLaserSystem   } from './laser-system.js';\nimport { addStarfield        } from './starfield.js';\nimport { addScore, loseHeart, setBurstMeter, syncHud, getScore, setBombs } from './hud.js';\nimport { createCollisionSystem } from './collision-system.js';\nimport { updateDiagnostics, renderDiagnosticsLines     } from './diagnostics.js';\nimport { initEnemySystem, CAPTURED_ENEMY_PATHS } from './enemy-system.js';\nimport { initFrigateEnemySystem } from './frigate-enemy.js';\nimport { BEHAVIOURS          } from './behaviours.js';      // NEW\nimport { initBossSystem      } from './boss-system.js';   // NEW\nimport { initPickupSystem } from './pickup-system.js';\nimport { initPlatformSystem } from './platform-system.js';\nimport { initStationTurretSystem } from './station-turret.js';\nimport { createBoltPool } from './bolt-pool.js';\nimport { initStationBoss } from './station-boss.js';\nimport { initAsteroidPassage } from './asteroid-passage.js';\nimport { createExplosionPool } from './explosion-pool.js';\nimport { OrbitControls } from './libs/examples/jsm/controls/OrbitControls.js';\nimport { TransformControls } from './libs/examples/jsm/controls/TransformControls.js';\n\n/* enable cache so preloaded GLTFs are reused */\nTHREE.Cache.enabled = true;\nconst isElectron = Boolean(typeof window !== 'undefined' && window?.process?.versions?.electron);\nconst RUNNING_IN_WORKER = (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)\n  || Boolean(globalThis.__IS_RENDER_WORKER);\nconst EDITOR_MODE = !RUNNING_IN_WORKER && typeof window !== 'undefined'\n  && (window.__EDITOR__ || new URLSearchParams(window.location.search).has('editor'));\nconst ENABLE_RENDER_WORKER = true; // flip to false to stay on main thread\nconst USE_RENDER_WORKER = !RUNNING_IN_WORKER && !isElectron && ENABLE_RENDER_WORKER && !EDITOR_MODE;\nconst ENEMY_CAPTURE_ENABLED = false; // set to false to stop path recording\nconst LEVEL_INTRO_DURATION_MS = 5000;\nconst LEVEL_INTRO_TITLE = 'Mission 1: Orbital Assault';\nconst LEVEL_INTRO_OBJECTIVE = 'Objective: Breach Oblivion Airspace';\nconst LOADING_PREVIEW_FADE_MS = 3600;\nconst LOADING_PREVIEW_HOLD_MS = 1350;\nconst LOADING_PREVIEW_TOTAL_MS = (LOADING_PREVIEW_FADE_MS * 2) + LOADING_PREVIEW_HOLD_MS;\nconst LOADING_FADE_OUT_MS = 750;\nconst LOADING_PROGRESS_DURATION_MS = 14000;\nconst DIALOGUE_POP_DELAY_MS = 5000;\nconst DIALOGUE_POP_DURATION_MS = 4200;\nconst PAUSE_KEY = 'KeyP';\nconst BOMB_KEY = 'KeyB';\nconst CHARACTER_MATERIAL_MODE = 'lambert'; // 'lambert' for A/B testing\nconst GAME_KEY_CODES = new Set([\n  'KeyA',\n  'KeyD',\n  'KeyW',\n  'KeyS',\n  'KeyQ',\n  'KeyE',\n  PAUSE_KEY,\n  BOMB_KEY,\n  'ShiftLeft',\n  'ShiftRight',\n  'KeyJ',\n  'KeyN',\n  'Space'\n]);\nlet renderWorker = null;\nlet renderWorkerLaunched = false;\nlet fallbackRun = null;\nlet laptopPreset = false;\nlet allowFpsToggle = true;\nlet drsOverrunCount = 0;\nlet drsUnderrunCount = 0;\nlet dialogueTimer = null;\nlet dialogueCleanup = null;\nconst shownDialogueIds = new Set();\nconst nowMs = () => (\n  typeof performance !== 'undefined' && typeof performance.now === 'function'\n    ? performance.now()\n    : Date.now()\n);\nconst stats = {\n  startMs: null,\n  endMs: null,\n  shotsFired: 0,\n  shotsHit: 0,\n  enemiesDestroyed: 0,\n  ringsCollected: 0\n};\nconst SHOT_HIT_BUCKETS = 4096;\nconst SHOT_HIT_MASK = SHOT_HIT_BUCKETS - 1;\nconst shotHitBuckets = new Uint32Array(SHOT_HIT_BUCKETS);\nconst recordShotFired = () => {\n  stats.shotsFired += 1;\n};\nconst recordShotHit = (shotId) => {\n  const id = shotId >>> 0;\n  if (!id) return;\n  const idx = id & SHOT_HIT_MASK;\n  if (shotHitBuckets[idx] === id) return;\n  shotHitBuckets[idx] = id;\n  stats.shotsHit += 1;\n};\nconst recordEnemyDestroyed = () => {\n  stats.enemiesDestroyed += 1;\n};\nconst recordRingCollected = (count = 1) => {\n  if (count > 0) stats.ringsCollected += count;\n};\nconst snapshotStats = (endTimeMs = null) => {\n  const endMs = Number.isFinite(endTimeMs) ? endTimeMs : nowMs();\n  const startMs = Number.isFinite(stats.startMs) ? stats.startMs : endMs;\n  return {\n    timeMs: Math.max(0, endMs - startMs),\n    shotsFired: stats.shotsFired,\n    shotsHit: stats.shotsHit,\n    enemiesDestroyed: stats.enemiesDestroyed,\n    ringsCollected: stats.ringsCollected\n  };\n};\nconst formatTime = (ms) => {\n  const totalSec = Math.max(0, Math.floor(ms / 1000));\n  const minutes = Math.floor(totalSec / 60);\n  const seconds = totalSec % 60;\n  return `${minutes}:${String(seconds).padStart(2, '0')}`;\n};\nconst buildStatsLines = (snapshot) => {\n  if (!snapshot) return [];\n  const shotsFired = snapshot.shotsFired ?? 0;\n  const shotsHit = snapshot.shotsHit ?? 0;\n  const accuracy = shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) : 0;\n  return [\n    `TIME: ${formatTime(snapshot.timeMs ?? 0)}`,\n    `ENEMIES DESTROYED: ${snapshot.enemiesDestroyed ?? 0}`,\n    `ACCURACY: ${accuracy}% (${shotsHit}/${shotsFired})`,\n    `RINGS COLLECTED: ${snapshot.ringsCollected ?? 0}`\n  ];\n};\nlet introPauseBlockUntilMs = 0;\nconst setIntroPauseBlock = (durationMs) => {\n  const duration = typeof durationMs === 'number' ? durationMs : 0;\n  introPauseBlockUntilMs = nowMs() + Math.max(0, duration);\n};\nconst isPauseBlockedForIntro = () => nowMs() < introPauseBlockUntilMs;\nconst degToRad = (v) => THREE.MathUtils.degToRad(v ?? 0);\nconst parseRotation = (cfg = {}) => {\n  const rotDeg = cfg.rotationDeg ?? cfg.rotationDegrees ?? null;\n  if (rotDeg) {\n    return {\n      x: degToRad(rotDeg.x),\n      y: degToRad(rotDeg.y),\n      z: degToRad(rotDeg.z)\n    };\n  }\n  const rot = cfg.rotation ?? null;\n  if (rot && (rot.unit === 'deg' || rot.units === 'deg' || rot.deg === true)) {\n    return {\n      x: degToRad(rot.x),\n      y: degToRad(rot.y),\n      z: degToRad(rot.z)\n    };\n  }\n  return rot ?? { x: 0, y: 0, z: 0 };\n};\nconst editorObjects = [];\nconst registerEditorObject = (root, { group, index, ref } = {}) => {\n  if (!EDITOR_MODE || !root) return;\n  root.traverse(o => {\n    o.matrixAutoUpdate = true;\n    o.matrixWorldNeedsUpdate = true;\n  });\n  root.userData.editorRef = ref ?? null;\n  root.userData.editorGroup = group ?? null;\n  root.userData.editorIndex = Number.isFinite(index) ? index : null;\n  root.userData.editorSelectable = true;\n  root.traverse(o => {\n    if (o.isMesh) o.userData.__editorRoot = root;\n  });\n  editorObjects.push(root);\n};\nfunction createPauseMenu() {\n  if (RUNNING_IN_WORKER || typeof document === 'undefined') return null;\n  const root = document.createElement('div');\n  Object.assign(root.style, {\n    position: 'fixed',\n    inset: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    background: 'rgba(0,0,0,0.6)',\n    color: '#0f0',\n    font: '14px/1.5 monospace',\n    letterSpacing: '0.05em',\n    textTransform: 'uppercase',\n    textAlign: 'center',\n    opacity: '0',\n    pointerEvents: 'none',\n    zIndex: 9999,\n    transition: 'opacity 0.2s ease'\n  });\n\n  const panel = document.createElement('div');\n  Object.assign(panel.style, {\n    padding: '14px 20px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    boxShadow: '0 0 12px rgba(0,255,0,0.15)',\n    minWidth: '260px'\n  });\n\n  const title = document.createElement('div');\n  title.textContent = 'PAUSED';\n  title.style.fontSize = '16px';\n  title.style.marginBottom = '8px';\n\n  const list = document.createElement('div');\n  Object.assign(list.style, {\n    display: 'grid',\n    rowGap: '4px'\n  });\n  [\n    'Move: W/A/S/D',\n    'Shoot: Space',\n    'Charge: Hold Space',\n    'Roll: Q/E',\n    'Bank: Hold Shift',\n    'Bomb: B',\n    'Boost: J',\n    'Brake: N',\n    'Pause/Menu: P'\n  ].forEach(text => {\n    const line = document.createElement('div');\n    line.textContent = text;\n    list.appendChild(line);\n  });\n\n  panel.appendChild(title);\n  panel.appendChild(list);\n\n  const restartWrap = document.createElement('div');\n  Object.assign(restartWrap.style, {\n    marginTop: '12px',\n    display: 'none',\n    flexDirection: 'column',\n    alignItems: 'center',\n    rowGap: '8px'\n  });\n\n  const startOverButton = document.createElement('button');\n  startOverButton.type = 'button';\n  startOverButton.textContent = 'Start Over?';\n  Object.assign(startOverButton.style, {\n    padding: '6px 14px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    color: '#0f0',\n    font: '13px monospace',\n    letterSpacing: '0.08em',\n    textTransform: 'uppercase',\n    cursor: 'pointer'\n  });\n\n  const startOverHint = document.createElement('div');\n  startOverHint.textContent = '[Enter]';\n  Object.assign(startOverHint.style, {\n    fontSize: '11px',\n    opacity: '0.7',\n    letterSpacing: '0.06em'\n  });\n\n  const confirmWrap = document.createElement('div');\n  Object.assign(confirmWrap.style, {\n    display: 'none',\n    flexDirection: 'column',\n    alignItems: 'center',\n    rowGap: '8px'\n  });\n\n  const confirmLabel = document.createElement('div');\n  confirmLabel.textContent = 'Are you sure?';\n\n  const confirmButtons = document.createElement('div');\n  Object.assign(confirmButtons.style, {\n    display: 'flex',\n    gap: '12px',\n    justifyContent: 'center'\n  });\n\n  const yesButton = document.createElement('button');\n  yesButton.type = 'button';\n  yesButton.textContent = 'Yes';\n  Object.assign(yesButton.style, {\n    padding: '5px 12px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    color: '#0f0',\n    font: '12px monospace',\n    letterSpacing: '0.08em',\n    textTransform: 'uppercase',\n    cursor: 'pointer'\n  });\n\n  const noButton = document.createElement('button');\n  noButton.type = 'button';\n  noButton.textContent = 'No';\n  Object.assign(noButton.style, {\n    padding: '5px 12px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    color: '#0f0',\n    font: '12px monospace',\n    letterSpacing: '0.08em',\n    textTransform: 'uppercase',\n    cursor: 'pointer'\n  });\n\n  const confirmHint = document.createElement('div');\n  Object.assign(confirmHint.style, {\n    display: 'grid',\n    rowGap: '2px',\n    fontSize: '11px',\n    opacity: '0.7',\n    letterSpacing: '0.06em',\n    justifyItems: 'center'\n  });\n  const confirmHintEnter = document.createElement('div');\n  confirmHintEnter.textContent = '[Enter]';\n  const confirmHintKeys = document.createElement('div');\n  confirmHintKeys.textContent = 'A: Yes / D: No';\n  confirmHint.appendChild(confirmHintEnter);\n  confirmHint.appendChild(confirmHintKeys);\n\n  const setButtonActive = (button, active) => {\n    button.style.boxShadow = active ? '0 0 10px rgba(0,255,0,0.5)' : 'none';\n    button.style.background = active ? 'rgba(0,0,0,0.85)' : 'rgba(0,0,0,0.7)';\n  };\n\n  confirmButtons.appendChild(yesButton);\n  confirmButtons.appendChild(noButton);\n  confirmWrap.appendChild(confirmLabel);\n  confirmWrap.appendChild(confirmButtons);\n  confirmWrap.appendChild(confirmHint);\n\n  restartWrap.appendChild(startOverButton);\n  restartWrap.appendChild(startOverHint);\n  restartWrap.appendChild(confirmWrap);\n  panel.appendChild(restartWrap);\n  root.appendChild(panel);\n  document.body.appendChild(root);\n\n  let visible = false;\n  let showRestart = false;\n  let mode = 'main';\n  let confirmChoice = 'no';\n  let keyHandler = null;\n\n  const setConfirmChoice = (choice) => {\n    confirmChoice = choice === 'yes' ? 'yes' : 'no';\n    const yesActive = confirmChoice === 'yes';\n    setButtonActive(yesButton, yesActive);\n    setButtonActive(noButton, !yesActive);\n    try {\n      (yesActive ? yesButton : noButton).focus({ preventScroll: true });\n    } catch {\n      (yesActive ? yesButton : noButton).focus();\n    }\n  };\n\n  const setMode = (nextMode) => {\n    mode = nextMode === 'confirm' ? 'confirm' : 'main';\n    if (mode === 'main') {\n      confirmWrap.style.display = 'none';\n      startOverButton.style.display = showRestart ? 'inline-block' : 'none';\n      startOverHint.style.display = showRestart ? 'block' : 'none';\n      if (showRestart) {\n        setButtonActive(startOverButton, true);\n        try {\n          startOverButton.focus({ preventScroll: true });\n        } catch {\n          startOverButton.focus();\n        }\n      } else {\n        setButtonActive(startOverButton, false);\n      }\n    } else {\n      startOverButton.style.display = 'none';\n      startOverHint.style.display = 'none';\n      confirmWrap.style.display = 'flex';\n      setConfirmChoice('no');\n    }\n  };\n\n  const attachKeyHandler = () => {\n    if (keyHandler) return;\n    keyHandler = (event) => {\n      if (!visible || !showRestart) return;\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        event.stopPropagation();\n        if (mode === 'main') {\n          startOverButton.click();\n        } else if (confirmChoice === 'yes') {\n          yesButton.click();\n        } else {\n          noButton.click();\n        }\n        return;\n      }\n      if (mode === 'confirm' && !event.repeat) {\n        if (event.code === 'KeyA' || event.code === 'KeyD') {\n          event.preventDefault();\n          event.stopPropagation();\n          setConfirmChoice(confirmChoice === 'yes' ? 'no' : 'yes');\n        }\n      }\n    };\n    document.addEventListener('keydown', keyHandler);\n  };\n\n  const detachKeyHandler = () => {\n    if (!keyHandler) return;\n    document.removeEventListener('keydown', keyHandler);\n    keyHandler = null;\n  };\n\n  startOverButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setMode('confirm');\n  });\n\n  yesButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    window.location.reload();\n  });\n\n  noButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setMode('main');\n  });\n\n  const setVisible = (next, titleText) => {\n    visible = Boolean(next);\n    if (titleText) title.textContent = titleText;\n    root.style.opacity = visible ? '1' : '0';\n    root.style.pointerEvents = visible ? 'auto' : 'none';\n    if (!visible) {\n      detachKeyHandler();\n      setMode('main');\n      return;\n    }\n    if (showRestart) {\n      attachKeyHandler();\n    } else {\n      detachKeyHandler();\n    }\n  };\n  return {\n    show: (titleText, options = {}) => {\n      showRestart = Boolean(options.showRestart);\n      restartWrap.style.display = showRestart ? 'flex' : 'none';\n      setMode('main');\n      setVisible(true, titleText);\n    },\n    hide: () => setVisible(false),\n    setVisible\n  };\n}\nfunction createEndScreen() {\n  if (RUNNING_IN_WORKER || typeof document === 'undefined') return null;\n  const root = document.createElement('div');\n  Object.assign(root.style, {\n    position: 'fixed',\n    inset: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    background: 'rgba(0,0,0,0.75)',\n    color: '#0f0',\n    font: '16px/1.5 monospace',\n    letterSpacing: '0.08em',\n    textTransform: 'uppercase',\n    textAlign: 'center',\n    opacity: '0',\n    pointerEvents: 'none',\n    zIndex: 10002,\n    transition: 'opacity 0.3s ease'\n  });\n\n  const panel = document.createElement('div');\n  Object.assign(panel.style, {\n    padding: '18px 28px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.8)',\n    boxShadow: '0 0 16px rgba(0,255,0,0.18)',\n    minWidth: '280px',\n    pointerEvents: 'auto'\n  });\n\n  const title = document.createElement('div');\n  title.style.fontSize = '18px';\n  title.style.marginBottom = '8px';\n\n  const scoreLine = document.createElement('div');\n  scoreLine.style.fontSize = '14px';\n  scoreLine.style.letterSpacing = '0.06em';\n\n  const statsWrap = document.createElement('div');\n  Object.assign(statsWrap.style, {\n    marginTop: '8px',\n    display: 'none',\n    fontSize: '12px',\n    letterSpacing: '0.05em',\n    lineHeight: '1.5'\n  });\n\n  const badgeRow = document.createElement('div');\n  Object.assign(badgeRow.style, {\n    marginTop: '10px',\n    display: 'none',\n    justifyContent: 'center',\n    gap: '8px'\n  });\n\n  const restartButton = document.createElement('button');\n  restartButton.type = 'button';\n  restartButton.textContent = 'Play Again?';\n  Object.assign(restartButton.style, {\n    marginTop: '12px',\n    padding: '6px 14px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    color: '#0f0',\n    font: '13px monospace',\n    letterSpacing: '0.08em',\n    textTransform: 'uppercase',\n    cursor: 'pointer',\n    display: 'none'\n  });\n  restartButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    window.location.reload();\n  });\n  restartButton.style.boxShadow = 'none';\n\n  const restartHint = document.createElement('div');\n  restartHint.textContent = '[Enter]';\n  Object.assign(restartHint.style, {\n    marginTop: '6px',\n    fontSize: '11px',\n    opacity: '0.7',\n    letterSpacing: '0.06em',\n    display: 'none'\n  });\n\n  let enterHandler = null;\n  let restartHintAnim = null;\n  const attachEnterHandler = () => {\n    if (enterHandler) return;\n    enterHandler = (event) => {\n      if (event.key !== 'Enter') return;\n      event.preventDefault();\n      event.stopPropagation();\n      restartButton.click();\n    };\n    document.addEventListener('keydown', enterHandler);\n  };\n  const detachEnterHandler = () => {\n    if (!enterHandler) return;\n    document.removeEventListener('keydown', enterHandler);\n    enterHandler = null;\n  };\n\n  panel.appendChild(title);\n  panel.appendChild(scoreLine);\n  panel.appendChild(statsWrap);\n  panel.appendChild(badgeRow);\n  panel.appendChild(restartButton);\n  panel.appendChild(restartHint);\n  root.appendChild(panel);\n  document.body.appendChild(root);\n\n  const show = ({ titleText = '', scoreText = '', statsLines = [], showRestart = false, badgeSources = [] } = {}) => {\n    title.textContent = titleText;\n    if (scoreText) {\n      scoreLine.textContent = scoreText;\n      scoreLine.style.display = 'block';\n    } else {\n      scoreLine.textContent = '';\n      scoreLine.style.display = 'none';\n    }\n    if (Array.isArray(statsLines) && statsLines.length) {\n      statsWrap.innerHTML = '';\n      statsLines.forEach(line => {\n        const row = document.createElement('div');\n        row.textContent = line;\n        statsWrap.appendChild(row);\n      });\n      statsWrap.style.display = 'block';\n    } else {\n      statsWrap.innerHTML = '';\n      statsWrap.style.display = 'none';\n    }\n    if (Array.isArray(badgeSources) && badgeSources.length) {\n      badgeRow.innerHTML = '';\n      badgeSources.forEach(src => {\n        const img = document.createElement('img');\n        img.src = src;\n        Object.assign(img.style, {\n          width: '3em',\n          height: '3em',\n          objectFit: 'contain',\n          imageRendering: 'auto',\n          filter: 'drop-shadow(0 0 4px rgba(0,255,0,0.25))'\n        });\n        badgeRow.appendChild(img);\n      });\n      badgeRow.style.display = 'flex';\n    } else {\n      badgeRow.innerHTML = '';\n      badgeRow.style.display = 'none';\n    }\n    restartButton.style.display = showRestart ? 'inline-block' : 'none';\n    restartButton.style.boxShadow = showRestart ? '0 0 12px rgba(0,255,0,0.45)' : 'none';\n    restartButton.style.background = showRestart ? 'rgba(0,0,0,0.85)' : 'rgba(0,0,0,0.7)';\n    restartHint.style.display = showRestart ? 'block' : 'none';\n    root.style.pointerEvents = showRestart ? 'auto' : 'none';\n    if (restartHintAnim) {\n      restartHintAnim.cancel();\n      restartHintAnim = null;\n    }\n    const shouldPulse = titleText === 'GAME OVER'\n      || titleText === 'MISSION COMPLETE'\n      || titleText === 'MISSION ACCOMPLISHED';\n    if (showRestart && shouldPulse) {\n      restartHintAnim = restartHint.animate(\n        [{ opacity: 0.2 }, { opacity: 1 }, { opacity: 0.2 }],\n        { duration: 1600, iterations: Infinity }\n      );\n    }\n    if (showRestart) {\n      attachEnterHandler();\n      try {\n        restartButton.focus({ preventScroll: true });\n      } catch {\n        restartButton.focus();\n      }\n    } else {\n      detachEnterHandler();\n    }\n    root.style.opacity = '1';\n  };\n  const hide = () => {\n    root.style.pointerEvents = 'none';\n    root.style.opacity = '0';\n    if (restartHintAnim) {\n      restartHintAnim.cancel();\n      restartHintAnim = null;\n    }\n    detachEnterHandler();\n  };\n  return { show, hide };\n}\nfunction createLoadingUI({ onPreviewDone = () => {}, onFinish = () => {} } = {}) {\n  if (RUNNING_IN_WORKER || typeof document === 'undefined') return null;\n  const root = document.createElement('div');\n  Object.assign(root.style, {\n    position: 'fixed',\n    inset: 0,\n    pointerEvents: 'none',\n    zIndex: 9998,\n    opacity: '1',\n    transition: `opacity ${LOADING_FADE_OUT_MS}ms ease`\n  });\n\n  const curtain = document.createElement('div');\n  Object.assign(curtain.style, {\n    position: 'absolute',\n    inset: 0,\n    background: '#000',\n    opacity: '1',\n    transition: `opacity ${LOADING_PREVIEW_FADE_MS}ms ease`\n  });\n\n  const hud = document.createElement('div');\n  Object.assign(hud.style, {\n    position: 'absolute',\n    left: '50%',\n    bottom: '10vh',\n    transform: 'translateX(-50%)',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    gap: '8px',\n    zIndex: 2,\n    opacity: '1',\n    transition: 'opacity 0.25s ease'\n  });\n\n  const controlsWrap = document.createElement('div');\n  Object.assign(controlsWrap.style, {\n    position: 'absolute',\n    inset: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    opacity: '0',\n    pointerEvents: 'none',\n    zIndex: 1,\n    transition: 'opacity 0.4s ease'\n  });\n\n  const titleWrap = document.createElement('div');\n  Object.assign(titleWrap.style, {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    width: '100%',\n    height: '0px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    pointerEvents: 'none'\n  });\n\n  const titleImage = document.createElement('img');\n  titleImage.src = './textures/title.png';\n  titleImage.alt = 'Game Title';\n  Object.assign(titleImage.style, {\n    width: '32vw',\n    maxWidth: '360px',\n    minWidth: '200px',\n    height: 'auto',\n    imageRendering: 'auto',\n    objectFit: 'contain',\n    opacity: '0.95'\n  });\n  titleWrap.appendChild(titleImage);\n\n  const controlsPanel = document.createElement('div');\n  Object.assign(controlsPanel.style, {\n    padding: '14px 20px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    boxShadow: '0 0 12px rgba(0,255,0,0.15)',\n    minWidth: '260px',\n    color: '#0f0',\n    font: '14px/1.5 monospace',\n    letterSpacing: '0.05em',\n    textTransform: 'uppercase',\n    textAlign: 'center'\n  });\n\n  const controlsTitle = document.createElement('div');\n  controlsTitle.textContent = 'Controls';\n  controlsTitle.style.fontSize = '16px';\n  controlsTitle.style.marginBottom = '8px';\n\n  const controlsList = document.createElement('div');\n  Object.assign(controlsList.style, {\n    display: 'grid',\n    rowGap: '4px'\n  });\n  const controlsText = EDITOR_MODE\n    ? [\n        'Camera: LMB rotate / RMB pan / Wheel zoom',\n        'Select: Click mesh',\n        'Move: G',\n        'Rotate: R',\n        'Scale: S',\n        'Save: Ctrl+S',\n        'Escape: Deselect'\n      ]\n    : [\n        'Move: W/A/S/D',\n        'Shoot: Space',\n        'Charge: Hold Space',\n        'Roll: Q/E',\n        'Bank: Hold Shift',\n        'Bomb: B',\n        'Boost: J',\n        'Brake: N',\n        'Pause/Menu: P'\n      ];\n  controlsText.forEach(text => {\n    const line = document.createElement('div');\n    line.textContent = text;\n    controlsList.appendChild(line);\n  });\n  controlsPanel.appendChild(controlsTitle);\n  controlsPanel.appendChild(controlsList);\n  controlsWrap.appendChild(titleWrap);\n  controlsWrap.appendChild(controlsPanel);\n\n  const label = document.createElement('div');\n  label.textContent = 'Plotting Course... 0%';\n  Object.assign(label.style, {\n    font: '14px monospace',\n    color: '#0f0',\n    letterSpacing: '0.04em',\n    textTransform: 'uppercase'\n  });\n\n  const barWrap = document.createElement('div');\n  Object.assign(barWrap.style, {\n    width: '60vw',\n    maxWidth: '460px',\n    minWidth: '220px',\n    height: '8px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.55)',\n    boxShadow: '0 0 10px rgba(0,255,0,0.2)'\n  });\n\n  const barFill = document.createElement('div');\n  Object.assign(barFill.style, {\n    width: '0%',\n    height: '100%',\n    background: '#0f0',\n    transition: 'width 0.2s linear'\n  });\n  barWrap.appendChild(barFill);\n  hud.appendChild(label);\n  hud.appendChild(barWrap);\n\n  root.appendChild(curtain);\n  root.appendChild(controlsWrap);\n  root.appendChild(hud);\n  document.body.appendChild(root);\n\n  const updateTitleLayout = () => {\n    const rect = controlsPanel.getBoundingClientRect();\n    const topSpace = Math.max(0, rect.top);\n    titleWrap.style.height = `${topSpace}px`;\n  };\n  const handleResize = () => updateTitleLayout();\n  window.addEventListener('resize', handleResize);\n  requestAnimationFrame(updateTitleLayout);\n\n  let progress = 0;\n  let targetProgress = 0;\n  let animFrame = 0;\n  const startMs = (typeof performance !== 'undefined' && typeof performance.now === 'function')\n    ? performance.now()\n    : Date.now();\n  const stepIntervalMs = LOADING_PROGRESS_DURATION_MS / 99;\n  let lastStepMs = startMs;\n  let previewActive = false;\n  let previewTimer = null;\n  let previewEndTimer = null;\n  let previewAnimation = null;\n  let previewPhase = 'idle';\n  let previewEverShown = false;\n  let finishPending = false;\n  let finishCallback = null;\n  let finished = false;\n  let controlsShown = false;\n  let controlsSuppressed = false;\n  const notifyPreviewDone = () => {\n    if (finished || finishPending) return;\n    if (typeof onPreviewDone === 'function') onPreviewDone();\n  };\n\n  const applyProgress = (pct, allowFull = false) => {\n    const cap = allowFull ? 100 : 99;\n    const next = Math.max(0, Math.min(cap, Math.floor(pct)));\n    if (next === progress) return;\n    progress = next;\n    label.textContent = `Plotting Course... ${progress}%`;\n    barFill.style.width = `${progress}%`;\n    if (!controlsSuppressed && !controlsShown && progress >= 33) {\n      controlsShown = true;\n      controlsWrap.style.opacity = '1';\n    }\n  };\n\n  const setProgressFromCounts = (loaded, total) => {\n    if (!total || total <= 0) {\n      targetProgress = Math.max(targetProgress, 0);\n      return;\n    }\n    const pct = Math.max(0, Math.min(99, Math.floor((loaded / total) * 99)));\n    targetProgress = Math.max(targetProgress, pct);\n  };\n\n  const tickProgress = () => {\n    const now = (typeof performance !== 'undefined' && typeof performance.now === 'function')\n      ? performance.now()\n      : Date.now();\n    const elapsed = Math.max(0, now - startMs);\n    const autoProgress = Math.min(99, Math.floor(elapsed / stepIntervalMs));\n    const goal = Math.min(99, Math.max(targetProgress, autoProgress));\n    if (goal > progress && now - lastStepMs >= stepIntervalMs) {\n      lastStepMs = now;\n      applyProgress(progress + 1);\n    }\n    animFrame = requestAnimationFrame(tickProgress);\n  };\n  animFrame = requestAnimationFrame(tickProgress);\n\n  const finalizeFinish = (immediate = false) => {\n    if (finished) return;\n    finished = true;\n    if (animFrame) cancelAnimationFrame(animFrame);\n    applyProgress(100, true);\n    if (previewTimer) clearTimeout(previewTimer);\n    if (previewEndTimer) clearTimeout(previewEndTimer);\n    window.removeEventListener('resize', handleResize);\n    if (immediate) {\n      if (typeof root.remove === 'function') root.remove();\n      else if (root.parentNode) root.parentNode.removeChild(root);\n      if (typeof finishCallback === 'function') finishCallback();\n      finishCallback = null;\n      return;\n    }\n    curtain.style.opacity = '0';\n    root.style.opacity = '0';\n    setTimeout(() => {\n      if (typeof root.remove === 'function') root.remove();\n      else if (root.parentNode) root.parentNode.removeChild(root);\n      if (typeof finishCallback === 'function') finishCallback();\n      finishCallback = null;\n    }, LOADING_FADE_OUT_MS + 50);\n  };\n\n  const previewFlash = () => {\n    if (previewActive) return;\n    if (controlsShown && !controlsSuppressed) {\n      controlsSuppressed = true;\n      controlsWrap.style.opacity = '0';\n    }\n    previewActive = true;\n    previewPhase = 'fadingIn';\n    previewEverShown = true;\n    if (previewTimer) clearTimeout(previewTimer);\n    if (previewEndTimer) clearTimeout(previewEndTimer);\n    if (previewAnimation) {\n      previewAnimation.cancel();\n      previewAnimation = null;\n    }\n    curtain.style.opacity = '1';\n    const totalMs = (LOADING_PREVIEW_FADE_MS * 2) + LOADING_PREVIEW_HOLD_MS;\n    if (typeof curtain.animate === 'function') {\n      const fadeInOffset = LOADING_PREVIEW_FADE_MS / totalMs;\n      const holdOffset = (LOADING_PREVIEW_FADE_MS + LOADING_PREVIEW_HOLD_MS) / totalMs;\n      previewAnimation = curtain.animate([\n        { opacity: 1, offset: 0 },\n        { opacity: 0, offset: fadeInOffset },\n        { opacity: 0, offset: holdOffset },\n        { opacity: 1, offset: 1 }\n      ], {\n        duration: totalMs,\n        easing: 'ease',\n        fill: 'forwards'\n      });\n      previewAnimation.onfinish = () => {\n        previewActive = false;\n        previewPhase = 'idle';\n        previewAnimation = null;\n        notifyPreviewDone();\n        if (finishPending) finalizeFinish(true);\n      };\n      previewAnimation.oncancel = () => {\n        previewActive = false;\n        previewPhase = 'idle';\n        previewAnimation = null;\n      };\n      return;\n    }\n    curtain.style.opacity = '0';\n    previewTimer = setTimeout(() => {\n      previewPhase = 'fadingOut';\n      curtain.style.opacity = '1';\n      previewEndTimer = setTimeout(() => {\n        previewActive = false;\n        previewPhase = 'idle';\n        notifyPreviewDone();\n        if (finishPending) finalizeFinish(true);\n      }, LOADING_PREVIEW_FADE_MS);\n    }, LOADING_PREVIEW_FADE_MS + LOADING_PREVIEW_HOLD_MS);\n  };\n\n  const finish = (onDone) => {\n    if (typeof onDone === 'function') finishCallback = onDone;\n    if (finishPending) return;\n    finishPending = true;\n    if (typeof onFinish === 'function') onFinish();\n    hud.style.opacity = '0';\n    if (previewActive) return;\n    finalizeFinish(previewEverShown);\n  };\n\n  return { setProgressFromCounts, previewFlash, finish };\n}\nfunction showDialoguePopup({\n  portraitSrc = '',\n  textLines = [],\n  durationMs = 4200\n} = {}) {\n  if (RUNNING_IN_WORKER || typeof document === 'undefined') return () => {};\n  const basePortrait = 86;\n  const portraitSize = Math.max(48, Math.round(window.innerHeight * 0.15));\n  const scale = portraitSize / basePortrait;\n  const lines = Array.isArray(textLines) ? textLines : [String(textLines ?? '')];\n  const root = document.createElement('div');\n  Object.assign(root.style, {\n    position: 'fixed',\n    left: `${Math.round(24 * scale)}px`,\n    bottom: `${Math.round(24 * scale)}px`,\n    display: 'flex',\n    alignItems: 'center',\n    gap: `${Math.round(12 * scale)}px`,\n    zIndex: 10020,\n    pointerEvents: 'none',\n    opacity: '0',\n    transition: 'opacity 0.2s ease'\n  });\n\n  const portraitWrap = document.createElement('div');\n  Object.assign(portraitWrap.style, {\n    width: `${portraitSize}px`,\n    height: `${portraitSize}px`,\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.6)',\n    boxShadow: '0 0 10px rgba(0,255,0,0.2)',\n    overflow: 'hidden',\n    transform: 'scaleY(0.04)',\n    transformOrigin: 'center',\n    transition: 'transform 0.25s ease-out'\n  });\n\n  const portraitImg = document.createElement('img');\n  portraitImg.src = portraitSrc;\n  Object.assign(portraitImg.style, {\n    width: '100%',\n    height: '100%',\n    objectFit: 'cover',\n    opacity: '0',\n    transition: 'opacity 0.2s ease'\n  });\n  portraitWrap.appendChild(portraitImg);\n\n  const textPanel = document.createElement('div');\n  Object.assign(textPanel.style, {\n    minHeight: `${portraitSize}px`,\n    padding: `${Math.round(10 * scale)}px ${Math.round(14 * scale)}px`,\n    border: '1px solid rgba(0,255,0,0.6)',\n    background: 'rgba(30,120,200,0.35)',\n    color: '#fff',\n    font: `${Math.max(12, Math.round(14 * scale))}px/1.4 monospace`,\n    letterSpacing: '0.03em',\n    maxWidth: `${Math.round(360 * scale)}px`,\n    transform: 'scaleX(0)',\n    transformOrigin: 'left center',\n    transition: 'transform 0.3s ease-out'\n  });\n  const text = document.createElement('div');\n  text.textContent = lines.join('\\n');\n  text.style.whiteSpace = 'pre-line';\n  textPanel.appendChild(text);\n\n  root.appendChild(portraitWrap);\n  root.appendChild(textPanel);\n  document.body.appendChild(root);\n\n  const revealTimer = setTimeout(() => {\n    portraitImg.style.opacity = '1';\n  }, 180);\n  const textTimer = setTimeout(() => {\n    textPanel.style.transform = 'scaleX(1)';\n  }, 260);\n  requestAnimationFrame(() => {\n    root.style.opacity = '1';\n    portraitWrap.style.transform = 'scaleY(1)';\n  });\n\n  const hideTimer = setTimeout(() => {\n    root.style.opacity = '0';\n  }, Math.max(800, durationMs));\n  const removeTimer = setTimeout(() => {\n    if (typeof root.remove === 'function') root.remove();\n    else if (root.parentNode) root.parentNode.removeChild(root);\n  }, Math.max(900, durationMs + 350));\n\n  return () => {\n    clearTimeout(revealTimer);\n    clearTimeout(textTimer);\n    clearTimeout(hideTimer);\n    clearTimeout(removeTimer);\n    if (typeof root.remove === 'function') root.remove();\n    else if (root.parentNode) root.parentNode.removeChild(root);\n  };\n}\nconst handleDialoguePayload = (payload = {}) => {\n  if (RUNNING_IN_WORKER) return;\n  const id = payload.id;\n  if (id && shownDialogueIds.has(id)) return;\n  if (id) shownDialogueIds.add(id);\n  const durationMs = Number.isFinite(payload.durationMs)\n    ? payload.durationMs\n    : DIALOGUE_POP_DURATION_MS;\n  const portraitSrc = payload.portraitSrc ?? './textures/protag.png';\n  const textLines = payload.textLines ?? [];\n  if (dialogueCleanup) {\n    dialogueCleanup();\n    dialogueCleanup = null;\n  }\n  dialogueCleanup = showDialoguePopup({\n    portraitSrc,\n    textLines,\n    durationMs\n  });\n};\nconst pauseMenu = (!RUNNING_IN_WORKER && typeof document !== 'undefined')\n  ? createPauseMenu()\n  : null;\nconst endScreen = (!RUNNING_IN_WORKER && typeof document !== 'undefined')\n  ? createEndScreen()\n  : null;\nlet pauseMenuVisible = false;\nlet pauseMenuLocked = false;\nlet endScreenActive = false;\nconst showPauseMenu = (titleText = 'PAUSED', { lock = false } = {}) => {\n  pauseMenuVisible = true;\n  if (lock) pauseMenuLocked = true;\n  pauseMenu?.show(titleText, { showRestart: !lock && titleText === 'PAUSED' });\n};\nconst hidePauseMenu = ({ force = false } = {}) => {\n  if (pauseMenuLocked && !force) return;\n  pauseMenuVisible = false;\n  pauseMenuLocked = false;\n  pauseMenu?.hide();\n};\nconst showEndScreen = ({\n  titleText = '',\n  scoreText = '',\n  statsLines = [],\n  showRestart = false,\n  badgeSources = []\n} = {}) => {\n  endScreenActive = true;\n  hidePauseMenu({ force: true });\n  endScreen?.show({ titleText, scoreText, statsLines, showRestart, badgeSources });\n};\nconst hideEndScreen = () => {\n  endScreenActive = false;\n  endScreen?.hide();\n};\nconst togglePauseMenu = () => {\n  if (endScreenActive) return;\n  if (pauseMenuLocked) return;\n  if (pauseMenuVisible) {\n    hidePauseMenu();\n  } else {\n    showPauseMenu('PAUSED');\n  }\n};\nconst loadingUI = (!RUNNING_IN_WORKER && typeof document !== 'undefined')\n  ? createLoadingUI({\n      onPreviewDone: () => {},\n      onFinish: () => hidePauseMenu({ force: true })\n    })\n  : null;\nfunction reportLoadingProgress(loaded, total) {\n  if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n    self.postMessage({ type: 'loadingProgress', loaded, total });\n    return;\n  }\n  loadingUI?.setProgressFromCounts(loaded, total);\n}\nfunction triggerLoadingPreview() {\n  if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n    self.postMessage({ type: 'loadingPreview' });\n    return;\n  }\n  loadingUI?.previewFlash();\n}\nfunction startLevelIntroOverlay(options = {}) {\n  const durationMs = typeof options.durationMs === 'number'\n    ? options.durationMs\n    : LEVEL_INTRO_DURATION_MS;\n  const titleText = typeof options.title === 'string'\n    ? options.title\n    : LEVEL_INTRO_TITLE;\n  const objectiveText = typeof options.objective === 'string'\n    ? options.objective\n    : LEVEL_INTRO_OBJECTIVE;\n  const instantBackdrop = Boolean(options.instantBackdrop);\n  if (RUNNING_IN_WORKER || typeof document === 'undefined' || durationMs <= 0) {\n    return () => {};\n  }\n  setIntroPauseBlock(durationMs);\n  const introScale = 1.7;\n  const root = document.createElement('div');\n  Object.assign(root.style, {\n    position: 'fixed',\n    inset: 0,\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    background: 'rgba(0,0,0,0.35)',\n    opacity: '0',\n    pointerEvents: 'none',\n    zIndex: 10000,\n    transition: 'opacity 0.35s ease'\n  });\n  if (instantBackdrop) {\n    root.style.opacity = '1';\n    root.style.transition = 'none';\n  }\n  const panel = document.createElement('div');\n  Object.assign(panel.style, {\n    marginTop: '10vh',\n    padding: '16px 26px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.75)',\n    color: '#0f0',\n    font: '16px/1.4 monospace',\n    letterSpacing: '0.06em',\n    textTransform: 'uppercase',\n    textAlign: 'center',\n    opacity: '0',\n    transform: `translateY(-24px) scale(${introScale})`,\n    transformOrigin: 'top center',\n    transition: 'transform 0.45s ease, opacity 0.45s ease'\n  });\n  const title = document.createElement('div');\n  title.textContent = titleText;\n  title.style.fontSize = '18px';\n  title.style.marginBottom = '6px';\n  const objective = document.createElement('div');\n  objective.textContent = objectiveText;\n  objective.style.fontSize = '13px';\n  panel.appendChild(title);\n  panel.appendChild(objective);\n  root.appendChild(panel);\n  document.body.appendChild(root);\n\n  requestAnimationFrame(() => {\n    if (!instantBackdrop) {\n      root.style.opacity = '1';\n    }\n    panel.style.opacity = '1';\n    panel.style.transform = `translateY(0) scale(${introScale})`;\n  });\n\n  const exitMs = Math.max(0, durationMs - 700);\n  const exitTimer = setTimeout(() => {\n    panel.style.opacity = '0';\n    panel.style.transform = `translateY(-24px) scale(${introScale})`;\n    root.style.opacity = '0';\n  }, exitMs);\n  const removeTimer = setTimeout(() => {\n    if (typeof root.remove === 'function') root.remove();\n    else if (root.parentNode) root.parentNode.removeChild(root);\n  }, durationMs + 300);\n\n  return () => {\n    clearTimeout(exitTimer);\n    clearTimeout(removeTimer);\n    if (typeof root.remove === 'function') root.remove();\n    else if (root.parentNode) root.parentNode.removeChild(root);\n  };\n}\nconst scheduleIdle = (() => {\n  let queued = false;\n  const tasks = [];\n  const runner = (deadline) => {\n    queued = false;\n    while (tasks.length) {\n      // if we’re out of idle time, reschedule remaining tasks\n      if (deadline && typeof deadline.timeRemaining === 'function' && deadline.timeRemaining() <= 1) break;\n      const fn = tasks.shift();\n      try { fn(); } catch (err) { console.warn('idle task error', err); }\n    }\n    if (tasks.length) {\n      queued = true;\n      const ric = typeof requestIdleCallback === 'function'\n        ? requestIdleCallback\n        : (cb) => setTimeout(() => cb({ timeRemaining: () => 5 }), 0);\n      ric(runner);\n    }\n  };\n  return (fn) => {\n    tasks.push(fn);\n    if (!queued) {\n      queued = true;\n      const ric = typeof requestIdleCallback === 'function'\n        ? requestIdleCallback\n        : (cb) => setTimeout(() => cb({ timeRemaining: () => 5 }), 0);\n      ric(runner);\n    }\n  };\n})();\nif (!GLTFLoader.prototype._uncullPatchApplied) {\n  const _origLoadAsync = GLTFLoader.prototype.loadAsync;\n  GLTFLoader.prototype.loadAsync = function (url, ...rest) {\n    return _origLoadAsync.call(this, url, ...rest).then((gltf) => {\n      if (gltf?.scene) {\n        gltf.scene.traverse(o => {\n          if (o.isMesh) o.frustumCulled = false;\n        });\n      }\n      return gltf;\n    });\n  };\n  GLTFLoader.prototype._uncullPatchApplied = true;\n}\n\nfunction installEnemyPathDump() {\n  if (RUNNING_IN_WORKER || typeof globalThis === 'undefined') return;\n  const g = globalThis;\n\n  function downloadPaths(paths) {\n    if (typeof document === 'undefined') {\n      console.warn('No document available to download JSON.');\n      return 0;\n    }\n    const payload = { paths };\n    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'enemy-paths-captured.json';\n    a.click();\n    URL.revokeObjectURL(url);\n    return paths?.length ?? 0;\n  }\n\n  async function dumpFromWorker() {\n    if (!renderWorker) {\n      console.warn('No render worker active; nothing to dump from worker.');\n      return 0;\n    }\n    return new Promise((resolve, reject) => {\n      const timer = setTimeout(() => {\n        renderWorker.removeEventListener('message', onMsg);\n        reject(new Error('Timed out waiting for worker path dump'));\n      }, 5000);\n      const onMsg = (evt) => {\n        const msg = evt.data;\n        if (!msg || msg.type !== 'pathsDump') return;\n        clearTimeout(timer);\n        renderWorker.removeEventListener('message', onMsg);\n        const count = downloadPaths(msg.payload?.paths ?? []);\n        resolve(count);\n      };\n      renderWorker.addEventListener('message', onMsg);\n      renderWorker.postMessage({ type: 'dumpPaths' });\n    });\n  }\n\n  g.dumpEnemyPaths = async () => {\n    if (!ENEMY_CAPTURE_ENABLED) {\n      console.warn('Enemy path capture is off. Set window.__CAPTURE_ENEMY_PATHS__ = true before loading to enable.');\n      return 0;\n    }\n    // If game is running on main thread, dump directly; otherwise ask worker.\n    if (!renderWorkerLaunched) {\n      return downloadPaths(CAPTURED_ENEMY_PATHS);\n    }\n    try {\n      return await dumpFromWorker();\n    } catch (err) {\n      console.warn('Could not dump paths from worker:', err?.message || err);\n      return 0;\n    }\n  };\n\n  if (ENEMY_CAPTURE_ENABLED) {\n    console.info('[dev] Enemy path capture ON; call  to download JSON.');\n  } else {\n    console.info('[dev] Enemy path capture OFF; set window.__CAPTURE_ENEMY_PATHS__ = true before load to record paths.');\n  }\n}\n\ninstallEnemyPathDump();\n\n/* ─── render worker bootstrap (main thread only) ───────────── */\nif (USE_RENDER_WORKER) {\n  const hostCanvas = typeof document !== 'undefined'\n    ? document.getElementById('c')\n    : null;\n  if (hostCanvas) {\n    hostCanvas.width = innerWidth;\n    hostCanvas.height = innerHeight;\n    hostCanvas.style.width = '100vw';\n    hostCanvas.style.height = '100vh';\n  }\n  let fallbackTriggered = false;\n  const triggerFallback = () => {\n    if (fallbackTriggered) return;\n    fallbackTriggered = true;\n    renderWorkerLaunched = false;\n    console.warn('Render worker failed; falling back to main-thread render.');\n    fallbackRun && fallbackRun();\n  };\n  if (hostCanvas?.transferControlToOffscreen && typeof Worker !== 'undefined') {\n    try {\n      const offscreen = hostCanvas.transferControlToOffscreen();\n      const worker = new Worker('./render-worker.js', { type: 'module' });\n      const dpr = typeof devicePixelRatio === 'number' ? devicePixelRatio : 1;\n      worker.postMessage({\n        type: 'init',\n        canvas: offscreen,\n        size: { w: innerWidth, h: innerHeight },\n        dpr\n      }, [offscreen]);\n      hostCanvas.dataset.offscreen = '1';\n      renderWorkerLaunched = true;\n      renderWorker = worker;\n\n      const inputBatch = [];\n      let inputFlushScheduled = false;\n      const scheduleInputFlush = (fn) => {\n        if (typeof queueMicrotask === 'function') {\n          queueMicrotask(fn);\n        } else {\n          Promise.resolve().then(fn);\n        }\n      };\n      const flushInputBatch = () => {\n        inputFlushScheduled = false;\n        if (!inputBatch.length) return;\n        worker.postMessage({ type: 'inputBatch', events: inputBatch });\n        inputBatch.length = 0;\n      };\n      const queueInputEvent = (event, code, repeat) => {\n        inputBatch.push({ event, code, repeat: Boolean(repeat) });\n        if (!inputFlushScheduled) {\n          inputFlushScheduled = true;\n          scheduleInputFlush(flushInputBatch);\n        }\n      };\n      const forwardedDown = new Set();\n      const forwardKey = (ev) => {\n        const code = ev?.code;\n        if (!code || !GAME_KEY_CODES.has(code)) return;\n        if (typeof ev.preventDefault === 'function') ev.preventDefault();\n        if (code === PAUSE_KEY && ev.type === 'keydown' && !ev.repeat) {\n          if (isPauseBlockedForIntro()) return;\n          togglePauseMenu();\n        }\n        if (ev.type === 'keydown') {\n          if (ev.repeat) return;\n          if (forwardedDown.has(code)) return;\n          forwardedDown.add(code);\n        } else if (ev.type === 'keyup') {\n          if (!forwardedDown.has(code)) return;\n          forwardedDown.delete(code);\n        } else {\n          return;\n        }\n        queueInputEvent(ev.type, code, ev.repeat);\n      };\n      window.addEventListener('keydown', forwardKey);\n      window.addEventListener('keyup', forwardKey);\n      window.addEventListener('blur', () => {\n        if (!forwardedDown.size) return;\n        forwardedDown.forEach((code) => {\n          queueInputEvent('keyup', code, false);\n        });\n        forwardedDown.clear();\n        flushInputBatch();\n      });\n      let lastResize = {\n        w: innerWidth,\n        h: innerHeight,\n        dpr: typeof devicePixelRatio === 'number' ? devicePixelRatio : 1\n      };\n      const readCanvasSize = () => {\n        const rect = typeof hostCanvas?.getBoundingClientRect === 'function'\n          ? hostCanvas.getBoundingClientRect()\n          : null;\n        const w = rect?.width || hostCanvas?.clientWidth || innerWidth;\n        const h = rect?.height || hostCanvas?.clientHeight || innerHeight;\n        return { w, h };\n      };\n      const sendResize = (force = false) => {\n        const { w, h } = readCanvasSize();\n        const dpr = typeof devicePixelRatio === 'number' ? devicePixelRatio : 1;\n        if (!force && w === lastResize.w && h === lastResize.h && dpr === lastResize.dpr) return;\n        lastResize = { w, h, dpr };\n        worker.postMessage({\n          type: 'resize',\n          size: { w, h },\n          dpr\n        });\n      };\n      window.addEventListener('resize', sendResize);\n      if (typeof ResizeObserver !== 'undefined' && hostCanvas) {\n        const ro = new ResizeObserver(sendResize);\n        ro.observe(hostCanvas);\n      }\n      requestAnimationFrame(sendResize);\n      requestAnimationFrame(() => sendResize(true));\n      setTimeout(() => sendResize(true), 250);\n      setTimeout(() => sendResize(true), 1000);\n\n      let pendingHudState = null;\n      let hudScheduled = false;\n      let pendingDiagLines = null;\n      let diagScheduled = false;\n      const flushHud = () => {\n        hudScheduled = false;\n        if (pendingHudState) {\n          syncHud(pendingHudState);\n          pendingHudState = null;\n        }\n      };\n      const flushDiag = () => {\n        diagScheduled = false;\n        if (pendingDiagLines) {\n          renderDiagnosticsLines(pendingDiagLines);\n          pendingDiagLines = null;\n        }\n      };\n\n      worker.addEventListener('message', (evt) => {\n        const msg = evt.data;\n        if (!msg) return;\n        if (msg.type === 'loadingProgress') {\n          loadingUI?.setProgressFromCounts(msg.loaded, msg.total);\n        } else if (msg.type === 'loadingPreview') {\n          loadingUI?.previewFlash();\n        } else if (msg.type === 'introStart') {\n          setIntroPauseBlock(msg.payload?.durationMs ?? LEVEL_INTRO_DURATION_MS);\n          if (loadingUI) {\n            loadingUI.finish(() => startLevelIntroOverlay({ ...(msg.payload ?? {}), instantBackdrop: true }));\n          } else {\n            startLevelIntroOverlay({ ...(msg.payload ?? {}), instantBackdrop: true });\n          }\n        } else if (msg.type === 'dialogue') {\n          const payload = msg.payload ?? {};\n          const delayMs = Number.isFinite(payload.delayMs) ? payload.delayMs : 0;\n          const durationMs = Number.isFinite(payload.durationMs) ? payload.durationMs : DIALOGUE_POP_DURATION_MS;\n          const portraitSrc = payload.portraitSrc ?? './textures/protag.png';\n          const textLines = payload.textLines ?? ['Everybody, stay alert!'];\n          setTimeout(() => {\n            handleDialoguePayload({\n              id: payload.id,\n              portraitSrc,\n              textLines,\n              durationMs\n            });\n          }, Math.max(0, delayMs));\n        } else if (msg.type === 'hud') {\n          pendingHudState = msg.state;\n          if (!hudScheduled) {\n            hudScheduled = true;\n            requestAnimationFrame(flushHud);\n          }\n        } else if (msg.type === 'gameOver') {\n          const score = typeof msg.payload?.score === 'number'\n            ? msg.payload.score\n            : getScore();\n          const statsLines = buildStatsLines(msg.payload?.stats);\n          showEndScreen({ titleText: 'GAME OVER', scoreText: `SCORE ${score}`, statsLines, showRestart: true });\n        } else if (msg.type === 'missionComplete') {\n          const score = typeof msg.payload?.score === 'number'\n            ? msg.payload.score\n            : getScore();\n          const escortSurvived = Boolean(msg.payload?.escortSurvived);\n          const missionTitle = msg.payload?.stationBossDestroyed && escortSurvived\n            ? 'MISSION COMPLETE'\n            : 'MISSION ACCOMPLISHED';\n          const statsLines = buildStatsLines(msg.payload?.stats);\n          const badgeSources = [\n            './textures/red.png',\n            escortSurvived ? './textures/green.png' : './textures/green-gray.png',\n            './textures/yellow.png'\n          ];\n          showEndScreen({\n            titleText: missionTitle,\n            scoreText: `SCORE ${score}`,\n            statsLines,\n            showRestart: true,\n            badgeSources\n          });\n        } else if (msg.type === 'diag') {\n          pendingDiagLines = msg.payload?.lines ?? [];\n          if (!diagScheduled) {\n            diagScheduled = true;\n            requestAnimationFrame(flushDiag);\n          }\n        } else if (msg.type === 'log') {\n          console.log('[render-worker]', ...(msg.args ?? []));\n      } else if (msg.type === 'error' || msg.type === 'fatal') {\n        console.error('[render-worker error]', msg.error?.message ?? msg, msg.error?.stack ?? '');\n        triggerFallback();\n      } else if (msg.type === 'pathsDump') {\n        // handled by dumpEnemyPaths promise listeners\n      } else if (msg.type === 'ready') {\n        console.log('[render-worker] ready');\n      }\n      });\n      worker.addEventListener('error', (err) => {\n        console.error('[render-worker] uncaught error', err?.message || err);\n        triggerFallback();\n      });\n    } catch (err) {\n      console.warn('Render worker init failed, using main thread', err);\n      renderWorkerLaunched = false;\n    }\n  } else {\n    console.warn('OffscreenCanvas not supported; staying on main thread renderer.');\n  }\n}\n\nasync function runGame() {\n\nconst FREE_ROAM = true;\nlet introActive = false;\nlet introStartMs = 0;\nlet pauseActive = false;\nlet allowPause = false;\nlet gameOverActive = false;\nlet levelCompleteActive = false;\nlet playerAlive = true;\nlet gameOverStartMs = 0;\nlet stationBossDestroyed = false;\nlet escortSurvived = false;\nlet missionCompleteTimer = null;\nconst STARTING_BOMBS = 3;\nlet bombCount = STARTING_BOMBS;\nconst MISSION_COMPLETE_DELAY_MS = 350;\nconst canEnemyFire = () => (\n  playerAlive\n  && !gameOverActive\n  && !levelCompleteActive\n  && !introActive\n  && !pauseActive\n);\nlet lasers = null;\nlet allySystem = null;\nlet pickupSystem = null;\nconst laserUpdateOptions = { allowFire: true };\nconst tmpDropPos = new THREE.Vector3();\nconst maybeDropHealRing = (ship, pos) => {\n  if (!ship?.userData?.dropHealRing) return;\n  ship.userData.dropHealRing = false;\n  if (!pickupSystem?.spawnHealRingAt) return;\n  if (pos) {\n    tmpDropPos.copy(pos);\n    pickupSystem.spawnHealRingAt(tmpDropPos);\n  } else if (ship.getWorldPosition) {\n    ship.getWorldPosition(tmpDropPos);\n    pickupSystem.spawnHealRingAt(tmpDropPos);\n  }\n};\n\n/* ─── simple loading overlay ───────────────────────────────── */\nfunction createLoadingOverlay() {\n  return {\n    update: (loaded, total) => {\n      reportLoadingProgress(loaded, total);\n    },\n    remove: () => {\n      reportLoadingProgress(1, 1);\n    }\n  };\n}\n\nfunction prewarmPrograms(renderer, scene, camera) {\n  const mats = new Set();\n  scene.traverse(o => {\n    if (!o.isMesh || !o.material) return;\n    if (Array.isArray(o.material)) o.material.forEach(m => mats.add(m));\n    else mats.add(o.material);\n  });\n  const dummyGeo = new THREE.BoxGeometry(1, 1, 1);\n  const dummyScene = new THREE.Scene();\n  mats.forEach(mat => {\n    const mesh = new THREE.Mesh(dummyGeo, mat);\n    mesh.visible = true;\n    dummyScene.add(mesh);\n  });\n  renderer.compile(dummyScene, camera);\n}\n\n/* ─── preload all GLTF models up-front to avoid midgame hitches ── */\nasync function preloadModels() {\n  const overlay = createLoadingOverlay();\n  const manager = new THREE.LoadingManager();\n  manager.onProgress = (_, loaded, total) => overlay.update(loaded, total);\n  const loader = new GLTFLoader(manager);\n\n  const MODEL_PATHS = Array.from(new Set([\n    './models/player_starfighter_body_only.glb',\n    './models/player_starfighter_v2.glb',\n    './models/blue1.glb',\n    './models/dark1.glb',\n    './models/dark2.glb',\n    './models/dark3.glb',\n    './models/dark4_jet.glb',\n    './models/dark_frigate.glb',\n    './models/player_starfighter_l_wing_only.glb',\n    './models/player_starfighter_r_wing_only.glb',\n    './models/asteroid.glb',\n    './models/asteroid_passage.glb',\n    './models/asteroid_flat.glb',\n    './models/drill_tunnel.glb',\n    './models/bldg_step_up.glb',\n    './models/bldg_bridge_dome.glb',\n    './models/bldg_industry_stacks.glb',\n    './models/bldg_tower_plat.glb',\n    './models/bldg_asteroid_mine.glb',\n    './models/bldg_mine_tower_front.glb',\n    './models/bldg_mine_tower_back.glb',\n    './models/bldg_mine_tunnel.glb',\n    './models/bldg_triple_tower_basic_new.glb',\n    './models/bldg_mine_plat.glb',\n    './models/asteroid_big_bulb.glb',\n    './models/asteroid_miner.glb',\n    './models/bldg_walk.glb',\n    './models/bldg_energy_hub_basic_new.glb',\n    './models/prop_door.glb',\n    './models/station.glb',\n    './models/turret.glb',\n    './models/plat.glb',\n    './models/boss_head.glb',\n    './models/boss_eyes.glb',\n    './models/boss_left_hand.glb',\n    './models/boss_left_palm.glb',\n    './models/boss_right_hand.glb',\n    './models/boss_right_palm.glb',\n    './models/pickup_bomb.glb'\n  ]));\n\n  await Promise.all(MODEL_PATHS.map(p => loader.loadAsync(p).catch(err => {\n    console.warn('Preload failed', p, err);\n  })));\n\n  overlay.remove();\n}\n\n/* ─── load curve + spawns ───────────────────────────────────── */\nconst [curveData, spawns, bakedPathFile] = await Promise.all([\n  fetch('./scene/curve.json').then(r => r.json()),\n  fetch('./scene/spawns.json').then(r => r.json()),\n  fetch('./scene/enemy-paths-captured.json').then(r => r.json()).catch(() => ({ paths: [] }))\n]);\nconst ALL_BAKED_PATHS = bakedPathFile?.paths ?? [];\n\nconst MAX_BAKED_MATCH_DIST = 250;\nconst MAX_BAKED_MATCH_DIST_SQ = MAX_BAKED_MATCH_DIST * MAX_BAKED_MATCH_DIST;\nfunction buildBakedPathMap(spawnArray, modelPath) {\n  const map = new Map();\n  if (!Array.isArray(spawnArray) || !spawnArray.length || !ALL_BAKED_PATHS.length) return map;\n  const candidates = ALL_BAKED_PATHS.filter(p => !modelPath || p.model === modelPath);\n  const used = new Set();\n  spawnArray.forEach((spawn, idx) => {\n    let best = -1;\n    let bestDist = Infinity;\n    for (let i = 0; i < candidates.length; i++) {\n      if (used.has(i)) continue;\n      const p = candidates[i];\n      if (!p.spawn) continue;\n      const dx = (p.spawn.x ?? 0) - spawn.x;\n      const dy = (p.spawn.y ?? 0) - spawn.y;\n      const dz = (p.spawn.z ?? 0) - spawn.z;\n      const d2 = dx*dx + dy*dy + dz*dz;\n      if (d2 < bestDist) {\n        bestDist = d2;\n        best = i;\n      }\n    }\n    if (best >= 0 && bestDist <= MAX_BAKED_MATCH_DIST_SQ) {\n      used.add(best);\n      const entry = candidates[best];\n      const samples = entry.samples ?? [];\n      const duration = samples.length ? samples[samples.length - 1].t : 0;\n      map.set(idx, { samples, duration });\n    } else {\n      console.warn('No baked path for spawn', spawn, 'model', modelPath);\n    }\n  });\n  return map;\n}\n\n/* ─── renderer ──────────────────────────────────────────────── */\nfunction obtainCanvas() {\n  if (RUNNING_IN_WORKER) {\n    let c = globalThis.__OFFSCREEN_CANVAS ?? null;\n    if (!c && typeof OffscreenCanvas !== 'undefined') {\n      // fallback: create a local offscreen so we don't crash; host should still send one\n      c = new OffscreenCanvas(innerWidth || 800, innerHeight || 600);\n      globalThis.__OFFSCREEN_CANVAS = c;\n    }\n    if (c && typeof c.width === 'undefined') {\n      c.width = innerWidth || 800;\n      c.height = innerHeight || 600;\n    }\n    return c;\n  }\n  let c = document.getElementById('c');\n  if (!c || c.dataset.offscreen === '1') {\n    c = document.createElement('canvas');\n    c.id = 'c';\n    c.style.display = 'block';\n    document.body.prepend(c);\n  }\n  return c;\n}\n\nconst canvas   = obtainCanvas();\nif (!canvas) {\n  const errMsg = 'No canvas available for renderer (worker)';\n  if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n    self.postMessage({ type: 'fatal', error: { message: errMsg } });\n  }\n  throw new Error(errMsg);\n}\nif (RUNNING_IN_WORKER) {\n  if (typeof canvas.width !== 'number') {\n    canvas.width = (typeof innerWidth === 'number' ? innerWidth : 800);\n    canvas.height = (typeof innerHeight === 'number' ? innerHeight : 600);\n  }\n  if (typeof canvas.style === 'undefined') {\n    canvas.style = { width: '', height: '' };\n  }\n}\nconst renderer = new THREE.WebGLRenderer({\n  canvas,\n  antialias: false,\n  powerPreference: 'high-performance'\n});\nconst PIXEL_RATIO_CAP = 1.0;\nlet initialPixelRatio = Math.min(\n  (typeof globalThis.devicePixelRatio === 'number' ? globalThis.devicePixelRatio : 1),\n  PIXEL_RATIO_CAP\n);\nrenderer.setPixelRatio(initialPixelRatio);\nlet renderScale = 1;\nconst setRendererSize = (w, h) => {\n  const sw = Math.max(1, Math.floor(w * renderScale));\n  const sh = Math.max(1, Math.floor(h * renderScale));\n  renderer.setSize(sw, sh, !RUNNING_IN_WORKER);\n};\nsetRendererSize(innerWidth, innerHeight);\nconst lastViewportSize = { w: 0, h: 0 };\nconst readViewportSize = () => {\n  if (!canvas) return null;\n  if (RUNNING_IN_WORKER) {\n    return {\n      w: canvas.width || innerWidth || 800,\n      h: canvas.height || innerHeight || 600\n    };\n  }\n  const rect = typeof canvas.getBoundingClientRect === 'function'\n    ? canvas.getBoundingClientRect()\n    : null;\n  return {\n    w: rect?.width || canvas.clientWidth || innerWidth || 800,\n    h: rect?.height || canvas.clientHeight || innerHeight || 600\n  };\n};\nconst syncViewportSize = (force = false, sizeOverride = null) => {\n  if (RUNNING_IN_WORKER && !sizeOverride) return;\n  const size = sizeOverride ?? readViewportSize();\n  if (!size) return;\n  const rawW = size.w;\n  const rawH = size.h;\n  if (!Number.isFinite(rawW) || !Number.isFinite(rawH) || rawW < 2 || rawH < 2) return;\n  const w = Math.max(1, Math.round(rawW));\n  const h = Math.max(1, Math.round(rawH));\n  if (!force && w === lastViewportSize.w && h === lastViewportSize.h) return;\n  lastViewportSize.w = w;\n  lastViewportSize.h = h;\n  setRendererSize(w, h);\n  if (camera) {\n    const nextAspect = w / h;\n    if (Math.abs(camera.aspect - nextAspect) > 1e-4) {\n      camera.aspect = nextAspect;\n      camera.updateProjectionMatrix();\n    }\n  }\n};\nlet pendingResize = null;\nlet lastKnownCanvasSize = {\n  w: (typeof innerWidth === 'number' && innerWidth) ? innerWidth : 800,\n  h: (typeof innerHeight === 'number' && innerHeight) ? innerHeight : 600\n};\nconst getPreferredViewportSize = () => {\n  if (RUNNING_IN_WORKER) {\n    if (pendingResize?.size?.w && pendingResize?.size?.h) return pendingResize.size;\n    if (lastKnownCanvasSize?.w && lastKnownCanvasSize?.h) return lastKnownCanvasSize;\n    return {\n      w: (typeof innerWidth === 'number' && innerWidth) ? innerWidth : 800,\n      h: (typeof innerHeight === 'number' && innerHeight) ? innerHeight : 600\n    };\n  }\n  return readViewportSize();\n};\nconst forceViewportSync = () => {\n  const size = getPreferredViewportSize();\n  if (!size) return;\n  lastKnownCanvasSize = { w: size.w, h: size.h };\n  syncViewportSize(true, size);\n};\n// Start a bit below full res on likely iGPU to ease bandwidth\n{\n  const gl = renderer.getContext();\n  const info = gl.getExtension('WEBGL_debug_renderer_info');\n  const rendererStr = info ? gl.getParameter(info.UNMASKED_RENDERER_WEBGL) || '' : '';\n  if (/intel/i.test(rendererStr)) {\n    laptopPreset = true;\n    renderScale = 0.65; // render a bit below full res on iGPU\n    allowFpsToggle = false; // force cap on laptop preset\n    fpsCapEnabled = true;\n    initialPixelRatio = Math.min(initialPixelRatio, 0.55);\n    renderer.setPixelRatio(initialPixelRatio);\n    setRendererSize(innerWidth, innerHeight);\n    console.warn('[preset] laptop preset applied (Intel GPU detected)');\n  }\n}\n\n// --- color output (safe across Three versions) ---\nif ('outputColorSpace' in renderer) {\n  renderer.outputColorSpace = THREE.SRGBColorSpace;\n}\n\n\nfunction syncRendererToCanvas() {\n  if (!canvas) return;\n  syncViewportSize(true);\n}\nif (!RUNNING_IN_WORKER) {\n  window.addEventListener('resize', syncRendererToCanvas);\n  if (typeof ResizeObserver !== 'undefined') {\n    const ro = new ResizeObserver(syncRendererToCanvas);\n    ro.observe(canvas);\n  }\n  requestAnimationFrame(syncRendererToCanvas);\n}\n\n/* ─── scene & lights ────────────────────────────────────────── */\nconst scene = new THREE.Scene();\nscene.fog   = new THREE.FogExp2(0x000000, 0.0002);\n\n/* ─── skybox (single equirectangular image) ─────────────────── */\n/* ─── skybox (single equirectangular image) ─────────────────── */\n{\n  // Change this to whatever you want:\n  const SKY_YAW = THREE.MathUtils.degToRad(180); // rotate left/right (around Y)\n\n  const pmremGen = new THREE.PMREMGenerator(renderer);\n  pmremGen.compileEquirectangularShader();\n\n  const applySkyTex = (tex) => {\n    if (!tex) return;\n    console.log('[sky] applying sky texture');\n    // correct color space (safe across Three versions)\n    if ('colorSpace' in tex) {\n      tex.colorSpace = THREE.SRGBColorSpace;\n    }\n\n    tex.mapping = THREE.EquirectangularReflectionMapping;\n    scene.background = tex;\n\n    const envRT = pmremGen.fromEquirectangular(tex);\n    scene.environment = envRT.texture;\n\n    if (scene.backgroundRotation) scene.backgroundRotation.set(0, SKY_YAW, 0);\n    if (scene.environmentRotation) scene.environmentRotation.set(0, SKY_YAW, 0);\n\n    pmremGen.dispose();\n  };\n\n  const skyPath = './textures/sky/space_4k.jpg';\n  if (RUNNING_IN_WORKER && typeof fetch === 'function' && typeof createImageBitmap === 'function') {\n    console.log('[sky] worker fetch+bitmap path', skyPath);\n    fetch(skyPath)\n      .then(r => r.blob())\n      .then(blob => createImageBitmap(blob, { imageOrientation: 'flipY' }))\n      .then(img => {\n        const tex = new THREE.Texture(img);\n        tex.needsUpdate = true;\n        applySkyTex(tex);\n      })\n      .catch(err => {\n        console.warn('Sky fetch->bitmap failed, falling back to TextureLoader', err);\n        new THREE.TextureLoader().load(skyPath, applySkyTex, undefined, e => console.warn('Sky load failed', e));\n      });\n  } else {\n    console.log('[sky] TextureLoader path', skyPath);\n    new THREE.TextureLoader().load(skyPath, applySkyTex, undefined, e => console.warn('Sky load failed', e));\n  }\n}\n\n\n\nscene.add(new THREE.HemisphereLight(0x88aaff, 0x080820, 0.6));\nconst sun = new THREE.DirectionalLight(0xffffff, 1);\nsun.position.set(60, 80, 40);\nscene.add(sun);\n\n/* ─── starfield ─────────────────────────────────────────────── */\naddStarfield(scene);\n\n/* ─── camera rig ────────────────────────────────────────────── */\nconst camera   = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 4000);\nforceViewportSync();\nconst railNode = new THREE.Object3D();\nconst steerNode= new THREE.Object3D();\nrailNode.add(steerNode);\nsteerNode.add(camera);\ncamera.position.set(0, 2, -10);\nscene.add(railNode);\n\n/* ─── rail helper ───────────────────────────────────────────── */\nconst railCurve = new THREE.CatmullRomCurve3(\n  curveData.points.map(p => new THREE.Vector3(p.x, p.y, p.z)),\n  curveData.closed ?? false, 'catmullrom', curveData.tension ?? 0.5\n);\nscene.add(new THREE.Line(\n  new THREE.BufferGeometry().setFromPoints(railCurve.getPoints(400)),\n  new THREE.LineBasicMaterial({ color: 0xffffff })\n));\n\n  /* ─── preload all models before instantiating game objects ─── */\n  await preloadModels();\n  forceViewportSync();\n  renderer.render(scene, camera);\n\n\n\n/* ─── asteroids ─────────────────────────────────────────────── */\nconst { group: asteroidGroup, update: updateAsteroids } =\n      await initAsteroids(scene, spawns.asteroid ?? [], './models/asteroid.glb', {\n        materialMode: 'standard'\n      });\nif (EDITOR_MODE && asteroidGroup) {\n  const asteroidSpawns = Array.isArray(spawns.asteroid) ? spawns.asteroid : [];\n  asteroidGroup.children.forEach((rock, idx) => {\n    if (!rock) return;\n    registerEditorObject(rock, { group: 'asteroid', index: idx, ref: asteroidSpawns[idx] });\n  });\n}\n\n/* ─── asteroid passage set piece (solid with tunnel) ───────── */\nconst passageDefs = Array.isArray(spawns.asteroidPassage)\n  ? spawns.asteroidPassage\n  : [spawns.asteroidPassage ?? { x: 0, y: 0, z: -320, scale: 60 }];\nconst asteroidPassages = await Promise.all(passageDefs.map(cfg =>\n  initAsteroidPassage(scene, {\n    position : { x: cfg.x ?? 0, y: cfg.y ?? 0, z: cfg.z ?? 0 },\n    rotation : parseRotation(cfg),\n    scale    : cfg.scale ?? 30,\n    materialMode: 'lambert',\n    cellSize: cfg.cellSize ?? 'auto'\n  })\n));\nconst primaryPassage = asteroidPassages[0] ?? null;\nif (EDITOR_MODE) {\n  asteroidPassages.forEach((piece, idx) => {\n    const mesh = piece?.getMesh?.();\n    if (mesh) registerEditorObject(mesh, { group: 'asteroidPassage', index: idx, ref: passageDefs[idx] });\n  });\n}\n\n/* ─── additional static hazards ────────────────────────────── */\nconst drillDefs = Array.isArray(spawns.drillTunnel)\n  ? spawns.drillTunnel\n  : [spawns.drillTunnel ?? { x: 0, y: 12, z: -180, scale: 30 }];\nconst drillTunnel = await Promise.all(drillDefs.map(cfg =>\n  initAsteroidPassage(scene, {\n    path     : './models/drill_tunnel.glb',\n    position : { x: cfg.x ?? 0, y: cfg.y ?? 0, z: cfg.z ?? 0 },\n    rotation : parseRotation(cfg),\n    scale    : cfg.scale ?? 30,\n    materialMode: 'lambert',\n    cellSize: cfg.cellSize ?? 'auto'\n  })\n));\nif (EDITOR_MODE) {\n  drillTunnel.forEach((piece, idx) => {\n    const mesh = piece?.getMesh?.();\n    if (mesh) registerEditorObject(mesh, { group: 'drillTunnel', index: idx, ref: drillDefs[idx] });\n  });\n}\n\nconst flatDefs = Array.isArray(spawns.asteroidFlat)\n  ? spawns.asteroidFlat\n  : [spawns.asteroidFlat ?? { x: 0, y: -18, z: -180, scale: 26 }];\nconst flatAsteroid = await Promise.all(flatDefs.map(cfg =>\n  (async () => {\n    const piece = await initAsteroidPassage(scene, {\n      path     : './models/asteroid_flat.glb',\n      position : { x: cfg.x ?? 0, y: cfg.y ?? 0, z: cfg.z ?? 0 },\n      rotation : parseRotation(cfg),\n      scale    : cfg.scale ?? 26,\n      materialMode: 'lambert',\n      cellSize: cfg.cellSize ?? 'auto'\n    });\n    const mesh = piece?.getMesh?.();\n    if (mesh?.userData && typeof cfg.scale === 'number' && cfg.scale >= 150) {\n      mesh.userData.laserCollisionEnabled = false;\n      mesh.userData.cullBehindZFactor = 0.5;\n    }\n        if (\n      mesh?.userData &&\n      Math.abs((cfg.x ?? 0) - 0) < 1e-3 &&\n      Math.abs((cfg.y ?? 0) - (-139)) < 1e-3 &&\n      Math.abs((cfg.z ?? 0) - (-5990)) < 1e-3\n    ) {\n      mesh.userData.activateDist = 800;\n    }\n    return piece;\n  })()\n));\nif (EDITOR_MODE) {\n  flatAsteroid.forEach((piece, idx) => {\n    const mesh = piece?.getMesh?.();\n    if (mesh) registerEditorObject(mesh, { group: 'asteroidFlat', index: idx, ref: flatDefs[idx] });\n  });\n}\n\nconst gateBox = new THREE.Box3();\nconst gateCenter = new THREE.Vector3();\nconst gateSize = new THREE.Vector3();\nfunction applyLaserGate(mesh) {\n  if (!mesh) return;\n  mesh.updateWorldMatrix(true, true);\n  gateBox.setFromObject(mesh);\n  if (gateBox.isEmpty()) return;\n  gateBox.getCenter(gateCenter);\n  gateBox.getSize(gateSize);\n  const radius = Math.max(gateSize.x, gateSize.z) * 0.5;\n  mesh.userData.gateCylinder = {\n    x: gateCenter.x,\n    z: gateCenter.z,\n    radius,\n    minY: gateBox.min.y,\n    maxY: gateBox.max.y\n  };\n}\n\n/* ─── building set pieces (colliders like other static hazards) ───────── */\nconst BUILDING_MODELS = {\n  step_up: './models/bldg_step_up.glb',\n  bridge_dome: './models/bldg_bridge_dome.glb',\n  industry_stacks: './models/bldg_industry_stacks.glb',\n  tower_plat: './models/bldg_tower_plat.glb',\n  asteroid_mine: './models/bldg_asteroid_mine.glb',\n  mine_tower_front: './models/bldg_mine_tower_front.glb',\n  mine_tower_back: './models/bldg_mine_tower_back.glb',\n  mine_tunnel: './models/bldg_mine_tunnel.glb',\n  triple_tower: './models/bldg_triple_tower_basic_new.glb',\n  mine_plat: './models/bldg_mine_plat.glb',\n  asteroid_big_bulb: './models/asteroid_big_bulb.glb',\n  asteroid_miner: './models/asteroid_miner.glb',\n  bldg_walk: './models/bldg_walk.glb',\n  energy_hub: './models/bldg_energy_hub_basic_new.glb',\n  prop_door: './models/prop_door.glb'\n};\nconst buildingCfgs = Array.isArray(spawns.buildings) ? spawns.buildings : [];\nconst buildingPieces = await Promise.all(\n  buildingCfgs.map(async cfg => {\n    const path = cfg.path\n      ?? BUILDING_MODELS[cfg.type]\n      ?? BUILDING_MODELS[cfg.name]\n      ?? BUILDING_MODELS[cfg.id]\n      ?? './models/bldg_step_up.glb';\n    const piece = await initAsteroidPassage(scene, {\n      path,\n      position : { x: cfg.x ?? 0, y: cfg.y ?? 0, z: cfg.z ?? 0 },\n      rotation : parseRotation(cfg),\n      scale    : cfg.scale ?? 30,\n      visible  : cfg.visible ?? true,\n      materialMode: 'lambert',\n      cellSize: cfg.cellSize ?? 'auto'\n    });\n    const mesh = piece?.getMesh?.();\n    if (mesh?.userData) {\n      mesh.userData.modelPath = path;\n      if (Number.isFinite(cfg.activateDist)) {\n        mesh.userData.activateDist = cfg.activateDist;\n      } else if (Number.isFinite(cfg.renderDist)) {\n        mesh.userData.activateDist = cfg.renderDist;\n      }\n      if (path.endsWith('bldg_asteroid_mine.glb')) {\n        mesh.userData.cullBehindZFactor = 4;\n      }\n      if (path.endsWith('asteroid_big_bulb.glb')) {\n        mesh.userData.cullBehindZFactor = 4;\n      }\n      if (path.endsWith('bldg_walk.glb')) {\n        mesh.userData.cullBehindZFactor = 4;\n      }\n      if (path.endsWith('bldg_energy_hub_basic_new.glb')) {\n        mesh.userData.cullBehindZFactor = 3;\n        mesh.userData.activateDist = 800;\n      }\n      if (path.endsWith('bldg_mine_tunnel.glb')) {\n        mesh.userData.cullBehindZFactor = 3;\n        mesh.userData.skipInsideCheck = true;\n      }\n      if (path.endsWith('bldg_mine_plat.glb')) {\n        mesh.userData.cullBehindZFactor = 1.25;\n      }\n      if (path.endsWith('bldg_mine_tower_front.glb')) {\n        mesh.userData.cullBehindZFactor = 0.5;\n      }\n      if (path.endsWith('bldg_mine_tower_back.glb')) {\n        mesh.userData.cullBehindZFactor = 2.25;\n      }\n      if (path.endsWith('bldg_triple_tower_basic_new.glb')) {\n        mesh.userData.cullBehindZFactor = 1.25;\n      }\n      if (path.endsWith('prop_door.glb')) {\n        const propHp = Number.isFinite(cfg.hp) ? cfg.hp : 5;\n        mesh.userData.destructible = { hp: propHp };\n        mesh.userData.blink = () => {\n          const blinkDurationMs = 150;\n          if (!mesh.userData._blinkMats) {\n            const mats = [];\n            mesh.traverse(child => {\n              if (!child.isMesh || !child.material) return;\n              const list = Array.isArray(child.material) ? child.material : [child.material];\n              list.forEach(mat => {\n                if (!mat || !mat.emissive) return;\n                if (!mat.userData) mat.userData = {};\n                if (!mat.userData._origEmissive) mat.userData._origEmissive = mat.emissive.clone();\n                mats.push(mat);\n              });\n            });\n            mesh.userData._blinkMats = mats;\n          }\n          const mats = mesh.userData._blinkMats;\n          mats.forEach(mat => mat.emissive.setRGB(1, 0, 0));\n          if (mesh.userData._blinkTimer) clearTimeout(mesh.userData._blinkTimer);\n          mesh.userData._blinkTimer = setTimeout(() => {\n            mats.forEach(mat => {\n              if (mat.userData?._origEmissive) mat.emissive.copy(mat.userData._origEmissive);\n            });\n            mesh.userData._blinkTimer = null;\n          }, blinkDurationMs);\n        };\n        mesh.userData.onDestroyed = (pos) => {\n          if (pos) explosions.spawn(pos);\n        };\n      }\n\n    }\n    if (mesh?.userData) {\n      applyLaserGate(mesh);\n    }\n    return piece;\n  })\n);\nif (EDITOR_MODE) {\n  buildingPieces.forEach((piece, idx) => {\n    const mesh = piece?.getMesh?.();\n    if (mesh) registerEditorObject(mesh, { group: 'buildings', index: idx, ref: buildingCfgs[idx] });\n  });\n}\n\n[...asteroidPassages, ...drillTunnel, ...flatAsteroid].forEach(p => {\n  const mesh = p?.getMesh?.();\n  if (mesh?.userData) applyLaserGate(mesh);\n});\n\n/* toggle to temporarily disable big set pieces/boss for perf testing */\n\nconst ENABLE_SET_PIECES = true;\nconst ENABLE_PLAYER_HAZARD_COLLISIONS = true; // player damage vs set pieces\nconst ENABLE_LASER_HAZARD_COLLISIONS  = true; // player/enemy lasers vs set pieces\nconst ENABLE_ENEMY_HAZARD_COLLISIONS  = false ; // enemy vs set-piece hazards\nconst ENABLE_BAKED_ENEMY_PATHS       = true; // master toggle for baked enemy paths\n\nconst staticHazardsRaw = [\n  ...drillTunnel,\n  ...flatAsteroid,\n  ...asteroidPassages.slice(1), // additional passages beyond the primary\n  ...buildingPieces\n].filter(Boolean);\nconst staticHazards = ENABLE_SET_PIECES ? staticHazardsRaw : [];\nconst hazardColliders = ENABLE_SET_PIECES\n  ? [primaryPassage, ...staticHazards].map(h => h?.collider).filter(Boolean)\n  : [];\nconst allHazards = ENABLE_SET_PIECES ? [primaryPassage, ...staticHazards] : [];\nconst hazardEntries = allHazards;\n\nconst HAZARD_CULL_Z = 60;\n\n/* ─── explosion pool for defeated enemies ───────────────────── */\nconst explosions = createExplosionPool(scene, { poolSize: 30, baseSize: 6 });\nconst largeExplosions = createExplosionPool(scene, { poolSize: 16, baseSize: 18 });\nconst wingExplosions = createExplosionPool(scene, { poolSize: 8, baseSize: 4 });\nconst asteroidExplosions = createExplosionPool(scene, {\n  poolSize: 20,\n  baseSize: 6,\n  colors: [0x5b4a3c] // dark gray-brown for rocks only\n});\nconst tmpExplosionPos = new THREE.Vector3();\nconst stationExplosionOffsets = [\n  new THREE.Vector3(12, 6, -4),\n  new THREE.Vector3(-10, -6, 8),\n  new THREE.Vector3(6, -4, -10)\n];\nconst shouldUseLargeExplosion = (ship) => Boolean(\n  ship?.userData?.largeExplosion || ship?.userData?.androssPart\n);\nconst spawnExplosionForShip = (pos, ship) => {\n  if (!pos && !ship) return;\n  const resolved = ship?.getWorldPosition\n    ? ship.getWorldPosition(tmpExplosionPos)\n    : pos;\n  if (!resolved) return;\n  if (shouldUseLargeExplosion(ship)) {\n    largeExplosions.spawn(resolved);\n  } else {\n    explosions.spawn(resolved);\n  }\n};\n\n/* ─── player fighter ───────────────────────────────────────── */\nconst { mesh: playerShip,\n        update: updateShipAttitude,\n        radius: shipRadius,\n        startRoll,\n        isRolling,\n        getRollDir,\n        updateTrail,\n        setEngineGlowScale } =             // NEW\n      await initPlayerShip(steerNode, {\n        scene,\n        explosionPool: wingExplosions,\n        materialMode: CHARACTER_MATERIAL_MODE\n      });\n\n/* ─── spinning platform turrets (plural) ──────────────── */\nconst platSys = await Promise.all(\n  (spawns.platform ?? []).map(pt =>\n    initPlatformSystem(scene, {\n      playerObj : playerShip,\n      camera    : camera,\n      canFire   : canEnemyFire,\n      railCurve,\n      spawn     : pt,                 // one turret per entry\n      materialMode: CHARACTER_MATERIAL_MODE\n    })\n  )\n);\n\nlet stationTurretSystems = [];\nlet stationSystem;\nconst STATION_EXPLOSION_SPACING_MS = 240;\nconst spawnStationBossExplosions = () => {\n  const stationMesh = stationSystem?.getMesh?.();\n  if (!stationMesh) return;\n  const base = stationMesh.getWorldPosition(new THREE.Vector3());\n  stationExplosionOffsets.forEach((offset, idx) => {\n    const pos = base.clone().add(offset);\n    const fire = () => largeExplosions.spawn(pos);\n    if (idx === 0) {\n      fire();\n    } else {\n      setTimeout(fire, STATION_EXPLOSION_SPACING_MS * idx);\n    }\n  });\n};\nstationSystem = await initStationBoss(scene, {\n  playerObj: playerShip,\n  camera,\n  onDestroyed: () => {\n    stationBossDestroyed = true;\n    recordEnemyDestroyed();\n    addScore(1000);\n    spawnStationBossExplosions();\n    stationTurretSystems.forEach(sys => {\n      const destroyed = sys.destroy?.();\n      if (destroyed) {\n        addScore(100);\n        recordEnemyDestroyed();\n      }\n    });\n  }\n});\nif (!ENABLE_SET_PIECES) {\n  const sm = stationSystem.getMesh();\n  if (sm) {\n    sm.visible = false;\n    sm.userData.dead = true;\n  }\n}\n\n/* ── set-piece activation (passage, drill, flat, station) ── */\nconst ACTIVATE_DIST = 600;  // show when within this many units (Z) of player\nconst setPieces = [];\nfunction prepSetPiece(mesh) {\n  if (!mesh) return null;\n  mesh.traverse(o => {\n    if (o.isMesh && o.material) {\n      o.material.transparent = false;\n      if (o.material.opacity !== undefined) o.material.opacity = 1;\n    }\n  });\n  mesh.visible = false;\n  return { mesh, active: false };\n}\nsetPieces.push(\n  ...asteroidPassages.map(p => prepSetPiece(p?.getMesh ? p.getMesh() : null)).filter(Boolean),\n  ...drillTunnel.map(p => prepSetPiece(p?.getMesh ? p.getMesh() : null)).filter(Boolean),\n  ...flatAsteroid.map(p => prepSetPiece(p?.getMesh ? p.getMesh() : null)).filter(Boolean),\n  prepSetPiece(stationSystem.getMesh ? stationSystem.getMesh() : null),\n  ...buildingPieces.map(b => prepSetPiece(b?.getMesh ? b.getMesh() : null)).filter(Boolean)\n);\nconst tmpSetpiecePlayer = new THREE.Vector3();\nfunction updateSetPieces() {\n  if (!ENABLE_SET_PIECES) return;\n  playerShip.getWorldPosition(tmpSetpiecePlayer);\n  setPieces.forEach(p => {\n    if (!p) return;\n    const m = p.mesh;\n    if (m.userData?.dead) { m.visible = false; p.active = false; return; }\n    const dz = Math.abs(m.position.z - tmpSetpiecePlayer.z);\n    const activateDist = m.userData?.activateDist ?? ACTIVATE_DIST;\n    const shouldBeVisible = dz < activateDist;\n      if (shouldBeVisible === p.active) return; // no change needed\n    p.active = shouldBeVisible;\n    m.visible = shouldBeVisible;\n  });\n}\nconst sharedBoltPool = createBoltPool(scene, { smallCount: 300, bigCount: 60 });\nscene.userData.boltPool = sharedBoltPool;\nsharedBoltPool.prewarm && sharedBoltPool.prewarm(renderer, camera);\n\nstationTurretSystems = await Promise.all(\n  (spawns.stationTurret ?? []).map(cfg =>\n    initStationTurretSystem(scene, {\n      playerObj: playerShip,\n      stationMesh: stationSystem.getMesh(),\n      camera,\n      spawn: cfg,\n      boltPool: sharedBoltPool,\n      canFire: canEnemyFire,\n      materialMode: CHARACTER_MATERIAL_MODE\n    })\n  )\n);\n\n\n/* bossSystem init */\nlet bossSystem;\nbossSystem = await initBossSystem(scene,{\n  spawn       : spawns.boss,\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  onDestroyed : (info = {}) => {\n    if (!info?.noScore) {\n      recordEnemyDestroyed();\n      addScore(500);\n    }\n    const bossMesh = bossSystem?.getMesh?.();\n    if (bossMesh) {\n      bossMesh.getWorldPosition(tmpExplosionPos);\n      largeExplosions.spawn(tmpExplosionPos);\n    }\n  },\n  autoDespawnZ: -3205,\n  canFire     : canEnemyFire,\n  materialMode: CHARACTER_MATERIAL_MODE\n}, sharedBoltPool);\nbossSystem.prewarm && bossSystem.prewarm(renderer, camera);\n\nconst tmpDeathPos = new THREE.Vector3();\nfunction triggerMissionComplete() {\n  if (levelCompleteActive) return;\n  levelCompleteActive = true;\n  allowPause = false;\n  pauseActive = false;\n  clearInputState();\n  lasers?.clearInput?.();\n  const missionTitle = stationBossDestroyed && escortSurvived\n    ? 'MISSION COMPLETE'\n    : 'MISSION ACCOMPLISHED';\n  const finishMission = () => {\n    missionCompleteTimer = null;\n    stats.endMs = nowMs();\n    const statsSnapshot = snapshotStats(stats.endMs);\n    const statsLines = buildStatsLines(statsSnapshot);\n    const score = getScore();\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({\n        type: 'missionComplete',\n        payload: {\n          score,\n          stationBossDestroyed,\n          escortSurvived,\n          stats: statsSnapshot\n        }\n      });\n    } else {\n      const badgeSources = [\n        './textures/red.png',\n        escortSurvived ? './textures/green.png' : './textures/green-gray.png',\n        './textures/yellow.png'\n      ];\n      showEndScreen({\n        titleText: missionTitle,\n        scoreText: `SCORE ${score}`,\n        statsLines,\n        showRestart: true,\n        badgeSources\n      });\n    }\n  };\n  if (MISSION_COMPLETE_DELAY_MS > 0) {\n    missionCompleteTimer = setTimeout(finishMission, MISSION_COMPLETE_DELAY_MS);\n  } else {\n    finishMission();\n  }\n}\n\n/* new end boss (head + hands) */\nconst androssBoss = await initBossAndross(scene, {\n  playerObj: playerShip,\n  boltPool: sharedBoltPool,\n  railSpeed: 35,\n  canFire: canEnemyFire,\n  onHeadDestroyed: triggerMissionComplete,\n  handCleanupDelay: 350,\n  materialMode: CHARACTER_MATERIAL_MODE,\n  onDialogue: (payload) => {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({ type: 'dialogue', payload });\n    } else {\n      handleDialoguePayload(payload);\n    }\n  },\n  summonWave: () => {\n    // optional: trigger a small wave later using existing enemy systems\n  }\n  , explosionPool: explosions\n});\n{\n  const tmpPos = new THREE.Vector3();\n  const tmpDir = new THREE.Vector3();\n  const prevParts = [];\n  const prevLayers = [];\n  const prevCulls = [];\n  const prevBeams = [];\n  const prevLightLayers = [];\n  const PREWARM_LAYER = 3;\n  const rig = androssBoss?.getRig?.();\n  if (rig && renderer && camera) {\n    const prevRigVis = rig.visible;\n    const prevRigPos = rig.position.clone();\n    const prevRigQuat = rig.quaternion.clone();\n    rig.visible = true;\n\n    const head = androssBoss.getHead?.();\n    const hands = androssBoss.getHands?.() ?? [];\n    const parts = [\n      head?.getMesh?.(),\n      head?.getEyes?.(),\n      hands[0]?.getMesh?.(),\n      hands[0]?.getPalm?.(),\n      hands[1]?.getMesh?.(),\n      hands[1]?.getPalm?.()\n    ].filter(Boolean);\n    parts.forEach(p => {\n      prevParts.push([p, p.visible]);\n      p.visible = true;\n    });\n\n    rig.traverse(o => {\n      prevLayers.push([o, o.layers.mask]);\n      o.layers.set(PREWARM_LAYER);\n      if (o.isMesh) {\n        prevCulls.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n    const beams = head?.getActiveBeams?.() ?? [];\n    if (beams.length) {\n      camera.getWorldPosition(tmpPos);\n      camera.getWorldDirection(tmpDir);\n      beams.forEach(beam => {\n        if (!beam) return;\n        prevBeams.push([\n          beam,\n          beam.visible,\n          beam.position.clone(),\n          beam.quaternion.clone(),\n          beam.frustumCulled,\n          beam.layers.mask\n        ]);\n        beam.visible = true;\n        beam.frustumCulled = false;\n        beam.layers.set(PREWARM_LAYER);\n        beam.position.copy(tmpPos).addScaledVector(tmpDir, 30);\n        beam.quaternion.copy(camera.quaternion);\n      });\n    }\n    scene.traverse(o => {\n      if (o.isLight) {\n        prevLightLayers.push([o, o.layers.mask]);\n        o.layers.enable(PREWARM_LAYER);\n      }\n    });\n\n    camera.getWorldPosition(tmpPos);\n    camera.getWorldDirection(tmpDir);\n    rig.position.copy(tmpPos).addScaledVector(tmpDir, 120);\n    rig.quaternion.copy(camera.quaternion);\n\n    const prevTarget = renderer.getRenderTarget();\n    const prevCameraMask = camera.layers.mask;\n    const rt = new THREE.WebGLRenderTarget(16, 16);\n    if ('outputColorSpace' in renderer && renderer.outputColorSpace) {\n      rt.texture.colorSpace = renderer.outputColorSpace;\n    }\n    camera.layers.set(PREWARM_LAYER);\n    renderer.setRenderTarget(rt);\n    renderer.render(scene, camera);\n    androssBoss.getMissiles?.()?.prewarm?.(renderer, camera, { layer: PREWARM_LAYER });\n    renderer.setRenderTarget(prevTarget);\n    rt.dispose();\n    camera.layers.mask = prevCameraMask;\n\n    rig.visible = prevRigVis;\n    rig.position.copy(prevRigPos);\n    rig.quaternion.copy(prevRigQuat);\n    prevParts.forEach(([p, vis]) => { p.visible = vis; });\n    prevCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    prevLayers.forEach(([o, mask]) => { o.layers.mask = mask; });\n    prevLightLayers.forEach(([o, mask]) => { o.layers.mask = mask; });\n    prevBeams.forEach(([beam, vis, pos, quat, culled, mask]) => {\n      beam.visible = vis;\n      beam.position.copy(pos);\n      beam.quaternion.copy(quat);\n      beam.frustumCulled = culled;\n      beam.layers.mask = mask;\n    });\n  }\n}\nlet androssActive = false;\nconst ANDROSS_SPAWN_Z = spawns.andross?.z ?? -8500;\n\nfunction triggerGameOver() {\n  if (gameOverActive) return;\n  gameOverActive = true;\n  playerAlive = false;\n  allowPause = false;\n  pauseActive = false;\n  gameOverStartMs = (typeof performance !== 'undefined' && performance.now)\n    ? performance.now()\n    : Date.now();\n  clearInputState();\n  lasers?.clearInput?.();\n  if (playerShip?.visible) {\n    playerShip.getWorldPosition(tmpDeathPos);\n    explosions?.spawn?.(tmpDeathPos);\n  }\n  if (playerShip) {\n    playerShip.visible = false;\n    playerShip.userData.dead = true;\n  }\n  stats.endMs = nowMs();\n  const statsSnapshot = snapshotStats(stats.endMs);\n  const statsLines = buildStatsLines(statsSnapshot);\n  if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n    self.postMessage({ type: 'gameOver', payload: { score: getScore(), stats: statsSnapshot } });\n  } else {\n    showEndScreen({ titleText: 'GAME OVER', scoreText: `SCORE ${getScore()}`, statsLines, showRestart: true });\n  }\n}\n\n/* ─── laser system ─────────────────────────────────────────── */\n\nlasers = createLaserSystem(scene,{\n  bossMesh   : bossSystem.getMesh(),\n  damageBoss : bossSystem.damageBoss,\n  stationMesh   : ENABLE_SET_PIECES ? stationSystem.getMesh() : null,\n  damageStation : ENABLE_SET_PIECES ? stationSystem.damageStation : (()=>{}),\n  bossHitR2  : bossSystem.getRadiusSq(),\n  androssParts : androssBoss?.getEnemyParts,\n\n    /* give the laser module a way to fetch every active enemy */\n  getEnemies : gatherEnemies,\n  camera      : camera,           // ← pass the main Three.js camera\n  passageColliders : hazardColliders,\n  onEnemyKilled : (pos, ship) => {\n    recordEnemyDestroyed();\n    spawnExplosionForShip(pos, ship);\n    maybeDropHealRing(ship, pos);\n  },\n  onShotFired: () => recordShotFired(),\n  onShotHit: recordShotHit,\n  onAsteroidDestroyed: (pos) => {\n    pos && asteroidExplosions.spawn(pos);\n  }\n\n});\nlasers.prewarm && lasers.prewarm(renderer, camera);\nlasers.prewarmDual && lasers.prewarmDual(playerShip);\nsetBombs(bombCount);\nif (playerShip?.userData) {\n  playerShip.userData.onWingLost = () => {\n    if (lasers.resetUpgrades) {\n      lasers.resetUpgrades();\n    } else {\n      lasers.enableDual(false);\n      lasers.enableBlue && lasers.enableBlue(false);\n    }\n  };\n}\n\nconst handlePlayerHit = (hitPoint = null) => {\n  if (!playerAlive || gameOverActive || levelCompleteActive) return;\n  let wingHit = null;\n  if (hitPoint && playerShip?.userData?.applyWingDamage) {\n    wingHit = playerShip.userData.applyWingDamage(hitPoint);\n  }\n  if (playerShip?.userData) {\n    const hitAt = nowMs();\n    playerShip.userData.lastHitAt = hitAt;\n    if (hitPoint) {\n      if (!playerShip.userData.lastHitPoint) {\n        playerShip.userData.lastHitPoint = new THREE.Vector3();\n      }\n      playerShip.userData.lastHitPoint.copy(hitPoint);\n    }\n    if (wingHit) {\n      playerShip.userData.lastWingHit = wingHit;\n      playerShip.userData.lastWingHitAt = hitAt;\n    }\n  }\n  const heartsLeft = loseHeart();\n  playerShip.userData?.blink?.();\n  if (heartsLeft <= 0) triggerGameOver();\n};\nif (playerShip?.userData) {\n  playerShip.userData.onHit = handlePlayerHit;\n  playerShip.userData.dead = false;\n}\n\npickupSystem = await initPickupSystem(scene, {\n  spawnArray : spawns.pickupDual ?? [],   // points read from spawns.json\n  blueSpawnArray : spawns.pickupDualBlue ?? [],\n  ringSpawnArray : spawns.pickupHealRing ?? [],\n  wingRepairSpawnArray : spawns.pickupWingRepair ?? [],\n  bombSpawnArray : spawns.pickupBomb ?? [],\n  playerObj  : playerShip,\n  lasers,\n  onBombPickup : (count = 1) => {\n    if (!Number.isFinite(count)) return;\n    bombCount = Math.max(0, bombCount + count);\n    setBombs(bombCount);\n  },\n  onRingCollected : (count = 1) => {\n    recordRingCollected(count);\n  }\n});\n\n\n/* ─── collision system ─────────────────────────────────────── */\n\n\nconst collisions = createCollisionSystem({\n  asteroidGroup,\n  laserSystem : lasers,\n    stationMesh: ENABLE_SET_PIECES ? stationSystem.getMesh() : null,              // new\n  damageStation: ENABLE_SET_PIECES ? stationSystem.damageStation : (()=>{}),        // new\n  enemyShips  : gatherEnemies,\n\n  enemyLasers : gatherEnemyLasers,         // NEW uses scratch list\n  androssBeams: () => androssBoss?.getHead?.().getActiveBeams?.() ?? [],\n\n  bossMesh    : bossSystem.getMesh(),\n  damageBoss  : bossSystem.damageBoss,\n  playerMesh  : playerShip,\n  playerRadius: shipRadius,\n  asteroidPassage: ENABLE_SET_PIECES ? primaryPassage : null,\n  staticHazards,\n  hazardPlayerCollisionEnabled: ENABLE_PLAYER_HAZARD_COLLISIONS,\n  hazardLaserCollisionEnabled : ENABLE_LASER_HAZARD_COLLISIONS,\n  hazardEnemyCollisionEnabled : ENABLE_ENEMY_HAZARD_COLLISIONS,\n  asteroidHazardCollisionEnabled: false,\n  isRolling   : isRolling,\n  onLaserHit  : () => addScore(10),\n  onPlayerHit : handlePlayerHit,\n  onEnemyDestroyed : (pos, ship) => {\n    recordEnemyDestroyed();\n    const scoreValue = ship?.userData?.scoreValue ?? 100;\n    addScore(scoreValue);\n    spawnExplosionForShip(pos, ship);\n    maybeDropHealRing(ship, pos);\n  },\n  onEnemyNeutralized : (pos, ship) => { spawnExplosionForShip(pos, ship); },\n  onShotHit : recordShotHit,\n  onAsteroidDestroyed : (pos) => {\n    pos && asteroidExplosions.spawn(pos);\n  }\n\n});\n\n/* ─── input (steering + dedicated roll/bank keys) ───────────────────── */\nconst keys        = Object.create(null);   // live key-state map\nlet shiftHeld = false;\nlet steerDx = 0;\nlet steerDy = 0;\nconst STEER_SMOOTH = 12;\nconst DEFAULT_SIDE_BANK_DIR = -1;\nlet lastStrafeDir = DEFAULT_SIDE_BANK_DIR;\n\n/* helper so we change the codes only in one place */\nconst LEFT   = 'KeyA';\nconst RIGHT  = 'KeyD';\nconst UP     = 'KeyW';\nconst DOWN   = 'KeyS';\nconst ROLL_LEFT = 'KeyQ';\nconst ROLL_RIGHT = 'KeyE';\n\nconst clearInputState = () => {\n  Object.keys(keys).forEach((k) => { keys[k] = false; });\n  shiftHeld = false;\n  lastStrafeDir = DEFAULT_SIDE_BANK_DIR;\n};\n\nconst setPauseActive = (next) => {\n  const target = Boolean(next);\n  if (pauseActive === target) return;\n  pauseActive = target;\n  if (pauseActive) {\n    showPauseMenu('PAUSED');\n  } else {\n    hidePauseMenu();\n  }\n  clearInputState();\n};\n\n/* FPS cap toggle (default off) */\nconst FPS_TOGGLE_KEY = null;\nconst DRS_TOGGLE_KEY = null;\nconst DEFAULT_TARGET_FPS = 60;\nconst MAX_FRAME_DT = 0.1; // seconds\nconst MAX_SIM_STEPS = 5;\nconst MAX_ACCUMULATED_DT = MAX_FRAME_DT;\nlet fpsCapEnabled = true;\nlet targetFps = DEFAULT_TARGET_FPS;\nlet lastFrameMs = performance.now();\nconst frameIntervalMs = () => 1000 / targetFps;\nconst DRS_MIN_PIXEL_RATIO = 0.5;  // lowered for laptop preset\nconst DRS_MAX_PIXEL_RATIO = Math.min(1.0, initialPixelRatio);  // upper bound\nlet   drsEnabled = true;\nlet   drsPixelRatio = DRS_MAX_PIXEL_RATIO;\nconst frameTimes = [];\nconst FRAME_WINDOW = 30; // track last 30 frames\nlet pendingDiag = null;\nlet pendingCullZ = null;\nlet simAccumulator = 0;\n\nfunction handleKeyDown(e) {\n  if (e?.code === 'ShiftLeft' || e?.code === 'ShiftRight') {\n    shiftHeld = true;\n  }\n  if (e?.code === PAUSE_KEY && !e.repeat) {\n    if (allowPause && !gameOverActive && !levelCompleteActive && !introActive && !isPauseBlockedForIntro()) {\n      setPauseActive(!pauseActive);\n    }\n    if (typeof e.preventDefault === 'function') e.preventDefault();\n    return;\n  }\n  if ((introActive || pauseActive || gameOverActive || levelCompleteActive) && e?.code && GAME_KEY_CODES.has(e.code)) {\n    if (typeof e.preventDefault === 'function') e.preventDefault();\n    return;\n  }\n  if (e?.code && GAME_KEY_CODES.has(e.code) && typeof e.preventDefault === 'function') {\n    e.preventDefault();\n  }\n  if (FPS_TOGGLE_KEY && e.code === FPS_TOGGLE_KEY && !e.repeat && allowFpsToggle) {\n    fpsCapEnabled = !fpsCapEnabled;\n    lastFrameMs = performance.now(); // avoid a big dt on the next tick\n  }\n  if (DRS_TOGGLE_KEY && e.code === DRS_TOGGLE_KEY && !e.repeat) { // toggle dynamic resolution scaling\n    drsEnabled = !drsEnabled;\n    if (!drsEnabled) {\n      drsPixelRatio = DRS_MAX_PIXEL_RATIO;\n      renderer.setPixelRatio(drsPixelRatio);\n    }\n  }\n  if (e.code === BOMB_KEY && !e.repeat) {\n    if (bombCount > 0 && playerAlive && lasers?.fireBomb) {\n      if (lasers.fireBomb(playerShip)) {\n        bombCount = Math.max(0, bombCount - 1);\n        setBombs(bombCount);\n      }\n    }\n  }\n\n  if (!e.repeat && (e.code === ROLL_LEFT || e.code === ROLL_RIGHT)) {\n    startRoll(e.code === ROLL_LEFT ? +1 : -1);\n  }\n  if (!e.repeat && (e.code === LEFT || e.code === RIGHT)) {\n    lastStrafeDir = e.code === LEFT ? -1 : 1;\n  }\n  keys[e.code] = true;\n}\n\nfunction handleKeyUp(e) {\n  if (e?.code === 'ShiftLeft' || e?.code === 'ShiftRight') {\n    shiftHeld = false;\n  }\n  if (e?.code === PAUSE_KEY) {\n    if (typeof e.preventDefault === 'function') e.preventDefault();\n    return;\n  }\n  if ((introActive || pauseActive || gameOverActive || levelCompleteActive) && e?.code && GAME_KEY_CODES.has(e.code)) {\n    if (typeof e.preventDefault === 'function') e.preventDefault();\n    return;\n  }\n  if (e?.code && GAME_KEY_CODES.has(e.code) && typeof e.preventDefault === 'function') {\n    e.preventDefault();\n  }\n  keys[e.code] = false;\n}\n\nif (!RUNNING_IN_WORKER && !EDITOR_MODE) {\n  addEventListener('keydown', handleKeyDown);\n  addEventListener('keyup', handleKeyUp);\n}\n\nif (RUNNING_IN_WORKER) {\n  globalThis.__INPUT_HANDLER_READY__ = true;\n  addEventListener('message', (evt) => {\n    const data = evt.data;\n    if (!data) return;\n    if (data.type === 'input' || data.type === 'inputBatch') {\n      const events = data.type === 'input'\n        ? [data]\n        : (Array.isArray(data.events) ? data.events : []);\n      events.forEach((entry) => {\n        if (!entry?.event) return;\n        const evtObj = { code: entry.code, repeat: entry.repeat };\n        if (entry.event === 'keydown') handleKeyDown(evtObj);\n        else if (entry.event === 'keyup') handleKeyUp(evtObj);\n        if (!introActive && !pauseActive && !gameOverActive && !levelCompleteActive && entry.code === 'Space') {\n          // Forward synthetic keyboard events for laser-system.\n          const synthetic = new Event(entry.event);\n          Object.defineProperty(synthetic, 'code', { value: entry.code });\n          Object.defineProperty(synthetic, 'repeat', { value: Boolean(entry.repeat) });\n          self.dispatchEvent(synthetic);\n        }\n      });\n    } else if (data.type === 'resize') {\n      pendingResize = data;\n      if (data?.size?.w && data?.size?.h) {\n        lastKnownCanvasSize = { w: data.size.w, h: data.size.h };\n      }\n    } else if (data.type === 'dumpPaths') {\n      self.postMessage({\n        type: 'pathsDump',\n        payload: { paths: CAPTURED_ENEMY_PATHS }\n      });\n    }\n  });\n}\n\n\n\n/* ─── enemy fighters (dark) ─────────────────────── */\nconst bakedEnemyPaths      = buildBakedPathMap(spawns.enemy ?? [], './models/dark1.glb');\nconst bakedBluePaths       = buildBakedPathMap(spawns.enemyBlue ?? [], './models/blue1.glb');\nconst bakedDiagPaths       = buildBakedPathMap(spawns.enemyDiag ?? [], './models/dark1.glb');\nconst bakedDiagRLPaths     = buildBakedPathMap(spawns.enemyDiagRL ?? [], './models/dark1.glb');\nconst bakedZigzagWidePaths = buildBakedPathMap(spawns.enemyZigzagWide ?? [], './models/dark1.glb');\nconst bakedZigzagTightPaths= buildBakedPathMap(spawns.enemyZigzagTight ?? [], './models/blue1.glb');\nconst bakedHoverPaths      = buildBakedPathMap(spawns.enemyHoverBob ?? [], './models/blue1.glb');\nconst bakedSpiralPaths     = buildBakedPathMap(spawns.enemySpiral ?? [], './models/dark1.glb');\nconst bakedSpiderPaths     = buildBakedPathMap(spawns.enemySpider ?? [], './models/dark3.glb');\nconst bakedJetPaths        = buildBakedPathMap(spawns.enemyJet ?? [], './models/dark4_jet.glb');\nconst EMPTY_BAKED          = new Map();\nconst bakedPathsEnabled    = ENABLE_BAKED_ENEMY_PATHS;\nconst frigateSpawnCount = Array.isArray(spawns.enemyFrigate) ? spawns.enemyFrigate.length : 0;\nconst frigateBluePoolSize = frigateSpawnCount ? frigateSpawnCount * 6 : 0;\n\nconst enemySystem = await initEnemySystem(scene, {\n  spawnArray  : spawns.enemy ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  manualPoolSize: 6,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath   : './models/dark1.glb',          // explicit, unchanged\n  behaviour  : BEHAVIOURS.straight,\n    camera     : camera,          // ← add this one line\n    materialMode: CHARACTER_MATERIAL_MODE,\n    bakedPaths : bakedPathsEnabled ? bakedEnemyPaths : EMPTY_BAKED,\n    useBakedPaths: bakedPathsEnabled,\n    editorGroup: 'enemy'\n\n\n});\n\n/* ─── enemy fighters (blue) ─────────────────────── */\nconst blueEnemySystem = await initEnemySystem(scene, {\n  /* you can give blue-only spawn points later; for now reuse list */\n  spawnArray  : spawns.enemyBlue ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/blue1.glb',\n  behaviour  : BEHAVIOURS.corkscrew,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedBluePaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyBlue'\n\n\n\n\n});\n\nconst blueStraightSys = await initEnemySystem(scene, {\n  spawnArray  : spawns.enemyBlueStraight ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/blue1.glb',\n  behaviour  : BEHAVIOURS.blueStraight,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : EMPTY_BAKED,\n      useBakedPaths: false,\n  manualPoolSize: frigateBluePoolSize,\n  editorGroup: 'enemyBlueStraight'\n});\n\n/* diagonal dark fighters ------------------------------------- */\nconst diagEnemySystem = await initEnemySystem(scene, {\n  spawnArray  : spawns.enemyDiag ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath   : './models/dark1.glb',   // same model\n  behaviour  : BEHAVIOURS.diagLR,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedDiagPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyDiag'\n\n\n\n});\n\n/* mirrored diagonal (right → left) -------------------------------- */\nconst diagRLSystem = await initEnemySystem(scene,{\n  spawnArray  : spawns.enemyDiagRL ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath   : './models/dark1.glb',\n  behaviour  : BEHAVIOURS.diagRL,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedDiagRLPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyDiagRL'\n\n\n});\n\nconst zigzagWideSys = await initEnemySystem(scene,{\n  spawnArray : spawns.enemyZigzagWide ?? [],\n  playerObj  : playerShip,\n  railCurve,\n  playerSpeed: 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/dark1.glb',\n  behaviour  : BEHAVIOURS.zigzagWide,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedZigzagWidePaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyZigzagWide'\n\n});\n\nconst zigzagTightSys = await initEnemySystem(scene,{\n  spawnArray : spawns.enemyZigzagTight ?? [],\n  playerObj  : playerShip,\n  railCurve,\n  playerSpeed: 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/blue1.glb',\n  behaviour  : BEHAVIOURS.zigzagTight,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedZigzagTightPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyZigzagTight'\n\n});\n\nconst hoverBobSys = await initEnemySystem(scene,{\n  spawnArray : spawns.enemyHoverBob ?? [],\n  playerObj  : playerShip,\n  railCurve,\n  playerSpeed: 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/blue1.glb',\n  behaviour  : BEHAVIOURS.hoverBob,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedHoverPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyHoverBob'\n\n});\n\nconst spiralSys = await initEnemySystem(scene,{\n  spawnArray : spawns.enemySpiral ?? [],\n  playerObj  : playerShip,\n  railCurve,\n  playerSpeed: 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath  : './models/dark1.glb',\n  behaviour  : BEHAVIOURS.spiralIn,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedSpiralPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemySpiral'\n\n});\n\nconst spiderSys = await initEnemySystem(scene,{\n  spawnArray  : spawns.enemySpider ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 35,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath   : './models/dark3.glb',\n  behaviour   : BEHAVIOURS.spiderTurret,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedSpiderPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemySpider'\n});\n\nconst jetEnemySys = await initEnemySystem(scene,{\n  spawnArray  : spawns.enemyJet ?? [],\n  playerObj   : playerShip,\n  railCurve,\n  playerSpeed : 60,\n  boltPool    : sharedBoltPool,\n  canFire     : canEnemyFire,\n  hazardColliders,\n  hazardEntries,\n  modelPath   : './models/dark4_jet.glb',\n  behaviour   : BEHAVIOURS.jetArc,\n      camera     : camera,\n      materialMode: CHARACTER_MATERIAL_MODE,\n      bakedPaths : bakedPathsEnabled ? bakedJetPaths : EMPTY_BAKED,\n      useBakedPaths: bakedPathsEnabled,\n      editorGroup: 'enemyJet'\n});\n\nconst frigateEnemySys = await initFrigateEnemySystem(scene, {\n  spawnArray : spawns.enemyFrigate ?? [],\n  playerObj  : playerShip,\n  boltPool   : sharedBoltPool,\n  canFire    : canEnemyFire,\n  hazardEntries,\n  spawnBlue  : blueStraightSys.spawnManual,\n  modelPath  : './models/dark_frigate.glb',\n  materialMode: CHARACTER_MATERIAL_MODE,\n  editorGroup: 'enemyFrigate'\n});\n\nallySystem = await initAllyShip(scene, {\n  railCurve,\n  playerObj: playerShip,\n  laserSystem: lasers,\n  enemySystem,\n  enemyLasers: () => sharedBoltPool.getActive(),\n  enemyBoltPool: sharedBoltPool,\n  explosionPool: explosions,\n  playerSpeed: 35,\n  materialMode: CHARACTER_MATERIAL_MODE,\n  onDialogue: (payload) => {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({ type: 'dialogue', payload });\n    } else {\n      handleDialoguePayload(payload);\n    }\n  },\n  onEscortOutcome: ({ survived } = {}) => {\n    escortSurvived = Boolean(survived);\n  },\n  spawn: { x: 80, y: 12, z: -3500 },\n  spawnTriggerZ: -3520\n});\n\n/* helpers to gather active enemies/lasers without concat churn */\nconst enemySystemsList = [\n  enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n  zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys,\n  frigateEnemySys,\n  ...platSys, ...stationTurretSystems\n];\nconst scratchEnemies = [];\nconst scratchLasers  = [];\nfunction gatherEnemies() {\n  scratchEnemies.length = 0;\n  enemySystemsList.forEach(sys => {\n    const arr = sys.getActiveShips?.();\n    if (arr && arr.length) scratchEnemies.push(...arr);\n  });\n  const stationEnemies = stationSystem.getActiveShips?.();\n  if (stationEnemies?.length) scratchEnemies.push(...stationEnemies);\n  const androssParts = androssBoss?.getEnemyParts?.();\n  if (androssParts?.length) scratchEnemies.push(...androssParts);\n  return scratchEnemies;\n}\nfunction gatherEnemyLasers() {\n  return sharedBoltPool.getActive();\n}\n\nfunction queueDiagnostics(dt, lines) {\n  pendingDiag = { dt, lines };\n  scheduleIdle(() => {\n    if (!pendingDiag) return;\n    const { dt, lines } = pendingDiag;\n    pendingDiag = null;\n    updateDiagnostics(dt, lines);\n  });\n}\n\nfunction queueCullTasks(playerZ) {\n  pendingCullZ = playerZ;\n  scheduleIdle(() => {\n    if (pendingCullZ === null) return;\n    const z = pendingCullZ;\n    pendingCullZ = null;\n    allHazards.forEach(h => {\n      const m = h?.getMesh ? h.getMesh() : h?.mesh;\n      if (!m) return;\n      const cullZ = HAZARD_CULL_Z * (m.userData?.cullBehindZFactor ?? 1);\n      if (m.visible && m.position.z > z + cullZ) {\n        m.visible = false;\n      }\n    });\n    setPieces.forEach(p => {\n      if (!p?.mesh) return;\n      const cullZ = HAZARD_CULL_Z * (p.mesh.userData?.cullBehindZFactor ?? 1);\n      if (p.mesh.visible && p.mesh.position.z > z + cullZ) {\n        p.mesh.visible = false;\n        p.active = false;\n      }\n    });\n    pickupSystem.idleCull && pickupSystem.idleCull(z);\n  });\n}\n\n/* ─── prewarm materials to avoid spawn hitches ─────────────── */\n// targeted warmup for the first enemy wave\nenemySystem.prewarm && enemySystem.prewarm(renderer, camera);\nenemySystem.prewarmRender && enemySystem.prewarmRender(renderer, camera);\nenemySystem.prewarmSpawn && enemySystem.prewarmSpawn(renderer, camera);\n\n// general warmup passes\n[\n  enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n  zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys,\n  frigateEnemySys,\n  ...platSys, ...stationTurretSystems, stationSystem, pickupSystem, allySystem, bossSystem, androssBoss\n].forEach(sys => sys.prewarm && sys.prewarm(renderer, camera));\n// extra: render once with fighters visible to force GPU programs ready\n[\n  enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n  zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys,\n  frigateEnemySys\n].forEach(sys => sys.prewarmRender && sys.prewarmRender(renderer, camera));\n// extra: force a dummy spawn render off-screen to warm state transitions\n[\n  enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n  zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys,\n  frigateEnemySys\n].forEach(sys => sys.prewarmSpawn && sys.prewarmSpawn(renderer, camera));\n\n// small offscreen warmup render to finalize shaders/buffers\n{\n  const prevSize = renderer.getSize(new THREE.Vector2());\n  renderer.setSize(256, 256, false);\n  renderer.render(scene, camera);\n  renderer.setSize(prevSize.x, prevSize.y, false);\n  forceViewportSync();\n}\n\n// warm up all set-piece meshes (tunnels/flats/buildings/station)\n{\n  const prevVis = [];\n  const prevCulled = [];\n  setPieces.forEach(p => {\n    if (!p?.mesh) return;\n    prevVis.push([p.mesh, p.mesh.visible]);\n    p.mesh.visible = true;\n    p.mesh.traverse(o => {\n      if (o.isMesh) {\n        prevCulled.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n  });\n  renderer.render(scene, camera);\n  prevVis.forEach(([m, v]) => { m.visible = v; });\n  prevCulled.forEach(([o, c]) => { o.frustumCulled = c; });\n}\n\n// warm up passage collider by doing a tiny dummy linecast\nif (primaryPassage?.collider?.linecast) {\n  const tmpA = new THREE.Vector3(0, 0, 0);\n  const tmpDir = new THREE.Vector3(0, 0, -1);\n  try { primaryPassage.collider.linecast(tmpA, tmpDir, 1); } catch (err) {}\n}\n\n// spawn + resolve one explosion in each pool to bake programs/textures\n{\n  const tmp = new THREE.Vector3(0, -500, -500); // off-camera\n  explosions.spawn(tmp);\n  explosions.update(0.01, camera);\n  explosions.update(1.0, camera);\n  largeExplosions.spawn(tmp);\n  largeExplosions.update(0.01, camera);\n  largeExplosions.update(1.0, camera);\n  wingExplosions.spawn(tmp);\n  wingExplosions.update(0.01, camera);\n  wingExplosions.update(1.0, camera);\n  asteroidExplosions.spawn(tmp);\n  asteroidExplosions.update(0.01, camera);\n  asteroidExplosions.update(1.0, camera);\n}\n\n// precompile all seen materials once programs exist\nprewarmPrograms(renderer, scene, camera);\nexplosions.prewarm && explosions.prewarm(renderer, camera);\nlargeExplosions.prewarm && largeExplosions.prewarm(renderer, camera);\nwingExplosions.prewarm && wingExplosions.prewarm(renderer, camera);\nasteroidExplosions.prewarm && asteroidExplosions.prewarm(renderer, camera);\n[\n  primaryPassage,\n  ...asteroidPassages.slice(1),\n  ...drillTunnel,\n  ...flatAsteroid,\n  ...buildingPieces\n].forEach(p => p?.prewarm && p.prewarm(renderer, camera));\n// extra tiny render to finalize drill/building programs before approach\n{\n  const prevSize = renderer.getSize(new THREE.Vector2());\n  renderer.setSize(128, 128, false);\n  renderer.render(scene, camera);\n  renderer.setSize(prevSize.x, prevSize.y, false);\n  forceViewportSync();\n}\n\n\n\n\nconst previewCamPos = new THREE.Vector3();\nconst previewCamDir = new THREE.Vector3();\nconst previewCamRight = new THREE.Vector3();\nconst previewCamUp = new THREE.Vector3();\nconst previewOrigin = new THREE.Vector3();\nconst previewOffset = new THREE.Vector3();\nconst previewEnemySystems = [\n  enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n  zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys,\n  frigateEnemySys\n].filter(Boolean);\nlet loadingPreviewActive = false;\nlet previewCleanup = null;\nlet previewTimer = null;\n\nfunction applyLoadingPreviewState() {\n  const prevVis = [];\n  const prevCulled = [];\n  setPieces.forEach(p => {\n    if (!p?.mesh) return;\n    prevVis.push([p, p.mesh.visible, p.active]);\n    p.active = true;\n    p.mesh.visible = true;\n    p.mesh.traverse(o => {\n      if (o.isMesh) {\n        prevCulled.push([o, o.frustumCulled]);\n        o.frustumCulled = false;\n      }\n    });\n  });\n\n  camera.getWorldPosition(previewCamPos);\n  camera.getWorldDirection(previewCamDir);\n  previewCamRight.copy(previewCamDir).cross(previewCamUp.set(0, 1, 0)).normalize();\n  previewCamUp.crossVectors(previewCamRight, previewCamDir).normalize();\n  previewOrigin.copy(previewCamPos).addScaledVector(previewCamDir, 120);\n\n  const spacing = 18;\n  const bossPrev = [];\n  const bossCulls = [];\n  if (bossSystem?.getMesh) {\n    const bossMesh = bossSystem.getMesh();\n    if (bossMesh) {\n      bossPrev.push([bossMesh, bossMesh.visible, bossMesh.position.clone(), bossMesh.quaternion.clone()]);\n      bossMesh.visible = true;\n      bossMesh.position.copy(previewOrigin);\n      bossMesh.lookAt(previewCamPos);\n      bossMesh.traverse(o => {\n        if (o.isMesh) {\n          bossCulls.push([o, o.frustumCulled]);\n          o.frustumCulled = false;\n        }\n      });\n    }\n  }\n\n  const androssPrev = [];\n  const androssPartsPrev = [];\n  const androssCulls = [];\n  const androssMatPrev = new Map();\n  const androssRig = androssBoss?.getRig?.();\n  if (androssRig) {\n    androssPrev.push([androssRig, androssRig.visible, androssRig.position.clone(), androssRig.quaternion.clone()]);\n    androssRig.visible = true;\n    androssRig.position\n      .copy(previewOrigin)\n      .addScaledVector(previewCamRight, spacing * 0.6);\n    androssRig.lookAt(previewCamPos);\n\n    const head = androssBoss?.getHead?.();\n    const hands = androssBoss?.getHands?.() ?? [];\n    const parts = [\n      head?.getMesh?.(),\n      head?.getEyes?.(),\n      hands[0]?.getMesh?.(),\n      hands[0]?.getPalm?.(),\n      hands[1]?.getMesh?.(),\n      hands[1]?.getPalm?.()\n    ].filter(Boolean);\n    parts.forEach(part => {\n      androssPartsPrev.push([part, part.visible]);\n      part.visible = true;\n    });\n\n    androssRig.traverse(o => {\n      if (!o.isMesh || !o.material) return;\n      androssCulls.push([o, o.frustumCulled]);\n      o.frustumCulled = false;\n      const mats = Array.isArray(o.material) ? o.material : [o.material];\n      mats.forEach(mat => {\n        if (!mat) return;\n        if (!androssMatPrev.has(mat)) {\n          androssMatPrev.set(mat, {\n            opacity: mat.opacity,\n            transparent: mat.transparent,\n            depthWrite: mat.depthWrite,\n            color: mat.color ? mat.color.clone() : null,\n            emissive: mat.emissive ? mat.emissive.clone() : null\n          });\n        }\n        mat.transparent = true;\n        mat.opacity = 0.01;\n        mat.depthWrite = false;\n        mat.needsUpdate = true;\n      });\n    });\n  }\n\n  const previewCleanups = [];\n  const baseOffset = -((previewEnemySystems.length - 1) * spacing) * 0.5;\n  previewEnemySystems.forEach((sys, idx) => {\n    if (!sys?.previewSetup) return;\n    previewOffset.copy(previewOrigin).addScaledVector(previewCamRight, baseOffset + idx * spacing);\n    const cleanup = sys.previewSetup({\n      origin: previewOffset,\n      right: previewCamRight,\n      up: previewCamUp,\n      count: 1,\n      spacing: 0,\n      faceTarget: previewCamPos\n    });\n    previewCleanups.push(cleanup);\n  });\n  return () => {\n    previewCleanups.forEach(fn => fn && fn());\n    prevVis.forEach(([p, v, active]) => {\n      p.mesh.visible = v;\n      p.active = active;\n    });\n    prevCulled.forEach(([o, c]) => { o.frustumCulled = c; });\n    bossPrev.forEach(([mesh, vis, pos, quat]) => {\n      mesh.visible = vis;\n      mesh.position.copy(pos);\n      mesh.quaternion.copy(quat);\n    });\n    bossCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    androssPrev.forEach(([rig, vis, pos, quat]) => {\n      rig.visible = vis;\n      rig.position.copy(pos);\n      rig.quaternion.copy(quat);\n    });\n    androssPartsPrev.forEach(([part, vis]) => { part.visible = vis; });\n    androssCulls.forEach(([o, c]) => { o.frustumCulled = c; });\n    androssMatPrev.forEach((state, mat) => {\n      mat.opacity = state.opacity;\n      mat.transparent = state.transparent;\n      mat.depthWrite = state.depthWrite;\n      if (state.color && mat.color) mat.color.copy(state.color);\n      if (state.emissive && mat.emissive) mat.emissive.copy(state.emissive);\n      mat.needsUpdate = true;\n    });\n  };\n}\n\nfunction endLoadingPreview() {\n  if (!loadingPreviewActive) return;\n  loadingPreviewActive = false;\n  if (previewCleanup) {\n    previewCleanup();\n    previewCleanup = null;\n  }\n  if (EDITOR_MODE && Array.isArray(setPieces)) {\n    setPieces.forEach(piece => {\n      if (!piece?.mesh) return;\n      piece.mesh.visible = true;\n      piece.active = true;\n    });\n  }\n  if (previewTimer) {\n    clearTimeout(previewTimer);\n    previewTimer = null;\n  }\n  forceViewportSync();\n  lastFrameMs = performance.now();\n}\n\nfunction startLoadingPreview() {\n  if (loadingPreviewActive) return;\n  loadingPreviewActive = true;\n  previewCleanup = applyLoadingPreviewState();\n  forceViewportSync();\n  renderer.render(scene, camera);\n  triggerLoadingPreview();\n  if (previewTimer) clearTimeout(previewTimer);\n  previewTimer = setTimeout(endLoadingPreview, LOADING_PREVIEW_TOTAL_MS + 50);\n}\n\nstartLoadingPreview();\n\nfunction formatSpawnsForSave(obj) {\n  const formatValue = (val) => {\n    if (val && typeof val === 'object' && !Array.isArray(val)) {\n      const inner = Object.keys(val)\n        .map((k) => `${JSON.stringify(k)}: ${formatValue(val[k])}`)\n        .join(', ');\n      return `{ ${inner} }`;\n    }\n    if (Array.isArray(val)) {\n      if (!val.length) return '[]';\n      const inner = val.map((v) => formatValue(v)).join(', ');\n      return `[ ${inner} ]`;\n    }\n    return JSON.stringify(val);\n  };\n  const keys = Object.keys(obj);\n  const lines = ['{'];\n  keys.forEach((k, idx) => {\n    const v = obj[k];\n    const comma = idx < keys.length - 1 ? ',' : '';\n    if (Array.isArray(v)) {\n      if (!v.length) {\n        lines.push(`  ${JSON.stringify(k)}: []${comma}`);\n        return;\n      }\n      lines.push(`  ${JSON.stringify(k)}: [`);\n      v.forEach((item, i) => {\n        const itemComma = i < v.length - 1 ? ',' : '';\n        lines.push(`    ${formatValue(item)}${itemComma}`);\n      });\n      lines.push(`  ]${comma}`);\n    } else {\n      lines.push(`  ${JSON.stringify(k)}: ${formatValue(v)}${comma}`);\n    }\n  });\n  lines.push('}');\n  return lines.join('\\n') + '\\n';\n}\n\nfunction initEditorMode() {\n  if (!EDITOR_MODE || RUNNING_IN_WORKER || typeof document === 'undefined') return false;\n\n  if (Array.isArray(setPieces)) {\n    setPieces.forEach(piece => {\n      if (!piece?.mesh) return;\n      piece.mesh.visible = true;\n      piece.active = true;\n    });\n  }\n\n  if (camera.parent) camera.parent.remove(camera);\n  scene.add(camera);\n  camera.position.set(0, 45, 140);\n  camera.lookAt(0, 0, -600);\n\n  const orbit = new OrbitControls(camera, renderer.domElement);\n  orbit.enableDamping = true;\n  orbit.dampingFactor = 0.08;\n  orbit.screenSpacePanning = true;\n\n  const transform = new TransformControls(camera, renderer.domElement);\n  transform.setMode('translate');\n  transform.setSpace('world');\n  scene.add(transform);\n  transform.addEventListener('dragging-changed', (e) => {\n    orbit.enabled = !e.value;\n  });\n\n  const panel = document.createElement('div');\n  Object.assign(panel.style, {\n    position: 'fixed',\n    right: '12px',\n    top: '12px',\n    padding: '10px 12px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.7)',\n    color: '#0f0',\n    font: '12px/1.4 monospace',\n    letterSpacing: '0.04em',\n    textTransform: 'uppercase',\n    zIndex: 10000,\n    minWidth: '220px'\n  });\n  const title = document.createElement('div');\n  title.textContent = 'Level Editor';\n  title.style.fontSize = '13px';\n  title.style.marginBottom = '6px';\n  const selectedLine = document.createElement('div');\n  const modeLine = document.createElement('div');\n  const makeNumberInput = (placeholder, step = 0.1) => {\n    const input = document.createElement('input');\n    input.type = 'number';\n    input.step = String(step);\n    input.placeholder = placeholder;\n    Object.assign(input.style, {\n      width: '62px',\n      background: 'rgba(0,0,0,0.55)',\n      color: '#0f0',\n      border: '1px solid rgba(0,255,0,0.4)',\n      font: '11px monospace',\n      padding: '2px 4px'\n    });\n    return input;\n  };\n  const makeRow = (labelText) => {\n    const row = document.createElement('div');\n    Object.assign(row.style, {\n      display: 'flex',\n      alignItems: 'center',\n      gap: '4px',\n      marginTop: '4px'\n    });\n    const label = document.createElement('span');\n    label.textContent = labelText;\n    label.style.minWidth = '42px';\n    row.appendChild(label);\n    return row;\n  };\n  const posLine = makeRow('Pos');\n  const posInputs = [\n    makeNumberInput('X', 0.1),\n    makeNumberInput('Y', 0.1),\n    makeNumberInput('Z', 0.1)\n  ];\n  posInputs.forEach(input => posLine.appendChild(input));\n  const rotLine = makeRow('Rot');\n  const rotInputs = [\n    makeNumberInput('X°', 1),\n    makeNumberInput('Y°', 1),\n    makeNumberInput('Z°', 1)\n  ];\n  rotInputs.forEach(input => rotLine.appendChild(input));\n  const scaleLine = makeRow('Scale');\n  const scaleInput = makeNumberInput('S', 0.01);\n  scaleLine.appendChild(scaleInput);\n  const statusLine = document.createElement('div');\n  statusLine.style.opacity = '0.7';\n  statusLine.style.marginTop = '6px';\n\n  const modeRow = document.createElement('div');\n  Object.assign(modeRow.style, {\n    display: 'flex',\n    gap: '6px',\n    marginTop: '6px'\n  });\n  const makeModeButton = (label) => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.textContent = label;\n    Object.assign(btn.style, {\n      padding: '2px 6px',\n      border: '1px solid #0f0',\n      background: 'rgba(0,0,0,0.55)',\n      color: '#0f0',\n      font: '11px monospace',\n      cursor: 'pointer'\n    });\n    return btn;\n  };\n  const moveBtn = makeModeButton('Move [G]');\n  const rotateBtn = makeModeButton('Rotate [R]');\n  const scaleBtn = makeModeButton('Scale [S]');\n  modeRow.appendChild(moveBtn);\n  modeRow.appendChild(rotateBtn);\n  modeRow.appendChild(scaleBtn);\n\n  const saveBtn = document.createElement('button');\n  saveBtn.type = 'button';\n  saveBtn.textContent = 'Save spawns.json';\n  Object.assign(saveBtn.style, {\n    marginTop: '8px',\n    padding: '4px 8px',\n    border: '1px solid #0f0',\n    background: 'rgba(0,0,0,0.6)',\n    color: '#0f0',\n    font: '12px monospace',\n    cursor: 'pointer'\n  });\n  const downloadLink = document.createElement('a');\n  downloadLink.href = '#';\n  downloadLink.download = 'spawns.json';\n  downloadLink.style.display = 'none';\n  const downloadBtn = document.createElement('button');\n  downloadBtn.type = 'button';\n  downloadBtn.textContent = 'Download spawns.json';\n  Object.assign(downloadBtn.style, {\n    marginTop: '6px',\n    display: 'none',\n    border: '1px solid rgba(0,255,0,0.4)',\n    background: 'rgba(0,0,0,0.55)',\n    color: '#0f0',\n    font: '11px monospace',\n    letterSpacing: '0.04em',\n    padding: '4px 6px',\n    textAlign: 'center',\n    cursor: 'pointer'\n  });\n\n  panel.appendChild(title);\n  panel.appendChild(selectedLine);\n  panel.appendChild(modeLine);\n  panel.appendChild(modeRow);\n  panel.appendChild(posLine);\n  panel.appendChild(rotLine);\n  panel.appendChild(scaleLine);\n  panel.appendChild(saveBtn);\n  panel.appendChild(downloadBtn);\n  panel.appendChild(statusLine);\n  document.body.appendChild(panel);\n  document.body.appendChild(downloadLink);\n\n  let selected = null;\n  let currentMode = 'translate';\n  let dragging = false;\n  let isTransformDragging = false;\n  const undoStack = [];\n  const MAX_UNDO = 10;\n  let dragUndoEntry = null;\n  let gizmoUndoEntry = null;\n  let downloadUrl = null;\n  const editorPickables = [];\n  const raycaster = new THREE.Raycaster();\n  const pointer = new THREE.Vector2();\n  const dragPlane = new THREE.Plane();\n  const dragHit = new THREE.Vector3();\n  const dragOffset = new THREE.Vector3();\n  const dragNormal = new THREE.Vector3();\n  const SET_GROUPS = new Set(['asteroidPassage', 'drillTunnel', 'asteroidFlat', 'buildings', 'boss']);\n\n  const round = (v, n = 3) => {\n    const f = Math.pow(10, n);\n    return Math.round(v * f) / f;\n  };\n  const radToDeg = (v) => THREE.MathUtils.radToDeg(v ?? 0);\n\n  const updatePanel = () => {\n    if (!selected) {\n      selectedLine.textContent = 'Selected: none';\n      modeLine.textContent = `Mode: ${currentMode === 'translate' ? 'Move' : (currentMode === 'rotate' ? 'Rotate' : 'Scale')}`;\n      posInputs.forEach(input => { input.value = ''; input.disabled = true; });\n      rotInputs.forEach(input => { input.value = ''; input.disabled = true; });\n      scaleInput.value = '';\n      scaleInput.disabled = true;\n      return;\n    }\n    const ref = selected.userData.editorRef;\n    const group = selected.userData.editorGroup ?? 'unknown';\n    const idx = selected.userData.editorIndex ?? '?';\n    selectedLine.textContent = `Selected: ${group} #${idx}`;\n    posInputs[0].value = String(round(selected.position.x));\n    posInputs[1].value = String(round(selected.position.y));\n    posInputs[2].value = String(round(selected.position.z));\n    rotInputs[0].value = String(round(radToDeg(selected.rotation.x), 2));\n    rotInputs[1].value = String(round(radToDeg(selected.rotation.y), 2));\n    rotInputs[2].value = String(round(radToDeg(selected.rotation.z), 2));\n    scaleInput.value = String(round(selected.scale.x, 3));\n    posInputs.forEach(input => { input.disabled = false; });\n    rotInputs.forEach(input => { input.disabled = false; });\n    scaleInput.disabled = false;\n    if (ref && typeof ref === 'object') {\n      statusLine.textContent = '';\n    }\n  };\n\n  const setTransformMode = (mode) => {\n    currentMode = mode;\n    transform.setMode(mode);\n    modeLine.textContent = `Mode: ${mode === 'translate' ? 'Move' : (mode === 'rotate' ? 'Rotate' : 'Scale')}`;\n  };\n\n  const captureTransform = (obj) => ({\n    obj,\n    pos: obj.position.clone(),\n    rot: obj.rotation.clone(),\n    scale: obj.scale.clone()\n  });\n  const hasTransformChanged = (obj, entry) => {\n    if (!obj || !entry) return false;\n    if (obj.position.distanceToSquared(entry.pos) > 1e-6) return true;\n    if (Math.abs(obj.rotation.x - entry.rot.x) > 1e-5) return true;\n    if (Math.abs(obj.rotation.y - entry.rot.y) > 1e-5) return true;\n    if (Math.abs(obj.rotation.z - entry.rot.z) > 1e-5) return true;\n    if (Math.abs(obj.scale.x - entry.scale.x) > 1e-5) return true;\n    return false;\n  };\n  const pushUndo = (entry) => {\n    if (!entry?.obj) return;\n    if (!hasTransformChanged(entry.obj, entry)) return;\n    undoStack.push(entry);\n    if (undoStack.length > MAX_UNDO) undoStack.shift();\n  };\n  const applyUndo = () => {\n    const entry = undoStack.pop();\n    if (!entry?.obj) return;\n    entry.obj.position.copy(entry.pos);\n    entry.obj.rotation.copy(entry.rot);\n    entry.obj.scale.copy(entry.scale);\n    entry.obj.updateMatrixWorld(true);\n    transform.updateMatrixWorld(true);\n    entry.obj.userData.editorDirty = true;\n    syncObjectToSpawns(entry.obj);\n    if (selected === entry.obj) updatePanel();\n  };\n\n  const syncObjectToSpawns = (obj) => {\n    if (!obj) return;\n    const ref = obj.userData.editorRef;\n    if (!ref || typeof ref !== 'object') return;\n    ref.x = round(obj.position.x);\n    ref.y = round(obj.position.y);\n    ref.z = round(obj.position.z);\n    if (typeof ref.yaw === 'number') {\n      ref.yaw = round(obj.rotation.y, 4);\n      return;\n    }\n    const shouldSetRot = SET_GROUPS.has(obj.userData.editorGroup)\n      || ref.rotation\n      || ref.rotationDeg;\n    if (shouldSetRot) {\n      if (ref.rotationDeg) {\n        ref.rotationDeg = {\n          x: round(radToDeg(obj.rotation.x), 2),\n          y: round(radToDeg(obj.rotation.y), 2),\n          z: round(radToDeg(obj.rotation.z), 2)\n        };\n      } else {\n        ref.rotation = {\n          x: round(obj.rotation.x, 4),\n          y: round(obj.rotation.y, 4),\n          z: round(obj.rotation.z, 4)\n        };\n      }\n    }\n    if (SET_GROUPS.has(obj.userData.editorGroup) || typeof ref.scale === 'number') {\n      ref.scale = round(obj.scale.x, 3);\n    }\n  };\n\n  const syncAllEditorObjectsToSpawns = () => {\n    const unique = new Set(editorObjects);\n    unique.forEach(obj => {\n      if (obj?.userData?.editorDirty) syncObjectToSpawns(obj);\n    });\n    if (selected?.userData?.editorDirty) syncObjectToSpawns(selected);\n  };\n\n  const markDirty = (obj) => {\n    if (!obj?.userData) return;\n    obj.userData.editorDirty = true;\n  };\n\n  const applyInputsToSelected = () => {\n    if (!selected) return;\n    const read = (input, fallback) => {\n      const val = parseFloat(input.value);\n      return Number.isFinite(val) ? val : fallback;\n    };\n    const posX = read(posInputs[0], selected.position.x);\n    const posY = read(posInputs[1], selected.position.y);\n    const posZ = read(posInputs[2], selected.position.z);\n    const rotX = read(rotInputs[0], radToDeg(selected.rotation.x));\n    const rotY = read(rotInputs[1], radToDeg(selected.rotation.y));\n    const rotZ = read(rotInputs[2], radToDeg(selected.rotation.z));\n    const scl = Math.max(0.001, read(scaleInput, selected.scale.x));\n    const before = captureTransform(selected);\n    if (\n      Math.abs(posX - selected.position.x) < 1e-6 &&\n      Math.abs(posY - selected.position.y) < 1e-6 &&\n      Math.abs(posZ - selected.position.z) < 1e-6 &&\n      Math.abs(rotX - radToDeg(selected.rotation.x)) < 1e-3 &&\n      Math.abs(rotY - radToDeg(selected.rotation.y)) < 1e-3 &&\n      Math.abs(rotZ - radToDeg(selected.rotation.z)) < 1e-3 &&\n      Math.abs(scl - selected.scale.x) < 1e-6\n    ) {\n      return;\n    }\n    selected.position.set(posX, posY, posZ);\n    selected.rotation.set(degToRad(rotX), degToRad(rotY), degToRad(rotZ));\n    selected.scale.setScalar(scl);\n    selected.updateMatrixWorld(true);\n    transform.updateMatrixWorld(true);\n    markDirty(selected);\n    pushUndo(before);\n    syncSelectedToSpawns();\n    updatePanel();\n  };\n\n  const syncSelectedToSpawns = () => {\n    if (!selected) return;\n    syncObjectToSpawns(selected);\n  };\n\n  const selectObject = (obj) => {\n    selected = obj;\n    if (selected) {\n      transform.attach(selected);\n      transform.visible = true;\n      transform.enabled = true;\n    } else {\n      transform.detach();\n      transform.visible = false;\n    }\n    updatePanel();\n  };\n\n  const rebuildPickables = () => {\n    editorPickables.length = 0;\n    const roots = Array.from(new Set(editorObjects));\n    roots.forEach(root => {\n      root.traverse(o => {\n        if (o.isMesh) editorPickables.push(o);\n      });\n    });\n  };\n\n  const setDownloadUrl = (blob) => {\n    if (downloadUrl) {\n      URL.revokeObjectURL(downloadUrl);\n      downloadUrl = null;\n    }\n    downloadUrl = URL.createObjectURL(blob);\n    downloadLink.href = downloadUrl;\n  };\n  const triggerDownload = () => {\n    syncAllEditorObjectsToSpawns();\n    const blob = new Blob([formatSpawnsForSave(spawns)], { type: 'application/json' });\n    setDownloadUrl(blob);\n    const anchor = document.createElement('a');\n    anchor.href = downloadLink.href;\n    anchor.download = downloadLink.download || 'spawns.json';\n    anchor.style.display = 'none';\n    document.body.appendChild(anchor);\n    anchor.click();\n    anchor.remove();\n  };\n\n  const saveSpawns = async () => {\n    syncAllEditorObjectsToSpawns();\n    const body = JSON.stringify({ spawns });\n    statusLine.textContent = 'Saving...';\n    try {\n      const res = await fetch('/__save_spawns', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body\n      });\n      if (!res.ok) throw new Error(await res.text());\n      statusLine.textContent = 'Saved.';\n      downloadBtn.style.display = 'none';\n      if (downloadUrl) {\n        URL.revokeObjectURL(downloadUrl);\n        downloadUrl = null;\n      }\n    } catch (err) {\n      statusLine.textContent = 'Save failed. Click download.';\n      downloadBtn.style.display = 'inline-block';\n      try {\n        triggerDownload();\n      } catch {\n        // User can click the link manually if autoplay is blocked.\n      }\n    }\n  };\n\n  saveBtn.addEventListener('click', saveSpawns);\n  downloadBtn.addEventListener('click', () => {\n    triggerDownload();\n  });\n  moveBtn.addEventListener('click', () => setTransformMode('translate'));\n  rotateBtn.addEventListener('click', () => setTransformMode('rotate'));\n  scaleBtn.addEventListener('click', () => setTransformMode('scale'));\n\n  const onPointerDown = (e) => {\n    if (e.button !== 0) return;\n    if (!editorPickables.length) return;\n    const rect = renderer.domElement.getBoundingClientRect();\n    pointer.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;\n    pointer.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;\n    raycaster.setFromCamera(pointer, camera);\n    const hits = raycaster.intersectObjects(editorPickables, false);\n    if (!hits.length) {\n      selectObject(null);\n      return;\n    }\n    const root = hits[0].object.userData.__editorRoot ?? hits[0].object;\n    selectObject(root);\n    if (!selected || currentMode !== 'translate' || isTransformDragging) return;\n    camera.getWorldDirection(dragNormal).normalize();\n    dragPlane.setFromNormalAndCoplanarPoint(dragNormal, selected.position);\n    if (raycaster.ray.intersectPlane(dragPlane, dragHit)) {\n      dragOffset.copy(selected.position).sub(dragHit);\n      dragUndoEntry = captureTransform(selected);\n      dragging = true;\n      orbit.enabled = false;\n    }\n  };\n  renderer.domElement.addEventListener('pointerdown', onPointerDown);\n\n  const onPointerMove = (e) => {\n    if (!dragging || !selected) return;\n    const rect = renderer.domElement.getBoundingClientRect();\n    pointer.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;\n    pointer.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;\n    raycaster.setFromCamera(pointer, camera);\n    if (raycaster.ray.intersectPlane(dragPlane, dragHit)) {\n      selected.position.copy(dragHit).add(dragOffset);\n      selected.updateMatrixWorld(true);\n      transform.updateMatrixWorld(true);\n      markDirty(selected);\n      syncSelectedToSpawns();\n      updatePanel();\n    }\n  };\n  const onPointerUp = () => {\n    if (!dragging) return;\n    dragging = false;\n    orbit.enabled = !isTransformDragging;\n    if (dragUndoEntry) {\n      pushUndo(dragUndoEntry);\n      dragUndoEntry = null;\n    }\n  };\n  window.addEventListener('pointermove', onPointerMove);\n  window.addEventListener('pointerup', onPointerUp);\n\n  const onKeyDown = (e) => {\n    if (e.code === 'KeyG') {\n      e.preventDefault();\n      setTransformMode('translate');\n    }\n    if (e.code === 'KeyR') {\n      e.preventDefault();\n      setTransformMode('rotate');\n    }\n    if (e.code === 'KeyS' && !e.ctrlKey) {\n      e.preventDefault();\n      setTransformMode('scale');\n    }\n    if (e.code === 'Escape') selectObject(null);\n    if (e.code === 'KeyZ' && e.ctrlKey) {\n      e.preventDefault();\n      applyUndo();\n    }\n    if (e.code === 'KeyS' && e.ctrlKey) {\n      e.preventDefault();\n      saveSpawns();\n    }\n  };\n  window.addEventListener('keydown', onKeyDown);\n\n  transform.addEventListener('objectChange', () => {\n    markDirty(selected);\n    syncSelectedToSpawns();\n    updatePanel();\n  });\n  transform.addEventListener('dragging-changed', (e) => {\n    isTransformDragging = Boolean(e.value);\n    orbit.enabled = !e.value;\n    if (e.value && selected) {\n      gizmoUndoEntry = captureTransform(selected);\n    } else if (!e.value && gizmoUndoEntry) {\n      pushUndo(gizmoUndoEntry);\n      gizmoUndoEntry = null;\n    }\n  });\n\n  // materialize dynamic systems for editor view\n  [\n    enemySystem, blueEnemySystem, blueStraightSys, diagEnemySystem, diagRLSystem,\n    zigzagWideSys, zigzagTightSys, hoverBobSys, spiralSys, spiderSys, jetEnemySys\n  ].forEach(sys => {\n    const ships = sys?.materializeSpawns?.();\n    if (ships?.length) {\n      ships.forEach(ship => {\n        if (ship?.userData?.editorRef) {\n          registerEditorObject(ship, {\n            group: ship.userData.editorGroup,\n            index: ship.userData.editorIndex,\n            ref: ship.userData.editorRef\n          });\n        }\n      });\n    }\n  });\n  if (frigateEnemySys?.materializeSpawns) {\n    const ships = frigateEnemySys.materializeSpawns();\n    ships?.forEach(ship => {\n      if (ship?.userData?.editorRef) {\n        registerEditorObject(ship, {\n          group: ship.userData.editorGroup,\n          index: ship.userData.editorIndex,\n          ref: ship.userData.editorRef\n        });\n      }\n    });\n  }\n  if (pickupSystem?.materializeAll) {\n    const pickupRoots = pickupSystem.materializeAll();\n    pickupRoots?.forEach(root => {\n      if (root?.userData?.editorRef) {\n        registerEditorObject(root, {\n          group: root.userData.editorGroup,\n          ref: root.userData.editorRef\n        });\n      }\n    });\n  }\n\n  if (bossSystem?.getMesh && spawns?.boss) {\n    const bossMesh = bossSystem.getMesh();\n    if (bossMesh) {\n      bossMesh.visible = true;\n      registerEditorObject(bossMesh, { group: 'boss', ref: spawns.boss });\n    }\n  }\n  if (stationTurretSystems?.length && Array.isArray(spawns.stationTurret)) {\n    stationTurretSystems.forEach((sys, idx) => {\n      const mesh = sys?.getMesh?.();\n      if (mesh) {\n        mesh.visible = true;\n        registerEditorObject(mesh, { group: 'stationTurret', index: idx, ref: spawns.stationTurret[idx] });\n      }\n    });\n  }\n  if (platSys?.length && Array.isArray(spawns.platform)) {\n    platSys.forEach((sys, idx) => {\n      const mesh = sys?.getMesh?.();\n      if (mesh) {\n        mesh.visible = true;\n        registerEditorObject(mesh, { group: 'platform', index: idx, ref: spawns.platform[idx] });\n      }\n    });\n  }\n\n  rebuildPickables();\n  setTransformMode('translate');\n  updatePanel();\n\n  [...posInputs, ...rotInputs, scaleInput].forEach((input) => {\n    input.addEventListener('keydown', (e) => {\n      e.stopPropagation();\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        applyInputsToSelected();\n      }\n    });\n    input.addEventListener('change', () => applyInputsToSelected());\n  });\n\n  renderer.setAnimationLoop(() => {\n    if (pendingResize?.size) {\n      if (typeof pendingResize.dpr === 'number') {\n        globalThis.devicePixelRatio = pendingResize.dpr;\n      }\n      syncViewportSize(true, pendingResize.size);\n      pendingResize = null;\n    } else {\n      syncViewportSize();\n    }\n    orbit.update();\n    renderer.render(scene, camera);\n  });\n\n  return true;\n}\n\n/* ─── main loop ─────────────────────────────────────────────── */\nconst BASE_SPEED_UU   = 35;                            // units / second\nconst BASE_SPEED_T    = BASE_SPEED_UU / railCurve.getLength(); // spline % / sec\nconst BURST_DURATION  = 1.25;                          // seconds of boost/brake (capacity)\nconst BURST_RECHARGE  = 3.0;                           // seconds to refill when empty\nconst BOOST_MULT      = 1.5;\nconst BRAKE_MULT      = 0.55;\nconst WING_DRIFT_PER_SEC = 6;\nconst BOOST_KEY       = 'KeyJ';\nconst BRAKE_KEY       = 'KeyN';\nconst INPUT_STALL_RESET_MS = 220;\nlet   railSpeedMult   = 1;\nlet   burstEnergy     = 1;                             // 0..1\nlet   burstActive     = false;\nlet   burstMode       = null;                          // 'boost' | 'brake' | null\nlet   burstLocked     = false;                         // true after empty until full\nlet   t               = 0;\nconst GAME_OVER_STOP_DELAY_MS = 120;\nconst GAME_OVER_STOP_DURATION_MS = 800;\nconst clamp01 = (value) => Math.max(0, Math.min(1, value));\nconst smoothstep = (value) => value * value * (3 - 2 * value);\nconst getRailStopFactor = (nowMs) => {\n  if (!gameOverActive) return 1;\n  const elapsed = nowMs - gameOverStartMs;\n  if (elapsed <= GAME_OVER_STOP_DELAY_MS) return 1;\n  const tNorm = clamp01((elapsed - GAME_OVER_STOP_DELAY_MS) / GAME_OVER_STOP_DURATION_MS);\n  return 1 - smoothstep(tNorm);\n};\n\n/* reset frame timer after load so preloading time doesn't inflate the first dt */\nlastFrameMs = performance.now();\nintroStartMs = lastFrameMs;\nintroActive = !EDITOR_MODE && LEVEL_INTRO_DURATION_MS > 0;\nif (introActive) {\n  if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n    self.postMessage({\n      type: 'introStart',\n      payload: {\n        durationMs: LEVEL_INTRO_DURATION_MS,\n        title: LEVEL_INTRO_TITLE,\n        objective: LEVEL_INTRO_OBJECTIVE\n      }\n    });\n  } else {\n    if (loadingUI) {\n      loadingUI.finish(() => startLevelIntroOverlay({ instantBackdrop: true }));\n    } else {\n      startLevelIntroOverlay({ instantBackdrop: true });\n    }\n  }\n} else if (EDITOR_MODE && loadingUI) {\n  loadingUI.finish(() => {});\n}\nallowPause = true;\n\nconst interpState = {\n  hasPrev: false,\n  railPrevPos: new THREE.Vector3(),\n  railPrevQuat: new THREE.Quaternion(),\n  railCurrPos: new THREE.Vector3(),\n  railCurrQuat: new THREE.Quaternion(),\n  steerPrevPos: new THREE.Vector3(),\n  steerPrevQuat: new THREE.Quaternion(),\n  steerCurrPos: new THREE.Vector3(),\n  steerCurrQuat: new THREE.Quaternion(),\n  shipPrevQuat: new THREE.Quaternion(),\n  shipCurrQuat: new THREE.Quaternion()\n};\nconst tmpPlayerPos = new THREE.Vector3();\nconst tmpCameraPos = new THREE.Vector3();\nconst tmpForward = new THREE.Vector3();\n\nfunction storePrevState() {\n  interpState.railPrevPos.copy(railNode.position);\n  interpState.railPrevQuat.copy(railNode.quaternion);\n  interpState.steerPrevPos.copy(steerNode.position);\n  interpState.steerPrevQuat.copy(steerNode.quaternion);\n  if (playerShip) {\n    interpState.shipPrevQuat.copy(playerShip.quaternion);\n  }\n  interpState.hasPrev = true;\n}\n\nfunction storeCurrentState() {\n  interpState.railCurrPos.copy(railNode.position);\n  interpState.railCurrQuat.copy(railNode.quaternion);\n  interpState.steerCurrPos.copy(steerNode.position);\n  interpState.steerCurrQuat.copy(steerNode.quaternion);\n  if (playerShip) {\n    interpState.shipCurrQuat.copy(playerShip.quaternion);\n  }\n}\n\nfunction applyInterpolation(alpha) {\n  if (!interpState.hasPrev) return;\n  const tAlpha = THREE.MathUtils.clamp(alpha, 0, 1);\n  railNode.position.lerpVectors(interpState.railPrevPos, interpState.railCurrPos, tAlpha);\n  railNode.quaternion.slerpQuaternions(interpState.railPrevQuat, interpState.railCurrQuat, tAlpha);\n  steerNode.position.lerpVectors(interpState.steerPrevPos, interpState.steerCurrPos, tAlpha);\n  steerNode.quaternion.slerpQuaternions(interpState.steerPrevQuat, interpState.steerCurrQuat, tAlpha);\n  if (playerShip) {\n    playerShip.quaternion.slerpQuaternions(interpState.shipPrevQuat, interpState.shipCurrQuat, tAlpha);\n  }\n}\n\nfunction restoreCurrentState() {\n  if (!interpState.hasPrev) return;\n  railNode.position.copy(interpState.railCurrPos);\n  railNode.quaternion.copy(interpState.railCurrQuat);\n  steerNode.position.copy(interpState.steerCurrPos);\n  steerNode.quaternion.copy(interpState.steerCurrQuat);\n  if (playerShip) {\n    playerShip.quaternion.copy(interpState.shipCurrQuat);\n  }\n}\n\nfunction simulateStep(stepDt, simNowMs) {\n  storePrevState();\n\n  const wasIntroActive = introActive;\n  introActive = LEVEL_INTRO_DURATION_MS > 0 && (simNowMs - introStartMs) < LEVEL_INTRO_DURATION_MS;\n  if (wasIntroActive && !introActive) {\n    clearInputState();\n    if (!EDITOR_MODE && !dialogueTimer && !shownDialogueIds.has('intro-alert')) {\n      if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n        dialogueTimer = -1;\n        self.postMessage({\n          type: 'dialogue',\n          payload: {\n            id: 'intro-alert',\n            delayMs: DIALOGUE_POP_DELAY_MS,\n            durationMs: DIALOGUE_POP_DURATION_MS,\n            portraitSrc: './textures/protag.png',\n            textLines: ['Everybody, stay alert!']\n          }\n        });\n      } else {\n        dialogueTimer = setTimeout(() => {\n          dialogueTimer = null;\n          if (gameOverActive || levelCompleteActive) return;\n          handleDialoguePayload({\n            id: 'intro-alert',\n            portraitSrc: './textures/protag.png',\n            textLines: ['Everybody, stay alert!'],\n            durationMs: DIALOGUE_POP_DURATION_MS\n          });\n        }, DIALOGUE_POP_DELAY_MS);\n      }\n    }\n  }\n  if (!EDITOR_MODE && stats.startMs === null && !introActive) {\n    stats.startMs = simNowMs;\n  }\n  const inputLocked = introActive || pauseActive || gameOverActive || levelCompleteActive;\n  const gameplayDt = (introActive || pauseActive || levelCompleteActive) ? 0 : stepDt;\n  const movementDt = gameplayDt * getRailStopFactor(simNowMs);\n\n  /* handle speed burst timers / energy */\n  const wantMode = inputLocked\n    ? null\n    : (keys[BOOST_KEY] ? 'boost' : (keys[BRAKE_KEY] ? 'brake' : null));\n  const canUse   = !burstLocked && burstEnergy > 0;\n  burstActive    = Boolean(wantMode && canUse);\n\n  if (burstActive) {\n    burstMode     = wantMode;\n    railSpeedMult = wantMode === 'boost' ? BOOST_MULT : BRAKE_MULT;\n    burstEnergy   = Math.max(0, burstEnergy - gameplayDt / BURST_DURATION);\n    if (burstEnergy === 0) {\n      burstLocked  = true;\n      burstActive  = false;\n      railSpeedMult = 1;\n    }\n  } else {\n    railSpeedMult = 1;\n  }\n\n  /* recharge when not actively draining */\n  if (!burstActive && burstEnergy < 1) {\n    const rechargeScale = burstLocked ? 1 : 0.66;\n    burstEnergy = Math.min(1, burstEnergy + (gameplayDt / BURST_RECHARGE) * rechargeScale);\n    if (burstEnergy === 1) {\n      burstLocked = false;\n      burstMode   = null;\n    }\n  }\n\n  /* scale engine glow based on boost/brake */\n  const glowMult = burstActive\n    ? (burstMode === 'boost' ? 2 : 0.5)\n    : 1;\n  setEngineGlowScale && setEngineGlowScale(glowMult);\n\n  setBurstMeter(burstEnergy, {\n    active      : burstActive || burstEnergy < 0.999 || burstLocked,\n    recharging  : !burstActive && burstEnergy < 1,\n    mode        : burstMode ?? 'boost'\n  });\n\n  /* follow spline */\n  t = Math.min(1, t + BASE_SPEED_T * railSpeedMult * movementDt);\n  const p     = railCurve.getPointAt(t);\n  const pNext = railCurve.getPointAt(Math.min(1, t + 0.0001));\n  railNode.position.copy(p);\n  railNode.lookAt(pNext);\n\n  /* steering */\n  const dx = inputLocked ? 0 : (keys[LEFT] ? 1 : 0) - (keys[RIGHT] ? 1 : 0);\n  const dy = inputLocked ? 0 : (keys[UP]   ? 1 : 0) - (keys[DOWN]  ? 1 : 0);\n  if (inputLocked || gameplayDt === 0) {\n    steerDx = 0;\n    steerDy = 0;\n  } else {\n    const alpha = Math.min(1, STEER_SMOOTH * gameplayDt);\n    steerDx += (dx - steerDx) * alpha;\n    steerDy += (dy - steerDy) * alpha;\n  }\n  const moveDir = (keys[LEFT] ? -1 : 0) + (keys[RIGHT] ? 1 : 0);\n  const sideBankDir = (!inputLocked && shiftHeld)\n    ? (moveDir !== 0 ? Math.sign(moveDir) : lastStrafeDir)\n    : 0;\n  const wingHpLeft = playerShip?.userData?.wingHpLeft;\n  const wingHpRight = playerShip?.userData?.wingHpRight;\n  const missingWings =\n    (typeof wingHpLeft === 'number' && wingHpLeft <= 0 ? 1 : 0) +\n    (typeof wingHpRight === 'number' && wingHpRight <= 0 ? 1 : 0);\n  const wingDrift = missingWings > 0 ? WING_DRIFT_PER_SEC * missingWings : 0;\n  steerNode.position.y = THREE.MathUtils.clamp(\n    steerNode.position.y + steerDy * 30 * gameplayDt - wingDrift * gameplayDt,\n    -35,\n    35\n  );\n  let speed = 45;\n  if (isRolling()){\n    const dir = getRollDir();\n    speed *= (dx === dir ? 1.3 : 0.7);       // boost / slow\n  }\n  steerNode.position.x = THREE.MathUtils.clamp(\n    steerNode.position.x + steerDx * speed * gameplayDt,  -35, 35);\n  updateShipAttitude(steerDx, steerDy, gameplayDt, sideBankDir);   // roll + nose-tilt\n  updateTrail && updateTrail(gameplayDt);\n\n  /* cull static hazards once safely behind the player */\n  playerShip.getWorldPosition(tmpPlayerPos);\n  const playerZ = tmpPlayerPos.z;\n  if (!EDITOR_MODE && playerZ <= -5335 && !shownDialogueIds.has('heavy-fire')) {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({\n        type: 'dialogue',\n        payload: {\n          id: 'heavy-fire',\n          portraitSrc: './textures/yellow.png',\n          textLines: ['Heavy enemy fire ahead! Do a barrel roll! (Press Q/E)']\n        }\n      });\n    } else {\n      handleDialoguePayload({\n        id: 'heavy-fire',\n        portraitSrc: './textures/yellow.png',\n        textLines: ['Heavy enemy fire ahead! Do a barrel roll! (Press Q/E)']\n      });\n    }\n  }\n  if (!EDITOR_MODE && playerZ <= -8400 && !shownDialogueIds.has('boss-8400')) {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({\n        type: 'dialogue',\n        payload: {\n          id: 'boss-8400',\n          portraitSrc: './textures/boss.png',\n          textLines: ['I will deal with these pestilent welps myself.']\n        }\n      });\n    } else {\n      handleDialoguePayload({\n        id: 'boss-8400',\n        portraitSrc: './textures/boss.png',\n        textLines: ['I will deal with these pestilent welps myself.']\n      });\n    }\n  }\n  if (!EDITOR_MODE && playerZ <= -8600 && !shownDialogueIds.has('boss-8600')) {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({\n        type: 'dialogue',\n        payload: {\n          id: 'boss-8600',\n          portraitSrc: './textures/boss.png',\n          textLines: ['You will be destroyed.']\n        }\n      });\n    } else {\n      handleDialoguePayload({\n        id: 'boss-8600',\n        portraitSrc: './textures/boss.png',\n        textLines: ['You will be destroyed.']\n      });\n    }\n  }\n  if (!EDITOR_MODE && playerZ <= -8200 && !shownDialogueIds.has('protag-ahead')) {\n    if (RUNNING_IN_WORKER && typeof self?.postMessage === 'function') {\n      self.postMessage({\n        type: 'dialogue',\n        payload: {\n          id: 'protag-ahead',\n          portraitSrc: './textures/protag.png',\n          textLines: [\"Something's up ahead. Looks different.\"]\n        }\n      });\n    } else {\n      handleDialoguePayload({\n        id: 'protag-ahead',\n        portraitSrc: './textures/protag.png',\n        textLines: [\"Something's up ahead. Looks different.\"]\n      });\n    }\n  }\n  if (!androssActive && playerZ <= ANDROSS_SPAWN_Z) {\n    androssBoss.activate(t);\n    androssActive = true;\n  }\n  queueCullTasks(playerZ);\n\n  /* fade/activate large set pieces near the player */\n  updateSetPieces(gameplayDt);\n\n  /* subsystem updates */\n  allySystem?.update(gameplayDt, t);\n  laserUpdateOptions.allowFire = !inputLocked && playerAlive;\n  lasers.update(gameplayDt, playerShip, laserUpdateOptions);\n  updateAsteroids(gameplayDt, camera);\n  collisions.update(gameplayDt);\n  enemySystem.update(gameplayDt, t);\n  blueEnemySystem.update(gameplayDt, t);\n  blueStraightSys.update(gameplayDt, t);\n  diagEnemySystem.update(gameplayDt, t);\n  diagRLSystem.update(gameplayDt, t);\n  zigzagWideSys.update(gameplayDt, t);\n  zigzagTightSys.update(gameplayDt, t);\n  hoverBobSys.update(gameplayDt, t);\n  spiralSys.update(gameplayDt, t);\n  pickupSystem.update(gameplayDt, introActive ? introStartMs : simNowMs);\n  spiderSys.update(gameplayDt, t);\n  jetEnemySys.update(gameplayDt, t);\n  frigateEnemySys.update(gameplayDt, t);\n  platSys.forEach(s => s.update(gameplayDt));\n  bossSystem.update(gameplayDt, t);\n  stationSystem.update(gameplayDt, t);\n  stationTurretSystems.forEach(sys => sys.update(gameplayDt));\n  sharedBoltPool.update(gameplayDt);\n  explosions.update(gameplayDt, camera);\n  largeExplosions.update(gameplayDt, camera);\n  wingExplosions.update(gameplayDt, camera);\n  asteroidExplosions.update(gameplayDt, camera);\n  androssBoss?.update(gameplayDt, t, playerZ, pauseActive);\n}\n\nif (EDITOR_MODE) {\n  initEditorMode();\n  return;\n}\n\nrenderer.setAnimationLoop(() => {\n  if (pendingResize?.size) {\n    if (typeof pendingResize.dpr === 'number') {\n      globalThis.devicePixelRatio = pendingResize.dpr;\n    }\n    syncViewportSize(true, pendingResize.size);\n    pendingResize = null;\n  } else {\n    syncViewportSize();\n  }\n  if (loadingPreviewActive) {\n    renderer.render(scene, camera);\n    return;\n  }\n\n  const now = performance.now();\n  const elapsedMs = now - lastFrameMs;\n  const intervalMs = frameIntervalMs();\n  if (fpsCapEnabled && elapsedMs < intervalMs) {\n    return; // wait until the desired frame interval passes\n  }\n  if (elapsedMs > INPUT_STALL_RESET_MS) {\n    clearInputState();\n    lasers?.clearInput?.();\n  }\n\n  const rawDt = elapsedMs / 1000;\n  const cappedDt = fpsCapEnabled ? Math.min(rawDt, intervalMs / 1000) : rawDt;\n  const frameDt = Math.min(MAX_FRAME_DT, cappedDt);\n  lastFrameMs = fpsCapEnabled\n    ? now - (elapsedMs % intervalMs)\n    : now;\n\n  // dynamic resolution scaling: track frame times and adjust pixel ratio\n  frameTimes.push(elapsedMs);\n  if (frameTimes.length > FRAME_WINDOW) frameTimes.shift();\n  if (drsEnabled && frameTimes.length === FRAME_WINDOW) {\n    const avgMs = frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length;\n    const targetMs = 1000 / targetFps;\n    const over = avgMs > targetMs * 1.05;\n    const under = avgMs < targetMs * 0.9;\n    drsOverrunCount = over ? drsOverrunCount + 1 : 0;\n    drsUnderrunCount = under ? drsUnderrunCount + 1 : 0;\n    const step = laptopPreset ? 0.1 : 0.05; // ramp faster on laptop preset\n    if (drsOverrunCount >= 3 && drsPixelRatio > DRS_MIN_PIXEL_RATIO) {\n      drsPixelRatio = Math.max(DRS_MIN_PIXEL_RATIO, drsPixelRatio - step);\n      renderer.setPixelRatio(drsPixelRatio);\n      drsOverrunCount = 0;\n    } else if (drsUnderrunCount >= 5 && drsPixelRatio < DRS_MAX_PIXEL_RATIO) {\n      drsPixelRatio = Math.min(DRS_MAX_PIXEL_RATIO, drsPixelRatio + step);\n      renderer.setPixelRatio(drsPixelRatio);\n      drsUnderrunCount = 0;\n    }\n  }\n\n  simAccumulator = Math.min(simAccumulator + frameDt, MAX_ACCUMULATED_DT);\n  const fixedDt = 1 / targetFps;\n  let simNowMs = now - simAccumulator * 1000;\n  let steps = 0;\n  while (simAccumulator >= fixedDt && steps < MAX_SIM_STEPS) {\n    simNowMs += fixedDt * 1000;\n    simulateStep(fixedDt, simNowMs);\n    simAccumulator -= fixedDt;\n    steps++;\n  }\n\n  storeCurrentState();\n  const alpha = fixedDt > 0 ? (simAccumulator / fixedDt) : 0;\n  applyInterpolation(alpha);\n\n\n  /* camera look-ahead */\n  railNode.getWorldDirection(tmpForward);\n  camera.getWorldPosition(tmpCameraPos);\n  camera.lookAt(tmpCameraPos.add(tmpForward));\n\n  renderer.render(scene, camera);\n  restoreCurrentState();\n  /* diagnostics (fps + optional wing debug) */\n  const diagLines = [\n    fpsCapEnabled ? `FPS cap: ${Math.round(targetFps)}` : 'FPS cap: off',\n    allowFpsToggle ? 'Toggle cap: unbound' : 'FPS cap locked (laptop preset)',\n    drsEnabled ? `DRS: ${drsPixelRatio.toFixed(2)}x` : 'DRS: off'\n  ];\n  if (globalThis.__DEBUG_WINGS__ && playerShip?.userData) {\n    const wingL = playerShip.userData.wingHpLeft ?? '?';\n    const wingR = playerShip.userData.wingHpRight ?? '?';\n    const wingVar = playerShip.userData.wingVariant ?? '?';\n    const lastWing = playerShip.userData.lastWingHit ?? 'none';\n    const lastWingAt = playerShip.userData.lastWingHitAt ?? 0;\n    const wingAge = lastWingAt ? `${Math.max(0, now - lastWingAt).toFixed(0)}ms` : '-';\n    const hitAt = playerShip.userData.lastHitAt ?? 0;\n    const hitAge = hitAt ? `${Math.max(0, now - hitAt).toFixed(0)}ms` : '-';\n    diagLines.push(`Wing HP L/R: ${wingL}/${wingR}  Variant: ${wingVar}`);\n    diagLines.push(`Last wing hit: ${lastWing} (${wingAge})`);\n    diagLines.push(`Last hit age: ${hitAge}`);\n  }\n  queueDiagnostics(rawDt, diagLines);\n});\n\n} // end runGame\n\nfallbackRun = () => {\n  try {\n    runGame();\n  } catch (err) {\n    console.error('Fallback main-thread run failed', err);\n  }\n};\n\nif (RUNNING_IN_WORKER) {\n  runGame()\n    .then(() => { self.postMessage && self.postMessage({ type: 'ready' }); })\n    .catch(err => {\n      self.postMessage && self.postMessage({\n        type: 'fatal',\n        error: { message: err?.message, stack: err?.stack }\n      });\n    });\n} else if (!renderWorkerLaunched) {\n  fallbackRun();\n}\n"],"names":["isWorker","hearts","score","bombs","meterState","bossHealth","bossAltHealth","notifyHost","HUD_METER_SEND_INTERVAL_MS","HUD_METER_EPSILON","lastHudSent","lastHudSentAt","renderScore","renderMeter","renderBoss","hud","hudDisabled","lastScoreText","lastBombText","lastMeterFraction","lastMeterColor","lastMeterShow","primaryBossState","altBossState","scoreLine","bombsMeterRow","bombsWrap","bombBadge","bombCountLine","meterWrap","meterFill","createBossBar","bossWrap","bossFill","primaryBar","altBar","nextText","nextBombText","clamped","nextColor","show","renderBossBar","bar","fraction","state","pushHudState","meterFraction","meterActive","meterRecharging","meterMode","boss","bossAlt","now","scoreChanged","heartsChanged","bombsChanged","bossChanged","bossAltChanged","meterFractionChanged","meterActiveChanged","meterRechargingChanged","meterModeChanged","addScore","pts","loseHeart","gainHeart","amount","getScore","setBombs","count","setBurstMeter","active","recharging","mode","setBossHealth","setBossHealthAlt","syncHud","scoreDirty","bombsDirty","meterDirty","bossDirty","bossAltDirty","nextFraction","nextActive","nextRecharging","nextMode","currentFraction","currentActive","currentRecharging","currentMode","nextBoss","nextBossAlt","toLambert","material","lambert","THREE.MeshLambertMaterial","THREE.Color","THREE.FrontSide","initBossHead","scene","modelPath","eyesPath","rig","boltPool","playerObj","railSpeed","summonWave","materialMode","prepareMeshBounds","root","o","loader","GLTFLoader","MAX_HP","hp","flashT","meshList","eyesMeshList","eyesRoot","eyesBlinkIdx","eyesBlinkTimer","eyesBlinkPattern","tmpBox","THREE.Box3","tmpSize","THREE.Vector3","tmpCenter","tmpInv","THREE.Matrix4","tmpSphere","THREE.Sphere","useLambert","setEmissive","list","r","g","b","m","blink","setEyesBlink","on","startEyesBlink","updateEyesBlink","dt","entry","amt","damage","err","eyesHitRadius","localBox","damageEyes","idleT","eyeSweepCd","sweeping","sweepT","retreating","tmp","tmpHead","tmpQuat","THREE.Quaternion","tmpQuatLook","headForward","aimTarget","aimHistory","aimPool","i","tmpAimFallback","tmpHeadPos","tmpTarget","tmpDirL","tmpDirR","tmpDirToAim","fallbackForward","elapsed","lastPlayerZ","IDLE_PHASES","getIdlePhase","ratio","p","headSwayAngle","swaySpeed","targetSwaySpeed","swayChangeTimer","eyeOffsetL","eyeOffsetR","eyeWorldL","eyeWorldR","aimInitialized","beamMat","THREE.MeshBasicMaterial","THREE.AdditiveBlending","BEAM_LEN","beamGeo","THREE.BoxGeometry","eyeBeamL","THREE.Mesh","eyeBeamR","startEyeSweep","stopEyeSweep","updateEyeBeams","headPos","lookDirL","lookDirR","update","tPlayer","allowFire","paused","e","hpRatio","phase","baseY","playerPos","sample","targetTime","oldSample","prev","next","a","span","alpha","THREE.MathUtils","full","blinkHead","scaled","initBossHand","palmPath","side","headMesh","getHeadHpRatio","palmRoot","palmMeshList","palmBlinkIdx","palmBlinkTimer","palmBlinkPattern","defense","setPalmBlink","startPalmBlink","updatePalmBlink","palmHitRadius","damagePalm","worldBox","inv","size","center","scale","halfSize","palmOffset","anchorHistory","anchorPool","tmpAnchorFallback","anchorElapsed","headAnchorScratch","delayedHeadScratch","tmpAnchoredBase","tmpIdlePos","baseOffset","palmTiltDir","getAnchorDelay","swipeCd","blastCd","swipeLungeT","swipeDist","swipeDir","swipeAxis","charging","chargeT","SWIPE_DURATION","SWIPE_DAMAGE_RADIUS2","tmpRootPos","tmpPlayerPos","tmpDirVec","tmpPlayerLocal","tmpHandLocal","tmpArcSide","tmpForwardRef","currentHeadPos","delay","prevSample","nextSample","histAlpha","loop","progress","offset","tilt","_b","_a","s","handle","blinkHand","setDefense","flag","setNoScore","forceRemove","createBossMissileSystem","explosionPool","poolSize","FORWARD","missiles","tmpV","tmpDir","tmpPrewarmPos","tmpPrewarmDir","burstQueue","burstTimer","BURST_SPACING","spawningEnabled","makeMissile","group","THREE.Group","bodyMat","THREE.MeshPhongMaterial","tipMat","finMat","glowMat","body","THREE.CylinderGeometry","tip","THREE.ConeGeometry","fin","fin2","exhaust","THREE.SphereGeometry","spawnBurst","offsets","ox","idx","launchQueuedMissile","mi","dirSign","origin","spawnPos","dir","destroyMissile","clearAll","player","ud","targetVel","processBurstQueue","getActiveShips","setSpawning","prewarm","renderer","camera","layer","prevCulls","c","initBossAndross","spawnZ","canFire","onHeadDestroyed","handCleanupDelay","onDialogue","THREE.Object3D","head","leftHand","rightHand","missileSystem","missileCd","missileMuted","headDefeated","handCleanupScheduled","phase2Dialogue","phase3Dialogue","emitDialogue","payload","baseZ","recentDamage","damageWindow","DAMAGE_WINDOW_TIME","BURST_THRESHOLD","onHeadDamaged","activate","_c","deactivate","playerZ","defender","idle","damageHead","critical","actual","dead","_d","doCleanup","damageHand","which","hand","headRoot","leftRoot","leftPalm","rightRoot","rightPalm","getEnemyParts","parts","eyes","palm","handleLaserHit","mesh","PREWARM_LAYER","prevTarget","prevCameraMask","prevVis","prevBeams","prevParts","prevLayers","prevLightLayers","beams","tmpPos","beam","rt","THREE.WebGLRenderTarget","_e","vis","pos","quat","culled","mask","ASTEROID_TYPES","initAsteroids","spawnArray","rockSrc","pickType","cfg","found","t","rock","preset","camPos","RENDER_DIST","initPlayerShip","parent","path","wingLeftPath","wingRightPath","fallbackColour","loadModel","fallbackModel","THREE.MeshStandardMaterial","tmpMatrix","tmpVec","tmpSizeVec","computeLocalBounds","box","node","computeNoseTipZ","bounds","xLimit","yLimit","zSamples","step","skip","prepareBody","model","data","prepareWing","bodyModel","bodyData","wingLeftModel","wingRightModel","wingLeft","wingRight","sphere","combinedBox","addLocalBox","obj","radius","noseTipZ","nosePoint","MAX_ROLL","MAX_YAW","MAX_PITCH","DAMP","ROLL_TIME","rollT","rollDir","SIDE_BANK_ANGLE","glowGeo","THREE.CircleGeometry","makeGlowMat","hex","opacity","softness","THREE.ShaderMaterial","THREE.DoubleSide","outerGlow","innerGlow","baseGlowScaleOuter","baseGlowScaleInner","engineOffset","TAIL_SEGMENTS","TAIL_SPACING","TAIL_FADE_IN","TAIL_FADE_OUT","TAIL_SMOOTH","TAIL_START_SCALE","TAIL_END_SCALE","TAIL_BASE_OPACITY","makeTailMat","tailMeshes","tailPositions","tailQuats","tailTargetPos","tailTargetQuat","tailTmpPos","tailCount","tailFade","lastTrailTime","boosting","boostScale","WING_MAX_HP","wingHpLeft","wingHpRight","wingMeshes","tmpWingLocal","tmpWingWorld","tmpWingDir","tmpBodyCenterWorld","tmpWingOrigin","WING_HIT_PAD","wingBlinkColor","WING_BLINK_DURATION","WING_BLINK_RATE","wingBlinkLeftT","wingBlinkRightT","wingBlinkLeftOn","wingBlinkRightOn","warnedMissingWings","syncWingUserData","updateWingVariant","nextKey","setWingVisible","wingData","visible","setWingGlow","spawnWingExplosion","segmentHitsBox","tMin","tMax","sx","sy","sz","dx","dy","dz","min","max","eps","t1","t2","hitWing","hitPointWorld","hitPointPlayerLocal","hitLocal","applyWingDamage","leftHit","rightHit","leftDist","meshes","intensity","updateWingBlink","leftActive","rightActive","pulse","restoreWings","bankDir","tgtRoll","tgtYaw","tgtPitch","spin","startRoll","isRolling","getRollDir","updateTrail","stepDt","scaleBoost","fade","setEngineGlowScale","mult","initAllyShip","railCurve","laserSystem","enemySystem","enemyLasers","enemyBoltPool","onEscortOutcome","playerSpeed","spawn","spawnTriggerZ","modelProto","boundsCenter","hitSphere","hitRadius","engineZ","createAllyRoot","escortRoot","targetA","targetB","fireSequence","ATTACK_START_MAX","ATTACK_START_MAX_SQ","FORWARD_TARGET","APPROACH_SPEED","FOLLOW_LERP","FIRE_DELAY","FIRE_INTERVAL","EXIT_DELAY","EXIT_FORWARD_SPEED","EXIT_LEFT_SPEED","EXIT_UP_SPEED","EXIT_DURATION","ESCORT_TRIGGER_Z","ESCORT_RESUME_Z","ESCORT_WAYPOINTS","ESCORT_SPAWN_POS","ESCORT_CHASER_CLEANUP_PAD","ESCORT_CHASER_CLEANUP_Z","ESCORT_CHASER_SPAWNS","ESCORT_CHASER_OFFSETS","ESCORT_SLOW_MULT","ESCORT_MATCH_LERP","ESCORT_WAYPOINT_EPS","ESCORT_CHASER_SPEED","ESCORT_ROLL_INTERVAL","ESCORT_EXIT_FORWARD_SPEED","ESCORT_EXIT_RIGHT_SPEED","ESCORT_EXIT_UP_SPEED","ESCORT_SCALE","TARGET_X","TARGET_Y","WORLD_UP","forwardAxis","FORWARD_FIX","tmpForward","tmpRailForward","tmpRight","tmpUp","tmpDesired","tmpAim","tmpLookMat","tmpLookTarget","tmpRollQuat","tmpExitVel","tmpExitForward","tmpEscortExitVel","tmpEscortExitForward","tmpEscortDir","tmpSeg","tmpToCenter","tmpClosest","tmpBoltDir","tmpBoltPos","tmpAxisZ","railLength","spawned","forwardOffset","attackElapsed","fireIndex","exitElapsed","rollAngle","escortActive","escortSpawned","escortState","escortSpeed","escortWaypoint","escortRollT","escortRollAngle","escortRollCooldown","escortExitElapsed","escortDestroyTimer","escortChasers","prevPlayerT","playerSpeedNow","escortOutcomeSent","escortCleanupDone","spawnNow","forward","right","up","triggerBlink","targetRoot","updateBlink","base","baseColor","segmentSphereHit","radiusSq","segLenSq","spawnEscort","spawnEscortChasers","spawnEscortChaser","chaser","ship","countAliveChasers","alive","cleanupEscortChasers","checkEscortLaserHits","lasers","bolt","fireEscortKillShots","targetPos","updateOrientation","desiredForward","deltaT","speed","d2A","d2B","aliveChasers","target","dist","baseSpeed","targetSpeed","arriveDist","aimDir","prevPos","prevQuat","createExplosionPool","baseSize","colors","life","geo","THREE.PlaneGeometry","canvas","ctx","grad","tex","THREE.CanvasTexture","defaultPalette","palette","opacities","variants","pool","mat","position","lifeOverride","fx","maxLife","baseOpacity","prevSize","THREE.Vector2","createLaserSystem","colour","cooldown","bossMesh","damageBoss","bossHitR2","stationMesh","damageStation","getEnemies","passageCollider","passageColliders","onEnemyKilled","onShotFired","onShotHit","dualMode","blueMode","damageMult","BASE_COLOR","BLUE_COLOR","LASER_WIDTH","LASER_RADIUS","tmp2","tmpPrev","tmpKill","blastFX","tmpAllyDir","tmpAllyQuat","MIN_HIT_R2","MAX_FLIGHT_T","ALLY_POOL_SIZE","allyMat","allyPool","CHARGE_COUNT","CHARGE_TIME","CHARGE_SPEED","CHARGE_RANGE","BOSS_MESH","DAMAGE_BOSS","BOSS_R2","STATION_MESH","STATION_COLLIDER","DAMAGE_STATION","CAMERA","GET_ENEMY","CHARGE_SCALE_MIN","CHARGE_SCALE_MAX","CHARGE_DAMAGE","BLAST_INNER_R","BLAST_OUTER_R","BLAST_MID_R","BLAST_COLOR_INNER","BLAST_COLOR_OUTER","BLAST_LIFE","BLAST_START_SCALE","CHARGE_FORWARD_OFFSET","CHARGE_FORWARD_TWEAK","CHARGE_NOSE_PAD","BOMB_RADIUS","BOMB_SPEED","BOMB_RANGE","BOMB_POOL_SIZE","BOMB_BLAST_INNER_R","BOMB_BLAST_OUTER_R","BOMB_BLAST_LIFE","BOMB_BLAST_START_SCALE","BOMB_DPS","BOMB_IMPACT_DAMAGE","PASSAGE_COLLIDERS","MUZZLE_POOL_SIZE","MUZZLE_BACK_OFFSET","MUZZLE_BASE_SIZE","MUZZLE_LIFE","TINY_IMPACT_LIFE","muzzleFxGreen","muzzleFxBlue","setBlastOpacity","value","createBlastMidMaterial","cGeo","cMat","chargePool","bombBodyMat","bombFaceMat","bombLetterMat","bombCore","bombBody","THREE.IcosahedronGeometry","bombFace","bombLetter","bStem","bTop","bBottom","bombPool","core","bombBlastFX","bombInnerGeo","bombOuterGeo","bombInnerMat","bombOuterMat","bombSpikeLen","bombSpikeGeo","bombSpikeMat","bombSpikeUp","bombSpikeDirs","v","createBombBlast","grp","inner","outer","spikes","spike","retGeo","THREE.RingGeometry","retMat","reticle","retLiteGeo","retLiteMat","reticleLite","retForward","retShipPos","retBillboardQ","RETICLE_DISTANCE","RETICLE_LITE_FACTOR","RETICLE_OPACITY_CHARGE","RETICLE_OPACITY_IDLE","RETICLE_LITE_OPACITY_CHARGE","RETICLE_LITE_OPACITY_IDLE","LOCK_MAX_DIST","LOCK_MAX_R2","forwardZ","fallbackForwardZ","homingForward","homingDesired","homingNew","lockVec","homingTargetPos","segDir","segMin","segMax","segBox","boxScratch","tmpStaticPos","shotIdCounter","nextShotId","suppressShotEvents","getProjectileForwardOffset","fromObject","noseOffset","setProjectilePosition","out","forwardQuat","nosePad","useQuat","TMP_FORWARD","getMuzzlePosition","offX","TMP_SIDE","segmentHitsCollider","collider","curr","aabb","hit","stationLinecast","stationIntersectsSphere","linecastStatic","col","intersects","applyStaticDamage","projectile","destructible","dmg","nextHp","findLockTarget","bestR2","candidate","enemies","f","l","r2","applyHoming","blend","desired","fwdNow","newFwd","triggerHeld","timer","fireCount","chargeObj","nextTarget","lockedTarget","lockTimer","LOCK_FADE","fireMuted","SINGLE_OFFSETS","DUAL_OFFSETS","resetTriggerState","shotId","fxPos","fireAllyShot","spawnTinyImpact","isBlue","spawnChargeSphere","initialScale","fireBomb","bomb","locked","baseOp","prevLife","dtApplied","applyBombDamage","reticleActive","expired","explodeNow","hitStatic","hitTarget","chargeRadius","hitR2","explodeCharge","bombRadius","explodeBomb","getActive","awardEnemyKill","scoreValue","killEnemy","bossHit","innerR","androssGroups","isCriticalAndross","part","didHit","processed","owner","died","blastR","_f","bombDamageProcessed","bombAndrossGroups","isCriticalAndrossPart","applyBombDamageAmount","cam","prevAlly","prevCharge","prevBomb","prevBombFx","prevRet","prevRetLite","prewarmDual","prevDual","prevBlue","prevDamage","applyLaserMode","enableBlue","resetUpgrades","addStarfield","depth","THREE.BufferGeometry","THREE.BufferAttribute","THREE.Points","THREE.PointsMaterial","createCollisionSystem","asteroidGroup","enemyShips","playerMesh","playerRadius","asteroidPassage","staticHazards","hazardPlayerCollisionEnabled","hazardLaserCollisionEnabled","hazardEnemyCollisionEnabled","asteroidHazardCollisionEnabled","onLaserHit","onPlayerHit","onEnemyDestroyed","onEnemyNeutralized","onAsteroidDestroyed","androssBeams","tmpShip","tmpRock","segTmpA","segTmpB","Z_GATE","ASTEROID_Z_PAD","tmpHandClosest","handHitCooldowns","beamClosest","beamSegA","beamSegB","tmpLocalPrev","tmpLocalCurr","tmpHit","BEAM_HIT_COOLDOWN","beamHitTimer","stationCollider","hazards","addHazard","stationInsideTimer","stationColliding","killRock","awardScore","damageEnemyShip","segmentIntersectsBox","tmin","tmax","segmentHitsHazard","onHit","h","prevZ","currZ","zGate","gate","segMinY","segmentDistSq2D","damageHazard","hazard","cx","cz","abx","abz","acx","acz","abLenSq","playerBolts","enemyBoltArr","laser","playerPosZ","shipPos","bbox","pointSegmentDistSq","hitR","shipWorld","hitBoxes","skipInside","inside","hitPoint","stateMap","_g","_h","_i","halfZ","androssPart","handCol","isHand","collided","cd","playerLocal","rHand","lenSq","showOverlay","acc","frames","el","emit","lastHtml","renderDiagnosticsLines","lines","html","updateDiagnostics","extraLines","fps","CAPTURED_ENEMY_PATHS","_modelCache","sharedLoader","loadModelCached","gltf","initEnemySystem","yaw","fireDir","orbitRadius","orbitRate","diagSpeed","diagVec","lateralAmp","lateralHz","verticalAmp","verticalHz","retreatDist","despawnDelay","behaviour","dualGun","gunSpacing","fireInterval","fireOffsetZ","burstCount","burstInterval","burstPause","passLoop","passDuration","passAhead","passBehind","passFireWindow","orientToVelocity","orientToPlayerWhenFiring","glowOffset","hazardColliders","hazardEntries","bakedPaths","useBakedPaths","manualPoolSize","editorGroup","backpedal","spawnList","proto","yawFixQ","forwardAxisNorm","LASER_LIFE","BOLT_POOL","useBurstFire","losHazards","tmpFireForward","tmpBoltQuat","tmpFireQuat","tmpBoltUp","tmpBoltBack","tmpBoltRight","tmpChaseOffset","tmpChaseAim","tmpLosDir","tmpLosMin","tmpLosMax","tmpLosBox","addLosHazard","hasLineOfSight","fireLaser","from","spawnBolt","offsetX","boltQuat","forwardDir","lockGeo","lockMat","glowCanvas","gctx","ggrad","glowTex","makeBasicGlow","outerGlowMat","innerGlowMat","glowOffsetZ","defaultGlowOffset","glowOffsetVec","innerGlowOffset","offsetDir","baseScale","globalScale","glowScaleMult","ACTIVE","ACTIVE_SHIPS","spawnQueue","bakedPathLookup","createShipInstance","n","ring","shipPool","manualPool","allShips","SPAWN_RADIUS","SPAWN_RADIUS_SQ","BUCKET_SIZE","spawnBuckets","bucketKey","k","resetShipState","baked","materializeSpawns","tmpTargetPos","tmpChaseDir","railDir","tmpBack","tmpPrevPos","tmpVel","tmpFaceQuat","tmpLosOrigin","CULL_Z_BEHIND","spawnedThisFrame","MAX_SPAWN_PER_FRAME","centerKey","keys","kIdx","usedBakedPath","chaseTarget","chaseOffset","chaseOffsetMode","chaseMinDist","chaseActive","aimPos","chaseSpeed","passLoopActive","zOffset","xOffset","yOffset","vLat","useForwardAxis","facePlayer","movingToward","flashing","prewarmRender","prewarmSpawn","prevStates","previewSetup","spacing","faceTarget","maxCount","manualSpawnIdx","manualSpawnCfg","spawnManual","overrides","initFrigateEnemySystem","spawnBlue","moveSpeed","wingBurstCount","wingBurstInterval","wingBurstPause","noseFireInterval","bigLaserScale","spawnInterval","spawnLimit","spawnRadius","cullBehind","faceMinDistance","baseBox","baseCenter","baseHitRadius","rootInv","maxDim","gridX","gridY","gridZ","cellCount","filled","baseMin","sizeX","sizeY","sizeZ","invSizeX","invSizeY","invSizeZ","toIndex","ix","iy","iz","sawVertex","posAttr","z0","z1","y0","y1","x0","x1","axisUp","axisRight","baseCorners","axisExtents","axis","corner","fExt","rExt","uExt","buildLocalPos","noseForward","wingForward","bellyForward","noseRight","noseLeft","wingUp","noseUp","bellyUp","baseWingLeft","baseWingRight","baseNoseLeft","baseNoseRight","baseBelly","createFrigateInstance","tmpPlayer","tmpSpawn","tmpOffset","boltForward","lookQuaternion","to","worldPos","worldQuat","big","resetFrigate","scaleMult","totalScale","spawnCap","yawOffset","spawnOffset","fired","useRight","noseLocal","BEHAVIOURS","initBossSystem","onDestroyed","autoDespawnZ","d","guns","FIRE_INT","isBig","getActiveLasers","destroyed","getMesh","tmpWorld","lookForward","fireTimer","autoKillZ","bossT","camDir","initPickupSystem","blueSpawnArray","ringSpawnArray","wingRepairSpawnArray","bombSpawnArray","onBombPickup","onRingCollected","tmp1","PICKUP_SPAWN_DISTANCE","barGeo","barMat","BLUE_LASER_COLOR","barMatBlue","bridgeGeo","bridgeMat","bridge","letterMat","vert","horiz","letterGrp","createDualCore","barMaterial","barL","barR","pickupCore","pickupBlueCore","pickups","inst","bluePickups","createBlueEntry","pending","BLUE_POOL_EXTRA","RING_OUTER_R","RING_INNER_R","RING_SCALE","RING_RADIUS","RING_RADIUS2","RING_HALF_DEPTH","RING_COLLECT_DURATION","RING_SPIN_SPEED","RING_MAJOR_R","RING_TUBE_R","ringGeo","THREE.TorusGeometry","ringMat","ringMesh","ringGrp","ringPickups","RING_POOL_EXTRA","createRingEntry","wingCore","wingCoreMat","wingBarMat","socketOuter","socketInnerMat","socketInner","openBase","jawGeo","jawL","jawR","wingCoreBounds","wingCoreCenter","child","wingCoreRadius","wingPickups","dualSpawnCount","WING_POOL_EXTRA","createWingEntry","BOMB_SCALE","BOMB_EMISSIVE_SCALE","sharedBombMaterials","makeBombEmissive","applyBombMaterials","key","bombCoreBounds","bombCoreCenter","bombCoreRadius","bombPickups","BOMB_POOL_EXTRA","createBombEntry","setPickupInactive","setWingPickupInactive","spawnWingRepairAt","spawnBluePickupAt","hasMissingWing","left","shouldSpawnAt","missingWing","hasDualGreen","hasDualBlue","shrink","tmpCamPos","tmpCamDir","tmpWarmPos","warmState","warmPickup","warmRing","idleCull","spawnHealRingAt","materializeAll","initPlatformSystem","spinRate","gunArc","ACTIVATE_DIST","GUN_DIRS","muzzleR","GUN_POS","LASER_SPD","fireGun","tmpWorldV","activeLasers","lrGeo","lrMat","lockRing","vPlayerDir","vPlayerWS","vRootWS","tmpWorldQ","DESPAWN_Z","prevCull","_turretCache","getTurretProto","initStationTurretSystem","turret","raycaster","THREE.Raycaster","playerWorldPos","lastPlayerPos","playerVel","turretWorldPos","leadTarget","fwdVec","MAX_LEAD_TIME","hasPlayerPrev","fireBolt","leadTime","hasClearShot","destroy","createBoltPool","smallCount","bigCount","smallColor","bigColor","geoSmall","matSmall","meshSmall","THREE.InstancedMesh","THREE.DynamicDrawUsage","geoBig","matBig","meshBig","small","activeList","dirVec","dummyHandle","alloc","dummyHandleBig","setTransform","free","bounced","arr","quaternion","scaleOverride","_m","_scale","flushInstances","MATERIAL_TEXTURE_KEYS","capMaterialAnisotropy","cap","freezeStaticTransforms","makeSpatialHash","cellSize","map","keyOf","insertTri","aabbMin","aabbMax","triIndex","cs","queryAABB","seen","closestPointOnTri","_v1","_v2","_v3","_v4","ab","ac","ap","d1","d2","bp","d3","d4","vc","cp","d5","d6","vb","w","va","denom","rayTri","rayOrig","rayDir","_v5","edge1","edge2","pvec","det","invDet","tvec","u","qvec","buildMeshCollider","sceneForDebug","_aabbMin","_aabbMax","_expandedAABB","_closest","_triN","geos","merged","BufferGeometryUtils.mergeGeometries","index","_","triCount","tris","hash","i0","i1","i2","worldAABB","_candIdx","_segmentAABB","outMin","outMax","_gatherCandidates","outIdx","testSphere","cand","bestDepth","tri","dist2","constrainPoint","maxIterations","result","probe","push","linecast","maxDist","tBox","THREE.Ray","end","bestT","bestN","point","isPointInside","pt","crossings","addDebugWire","initStationBoss","colliderCellSize","anisotropyCap","freezeTransforms","station","prewarmPos","prewarmDir","_tmpSize","initAsteroidPassage","rotation","minDim","midDim","thickness","volume","density","raw","_changeEvent","_startEvent","_endEvent","_ray","Ray","_plane","Plane","_TILT_LIMIT","MathUtils","_v","Vector3","_twoPI","_STATE","_EPS","OrbitControls","Controls","object","domElement","MOUSE","TOUCH","Quaternion","Spherical","Vector2","onPointerMove","onPointerDown","onPointerUp","onContextMenu","onMouseWheel","onKeyDown","onTouchStart","onTouchMove","onMouseDown","onMouseMove","interceptControlDown","interceptControlUp","element","deltaTime","zoomChanged","prevRadius","newRadius","radiusDelta","mouseBefore","prevZoom","mouseAfter","delta","normalizedDelta","angle","distance","objectMatrix","deltaX","deltaY","targetDistance","dollyScale","x","y","rect","event","needsUpdate","centerX","centerY","pointerId","newEvent","mouseAction","_raycaster","Raycaster","_tempVector","_tempVector2","_tempQuaternion","_unit","_mouseDownEvent","_mouseUpEvent","_objectChangeEvent","TransformControls","TransformControlsRoot","gizmo","TransformControlsGizmo","plane","TransformControlsPlane","scope","defineProperty","propName","defaultValue","propValue","worldPosition","worldPositionStart","worldQuaternion","worldQuaternionStart","cameraPosition","cameraQuaternion","pointStart","pointEnd","rotationAxis","rotationAngle","eye","getPointer","onPointerHover","pointer","intersect","intersectObjectWithRay","planeIntersect","space","ROTATION_SPEED","_inPlaneRotation","translationSnap","rotationSnap","scaleSnap","includeInvisible","allIntersections","_tempEuler","Euler","_alignVector","_zeroVector","_lookAtMatrix","Matrix4","_tempQuaternion2","_identityQuaternion","_dirVector","_tempMatrix","_unitX","_unitY","_unitZ","Object3D","controls","force","gizmoMaterial","MeshBasicMaterial","gizmoLineMaterial","LineBasicMaterial","matInvisible","matHelper","matRed","matGreen","matBlue","matRedTransparent","matGreenTransparent","matBlueTransparent","matWhiteTransparent","matYellowTransparent","matGray","arrowGeometry","CylinderGeometry","scaleHandleGeometry","BoxGeometry","lineGeometry","BufferGeometry","Float32BufferAttribute","lineGeometry2","CircleGeometry","arc","geometry","TorusGeometry","TranslateHelperGeometry","gizmoTranslate","Mesh","OctahedronGeometry","pickerTranslate","helperTranslate","Line","gizmoRotate","helperRotate","pickerRotate","SphereGeometry","gizmoScale","pickerScale","helperScale","setupGizmo","gizmoMap","name","tag","tempGeometry","handles","factor","PlaneGeometry","DoubleSide","THREE.Cache","isElectron","RUNNING_IN_WORKER","EDITOR_MODE","ENABLE_RENDER_WORKER","USE_RENDER_WORKER","LEVEL_INTRO_DURATION_MS","LEVEL_INTRO_TITLE","LEVEL_INTRO_OBJECTIVE","LOADING_PREVIEW_FADE_MS","LOADING_PREVIEW_HOLD_MS","LOADING_PREVIEW_TOTAL_MS","LOADING_FADE_OUT_MS","LOADING_PROGRESS_DURATION_MS","DIALOGUE_POP_DELAY_MS","DIALOGUE_POP_DURATION_MS","PAUSE_KEY","BOMB_KEY","CHARACTER_MATERIAL_MODE","GAME_KEY_CODES","renderWorker","renderWorkerLaunched","fallbackRun","laptopPreset","allowFpsToggle","drsOverrunCount","drsUnderrunCount","dialogueTimer","dialogueCleanup","shownDialogueIds","nowMs","stats","SHOT_HIT_BUCKETS","SHOT_HIT_MASK","shotHitBuckets","recordShotFired","recordShotHit","id","recordEnemyDestroyed","recordRingCollected","snapshotStats","endTimeMs","endMs","startMs","formatTime","ms","totalSec","minutes","seconds","buildStatsLines","snapshot","shotsFired","shotsHit","accuracy","introPauseBlockUntilMs","setIntroPauseBlock","durationMs","duration","isPauseBlockedForIntro","degToRad","parseRotation","rotDeg","rot","editorObjects","registerEditorObject","ref","createPauseMenu","panel","title","text","line","restartWrap","startOverButton","startOverHint","confirmWrap","confirmLabel","confirmButtons","yesButton","noButton","confirmHint","confirmHintEnter","confirmHintKeys","setButtonActive","button","showRestart","confirmChoice","keyHandler","setConfirmChoice","choice","yesActive","setMode","attachKeyHandler","detachKeyHandler","setVisible","titleText","options","createEndScreen","statsWrap","badgeRow","restartButton","restartHint","enterHandler","restartHintAnim","attachEnterHandler","detachEnterHandler","scoreText","statsLines","badgeSources","row","src","img","createLoadingUI","onPreviewDone","onFinish","curtain","controlsWrap","titleWrap","titleImage","controlsPanel","controlsTitle","controlsList","label","barWrap","barFill","updateTitleLayout","topSpace","handleResize","targetProgress","animFrame","stepIntervalMs","lastStepMs","previewActive","previewTimer","previewEndTimer","previewAnimation","previewEverShown","finishPending","finishCallback","finished","controlsShown","controlsSuppressed","notifyPreviewDone","applyProgress","pct","allowFull","setProgressFromCounts","loaded","total","tickProgress","autoProgress","finalizeFinish","immediate","totalMs","fadeInOffset","holdOffset","onDone","showDialoguePopup","portraitSrc","textLines","basePortrait","portraitSize","portraitWrap","portraitImg","textPanel","revealTimer","textTimer","hideTimer","removeTimer","handleDialoguePayload","pauseMenu","endScreen","pauseMenuVisible","pauseMenuLocked","endScreenActive","showPauseMenu","lock","hidePauseMenu","showEndScreen","togglePauseMenu","loadingUI","reportLoadingProgress","triggerLoadingPreview","startLevelIntroOverlay","objectiveText","instantBackdrop","introScale","objective","exitMs","exitTimer","scheduleIdle","queued","tasks","runner","deadline","fn","cb","_origLoadAsync","url","rest","installEnemyPathDump","hostCanvas","fallbackTriggered","triggerFallback","offscreen","worker","dpr","inputBatch","inputFlushScheduled","scheduleInputFlush","flushInputBatch","queueInputEvent","code","repeat","forwardedDown","forwardKey","ev","lastResize","readCanvasSize","sendResize","pendingHudState","hudScheduled","pendingDiagLines","diagScheduled","flushHud","flushDiag","evt","msg","delayMs","escortSurvived","missionTitle","_j","runGame","introActive","introStartMs","pauseActive","allowPause","gameOverActive","levelCompleteActive","playerAlive","gameOverStartMs","stationBossDestroyed","bombCount","MISSION_COMPLETE_DELAY_MS","canEnemyFire","allySystem","pickupSystem","laserUpdateOptions","tmpDropPos","maybeDropHealRing","createLoadingOverlay","prewarmPrograms","mats","dummyGeo","dummyScene","THREE.Scene","preloadModels","overlay","manager","THREE.LoadingManager","MODEL_PATHS","curveData","spawns","bakedPathFile","ALL_BAKED_PATHS","MAX_BAKED_MATCH_DIST","MAX_BAKED_MATCH_DIST_SQ","buildBakedPathMap","candidates","used","best","bestDist","samples","obtainCanvas","errMsg","THREE.WebGLRenderer","PIXEL_RATIO_CAP","initialPixelRatio","renderScale","setRendererSize","sw","sh","lastViewportSize","readViewportSize","syncViewportSize","sizeOverride","rawW","rawH","nextAspect","pendingResize","lastKnownCanvasSize","getPreferredViewportSize","forceViewportSync","gl","info","rendererStr","fpsCapEnabled","THREE.SRGBColorSpace","syncRendererToCanvas","THREE.FogExp2","SKY_YAW","pmremGen","THREE.PMREMGenerator","applySkyTex","THREE.EquirectangularReflectionMapping","envRT","skyPath","blob","THREE.Texture","THREE.TextureLoader","THREE.HemisphereLight","sun","THREE.DirectionalLight","THREE.PerspectiveCamera","railNode","steerNode","THREE.CatmullRomCurve3","THREE.Line","THREE.LineBasicMaterial","updateAsteroids","asteroidSpawns","passageDefs","asteroidPassages","primaryPassage","piece","drillDefs","drillTunnel","flatDefs","flatAsteroid","gateBox","gateCenter","gateSize","applyLaserGate","BUILDING_MODELS","buildingCfgs","buildingPieces","propHp","explosions","ENABLE_PLAYER_HAZARD_COLLISIONS","ENABLE_LASER_HAZARD_COLLISIONS","ENABLE_ENEMY_HAZARD_COLLISIONS","ENABLE_BAKED_ENEMY_PATHS","allHazards","HAZARD_CULL_Z","largeExplosions","wingExplosions","asteroidExplosions","tmpExplosionPos","stationExplosionOffsets","shouldUseLargeExplosion","spawnExplosionForShip","resolved","playerShip","updateShipAttitude","shipRadius","platSys","stationTurretSystems","stationSystem","STATION_EXPLOSION_SPACING_MS","spawnStationBossExplosions","fire","sys","setPieces","prepSetPiece","tmpSetpiecePlayer","updateSetPieces","activateDist","shouldBeVisible","sharedBoltPool","bossSystem","tmpDeathPos","triggerMissionComplete","clearInputState","statsSnapshot","androssBoss","prevRigVis","prevRigPos","prevRigQuat","hands","_k","_l","_n","_q","_p","_o","androssActive","ANDROSS_SPAWN_Z","_r","triggerGameOver","gatherEnemies","handlePlayerHit","wingHit","hitAt","heartsLeft","collisions","gatherEnemyLasers","shiftHeld","steerDx","steerDy","STEER_SMOOTH","DEFAULT_SIDE_BANK_DIR","lastStrafeDir","LEFT","RIGHT","UP","DOWN","ROLL_LEFT","ROLL_RIGHT","setPauseActive","DEFAULT_TARGET_FPS","MAX_FRAME_DT","MAX_SIM_STEPS","MAX_ACCUMULATED_DT","targetFps","lastFrameMs","frameIntervalMs","DRS_MIN_PIXEL_RATIO","DRS_MAX_PIXEL_RATIO","drsPixelRatio","frameTimes","FRAME_WINDOW","pendingDiag","pendingCullZ","simAccumulator","handleKeyDown","handleKeyUp","evtObj","synthetic","bakedEnemyPaths","bakedBluePaths","bakedDiagPaths","bakedDiagRLPaths","bakedZigzagWidePaths","bakedZigzagTightPaths","bakedHoverPaths","bakedSpiralPaths","bakedSpiderPaths","bakedJetPaths","EMPTY_BAKED","bakedPathsEnabled","frigateSpawnCount","frigateBluePoolSize","blueEnemySystem","blueStraightSys","diagEnemySystem","diagRLSystem","zigzagWideSys","zigzagTightSys","hoverBobSys","spiralSys","spiderSys","jetEnemySys","frigateEnemySys","survived","enemySystemsList","scratchEnemies","stationEnemies","androssParts","queueDiagnostics","queueCullTasks","z","cullZ","prevCulled","_s","tmpA","previewCamPos","previewCamDir","previewCamRight","previewCamUp","previewOrigin","previewOffset","previewEnemySystems","loadingPreviewActive","previewCleanup","applyLoadingPreviewState","bossPrev","bossCulls","androssPrev","androssPartsPrev","androssCulls","androssMatPrev","androssRig","previewCleanups","cleanup","endLoadingPreview","startLoadingPreview","formatSpawnsForSave","formatValue","val","comma","item","itemComma","initEditorMode","orbit","transform","selectedLine","modeLine","makeNumberInput","placeholder","input","makeRow","labelText","posLine","posInputs","rotLine","rotInputs","scaleLine","scaleInput","statusLine","modeRow","makeModeButton","btn","moveBtn","rotateBtn","scaleBtn","saveBtn","downloadLink","downloadBtn","selected","dragging","isTransformDragging","undoStack","MAX_UNDO","dragUndoEntry","gizmoUndoEntry","downloadUrl","editorPickables","dragPlane","THREE.Plane","dragHit","dragOffset","dragNormal","SET_GROUPS","round","radToDeg","updatePanel","setTransformMode","captureTransform","hasTransformChanged","pushUndo","applyUndo","syncObjectToSpawns","syncAllEditorObjectsToSpawns","markDirty","applyInputsToSelected","read","fallback","posX","posY","posZ","rotX","rotY","rotZ","scl","before","syncSelectedToSpawns","selectObject","rebuildPickables","setDownloadUrl","triggerDownload","anchor","saveSpawns","res","hits","ships","pickupRoots","BASE_SPEED_T","BURST_DURATION","BURST_RECHARGE","BOOST_MULT","BRAKE_MULT","WING_DRIFT_PER_SEC","BOOST_KEY","BRAKE_KEY","INPUT_STALL_RESET_MS","railSpeedMult","burstEnergy","burstActive","burstMode","burstLocked","GAME_OVER_STOP_DELAY_MS","GAME_OVER_STOP_DURATION_MS","clamp01","smoothstep","getRailStopFactor","tNorm","interpState","tmpCameraPos","storePrevState","storeCurrentState","applyInterpolation","tAlpha","restoreCurrentState","simulateStep","simNowMs","wasIntroActive","inputLocked","gameplayDt","movementDt","wantMode","canUse","rechargeScale","pNext","moveDir","sideBankDir","missingWings","wingDrift","elapsedMs","intervalMs","rawDt","cappedDt","frameDt","avgMs","targetMs","over","under","fixedDt","steps","diagLines","wingL","wingR","wingVar","lastWing","lastWingAt","wingAge","hitAge"],"mappings":"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"}